<!DOCTYPE html>
<html dir="ltr" prefix="og: https://ogp.me/ns#" class=" js supports cssanimations flexbox csstransforms csstransforms3d" style="" lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><style>body {transition: opacity ease-in 0.2s; } 
body[unresolved] {opacity: 0; display: block; overflow: hidden; position: relative; } 
</style><style type="text/css">.truste_cursor_pointer {cursor: pointer;}.truste_border_none {border: none;}</style>
    <meta charset="utf-8">
<link rel="canonical" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="shortlink" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<meta property="og:site_name" content="Red Hat Customer Portal">
<meta property="og:type" content="article">
<meta property="og:url" content="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<meta property="og:title" content="Monitoring and managing system status and performance Red Hat Enterprise Linux 9 | Red Hat Customer Portal">
<meta property="og:description" content="Monitor and optimize the throughput, latency, and power consumption of Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9 in different scenarios.">
<meta property="og:image" content="https://access.redhat.com/webassets/avalon/g/shadowman-200.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="Monitor and optimize the throughput, latency, and power consumption of Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9 in different scenarios.">
<meta name="twitter:title" content="Monitoring and managing system status and performance Red Hat Enterprise Linux 9 | Red Hat Customer Portal">
<meta name="twitter:url" content="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<meta name="twitter:image" content="https://access.redhat.com/webassets/avalon/g/shadowman-200.png">
<meta name="title" content="Monitoring and managing system status and performance Red Hat Enterprise Linux 9 | Red Hat Customer Portal">
<link rel="alternate" hreflang="en" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="ko" href="https://access.redhat.com/documentation/ko-kr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="zh-hans" href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="ja" href="https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="es" href="https://access.redhat.com/documentation/es-es/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="ru" href="https://access.redhat.com/documentation/ru-ru/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="pt-br" href="https://access.redhat.com/documentation/pt-br/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="it" href="https://access.redhat.com/documentation/it-it/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="de" href="https://access.redhat.com/documentation/de-de/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="fr" href="https://access.redhat.com/documentation/fr-fr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<link rel="alternate" hreflang="zh-hant" href="https://access.redhat.com/documentation/zh-tw/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index">
<meta name="Generator" content="Drupal 9 (https://www.drupal.org)">
<meta name="MobileOptimized" content="width">
<meta name="HandheldFriendly" content="true">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="revision" product="0ad2e1c5-8cc7-4fb9-8e05-1c2d8c07d005" title="c4f60d42-94bc-4c39-9c6f-6c06620794e7" page="a7281bde-cc68-4bb4-82b7-ba1b12ec5589" revision="90ebb6d24102c002aa312ec5c54de23e6b9a0c8a:en-us" body="64a67b12492f3d02cab418a97e87f3f5.html" toc="6cb26041df1d7d913b90c4ebe7cd863a.json">

    <title>Monitoring and managing system status and performance Red Hat Enterprise Linux 9 | Red Hat Customer Portal</title>
    <link rel="stylesheet" media="all" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/css_87GMcmxT1ib8ziQiU2KUAnTDFtZQV6iP-KGslA9LigM.css">
<link rel="stylesheet" media="all" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/css__Xq4GfgPDJw9K_yYJFmlRZGJeCENu3R3r4s0K7Tr_9g.css">

    
    <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"documentation\/en-us\/red_hat_enterprise_linux\/9\/html-single\/monitoring_and_managing_system_status_and_performance\/index","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","suppressDeprecationErrors":true,"red_hat_jwt":{"client_id":"customer-portal","cookie_name":"rh_jwt","leeway":"0","realm":"redhat-external","sso_host":"https:\/\/sso.redhat.com\/","user_integration":1,"user_plugin":"drupal_user_auth","use_external_js":0,"use_internal_js":0,"use_in_admin":0},"user":{"uid":0,"permissionsHash":"e301988aec96403b7b03860ee81161237ee18c188536caa2bfab8701012b505e"}}</script>
<script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/js_EQWKo9EokWkWS99x_e1oM-NEM0zlKyTkp_83mGdm5Ks.js"></script>

    <!-- CP_PRIMER_HEAD -->  <!-- TrustArc & DTM -->
  <script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/trustarc.js"></script><script type="text/javascript" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/notice" id="truste_0.2847026531795397"></script>
  <script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/dtm.js"></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/AppMeasurement.min.js" async=""></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/AppMeasurement_Module_ActivityMap.min.js" async=""></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/AppMeasurement_Module_AudienceManagement.min.js" async=""></script><script id="mktgJS" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/rh.mktg.js"></script><script>_satellite["_runScript1"](function(event, target, Promise) {
var targetWaitAttempts = 0;

var awaitBody = function(offer){
	//mbox call has returned, ensure <body> exists, then add the mbox DIV
	var docBody  = document.getElementsByTagName("body"),
		int_mbox;
	if(docBody.length){
		int_mbox = document.createElement("div");
		docBody = docBody[0];
		int_mbox.id = "int_mbox";
		int_mbox.classList.add("mboxDefault");
		int_mbox.style.display = "none";
		//place mbox DIV as first tag within BODY
		docBody.insertBefore(int_mbox, docBody.firstChild);
	
		//now that receiving DIV is in place, inject the offer code
		adobe.target.applyOffer({
			"mbox": "int_mbox",
			"selector": "#int_mbox",
			"offer": offer
		});
	
		//and then un-hide the mbox DIV
		int_mbox.style.display = "block";
	}else{
		setTimeout(function(){awaitBody(offer)},100);
	}
}

var awaitTarget = function(){
	if (typeof adobe !== "undefined" && typeof adobe.target !== "undefined" && typeof adobe.target.getOffer !== "undefined") {
		//First get the mbox call going out
		adobe.target.getOffer({
			"mbox": "int_mbox",
			"success": function(offer) {
				awaitBody(offer);
			},
			// Handle errors gracefully
			"error": function(status, error) {}
		});
	}else{
		if(++targetWaitAttempts < 50){
			setTimeout(awaitTarget,100);
		}
	}
}
awaitTarget();
});</script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!--[if IEMobile]><meta http-equiv="cleartype" content="on"><![endif]-->

<!-- metaInclude -->
<meta name="avalon-host-info" content="dxp-kbase-prod-138-57cf79cd99-wkvtp">
<meta name="avalon-version" content="eb0593bd">
<meta name="cp-chrome-build-date" content="2023-09-01T18:06:20.591Z">

<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Chrome, Firefox OS and Opera -->
<meta name="theme-color" content="#000000">
<!-- Windows Phone -->
<meta name="msapplication-navbutton-color" content="#000000">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-status-bar-style" content="#000000">
<link rel="manifest" href="https://access.redhat.com/webassets/avalon/j/manifest.json">
<!-- Open Search - Tap to search -->
<link rel="search" type="application/opensearchdescription+xml" title="Red Hat Customer Portal" href="https://access.redhat.com/webassets/avalon/j/opensearch.xml">
<!-- title -->
<title>Red Hat Customer Portal - Access to 24x7 support and knowledge</title>
<!-- /title -->
<script type="text/javascript">
    window.portal = {
        analytics : {},
        host      : "https://access.redhat.com",
        idp_url   : "https://sso.redhat.com",
        lang      : "en", 
        version   : "eb0593bd",
        builddate : "2023-09-01T18:06:20.591Z",        fetchdate : "2023-09-03T14:30:08-0400",        nrid      : "NOLONGERSUPPORTED",
        nrlk      : "NOLONGERSUPPORTED"
    };
</script>
<script type="text/javascript">
    if (!/\/logout.*/.test(location.pathname) && portal.host === location.origin && document.cookie.indexOf('rh_sso_session') >= 0 && !(document.cookie.indexOf('rh_jwt') >= 0)) window.location = '/login?redirectTo=' + encodeURIComponent(window.location.href);
</script>
<!-- cssInclude -->

<link rel="shortcut icon" href="https://access.redhat.com/webassets/avalon/g/favicon.ico"><link media="all" rel="stylesheet" type="text/css" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/bootstrap.css">
<link media="all" rel="stylesheet" type="text/css" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/bootstrap-grid.css">
<link media="all" rel="stylesheet" type="text/css" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/main.css">



<link href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/chosen.css" rel="stylesheet" type="text/css">

<!--[if lte IE 9]>
<link media="all" rel="stylesheet" type="text/css" href="https://access.redhat.com/chrome_themes/nimbus/css/ie.css" />
<![endif]--><noscript>
    <style type="text/css" media="screen"> .primary-nav { display: block; } </style>
</noscript>
<link media="all" rel="stylesheet" type="text/css" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-navigation--lightdom.min.css">
<!-- /cssInclude -->
<script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/ie-polyfills.js"></script>

<script async="">
  if (!HTMLScriptElement.supports || !HTMLScriptElement.supports('importmap')) {
    import("https://www.redhatstatic.com/dx/v1-alpha/es-module-shims@1.7.3.js");
  }
</script>
<script type="importmap">
{
  "imports": {
    "@patternfly/elements/" : "https://www.redhatstatic.com/dx/v1-alpha/@patternfly/elements@2.2.2/",
    "@rhds/elements/":"https://www.redhatstatic.com/dx/v1-alpha/@rhds/elements@1.1.0/elements/",
    "@rhds/elements/lib/":"https://www.redhatstatic.com/dx/v1-alpha/@rhds/elements@1.1.0/lib/",
    "@cpelements/elements/":"https://www.redhatstatic.com/dx/v1-alpha/@cpelements/elements@2.0.0-alpha.7/elements/"
  }
}
</script><script type="text/javascript" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/require.js" data-main="/webassets/avalon/j/"></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/v1.7-920" async="async" crossorigin="" importance="high"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<script src="https://access.redhat.com/chrome_themes/nimbus/js/ie8.js"></script>
<![endif]-->
<script type="text/javascript" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/new-nav.js"></script>
<!-- /CP_PRIMER_HEAD -->

  <script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/RC89cb5efc622a491caa02ca11adc4672f-source.min.js" async=""></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/RC4291db99e867433ca8496d298dca09cb-source.min.js" async=""></script><link href="data:text/css,%5Bid*%3D'google_ads_iframe'%5D%2C%5Bid*%3D'taboola-'%5D%2C.taboolaHeight%2C.taboola-placeholder%2C%23credential_picker_container%2C%23credentials-picker-container%2C%23credential_picker_iframe%2C%5Bid*%3D'google-one-tap-iframe'%5D%2C%23google-one-tap-popup-container%2C.google-one-tap-modal-div%2C%23amp_floatingAdDiv%2C%23ez-content-blocker-container%2C%23notify-adblock%7Bdisplay%3Anone!important%3Bmin-height%3A0!important%3Bheight%3A0!important%3B%7D" rel="stylesheet" type="text/css"><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/prompt.js"></script><script charset="utf-8" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/12.2158c5447122fa995560.chunk.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="https://access.redhat.com/webassets/avalon/j/lib/require-css/require.css.min.js" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/require.css.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="rhn-modal" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/rhn-modal.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="status-widget" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/status-widget.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="avatars" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/avatars.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="cookie-monster" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/cookie-monster.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="pfe" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="wc" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/wc.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="nimbus/searchbar" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/searchbar.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="webcomponentsjs/custom-elements-es5-adapter" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/custom-elements-es5-adapter.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="webcomponentsjs/webcomponents-bundle" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/webcomponents-bundle.js"></script><link rel="stylesheet" media="all" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/rh-table--lightdom.min.css"><script charset="utf-8" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/7.41dc96447e48575a0cfd.chunk.js"></script><script charset="utf-8" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/1.e4bb9861ae9a0d936559.chunk.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="data-action" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/data-action.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="nimbus/tour" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/tour.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="introjs" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/introjs.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="moment" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/moment.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfe-icon/dist/pfe-icon.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-icon.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfe-cta/dist/pfe-cta.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-cta.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfe-avatar/dist/pfe-avatar.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-avatar.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@cpelements/cp-search-autocomplete/dist/cp-search-autocomplete.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/cp-search-autocomplete.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@cpelements/rh-site-switcher/dist/site-switcher.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/site-switcher.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@cpelements/pfe-navigation/dist/pfe-navigation.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-navigation.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfe-primary-detail/dist/pfe-primary-detail.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-primary-detail.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfelement/dist/pfelement.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfelement.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfe-autocomplete/dist/pfe-autocomplete.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-autocomplete.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfe-button/dist/pfe-button.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-button.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@cpelements/rh-table/dist/rh-table.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/rh-table.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="ieSVGfix" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/ieSVGfix.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@cpelements/rh-account-dropdown/dist/rh-account-dropdown.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/rh-account-dropdown.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="public_modules/@patternfly/pfe-clipboard/dist/pfe-clipboard.umd.min" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pfe-clipboard.umd.min.js"></script><script type="text/javascript" charset="utf-8" async="" data-requirecontext="_" data-requiremodule="prism" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/prism.js"></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/RC1badf0bc400d462b892df3a5874c0bc4-source.min.js" async=""></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/RCb1afac0346e94d81bf645b608336061e-source.min.js" async=""></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/RCa65a5b793a1a4b4abe76ffa69f30f470-source.min.js" async=""></script></head>
  <body class="en loggedOut">
    
      <div class="dialog-off-canvas-main-canvas" data-off-canvas-main-canvas="">
      <!-- CP_PRIMER_HEADER -->
<div id="page-wrap" class="page-wrap">
    <div id="pers-top-page-wrap" class="top-page-wrap pers-loader-bg">

      <div id="hero-bg-top-left" class="summit-bg-shapes"></div>
      <div id="hero-bg-top-right" class="summit-bg-shapes"></div>

        <!--googleoff: all-->
        <header class="masthead" id="masthead">

            <a href="#pfe-navigation" id="global-skip-to-nav" class="skip-link visually-hidden">Skip to navigation</a>
            <a href="#doc-wrapper" class="skip-link visually-hidden">Skip to main content</a>            <nav id="portal-utility-nav" class="utility-navigation utility-navigation--bar hidden-at-mobile" data-analytics-region="utility" aria-labelledby="nav__utility-nav--desktop">
                <h3 id="nav__utility-nav--desktop" class="element-invisible">Utilities
                </h3>
                <ul aria-labelledby="nav__utility-nav--desktop">
                    <li id="nav-subscription" data-portal-tour-1="1">
                        <a class="top-nav-subscriptions" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Subscription" href="https://access.redhat.com/management/">Subscriptions
                        </a>
                    </li>
                    <li id="nav-downloads" data-portal-tour-1="2">
                        <a class="top-nav-downloads" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Downloads" href="https://access.redhat.com/downloads/">Downloads
                        </a>
                    </li>
                    <li id="nav-containers">
                        <a class="top-nav-containers" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Containers" href="https://catalog.redhat.com/software/containers/explore/">Containers
                        </a>
                    </li>
                    <li id="nav-support" data-portal-tour-1="3">
                        <a class="top-nav-support-cases" data-analytics-level="2" data-analytics-category="Utilities" data-analytics-text="Support Cases" href="https://access.redhat.com/support/cases/">Support Cases
                        </a>
                    </li>
                </ul>
            </nav>

            <pfe-navigation id="pfe-navigation" data-analytics-region="mega menu" pfelement="" class="PFElement pfe-navigation--processed pfe-navigation--has-search pfe-navigation--custom-dropdowns--processed" type="combo" has_search="" has_account="" breakpoint="desktop" lang="en">
                <div class="pfe-navigation__logo-wrapper" id="pfe-navigation__logo-wrapper">
                    <a href="https://access.redhat.com/" class="pfe-navigation__logo-link" data-analytics-text="logo" data-analytics-category="MM|logo">
                        <img class="pfe-navigation__logo-image" alt="Red Hat Customer Portal" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/red-hat-customer-portal.svg">
                    </a>
                </div>

                <nav class="pfe-navigation" aria-label="Main Navigation" data-analytics-region="main nav">
                    <ul class="pfe-navigation__menu" id="pfe-navigation__menu">                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-subscription--mobile" data-portal-tour-1="1">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Subscription" href="https://access.redhat.com/management/">Subscriptions
                            </a>
                        </li>
                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-downloads--mobile" data-portal-tour-1="2">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Downloads" href="https://access.redhat.com/downloads/">Downloads
                            </a>
                        </li>
                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-containers--mobile">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Containers" href="https://catalog.redhat.com/software/containers/explore/">Containers
                            </a>
                        </li>
                        <li class="pfe-navigation__menu-item hidden-at-tablet hidden-at-desktop" id="nav-support--mobile" data-portal-tour-1="3">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Support Cases" href="https://access.redhat.com/support/cases/">Support Cases
                            </a>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a href="https://access.redhat.com/products/" class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Products and Services">Products &amp; Services
                            </a>
                            <div class="pfe-navigation__dropdown has-primary-detail">                                <div class="desktop-col-span-2 tablet-col-span-all">
                                    <h3>
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Products" href="https://access.redhat.com/products/">Products
                                        </a>
                                    </h3>
                                    <slot name="main-menu__dropdown--product__product-listing"></slot>
                                </div>                                <div>
                                    <h3 id="nav__products__support">
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Support" href="https://access.redhat.com/support">Support
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__products__support">
                                        <li><a data-analytics-level="3" data-analytics-category="Products and Services|Support" data-analytics-text="Production Support" href="https://access.redhat.com/support/offerings/production/">Production Support
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Support" data-analytics-text="Development Support" href="https://access.redhat.com/support/offerings/developer/">Development Support
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Support" data-analytics-text="Product Life Cycles" href="https://access.redhat.com/product-life-cycles/">Product Life Cycles
                                                    </a></li>
                                    </ul>

                                    <h3 id="nav__products__services">
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Services" href="https://www.redhat.com/en/services">Services
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__products__services">
                                        <li><a data-analytics-level="3" data-analytics-category="Products and Services|Services" data-analytics-text="Consulting" href="https://www.redhat.com/en/services/consulting">Consulting
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Services" data-analytics-text="Technical Account Management" href="https://access.redhat.com/support/offerings/tam/">Technical Account Management
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Services" data-analytics-text="Training and Certifications" href="https://www.redhat.com/en/services/training-and-certification">Training &amp; Certifications
                                                    </a></li>
                                    </ul>
                                </div>                                <div>
                                    <h3 id="nav__products__documentation">
                                        <a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Documentation" href="https://access.redhat.com/documentation">Documentation
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__products__documentation">
                                        <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat Enterprise Linux" href="https://access.redhat.com/documentation/en/red_hat_enterprise_linux">Red Hat Enterprise Linux
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat JBoss Enterprise Application Platform" href="https://access.redhat.com/documentation/en/red_hat_jboss_enterprise_application_platform">Red Hat JBoss Enterprise Application Platform
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat OpenStack Platform" href="https://access.redhat.com/documentation/en/red_hat_openstack_platform">Red Hat OpenStack Platform
                                                    </a></li>
                                                    <li><a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="Red Hat OpenShift Container Platform" href="https://access.redhat.com/documentation/en/openshift_container_platform">Red Hat OpenShift Container Platform
                                                        </a></li>
                                    </ul>
                                    <pfe-cta pfelement="" class="PFElement" has_link="">
                                        <a data-analytics-level="3" data-analytics-category="Products and Services|Documentation" data-analytics-text="All Documentation" data-analytics-linktype="cta" href="https://access.redhat.com/documentation">All Documentation
                                        </a>
                                    </pfe-cta>

                                    <h3 id="nav__products__catalog"><a data-analytics-level="2" data-analytics-category="Products and Services" data-analytics-text="Ecosystem Catalog" href="https://catalog.redhat.com/">Ecosystem Catalog
                                        </a></h3>
                                        <ul aria-labelledby="nav__products__catalog">
                                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Ecosystem Catalog" data-analytics-text="Red Hat Partner Ecosystem" href="https://access.redhat.com/ecosystem/">Red Hat Partner Ecosystem
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Products and Services|Ecosystem Catalog" data-analytics-text="Partner Resources" href="https://access.redhat.com/ecosystem/partner-resources">Partner Resources
                                                    </a></li>
                                        </ul>
                                </div>
                            </div>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Tools" href="https://access.redhat.com/labs/">Tools
                            </a>
                            <div class="pfe-navigation__dropdown pfe-navigation__dropdown--3-column">                                <div>
                                    <h3 id="nav__tools__tools" data-analytics-level="2" data-analytics-text="Tools" data-analytics-category="Tools">Tools
                                    </h3>
                                    <ul aria-labelledby="nav__tools__tools">
                                        <li><a data-analytics-level="3" data-analytics-category="Tools|Tools" data-analytics-text="Solution Engine" href="https://access.redhat.com/support/cases/#/troubleshoot">Troubleshoot a product issue
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Tools|Tools" data-analytics-text="Packages" href="https://access.redhat.com/downloads/content/package-browser">Packages
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Tools|Tools" data-analytics-text="Errata" href="https://access.redhat.com/errata/">Errata
                                                    </a></li>
                                    </ul>
                                </div>                                <div>
                                    <h3 id="nav__tools__labs">
                                        <a data-analytics-level="2" data-analytics-category="Tools" data-analytics-text="Customer Portal Labs" href="https://access.redhat.com/labs/">Customer Portal Labs
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__tools__labs">
                                        <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Configuration" href="https://access.redhat.com/labs/#!?type=config">Configuration
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Deployment" href="https://access.redhat.com/labs/#!?type=deploy">Deployment
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Security" href="https://access.redhat.com/labs/#!?type=security">Security
                                                    </a></li>                                                    <li><a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="Troubleshooting" href="https://access.redhat.com/labs/#!?type=troubleshoot">Troubleshoot
                                                        </a></li>
                                    </ul>
                                    <pfe-cta pfelement="" class="PFElement" has_link="">
                                        <a data-analytics-level="3" data-analytics-category="Tools|Customer Portal Labs" data-analytics-text="All Labs" data-analytics-linktype="cta" href="https://access.redhat.com/labs/">All labs
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h4 id="nav__tools__red-hat-insights">
                                        <a data-analytics-level="2" data-analytics-category="Tools" data-analytics-text="Red Hat Insights" href="https://www.redhat.com/en/technologies/management/insights">Red Hat Insights
                                        </a>
                                    </h4>
                                    <p>Increase visibility into IT operations to detect and resolve technical issues before they impact your business.</p>
                                    <a data-analytics-level="3" data-analytics-category="Tools|Red Hat Insights" data-analytics-text="Learn more" href="https://www.redhat.com/en/technologies/management/insights">Learn More
                                    </a>
                                    <br>
                                    <a data-analytics-level="3" data-analytics-category="Tools|Red Hat Insights" data-analytics-text="Go to Insights" href="https://cloud.redhat.com/insights">Go to Insights
                                    </a>
                                </div>
                            </div>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Security" href="https://access.redhat.com/security/">Security
                            </a>
                            <div class="pfe-navigation__dropdown pfe-navigation__dropdown--3-column">                                <div>
                                    <h3 id="security__security-center">
                                        <a data-analytics-level="2" data-analytics-category="Security" data-analytics-text="Red Hat Product Security Center" href="https://access.redhat.com/security">Red Hat Product Security Center
                                        </a>
                                    </h3>
                                    <p>Engage with our Red Hat Product 
Security team, access security updates, and ensure your environments are
 not exposed to any known security vulnerabilities.
                                    </p>
                                    <pfe-cta pfe-priority="primary" priority="primary" pfelement="" class="PFElement" has_link="">
                                        <a data-analytics-level="3" data-analytics-category="Security|Red Hat Product Security Center" data-analytics-text="Product Security Center" data-analytics-linktype="cta" href="https://access.redhat.com/security/">Product Security Center
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h3 id="nav__security__updates" data-analytics-level="2" data-analytics-text="Security Updates" data-analytics-category="Security">
                                        <a data-analytics-level="2" data-analytics-category="Security" data-analytics-text="Security Updates" href="https://access.redhat.com/security">Security Updates
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__security__updates">
                                        <li><a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="Security Advisories" href="https://access.redhat.com/security/security-updates/#/security-advisories">Security Advisories
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="Red Hat CVE Database" href="https://access.redhat.com/security/security-updates/#/cve">Red Hat CVE Database
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="Security Labs" href="https://access.redhat.com/security/security-updates/#/security-labs">Security Labs
                                                    </a></li>
                                    </ul>
                                    <p class="margin-top-xl">Keep your systems secure with Red Hat's specialized responses to security vulnerabilities.
                                    </p>
                                    <pfe-cta pfelement="" class="PFElement" has_link="">
                                        <a data-analytics-level="3" data-analytics-category="Security|Security Updates" data-analytics-text="View Responses" data-analytics-linktype="cta" href="https://access.redhat.com/security/vulnerability">View Responses
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h3 id="nav__security__resources">
                                        <a data-analytics-level="2" data-analytics-category="Security" data-analytics-text="Resources" href="https://access.redhat.com/security/overview">Resources
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__security__resources">                                            <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Security Blog" href="https://redhat.com/en/blog/channel/security">Security Blog
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Security Measurement" href="https://www.redhat.com/security/data/metrics/">Security Measurement
                                                    </a></li>
                                                    <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Severity Ratings" href="https://access.redhat.com/security/updates/classification/">Severity Ratings
                                                        </a></li>
                                                        <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Backporting Policies" href="https://access.redhat.com/security/updates/backporting/">Backporting Policies
                                                            </a></li>
                                                            <li><a data-analytics-level="3" data-analytics-category="Security|Resources" data-analytics-text="Product Signing (GPG) Keys" href="https://access.redhat.com/security/team/key/">Product Signing (GPG) Keys
                                                                </a></li>
                                    </ul>
                                </div>

                            </div>
                        </li>                        <li class="pfe-navigation__menu-item">
                            <a href="https://access.redhat.com/community/" class="pfe-navigation__menu-link" data-analytics-level="1" data-analytics-text="Community">Community
                            </a>
                            <div class="pfe-navigation__dropdown pfe-navigation__dropdown--3-column">                                <div>
                                    <h3 id="nav__community__cp-community">
                                        <a href="https://access.redhat.com/community" data-analytics-level="2" data-analytics-text="Customer Portal Community" data-analytics-category="Community">Customer Portal Community
                                        </a>
                                    </h3>
                                    <ul aria-labelledby="nav__community__cp-community">
                                        <li><a data-analytics-level="3" data-analytics-category="Community|Customer Portal Community" data-analytics-text="Discussions" href="https://access.redhat.com/discussions">Discussions
                                            </a></li>                                                <li><a data-analytics-level="3" data-analytics-category="Community|Customer Portal Community" data-analytics-text="Private Groups" href="https://access.redhat.com/groups/">Private Groups
                                                    </a></li>
                                    </ul>

                                    <pfe-cta pfe-priority="primary" priority="primary" pfelement="" class="PFElement" has_link="">
                                        <a data-analytics-level="3" data-analytics-category="Community|Customer Portal Community" data-analytics-text="Community Activity" data-analytics-linktype="cta" href="https://access.redhat.com/community/">Community Activity
                                        </a>
                                    </pfe-cta>
                                </div>                                <div>
                                    <h3 id="nav__community__events" data-analytics-level="2" data-analytics-text="Customer Events" data-analytics-category="Community">Customer Events
                                    </h3>
                                    <ul aria-labelledby="nav__community__events">
                                        <li><a data-analytics-level="3" data-analytics-category="Community|Customer Events" data-analytics-text="Red Hat Convergence" href="https://access.redhat.com/convergence/">Red Hat Convergence
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-category="Community|Customer Events" data-analytics-text="Red Hat Summit" href="http://www.redhat.com/summit/">Red Hat Summit
                                                </a></li>
                                    </ul>
                                </div>                                <div>
                                    <h3 id="nav__community__stories" data-analytics-level="2" data-analytics-text="Stories" data-analytics-category="Community">Stories
                                    </h3>
                                    <ul aria-labelledby="nav__community__stories">
                                        <li><a data-analytics-level="3" data-analytics-category="Community|Stories" data-analytics-text="Red Hat Subscription Value" href="https://access.redhat.com/subscription-value/">Red Hat Subscription Value
                                            </a></li>
                                            <li><a data-analytics-level="3" data-analytics-text="You Asked. We Acted." data-analytics-category="Community|Stories" href="https://access.redhat.com/you-asked-we-acted/">You Asked. We Acted.
                                                </a></li>
                                                <li><a data-analytics-level="3" data-analytics-category="Community|Stories" data-analytics-text="Open Source Communities" href="http://www.redhat.com/en/open-source">Open Source Communities
                                                    </a></li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>                </nav>                <div id="site-search" slot="search" class="utility-link site-search">
                    <div class="content">
                        <form class="ng-pristine ng-valid topSearchForm" id="topSearchForm" name="topSearchForm" action="/search/browse/search/" method="get" enctype="application/x-www-form-urlencoded">
                            <cp-search-autocomplete class="push-bottom PFElement" path="/webassets/avalon/j/data.json" num-items="5" placeholder="Enter your search term" pfelement="" type="container"></cp-search-autocomplete>                            <div>Or <a href="https://access.redhat.com/support/cases/#/troubleshoot">troubleshoot an issue</a>.
                            </div>
                        </form>
                    </div>
                </div>


                <div slot="secondary-links" id="localesMenu" class="pfe-navigation__custom-dropdown__wrapper--single-column pfe-navigation__custom-dropdown__wrapper">
                    <button class="pfe-navigation__secondary-link" id="pfe-navigation__secondary-link--English" aria-controls="pfe-navigation__custom-dropdown--English" aria-expanded="false">
                        <pfe-icon icon="web-icon-globe" size="sm" aria-hidden="true" pfelement="" class="PFElement" on="light" type="content"></pfe-icon>English
                    </button>

                    
                <div id="pfe-navigation__custom-dropdown--English" class="pfe-navigation__dropdown-wrapper pfe-navigation__custom-dropdown--single-column pfe-navigation__dropdown-wrapper--invisible" aria-hidden="true" tabindex="-1"><pfe-navigation-dropdown dropdown-width="single" pfelement="" class="PFElement pfe-navigation__dropdown" type="container" data-id-suffix="English">
                        <h2 class="utility-header">Select Your Language
                        </h2>
                        <ul class="reset">
                            <li><a href="https://access.redhat.com/changeLanguage?language=en&amp;redirectTo=https%3A//access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index" data-lang="en" id="en" data-analytics-text="English" class="selected">English</a></li>
                            <li><a href="https://access.redhat.com/changeLanguage?language=ko&amp;redirectTo=https%3A//access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index" data-lang="ko" id="ko" data-analytics-text="Korean">한국어</a></li>
                            <li><a href="https://access.redhat.com/changeLanguage?language=ja&amp;redirectTo=https%3A//access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index" data-lang="ja" id="ja" data-analytics-text="Japanese">日本語</a></li>
                            <li><a href="https://access.redhat.com/changeLanguage?language=zh_CN&amp;redirectTo=https%3A//access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index" data-lang="zh_CN" id="zh_CN" data-analytics-text="Chinese">中文 (中国)</a></li>
                        </ul>

                    </pfe-navigation-dropdown></div></div>                <rh-account-dropdown slot="account" pfelement="" class="PFElement" type="content" login-link="https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/auth?client_id=customer-portal&amp;redirect_uri=https%3A%2F%2Faccess.redhat.com%2Fwebassets%2Favalon%2Fj%2Fincludes%2Fsession%2Fscribe%2F%3FredirectTo%3Dhttps%253A%252F%252Faccess.redhat.com%252Fdocumentation%252Fen-us%252Fred_hat_enterprise_linux%252F9%252Fhtml-single%252Fmonitoring_and_managing_system_status_and_performance%252Findex&amp;state=7f7795d1-dea7-45ad-8163-38cc7b2950cc&amp;nonce=a357b2fb-cf4a-4a42-97fc-a23d22a5c5ee&amp;response_mode=fragment&amp;response_type=code&amp;scope=openid" lang="en"></rh-account-dropdown>                <pfe-primary-detail breakpoint-width="600" class="main-menu__dropdown--product__product-listing PFElement" slot="main-menu__dropdown--product__product-listing" consistent-height="" aria-orientation="vertical" role="tablist" pfelement="" on="&quot;light&quot;" type="container" has_details="" breakpoint="compact">
                    <button role="tab" slot="details-nav" data-was-tag="H3" id="pfe-detail-toggle-u2h64jsve" data-index="0" aria-controls="pfe-detail-wq9wpq4hp" aria-expanded="false">Infrastructure and Management                    </button>
                    <div slot="details" data-index="0" id="pfe-detail-wq9wpq4hp" role="tabpanel" tabindex="-1" aria-labelledby="pfe-detail-toggle-u2h64jsve" data-processed="true" aria-hidden="true" hidden="">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Enterprise Linux" href="https://access.redhat.com/products/red-hat-enterprise-linux/">Red Hat Enterprise Linux
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Satellite" href="https://access.redhat.com/products/red-hat-satellite/">Red Hat Satellite
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Subscription Management" href="https://access.redhat.com/products/red-hat-subscription-management/">Red Hat Subscription Management
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Insights" href="https://access.redhat.com/products/red-hat-insights/">Red Hat Insights
                                </a>
                            </li>
                            <li><a data-analytics-level="3" data-analytics-category="Products and Services|Products:Infrastructure and Management" data-analytics-text="Red Hat Ansible Automation Platform" href="https://access.redhat.com/products/red-hat-ansible-automation-platform/">Red Hat Ansible Automation Platform
                                </a></li>
                        </ul>
                    </div>

                    <button role="tab" slot="details-nav" data-was-tag="H3" id="pfe-detail-toggle-zjmx0536x" data-index="1" aria-controls="pfe-detail-u9udu5pz3" aria-expanded="false">Cloud Computing                    </button>
                    <div slot="details" data-index="1" id="pfe-detail-u9udu5pz3" role="tabpanel" tabindex="-1" aria-labelledby="pfe-detail-toggle-zjmx0536x" data-processed="true" aria-hidden="true" hidden="">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenShift" href="https://access.redhat.com/products/openshift">Red Hat OpenShift
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenStack Platform" href="https://access.redhat.com/products/red-hat-openstack-platform/">Red Hat OpenStack Platform
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing Platform" data-analytics-text="Red Hat OpenShift Container Platform" href="https://access.redhat.com/products/red-hat-openshift-container-platform/">Red Hat OpenShift Container Platform
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing Platform" data-analytics-text="Red Hat OpenShift Data Science" href="https://access.redhat.com/products/red-hat-openshift-data-science/">Red Hat OpenShift Data Science
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenShift Dedicated" href="https://access.redhat.com/products/openshift-dedicated-red-hat/">Red Hat OpenShift Dedicated
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing Platform" data-analytics-text="Red Hat Advanced Cluster Security for Kubernetes" href="https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/">Red Hat Advanced Cluster Security for Kubernetes
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat Advanced Cluster Management for Kubernetes" href="https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/">Red Hat Advanced Cluster Management for Kubernetes
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat Quay" href="https://access.redhat.com/products/red-hat-quay/">Red Hat Quay
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat CodeReady Workspaces" href="https://access.redhat.com/products/red-hat-codeready-workspaces/">OpenShift Dev Spaces
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Cloud Computing" data-analytics-text="Red Hat OpenShift Service on AWS" href="https://access.redhat.com/products/red-hat-openshift-service-aws">Red Hat OpenShift Service on AWS
                                </a>
                            </li>
                        </ul>
                    </div>

                    <button role="tab" slot="details-nav" data-was-tag="H3" id="pfe-detail-toggle-cmabpctj6" data-index="2" aria-controls="pfe-detail-vutiii64z" aria-expanded="false">Storage                    </button>
                    <div slot="details" data-index="2" id="pfe-detail-vutiii64z" role="tabpanel" tabindex="-1" aria-labelledby="pfe-detail-toggle-cmabpctj6" data-processed="true" aria-hidden="true" hidden="">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Gluster Storage" href="https://access.redhat.com/products/red-hat-storage/">Red Hat Gluster Storage
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Hyperconverged Infrastructure" href="https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/">Red Hat Hyperconverged Infrastructure
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Ceph Storage" href="https://access.redhat.com/products/red-hat-ceph-storage/">Red Hat Ceph Storage
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Storage" data-analytics-text="Red Hat Openshift Container Storage" href="https://access.redhat.com/products/red-hat-openshift-data-foundation">Red Hat OpenShift Data Foundation
                                </a>
                            </li>
                        </ul>
                    </div>

                    <button role="tab" slot="details-nav" data-was-tag="H3" id="pfe-detail-toggle-7vcxtlwlx" data-index="3" aria-controls="pfe-detail-yy8kezhr9" aria-expanded="false">Runtimes                    </button>
                    <div slot="details" data-index="3" id="pfe-detail-yy8kezhr9" role="tabpanel" tabindex="-1" aria-labelledby="pfe-detail-toggle-7vcxtlwlx" data-processed="true" aria-hidden="true" hidden="">
                        <ul>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat Runtimes" href="https://access.redhat.com/products/red-hat-runtimes/">Red Hat Runtimes
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat JBoss Enterprise Application Platform" href="https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/">Red Hat JBoss Enterprise Application Platform
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat Data Grid" href="https://access.redhat.com/products/red-hat-data-grid/">Red Hat Data Grid
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat JBoss Web Server" href="https://access.redhat.com/products/red-hat-jboss-web-server/">Red Hat JBoss Web Server
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat Single Sign On" href="https://access.redhat.com/products/red-hat-single-sign-on/">Red Hat Single Sign On
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat support for Spring Boot" href="https://access.redhat.com/products/spring-boot/">Red Hat support for Spring Boot
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat build of Node.js" href="https://access.redhat.com/products/nodejs/">Red Hat build of Node.js
                                </a>
                            </li>                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Runtimes" data-analytics-text="Red Hat build of Quarkus" href="https://access.redhat.com/products/quarkus/">Red Hat build of Quarkus
                                </a>
                            </li>
                        </ul>
                    </div>

                    <button role="tab" slot="details-nav" data-was-tag="H3" id="pfe-detail-toggle-e4a66i8n7" data-index="4" aria-controls="pfe-detail-7f0cboq5b" aria-expanded="false">Integration and Automation                    </button>
                    <div slot="details" data-index="4" id="pfe-detail-7f0cboq5b" role="tabpanel" tabindex="-1" aria-labelledby="pfe-detail-toggle-e4a66i8n7" data-processed="true" aria-hidden="true" hidden="">
                        <ul class="border-bottom" id="portal-menu-border-bottom">
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat Application Foundations" href="https://access.redhat.com/products/red-hat-application-foundations/">Red Hat Application Foundations
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat Fuse" href="https://access.redhat.com/products/red-hat-fuse/">Red Hat Fuse
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat AMQ" href="https://access.redhat.com/products/red-hat-amq/">Red Hat AMQ
                                </a>
                            </li>
                            <li>
                                <a data-analytics-level="3" data-analytics-category="Products and Services|Products:Integration and Automation" data-analytics-text="Red Hat 3scale API Management" href="https://access.redhat.com/products/red-hat-3scale/">Red Hat 3scale API Management
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div slot="details-nav--footer">
                        <pfe-cta pfe-priority="primary" priority="primary" pfelement="" class="PFElement" on="&quot;light&quot;" has_link="">
                            <a href="https://access.redhat.com/products/" class="pfe-navigation__menu-link" data-analytics-level="2" data-analytics-text="All Products" data-analytics-category="Products and Services|Products:" data-analytics-linktype="cta">All Products
                            </a>
                        </pfe-cta>
                    </div>
                </pfe-primary-detail>

            <div slot="secondary-links" class="pfe-navigation__site-switcher pfe-navigation__custom-dropdown__wrapper--full pfe-navigation__custom-dropdown__wrapper" mobile-slider=""><button class="pfe-navigation__secondary-link" id="pfe-navigation__secondary-link--All-Red-Hat" aria-controls="pfe-navigation__custom-dropdown--All-Red-Hat" aria-expanded="false"><pfe-icon icon="web-icon-grid-3x3" size="sm" aria-hidden="true" pfelement="" class="PFElement" on="light" type="content"></pfe-icon>All Red Hat</button> <div id="pfe-navigation__custom-dropdown--All-Red-Hat" class="pfe-navigation__dropdown-wrapper pfe-navigation__custom-dropdown--full pfe-navigation__dropdown-wrapper--invisible" aria-hidden="true" tabindex="-1"><pfe-navigation-dropdown dropdown-width="full" pfelement="" class="PFElement pfe-navigation__dropdown" type="container" data-id-suffix="All-Red-Hat"><div class="pfe-navigation__site-switcher__back-wrapper"><button class="pfe-navigation__site-switcher__back-button" aria-label="Close undefined and return to menu">Back to menu</button></div><site-switcher pfelement="" class="PFElement" type="content" lang="en"><article class="node-355871 node node-page clearfix">


    <div class="field field-name-body field-type-text-with-summary field-label-hidden">
        <div class="field-items">
            <div class="field-item even">
                <!--linking to stylesheets so /cms/ajax/site-switcher will load with styles -->
  <link type="text/css" rel="stylesheet" href="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/site-switcher.css" media="all">
  
  <!-- overriding css variables to get the redhat.com logo box and text to change style indicating you are on this site-->

                <style>
                    :root {
                        --rhdc--logo: var(--rhdc--logo--you-are-here);
                        --rhdc--backgroundColor: var(--background--you-are-here);
                        --rhdc--label: var(--label--you-are-here);
                        --rhdc--margin-top: 0px;
                    }
                </style>

                <section class="site-switcher-tray" data-analytics-region="site-switcher">
                    <div class="content">
                        <div class="container">
                            <section class="site-switcher-container">
                                <ul class="site-switcher-primary-list">
                                    <li class="rhdc">
                                        <a href="https://www.redhat.com/?intcmp=701f20000012k69AAA" data-analytics-category="Websites" data-analytics-text="redhat">
                                            <p class="location-label">You are here</p>
                                            <div class="tntLogo">
                                                <div class="image"></div>
                                            </div>
                                            <h3>Red Hat</h3>
                                            <p>Learn about our open source products, services, and company.</p>
                                        </a>
                                    </li>
                                    <li class="customer-portal">
                                        <a href="https://access.redhat.com/?intcmp=701f20000012k6EAAQ" data-analytics-category="Websites" data-analytics-text="access_redhat">
                                            <p class="location-label">You are here</p>
                                            <div class="tntLogo">
                                                <!-- Customer portal -->
                                                <div class="image"></div>
                                            </div>
                                            <h3>Red Hat Customer Portal</h3>
                                            <p>Get product support and knowledge from the open source experts.</p>
                                        </a>
                                    </li>
                                    <li class="developers">
                                        <a href="https://developers.redhat.com/?intcmp=701f20000012k6JAAQ" data-analytics-category="Websites" data-analytics-text="developers_redhat">
                                            <p class="location-label">You are here</p>
                                            <div class="tntLogo">
                                                <!-- Red Hat Developer -->
                                                <div class="image"></div>
                                            </div>
                                            <h3>Red Hat Developer</h3>
                                            <p>Read developer tutorials and download Red Hat software for cloud
                                                application development.</p>
                                        </a>
                                    </li>
                                    <li class="connect">
                                        <a href="https://connect.redhat.com/" data-analytics-category="Websites" data-analytics-text="connect_redhat">
                                            <p class="location-label">You are here</p>
                                            <div class="tntLogo">
                                                <!-- Red Hat Partner Connect -->
                                                <div class="image"></div>
                                            </div>
                                            <h3>Red Hat Partner Connect</h3>
                                            <p>Become a Red Hat partner and get support in building customer solutions.
                                            </p>
                                        </a>
                                    </li>
                                </ul>
                                <hr>

                                <ul class="site-switcher-secondary-list">
                                    <li>
                                        <h2>Products</h2>
                                        <ul>
                                            <li><a href="https://www.ansible.com/?intcmp=701f20000012k6TAAQ" data-analytics-category="Websites" data-analytics-text="ansible">
                                                    <h3>Ansible.com</h3>
                                                </a>Learn about and try our IT automation product.</li>

                                        </ul>
                                    </li>
                                    <li>
                                        <h2>Try, Buy, Sell</h2>
                                        <ul>
                                            <li><a href="https://cloud.redhat.com/" data-analytics-category="Websites" data-analytics-text="hybrid-cloud">
                                                    <h3>Red Hat Hybrid Cloud</h3>
                                                </a>Access technical how-tos, tutorials, and learning paths focused on
                                                Red Hat’s hybrid cloud managed services.</li>

                                            <li><a href="https://www.redhat.com/store?intcmp=701f20000012k6nAAA" data-analytics-category="Websites" data-analytics-text="store">
                                                    <h3>Red Hat Store</h3>
                                                </a>Buy select Red Hat products and services online.</li>

                                            <li><a href="https://marketplace.redhat.com/" data-analytics-category="Websites" data-analytics-text="marketplace">
                                                    <h3>Red Hat Marketplace</h3>
                                                </a>Try, buy, sell, and manage certified enterprise software for
                                                container-based environments.</li>

                                        </ul>
                                    </li>
                                    <li>
                                        <h2>Community &amp; Open Source</h2>
                                        <ul>
                                            <li><a href="https://enterprisersproject.com/?intcmp=701f20000012k6sAAA" data-analytics-category="Websites" data-analytics-text="enterprisersproject">
                                                    <h3>The Enterprisers Project</h3>
                                                </a>Read analysis and advice articles written by CIOs, for CIOs.</li>
                                            <li><a href="https://opensource.com/?intcmp=701f20000012k6OAAQ" data-analytics-category="Websites" data-analytics-text="opensource">
                                                    <h3>Opensource.com</h3>
                                                </a>Read articles on a range of topics about open source.</li>
                                        </ul>
                                    </li>
                                    <li>
                                        <h2>&nbsp;</h2>
                                        <ul>
                                            <li><a href="https://www.redhat.com/summit?intcmp=701f20000012k6xAAA" data-analytics-category="Websites" data-analytics-text="summit">
                                                    <h3>Red Hat Summit</h3>
                                                </a>Register for and learn about our annual open source IT industry
                                                event.</li>
                                            <li><a href="https://catalog.redhat.com/" data-analytics-category="Websites" data-analytics-text="catalog">
                                                    <h3>Red Hat Ecosystem Catalog</h3>
                                                </a>Find hardware, software, and cloud providers―and download container
                                                images―certified to perform with Red Hat technologies.</li>
                                        </ul>
                                    </li>
                                </ul>
                            </section>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>



</article></site-switcher></pfe-navigation-dropdown></div></div></pfe-navigation>

            <div id="scroll-anchor"></div>

            <!--[if IE 8]>
                <div class="portal-messages">
                <div class="alert alert-warning alert-portal alert-w-icon">
                <span class="icon-warning alert-icon" aria-hidden="true"></span>
                You are using an unsupported web browser. Update to a supported browser for the best experience. <a href="/announcements/2120951">Read the announcement</a>.
                </div>
                </div>
            <![endif]-->
            <!--[if IE 9]>
                <div class="portal-messages">
                <div class="alert alert-warning alert-portal alert-w-icon">
                <span class="icon-warning alert-icon" aria-hidden="true"></span>As of March 1, 2016, the Red Hat Customer Portal will no longer support Internet Explorer 9. See our new <a href="/help/browsers">browser support policy</a> for more information.
                </div>
                </div>
            <![endif]-->
            <div id="site-section"></div>
        <div class="breadcrumbs"><div id="breadcrumbs" class="container"><ul><li><a href="https://access.redhat.com/products/">Products &amp; Services</a></li><li><a href="https://access.redhat.com/documentation">Product Documentation</a></li><li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux">Red&nbsp;Hat Enterprise Linux</a></li><li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9">9</a></li><li><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance">Monitoring and managing system status and performance</a></li><li>Monitoring and managing system status and performance</li></ul></div></div></header>
        <!--googleon: all-->

        <main id="cp-main" class="portal-content-area">
            <div id="cp-content" class="main-content">                            <!-- /CP_PRIMER_HEADER -->

      <div class="container">
        

                                                                                                        <script>breadcrumbs = [["Products & Services","\/products\/"],["Product Documentation","\/documentation"],["Red Hat Enterprise Linux","\/documentation\/en-us\/red_hat_enterprise_linux"],["9","\/documentation\/en-us\/red_hat_enterprise_linux\/9"],["Monitoring and managing system status and performance","\/documentation\/en-us\/red_hat_enterprise_linux\/9\/html\/monitoring_and_managing_system_status_and_performance"],["Monitoring and managing system status and performance","\/documentation\/en-us\/red_hat_enterprise_linux\/9\/html\/monitoring_and_managing_system_status_and_performance\/--single-page-document--"]]</script>

<div data-drupal-messages-fallback="" class="hidden"></div>


    </div>
        <div class="j-chrome-content-container">
        

  

  


  <article class="pvof-doc__content-wrapper__outer">
    <script>
      'use strict';

            var $outerWrapper = document.querySelector('.pvof-doc__content-wrapper__outer');
      if ($outerWrapper && $outerWrapper.closest) {
        var $containerWrapper = $outerWrapper.closest('.container');
        if ($containerWrapper) {
          $containerWrapper.classList.remove('container');
          $containerWrapper.classList.add('j-chrome-content-container');
        }
      }

            var cssRemoved = false;
      try {
        var $crapCss = document.querySelectorAll(
          'link[href*="/chrome_themes/nimbus/css/pages.css"], link[href*="/chrome_themes/nimbus/css/components.css"]'
        );
        if ($crapCss.length) {
          for (let index = 0; index < $crapCss.length; index++) {
            const $stylesheet = $crapCss[index];
            $stylesheet.remove();
          }
        }
        cssRemoved = true;
      }
      catch (error) {
        console.error('Ran into an issue while trying to retheme page', error);
        cssRemoved = false;
      }

            if (cssRemoved) {
        var $pvofOuterWrapper = document.querySelector('.pvof-doc__content-wrapper__outer--css-not-removed');
        if ($pvofOuterWrapper) {
          $pvofOuterWrapper.classList.remove('pvof-doc__content-wrapper__outer--css-not-removed');
        }
      }
    </script>
    <div itemscope="" itemtype="https://schema.org/TechArticle" itemref="techArticle-md1 techArticle-md2 techArticle-md3"></div>
    <div itemscope="" itemtype="https://schema.org/SoftwareApplication" itemref="softwareApplication-md1 softwareApplication-md2 softwareApplication-md3 softwareApplication-md4"></div>
    <div class="pvof-doc__content-wrapper pvof-doc__content-wrapper--has-sidebar">
                                <div class="pvof-doc__content-wrapper__inner j-superdoc j-superdoc--has-nav j-reading-mode-initialized">
                            <div class="pvof-sidebar__wrapper j-doc-nav j-superdoc__nav">
            <div class="j-sidebar__menu-container j-sidebar__menu-container--processed">
              <button class="j-sidebar__menu-trigger content-expander__trigger content-expander__trigger--processed" aria-expanded="true" aria-controls="content-expander-rfpfty6">
                <span class="j-sidebar__menu-trigger__open-text">Jump To</span>
                <span class="j-sidebar__menu-trigger__close-text">Close</span>
              </button>

              <div class="pvof-sidebar__inner-wrapper j-doc-nav__wrapper content-expander content-expander--processed" id="content-expander-rfpfty6" open="">
                <div class="j-sidebar__menu-details-container">
                  <button class="j-sidebar__menu-details-button j-sidebar__menu-details-button--expand">
                    Expand all
                  </button>
                  <button class="j-sidebar__menu-details-button j-sidebar__menu-details-button--collapse">
                    Collapse all
                  </button>
                </div>
                

  <nav id="pvof-doc__toc" class="pvof-doc__toc">
  <h2 class="j-doc-nav__title" id="j-doc-nav__title">
    Table of contents
  </h2>
  <div class="pvof-doc__toc-inner">
              <ol class="j-doc-nav__list" aria-labelledby="j-doc-nav__title">
                  <li class="j-doc-nav__list-item">
                                    

    <a href="#doc-wrapper" class="j-doc-nav__link is-active">
    Monitoring and managing system status and performance
  </a>
  
          </li>
                  <li class="j-doc-nav__list-item">
                                    

    <a href="#making-open-source-more-inclusive" class="j-doc-nav__link ">
    Making open source more inclusive
  </a>
  
          </li>
                  <li class="j-doc-nav__list-item">
                                    

    <a href="#proc_providing-feedback-on-red-hat-documentation_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link ">
    Providing feedback on Red Hat documentation
  </a>
  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#getting-started-with-tuned_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    1. Getting started with TuneD
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-yda0qty">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "1. Getting started with TuneD"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "1. Getting started with TuneD"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-yda0qty" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-tuned_getting-started-with-tuned" class="j-doc-nav__link ">
    1.1. The purpose of TuneD
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuned-profiles_getting-started-with-tuned" class="j-doc-nav__link ">
    1.2. TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-default-tuned-profile_getting-started-with-tuned" class="j-doc-nav__link ">
    1.3. The default TuneD profile
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#merged-tuned-profiles_getting-started-with-tuned" class="j-doc-nav__link ">
    1.4. Merged TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-location-of-tuned-profiles_getting-started-with-tuned" class="j-doc-nav__link ">
    1.5. The location of TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuned-profiles-distributed-with-rhel_getting-started-with-tuned" class="j-doc-nav__link ">
    1.6. TuneD profiles distributed with RHEL
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuned-cpu-partitioning-profile_getting-started-with-tuned" class="j-doc-nav__link ">
    1.7. TuneD cpu-partitioning profile
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-the-tuned-cpu-partitioning-profile-for-low-latency-tuning_getting-started-with-tuned" class="j-doc-nav__link ">
    1.8. Using the TuneD cpu-partitioning profile for low-latency tuning
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#customizing-the-cpu-partitioning-tuned-profile_getting-started-with-tuned" class="j-doc-nav__link ">
    1.9. Customizing the cpu-partitioning TuneD profile
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#real-time-tuned-profiles-distributed-with-rhel_getting-started-with-tuned" class="j-doc-nav__link ">
    1.10. Real-time TuneD profiles distributed with RHEL
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#static-and-dynamic-tuning-in-tuned_getting-started-with-tuned" class="j-doc-nav__link ">
    1.11. Static and dynamic tuning in TuneD
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuned-no-daemon-mode_getting-started-with-tuned" class="j-doc-nav__link ">
    1.12. TuneD no-daemon mode
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-and-enabling-tuned_getting-started-with-tuned" class="j-doc-nav__link ">
    1.13. Installing and enabling TuneD
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#listing-available-tuned-profiles_getting-started-with-tuned" class="j-doc-nav__link ">
    1.14. Listing available TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-a-tuned-profile_getting-started-with-tuned" class="j-doc-nav__link ">
    1.15. Setting a TuneD profile
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#disabling-tuned_getting-started-with-tuned" class="j-doc-nav__link ">
    1.16. Disabling TuneD
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    2. Customizing TuneD profiles
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-skvk16k">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "2. Customizing TuneD profiles"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "2. Customizing TuneD profiles"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-skvk16k" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.1. TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-default-tuned-profile_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.2. The default TuneD profile
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#merged-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.3. Merged TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-location-of-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.4. The location of TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#inheritance-between-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.5. Inheritance between TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#static-and-dynamic-tuning-in-tuned_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.6. Static and dynamic tuning in TuneD
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuned-plug-ins_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.7. TuneD plug-ins
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#available-tuned-plug-ins_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.8. Available TuneD plug-ins
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#functionalities-of-the-scheduler-tuned-plug-in_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.9. Functionalities of the scheduler TuneD plugin
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#variables-in-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.10. Variables in TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#built-in-functions-in-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.11. Built-in functions in TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#built-in-functions-available-in-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.12. Built-in functions available in TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#creating-new-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.13. Creating new TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#modifying-existing-tuned-profiles_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.14. Modifying existing TuneD profiles
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-the-disk-scheduler-using-tuned_customizing-tuned-profiles" class="j-doc-nav__link ">
    2.15. Setting the disk scheduler using TuneD
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    3. Reviewing a system using tuna interface
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-xnl939g">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "3. Reviewing a system using tuna interface"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "3. Reviewing a system using tuna interface"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-xnl939g" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-tuna-tool_reviewing-a-system-using-tuna-interface" class="j-doc-nav__link ">
    3.1. Installing tuna tool
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#viewing-the-system-status-using-tuna-tool_reviewing-a-system-using-tuna-interface" class="j-doc-nav__link ">
    3.2. Viewing the system status using tuna tool
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuning-cpus-using-tuna-tool_reviewing-a-system-using-tuna-interface" class="j-doc-nav__link ">
    3.3. Tuning CPUs using tuna tool
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuning-irqs-using-tuna-tool_reviewing-a-system-using-tuna-interface" class="j-doc-nav__link ">
    3.4. Tuning IRQs using tuna tool
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#monitoring-performance-using-rhel-system-roles_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    4. Monitoring performance using RHEL&nbsp;System&nbsp;Roles
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-j06nydj">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "4. Monitoring performance using RHEL&nbsp;System&nbsp;Roles"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "4. Monitoring performance using RHEL&nbsp;System&nbsp;Roles"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-j06nydj" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles_monitoring-performance-using-rhel-system-roles" class="j-doc-nav__link j-doc-nav__link--has-children">
    4.1. Preparing a control node and managed nodes to use RHEL&nbsp;System&nbsp;Roles
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-7wmt04d">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "4.1. Preparing a control node and managed nodes to use RHEL&nbsp;System&nbsp;Roles"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "4.1. Preparing a control node and managed nodes to use RHEL&nbsp;System&nbsp;Roles"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-7wmt04d" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_preparing-a-control-node_assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles" class="j-doc-nav__link ">
    4.1.1. Preparing a control node on RHEL 9
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_preparing-a-managed-node_assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles" class="j-doc-nav__link ">
    4.1.2. Preparing a managed node
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#introduction-to-the-metrics-role_monitoring-performance-using-rhel-system-roles" class="j-doc-nav__link ">
    4.2. Introduction to the metrics System Role
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-the-metrics-role-to-monitor-your-local-system-with-visualization_monitoring-performance-using-rhel-system-roles" class="j-doc-nav__link ">
    4.3. Using the metrics System Role to monitor your local system with visualization
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-the-metrics-role-to-monitor-a-fleet-of-machines-remotely_monitoring-performance-using-rhel-system-roles" class="j-doc-nav__link ">
    4.4. Using the metrics System Role to set up a fleet of individual systems to monitor themselves
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-the-metrics-role-to-monitor-a-fleet-of-machines-centrally-via-your-local-machine_monitoring-performance-using-rhel-system-roles" class="j-doc-nav__link ">
    4.5. Using the metrics System Role to monitor a fleet of machines centrally via your local machine
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-up-authentication-while-monitoring-a-system-using-the-metrics-system-role_monitoring-performance-using-rhel-system-roles" class="j-doc-nav__link ">
    4.6. Setting up authentication while monitoring a system using the metrics System Role
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-the-metrics-system-role-to-configure-and-enable-metrics-collection-for-sql-server_monitoring-performance-using-rhel-system-roles" class="j-doc-nav__link ">
    4.7. Using the metrics System Role to configure and enable metrics collection for SQL Server
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#setting-up-pcp_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    5. Setting up PCP
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-dhuv16l">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "5. Setting up PCP"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "5. Setting up PCP"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-dhuv16l" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#overview-of-pcp_setting-up-pcp" class="j-doc-nav__link ">
    5.1. Overview of PCP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-and-enabling-pcp_setting-up-pcp" class="j-doc-nav__link ">
    5.2. Installing and enabling PCP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#deploying-a-minimal-pcp-setup_setting-up-pcp" class="j-doc-nav__link ">
    5.3. Deploying a minimal PCP setup
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#system-services-distributed-with-pcp_setting-up-pcp" class="j-doc-nav__link ">
    5.4. System services distributed with PCP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tools-distributed-with-pcp_setting-up-pcp" class="j-doc-nav__link ">
    5.5. Tools distributed with PCP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#pcp-deployment-architectures_setting-up-pcp" class="j-doc-nav__link ">
    5.6. PCP deployment architectures
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#recommended-deployment-architecture_setting-up-pcp" class="j-doc-nav__link ">
    5.7. Recommended deployment architecture
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#sizing-factors_setting-up-pcp" class="j-doc-nav__link ">
    5.8. Sizing factors
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuration-options-for-pcp-scaling_setting-up-pcp" class="j-doc-nav__link ">
    5.9. Configuration options for PCP scaling
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#example-analyzing-the-centralized-logging-deployment_setting-up-pcp" class="j-doc-nav__link ">
    5.10. Example: Analyzing the centralized logging deployment
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#example-analyzing-the-federated-setup-deployment_setting-up-pcp" class="j-doc-nav__link ">
    5.11. Example: Analyzing the federated setup deployment
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#establishing-secure-pcp-connections_setting-up-pcp" class="j-doc-nav__link j-doc-nav__link--has-children">
    5.12. Establishing secure PCP connections
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-wuuisws">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "5.12. Establishing secure PCP connections"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "5.12. Establishing secure PCP connections"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-wuuisws" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#secure-pcp-connections_establishing-secure-pcp-connections" class="j-doc-nav__link ">
    5.12.1. Secure PCP connections
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-secure-connections-for-pcp-collector-components_establishing-secure-pcp-connections" class="j-doc-nav__link ">
    5.12.2. Configuring secure connections for PCP collector components
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-secure-connections-for-pcp-monitoring-components_establishing-secure-pcp-connections" class="j-doc-nav__link ">
    5.12.3. Configuring secure connections for PCP monitoring components
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#troubleshooting-high-memory-usage_setting-up-pcp" class="j-doc-nav__link ">
    5.13. Troubleshooting high memory usage
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    6. Logging performance data with pmlogger
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-qkr5tvf">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "6. Logging performance data with pmlogger"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "6. Logging performance data with pmlogger"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-qkr5tvf" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#modifying-the-pmlogger-configuration-file-with-pmlogconf_logging-performance-data-with-pmlogger" class="j-doc-nav__link ">
    6.1. Modifying the pmlogger configuration file with pmlogconf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#editing-the-pmlogger-configuration-file-manually_logging-performance-data-with-pmlogger" class="j-doc-nav__link ">
    6.2. Editing the pmlogger configuration file manually
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#enabling-the-pmlogger-service_logging-performance-data-with-pmlogger" class="j-doc-nav__link ">
    6.3. Enabling the pmlogger service
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-up-a-client-system-for-metrics-collection_logging-performance-data-with-pmlogger" class="j-doc-nav__link ">
    6.4. Setting up a client system for metrics collection
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-up-the-central-server-to-collect-data_logging-performance-data-with-pmlogger" class="j-doc-nav__link ">
    6.5. Setting up a central server to collect data
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#replaying-the-pcp-log-archives_logging-performance-data-with-pmlogger" class="j-doc-nav__link ">
    6.6. Replaying the PCP log archives with pmrep
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#enabling-pcp-version-3-archives_logging-performance-data-with-pmlogger" class="j-doc-nav__link ">
    6.7. Enabling PCP version 3 archives
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#monitoring-performance-with-performance-co-pilot_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    7. Monitoring performance with Performance Co-Pilot
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-te8cbca">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "7. Monitoring performance with Performance Co-Pilot"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "7. Monitoring performance with Performance Co-Pilot"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-te8cbca" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#monitoring-postfix-with-pmda-postfix_monitoring-performance-with-performance-co-pilot" class="j-doc-nav__link ">
    7.1. Monitoring postfix with pmda-postfix
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#visually-tracing-pcp-log-archives-with-pcp-charts_monitoring-performance-with-performance-co-pilot" class="j-doc-nav__link ">
    7.2. Visually tracing PCP log archives with the PCP Charts application
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#collecting-data-from-sql-server-using-pcp_monitoring-performance-with-performance-co-pilot" class="j-doc-nav__link ">
    7.3. Collecting data from SQL server using PCP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_generating-pcp-archives-from-sadc-archives_monitoring-performance-with-performance-co-pilot" class="j-doc-nav__link ">
    7.4. Generating PCP archives from sadc archives
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    8. Performance analysis of XFS with PCP
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-mpoh8jw">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "8. Performance analysis of XFS with PCP"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "8. Performance analysis of XFS with PCP"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-mpoh8jw" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-xfs-pmda-manually_performance-analysis-of-xfs-with-pcp" class="j-doc-nav__link ">
    8.1. Installing XFS PMDA manually
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#examining-xfs-performance-metrics-with-pminfo_performance-analysis-of-xfs-with-pcp" class="j-doc-nav__link ">
    8.2. Examining XFS performance metrics with pminfo
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#resetting-xfs-performance-metrics-with-pmstore_performance-analysis-of-xfs-with-pcp" class="j-doc-nav__link ">
    8.3. Resetting XFS performance metrics with pmstore
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#pcp-metric-groups-for-xfs_performance-analysis-of-xfs-with-pcp" class="j-doc-nav__link ">
    8.4. PCP metric groups for XFS
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#per-device-pcp-metric-groups-for-xfs_performance-analysis-of-xfs-with-pcp" class="j-doc-nav__link ">
    8.5. Per-device PCP metric groups for XFS
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    9. Setting up graphical representation of PCP metrics
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-0evhixr">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "9. Setting up graphical representation of PCP metrics"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "9. Setting up graphical representation of PCP metrics"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-0evhixr" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.1. Setting up PCP with pcp-zeroconf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.2. Setting up a grafana-server
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#accessing-the-grafana-web-ui_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.3. Accessing the Grafana web UI
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-secure-connections-for-grafana_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.4. Configuring secure connections for Grafana
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-pcp-redis_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.5. Configuring PCP Redis
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-secure-connections-for-pcp-redis_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.6. Configuring secure connections for PCP redis
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#creating-panel-and-alerts-in-pcp-redis-data-source_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.7. Creating panels and alert in PCP Redis data source
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#adding-notification-channels-for-alerts_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.8. Adding notification channels for alerts
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-up-authentication-between-pcp-components_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.9. Setting up authentication between PCP components
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-pcp-bpftrace_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.10. Installing PCP bpftrace
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#viewing-the-pcp-bpftrace-system-analysis-dashboard_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.11. Viewing the PCP bpftrace System Analysis dashboard
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-pcp-vector_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.12. Installing PCP Vector
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#viewing-the-pcp-vector-checklist_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.13. Viewing the PCP Vector Checklist
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#troubleshooting-grafana-issues_setting-up-graphical-representation-of-pcp-metrics" class="j-doc-nav__link ">
    9.14. Troubleshooting Grafana issues
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#using-the-web-console-for-selecting-performance-profiles_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    10. Optimizing the system performance using the web console
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-b5p7sn8">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "10. Optimizing the system performance using the web console"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "10. Optimizing the system performance using the web console"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-b5p7sn8" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#performance-tuning-options-in-the-web-console_optimizing-the-system-performance-using-the-web-console" class="j-doc-nav__link ">
    10.1. Performance tuning options in the web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-a-performance-profile-in-the-web-console_optimizing-the-system-performance-using-the-web-console" class="j-doc-nav__link ">
    10.2. Setting a performance profile in the web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#monitoring-performance-using-the-web-console_optimizing-the-system-performance-using-the-web-console" class="j-doc-nav__link ">
    10.3. Monitoring performance on the local system using the web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_enabling-performance-metrics-export-with-pcp-from-the-web-console_optimizing-the-system-performance-using-the-web-console" class="j-doc-nav__link ">
    10.4. Monitoring performance on several systems using the web console and Grafana
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    11. Setting the disk scheduler
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-8rqhmak">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "11. Setting the disk scheduler"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "11. Setting the disk scheduler"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-8rqhmak" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#available-disk-schedulers_setting-the-disk-scheduler" class="j-doc-nav__link ">
    11.1. Available disk schedulers
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#different-disk-schedulers-for-different-use-cases_setting-the-disk-scheduler" class="j-doc-nav__link ">
    11.2. Different disk schedulers for different use cases
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-default-disk-scheduler_setting-the-disk-scheduler" class="j-doc-nav__link ">
    11.3. The default disk scheduler
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#determining-the-active-disk-scheduler_setting-the-disk-scheduler" class="j-doc-nav__link ">
    11.4. Determining the active disk scheduler
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-the-disk-scheduler-using-tuned_setting-the-disk-scheduler" class="j-doc-nav__link ">
    11.5. Setting the disk scheduler using TuneD
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-the-disk-scheduler-using-udev-rules_setting-the-disk-scheduler" class="j-doc-nav__link ">
    11.6. Setting the disk scheduler using udev rules
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#temporarily-setting-a-scheduler-for-a-specific-disk_setting-the-disk-scheduler" class="j-doc-nav__link ">
    11.7. Temporarily setting a scheduler for a specific disk
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#assembly_tuning-the-performance-of-a-samba-server_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    12. Tuning the performance of a Samba server
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-ujc4d7b">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "12. Tuning the performance of a Samba server"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "12. Tuning the performance of a Samba server"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-ujc4d7b" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_setting-the-smb-protocol-version_assembly_tuning-the-performance-of-a-samba-server" class="j-doc-nav__link ">
    12.1. Setting the SMB protocol version
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_tuning-shares-with-directories-that-contain-a-large-number-of-files_assembly_tuning-the-performance-of-a-samba-server" class="j-doc-nav__link ">
    12.2. Tuning shares with directories that contain a large number of files
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_settings-that-can-have-a-negative-performance-impact_assembly_tuning-the-performance-of-a-samba-server" class="j-doc-nav__link ">
    12.3. Settings that can have a negative performance impact
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#optimizing-virtual-machine-performance-in-rhel_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    13. Optimizing virtual machine performance
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-3oo33xg">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "13. Optimizing virtual machine performance"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "13. Optimizing virtual machine performance"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-3oo33xg" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#what-influences-virtual-machine-performance_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link ">
    13.1. What influences virtual machine performance
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#optimizing-virtual-machine-performance-using-tuned_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link ">
    13.2. Optimizing virtual machine performance using TuneD
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#assembly_optimizing-libvirt-daemons_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link j-doc-nav__link--has-children">
    13.3. Optimizing libvirt daemons
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-kp974bq">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "13.3. Optimizing libvirt daemons"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "13.3. Optimizing libvirt daemons"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-kp974bq" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_types-of-libvirt-daemons_assembly_optimizing-libvirt-daemons" class="j-doc-nav__link ">
    13.3.1. Types of libvirt daemons
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_enabling-modular-libvirt-daemons_assembly_optimizing-libvirt-daemons" class="j-doc-nav__link ">
    13.3.2. Enabling modular libvirt daemons
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#configuring-virtual-machine-ram_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link j-doc-nav__link--has-children">
    13.4. Configuring virtual machine memory
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-krdxl7k">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "13.4. Configuring virtual machine memory"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "13.4. Configuring virtual machine memory"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-krdxl7k" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#adding-and-removing-virtual-machine-ram-using-the-web-console_configuring-virtual-machine-ram" class="j-doc-nav__link ">
    13.4.1. Adding and removing virtual machine memory using the web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#adding-and-removing-virtual-machine-ram-using-the-command-line-interface_configuring-virtual-machine-ram" class="j-doc-nav__link ">
    13.4.2. Adding and removing virtual machine memory using the command-line interface
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#additional_resources" class="j-doc-nav__link ">
    13.4.3. Additional resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#optimizing-virtual-machine-i-o-performance_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link j-doc-nav__link--has-children">
    13.5. Optimizing virtual machine I/O performance
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-8px93uu">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "13.5. Optimizing virtual machine I/O performance"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "13.5. Optimizing virtual machine I/O performance"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-8px93uu" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuning-block-i-o-in-virtual-machines_optimizing-virtual-machine-i-o-performance" class="j-doc-nav__link ">
    13.5.1. Tuning block I/O in virtual machines
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#disk-i-o-throttling-in-virtual-machines_optimizing-virtual-machine-i-o-performance" class="j-doc-nav__link ">
    13.5.2. Disk I/O throttling in virtual machines
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-multi-queue-virtio-scsi_optimizing-virtual-machine-i-o-performance" class="j-doc-nav__link ">
    13.5.3. Enabling multi-queue virtio-scsi
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#optimizing-virtual-machine-cpu-performance_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link j-doc-nav__link--has-children">
    13.6. Optimizing virtual machine CPU performance
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-lq0nb1e">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "13.6. Optimizing virtual machine CPU performance"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "13.6. Optimizing virtual machine CPU performance"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-lq0nb1e" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#adding-and-removing-virtual-cpus-using-the-command-line-interface_optimizing-virtual-machine-cpu-performance" class="j-doc-nav__link ">
    13.6.1. Adding and removing virtual CPUs using the command-line interface
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#managing-virtual-cpus-using-the-web-console_optimizing-virtual-machine-cpu-performance" class="j-doc-nav__link ">
    13.6.2. Managing virtual CPUs using the web console
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-numa-in-a-virtual-machine_optimizing-virtual-machine-cpu-performance" class="j-doc-nav__link ">
    13.6.3. Configuring NUMA in a virtual machine
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#sample-vcpu-performance-tuning-scenario_optimizing-virtual-machine-cpu-performance" class="j-doc-nav__link ">
    13.6.4. Sample vCPU performance tuning scenario
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_managing-ksm_optimizing-virtual-machine-cpu-performance" class="j-doc-nav__link ">
    13.6.5. Managing kernel same-page merging
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#optimizing-virtual-machine-network-performance_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link ">
    13.7. Optimizing virtual machine network performance
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#virtual-machine-performance-monitoring-tools_optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link ">
    13.8. Virtual machine performance monitoring tools
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#related-information-optimizing-virtual-machine-performance-in-rhel" class="j-doc-nav__link ">
    13.9. Additional resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#importance-of-power-management_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    14. Importance of power management
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-6o8kjx2">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "14. Importance of power management"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "14. Importance of power management"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-6o8kjx2" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#power-management-basics_importance-of-power-management" class="j-doc-nav__link ">
    14.1. Power management basics
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#audit-and-analysis-overview_importance-of-power-management" class="j-doc-nav__link ">
    14.2. Audit and analysis overview
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tools-for-auditing_importance-of-power-management" class="j-doc-nav__link ">
    14.3. Tools for auditing
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#managing-power-consumption-with-powertop_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    15. Managing power consumption with PowerTOP
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-novgret">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "15. Managing power consumption with PowerTOP"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "15. Managing power consumption with PowerTOP"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-novgret" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-powertop_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.1. The purpose of PowerTOP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#using-powertop_managing-power-consumption-with-powertop" class="j-doc-nav__link j-doc-nav__link--has-children">
    15.2. Using PowerTOP
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-fa8rhb3">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "15.2. Using PowerTOP"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "15.2. Using PowerTOP"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-fa8rhb3" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#starting-powertop_using-powertop" class="j-doc-nav__link ">
    15.2.1. Starting PowerTOP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#calibrating-powertop_using-powertop" class="j-doc-nav__link ">
    15.2.2. Calibrating PowerTOP
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-the-measuring-interval_using-powertop" class="j-doc-nav__link ">
    15.2.3. Setting the measuring interval
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#related-information-using-powertop" class="j-doc-nav__link ">
    15.2.4. Additional resources
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#powertop-statistics_managing-power-consumption-with-powertop" class="j-doc-nav__link j-doc-nav__link--has-children">
    15.3. PowerTOP statistics
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-auvcpuv">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "15.3. PowerTOP statistics"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "15.3. PowerTOP statistics"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-auvcpuv" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#overview-tab_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.3.1. The Overview tab
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#idle-stats-tab_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.3.2. The Idle stats tab
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#device-stats-tab_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.3.3. The Device stats tab
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tunables-tab_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.3.4. The Tunables tab
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#wakeup-tab_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.3.5. The WakeUp tab
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_why-powertop-does-not-display-frequency-stats-values-in-some-instances_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.4. Why Powertop does not display Frequency stats values in some instances
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#generating-an-html-output_managing-power-consumption-with-powertop" class="j-doc-nav__link ">
    15.5. Generating an HTML output
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#optimizing-power-consumption_managing-power-consumption-with-powertop" class="j-doc-nav__link j-doc-nav__link--has-children">
    15.6. Optimizing power consumption
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-92yf5yh">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "15.6. Optimizing power consumption"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "15.6. Optimizing power consumption"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-92yf5yh" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#optimizing-power-consumption-using-the-powertop-service_optimizing-power-consumption" class="j-doc-nav__link ">
    15.6.1. Optimizing power consumption using the powertop service
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#powertop2tuned-utility_optimizing-power-consumption" class="j-doc-nav__link ">
    15.6.2. The powertop2tuned utility
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#optimizing-power-consumption-with-powertop2tuned_optimizing-power-consumption" class="j-doc-nav__link ">
    15.6.3. Optimizing power consumption using the powertop2tuned utility
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_comparison-of-powertop-service-and-powertop2tuned_optimizing-power-consumption" class="j-doc-nav__link ">
    15.6.4. Comparison of powertop.service and powertop2tuned
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#getting-started-with-perf_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    16. Getting started with perf
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-ku3o5v3">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "16. Getting started with perf"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "16. Getting started with perf"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-ku3o5v3" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#introduction-to-perf_getting-started-with-perf" class="j-doc-nav__link ">
    16.1. Introduction to perf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-perf_getting-started-with-perf" class="j-doc-nav__link ">
    16.2. Installing perf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#common-perf-commands_getting-started-with-perf" class="j-doc-nav__link ">
    16.3. Common perf commands
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#profiling-cpu-usage-in-real-time-with-top_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    17. Profiling CPU usage in real time with perf top
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-wwarfee">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "17. Profiling CPU usage in real time with perf top"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "17. Profiling CPU usage in real time with perf top"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-wwarfee" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-perf-top_profiling-cpu-usage-in-real-time-with-top" class="j-doc-nav__link ">
    17.1. The purpose of perf top
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#profiling-cpu-usage-with-perf-top_profiling-cpu-usage-in-real-time-with-top" class="j-doc-nav__link ">
    17.2. Profiling CPU usage with perf top
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#interpretation-of-perf-top-output_profiling-cpu-usage-in-real-time-with-top" class="j-doc-nav__link ">
    17.3. Interpretation of perf top output
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#why-perf-displays-some-function-names-as-raw-function-addresses_profiling-cpu-usage-in-real-time-with-top" class="j-doc-nav__link ">
    17.4. Why perf displays some function names as raw function addresses
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#enabling-debug-and-source-repositories_profiling-cpu-usage-in-real-time-with-top" class="j-doc-nav__link ">
    17.5. Enabling debug and source repositories
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#getting-debuginfo-packages-for-an-application-or-library-using-gdb_profiling-cpu-usage-in-real-time-with-top" class="j-doc-nav__link ">
    17.6. Getting debuginfo packages for an application or library using GDB
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#counting-events-during-process-execution-with-perf-stat_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    18. Counting events during process execution with perf stat
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-uw8vy51">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "18. Counting events during process execution with perf stat"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "18. Counting events during process execution with perf stat"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-uw8vy51" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-perf-stat_counting-events-during-process-execution-with-perf-stat" class="j-doc-nav__link ">
    18.1. The purpose of perf stat
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#counting-events-with-perf-stat_counting-events-during-process-execution-with-perf-stat" class="j-doc-nav__link ">
    18.2. Counting events with perf stat
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#interpretation-of-perf-stat-output_counting-events-during-process-execution-with-perf-stat" class="j-doc-nav__link ">
    18.3. Interpretation of perf stat output
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#attaching-perf-stat-to-a-running-process_counting-events-during-process-execution-with-perf-stat" class="j-doc-nav__link ">
    18.4. Attaching perf stat to a running process
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#recording-and-analyzing-performance-profiles-with-perf_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    19. Recording and analyzing performance profiles with perf
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-e2vchua">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "19. Recording and analyzing performance profiles with perf"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "19. Recording and analyzing performance profiles with perf"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-e2vchua" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-perf-record_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.1. The purpose of perf record
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#recording-a-performance-profile-without-root-access_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.2. Recording a performance profile without root access
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#recording-a-performance-profile-with-root-access_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.3. Recording a performance profile with root access
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#recording-a-performance-profile-in-per-cpu-mode_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.4. Recording a performance profile in per-CPU mode
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#capturing-call-graph-data-with-perf-record_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.5. Capturing call graph data with perf record
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#analyzing-perf-data-with-perf-report_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.6. Analyzing perf.data with perf report
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#interpretation-of-perf-report-output_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.7. Interpretation of perf report output
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#generating-a-perf-data-file-that-is-readable-on-a-different-device_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.8. Generating a perf.data file that is readable on a different device
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#analyzing-a-perf-data-file-that-was-created-on-a-different-device_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.9. Analyzing a perf.data file that was created on a different device
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#why-perf-displays-some-function-names-as-raw-function-addresses_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.10. Why perf displays some function names as raw function addresses
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#enabling-debug-and-source-repositories_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.11. Enabling debug and source repositories
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#getting-debuginfo-packages-for-an-application-or-library-using-gdb_recording-and-analyzing-performance-profiles-with-perf" class="j-doc-nav__link ">
    19.12. Getting debuginfo packages for an application or library using GDB
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#investigating-busy-cpus-with-perf_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    20. Investigating busy CPUs with perf
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-r77etkr">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "20. Investigating busy CPUs with perf"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "20. Investigating busy CPUs with perf"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-r77etkr" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#displaying-which-cpu-events-were-counted-on-with-perf-stat_investigating-busy-cpus-with-perf" class="j-doc-nav__link ">
    20.1. Displaying which CPU events were counted on with perf stat
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#displaying-which-cpu-samples-were-taken-on-with-perf-report_investigating-busy-cpus-with-perf" class="j-doc-nav__link ">
    20.2. Displaying which CPU samples were taken on with perf report
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#displaying-specific-cpus-during-profiling-with-perf-top_investigating-busy-cpus-with-perf" class="j-doc-nav__link ">
    20.3. Displaying specific CPUs during profiling with perf top
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#monitoring-specific-cpus-with-perf-record-and-perf-report_investigating-busy-cpus-with-perf" class="j-doc-nav__link ">
    20.4. Monitoring specific CPUs with perf record and perf report
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#monitoring-application-performance-with-perf_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    21. Monitoring application performance with perf
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-f4bm95i">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "21. Monitoring application performance with perf"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "21. Monitoring application performance with perf"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-f4bm95i" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#attaching-perf-record-to-a-running-process_monitoring-application-performance-with-perf" class="j-doc-nav__link ">
    21.1. Attaching perf record to a running process
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#capturing-call-graph-data-with-perf-record_monitoring-application-performance-with-perf" class="j-doc-nav__link ">
    21.2. Capturing call graph data with perf record
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#analyzing-perf-data-with-perf-report_monitoring-application-performance-with-perf" class="j-doc-nav__link ">
    21.3. Analyzing perf.data with perf report
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#creating-uprobes-with-perf_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    22. Creating uprobes with perf
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-8d67ugp">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "22. Creating uprobes with perf"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "22. Creating uprobes with perf"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-8d67ugp" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_creating-uprobes-at-the-fucntion-level-with-perf_assembly_creating-uprobes-with-perf" class="j-doc-nav__link ">
    22.1. Creating uprobes at the function level with perf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_creating-uprobes-on-lines-within-a-function-with-perf_assembly_creating-uprobes-with-perf" class="j-doc-nav__link ">
    22.2. Creating uprobes on lines within a function with perf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#ref_perf-script-output-of-a-perf-data-file-generated-over-uprobes_assembly_creating-uprobes-with-perf" class="j-doc-nav__link ">
    22.3. Perf script output of data recorded over uprobes
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#profiling-memory-accesses-with-perf-mem_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    23. Profiling memory accesses with perf mem
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-tlwl9p1">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "23. Profiling memory accesses with perf mem"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "23. Profiling memory accesses with perf mem"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-tlwl9p1" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-perf-mem_profiling-memory-accesses-with-perf-mem" class="j-doc-nav__link ">
    23.1. The purpose of perf mem
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#sampling-memory-access-with-perf-mem_profiling-memory-accesses-with-perf-mem" class="j-doc-nav__link ">
    23.2. Sampling memory access with perf mem
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#interpretation-of-perf-mem-report-output_profiling-memory-accesses-with-perf-mem" class="j-doc-nav__link ">
    23.3. Interpretation of perf mem report output
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#detecting-false-sharing_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    24. Detecting false sharing
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-myxewcj">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "24. Detecting false sharing"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "24. Detecting false sharing"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-myxewcj" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-perf-c2c_detecting-false-sharing" class="j-doc-nav__link ">
    24.1. The purpose of perf c2c
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#detecting-cache-line-contention-with-perf-c2c_detecting-false-sharing" class="j-doc-nav__link ">
    24.2. Detecting cache-line contention with perf c2c
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#visualizing-a-perf-data-file-recorded-with-perf-c2c-record_detecting-false-sharing" class="j-doc-nav__link ">
    24.3. Visualizing a perf.data file recorded with perf c2c record
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#interpretation-of-perf-c2c-report-output_detecting-false-sharing" class="j-doc-nav__link ">
    24.4. Interpretation of perf c2c report output
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#detecting-false-sharing-with-perf-c2c_detecting-false-sharing" class="j-doc-nav__link ">
    24.5. Detecting false sharing with perf c2c
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#getting-started-with-flamegraphs_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    25. Getting started with flamegraphs
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-uiriueh">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "25. Getting started with flamegraphs"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "25. Getting started with flamegraphs"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-uiriueh" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-flamegraphs_getting-started-with-flamegraphs" class="j-doc-nav__link ">
    25.1. Installing flamegraphs
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#creating-flamegraphs-over-the-entire-system_getting-started-with-flamegraphs" class="j-doc-nav__link ">
    25.2. Creating flamegraphs over the entire system
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#creating-flamegraphs-over-specific-processes_getting-started-with-flamegraphs" class="j-doc-nav__link ">
    25.3. Creating flamegraphs over specific processes
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#interpreting-flamegraphs_getting-started-with-flamegraphs" class="j-doc-nav__link ">
    25.4. Interpreting flamegraphs
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#creating-custom-circular-buffers-to-collect-specific-data-with-perf_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    26. Monitoring processes for performance bottlenecks using perf circular buffers
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-fdh2mmy">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "26. Monitoring processes for performance bottlenecks using perf circular buffers"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "26. Monitoring processes for performance bottlenecks using perf circular buffers"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-fdh2mmy" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#circular-buffers-and-event-specific-snapshots_assembly_creating-custom-circular-buffers-to-collect-specific-data-with-perf" class="j-doc-nav__link ">
    26.1. Circular buffers and event-specific snapshots with perf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-perf-to-create-custom-circular-buffers-that-perform-event-specific-snapshots_assembly_creating-custom-circular-buffers-to-collect-specific-data-with-perf" class="j-doc-nav__link ">
    26.2. Collecting specific data to monitor for performance bottlenecks using perf circular buffers
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#turning-tracepoints-on-and-off-without-stopping-or-restarting-perf_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    27. Adding and removing tracepoints from a running perf collector without stopping or restarting perf
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-tvlmkz2">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "27. Adding and removing tracepoints from a running perf collector without stopping or restarting perf"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "27. Adding and removing tracepoints from a 
running perf collector without stopping or restarting perf"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-tvlmkz2" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#adding-tracepoints-to-a-running-perf-collector-without-stopping-or-restarting-perf_turning-tracepoints-on-and-off-without-stopping-or-restarting-perf" class="j-doc-nav__link ">
    27.1. Adding tracepoints to a running perf collector without stopping or restarting perf
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#removing-tracepoints-from-a-running-perf-collector-without-stopping-or-restarting-perf_turning-tracepoints-on-and-off-without-stopping-or-restarting-perf" class="j-doc-nav__link ">
    27.2. Removing tracepoints from a running perf collector without stopping or restarting perf
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#profiling-memory-allocation-with-numastat_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    28. Profiling memory allocation with numastat
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-e2cfkrs">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "28. Profiling memory allocation with numastat"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "28. Profiling memory allocation with numastat"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-e2cfkrs" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#default-numastat-statistics_profiling-memory-allocation-with-numastat" class="j-doc-nav__link ">
    28.1. Default numastat statistics
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#viewing-memory-allocation-with-numastat_profiling-memory-allocation-with-numastat" class="j-doc-nav__link ">
    28.2. Viewing memory allocation with numastat
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#configuring-an-operating-system-to-optimize-cpu-utilization_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    29. Configuring an operating system to optimize CPU utilization
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-3xayf3f">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "29. Configuring an operating system to optimize CPU utilization"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "29. Configuring an operating system to optimize CPU utilization"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-3xayf3f" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tools-for-monitoring-and-diagnosing-processor-issues_configuring-an-operating-system-to-optimize-cpu-utilization" class="j-doc-nav__link ">
    29.1. Tools for monitoring and diagnosing processor issues
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#types-of-system-topology_configuring-an-operating-system-to-optimize-cpu-utilization" class="j-doc-nav__link j-doc-nav__link--has-children">
    29.2. Types of system topology
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-s7cxomx">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "29.2. Types of system topology"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "29.2. Types of system topology"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-s7cxomx" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#displaying-system-topologies_configuring-an-operating-system-to-optimize-cpu-utilization" class="j-doc-nav__link ">
    29.2.1. Displaying system topologies
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-kernel-tick-time_configuring-an-operating-system-to-optimize-cpu-utilization" class="j-doc-nav__link ">
    29.3. Configuring kernel tick time
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#overview-of-an-interrupt-request_configuring-an-operating-system-to-optimize-cpu-utilization" class="j-doc-nav__link j-doc-nav__link--has-children">
    29.4. Overview of an interrupt request
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-245yevb">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "29.4. Overview of an interrupt request"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "29.4. Overview of an interrupt request"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-245yevb" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#balancing-interrupts-manually_configuring-an-operating-system-to-optimize-cpu-utilization" class="j-doc-nav__link ">
    29.4.1. Balancing interrupts manually
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-the-smp_affinity-mask_configuring-an-operating-system-to-optimize-cpu-utilization" class="j-doc-nav__link ">
    29.4.2. Setting the smp_affinity mask
  </a>
  
          </li>
              </ol>

  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#tuning-scheduling-policy_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    30. Tuning scheduling policy
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-r73zsok">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "30. Tuning scheduling policy"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "30. Tuning scheduling policy"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-r73zsok" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_categories-of-scheduling-policies_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.1. Categories of scheduling policies
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#static-priority-scheduling-with-SCHED_FIFO_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.2. Static priority scheduling with SCHED_FIFO
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#round-robin-priority-scheduling-with-sched_rr_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.3. Round robin priority scheduling with SCHED_RR
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#normal-scheduling-with-sched_other_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.4. Normal scheduling with SCHED_OTHER
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-scheduler-policies_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.5. Setting scheduler policies
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#policy-options-for-the-chrt-command_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.6. Policy options for the chrt command
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#changing-the-priority-of-service-during-the-boot-process_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.7. Changing the priority of services during the boot process
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#priority-map_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.8. Priority map
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuned-cpu-partitioning-profile_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.9. TuneD cpu-partitioning profile
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-the-tuned-cpu-partitioning-profile-for-low-latency-tuning_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.10. Using the TuneD cpu-partitioning profile for low-latency tuning
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#customizing-the-cpu-partitioning-tuned-profile_tuning-scheduling-policy" class="j-doc-nav__link ">
    30.11. Customizing the cpu-partitioning TuneD profile
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#tuning-the-network-performance_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31. Tuning the network performance
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-afbor4b">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31. Tuning the network performance"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31. Tuning the network performance"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-afbor4b" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#tuning-network-adapter-settings_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.1. Tuning network adapter settings
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-l38d9fo">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.1. Tuning network adapter settings"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.1. Tuning network adapter settings"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-l38d9fo" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#increasing-the-ring-buffers-to-reduce-a-high-packet-drop-rate_tuning-network-adapter-settings" class="j-doc-nav__link ">
    31.1.1. Increasing the ring buffers to reduce a high packet drop rate
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuning-the-network-device-backlog-queue-to-avoid-packet-drops_tuning-network-adapter-settings" class="j-doc-nav__link ">
    31.1.2. Tuning the network device backlog queue to avoid packet drops
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#increasing-the-transmit-queue-length-of-a-nic-to-reduce-the-number-of-transmit-errors_tuning-network-adapter-settings" class="j-doc-nav__link ">
    31.1.3. Increasing the transmit queue length of a NIC to reduce the number of transmit errors
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#tuning-irq-balancing_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.2. Tuning IRQ balancing
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-nbwmaz7">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.2. Tuning IRQ balancing"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.2. Tuning IRQ balancing"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-nbwmaz7" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#interrupts-and-interrupt-handlers_tuning-irq-balancing" class="j-doc-nav__link ">
    31.2.1. Interrupts and interrupt handlers
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#software-interrupt-requests_tuning-irq-balancing" class="j-doc-nav__link ">
    31.2.2. Software interrupt requests
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#napi-polling_tuning-irq-balancing" class="j-doc-nav__link ">
    31.2.3. NAPI Polling
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-irqbalance-service_tuning-irq-balancing" class="j-doc-nav__link ">
    31.2.4. The irqbalance service
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#increasing-the-time-softirqs-can-run-on-the-cpu_tuning-irq-balancing" class="j-doc-nav__link ">
    31.2.5. Increasing the time SoftIRQs can run on the CPU
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#improving-the-network-latency_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.3. Improving the network latency
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-hf8q2x6">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.3. Improving the network latency"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.3. Improving the network latency"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-hf8q2x6" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#how-the-cpu-power-states-influence-the-network-latency_improving-the-network-latency" class="j-doc-nav__link ">
    31.3.1. How the CPU power states influence the network latency
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#c-state-settings-in-the-efi-firmware_improving-the-network-latency" class="j-doc-nav__link ">
    31.3.2. C-state settings in the EFI firmware
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#disabling-c-states-by-using-a-custom-tuned-profile_improving-the-network-latency" class="j-doc-nav__link ">
    31.3.3. Disabling C-states by using a custom TuneD profile
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#disabling-c-states-by-using-a-kernel-command-line-option_improving-the-network-latency" class="j-doc-nav__link ">
    31.3.4. Disabling C-states by using a kernel command line option
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#improving-the-throughput-of-large-amounts-of-contiguous-data-streams_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.4. Improving the throughput of large amounts of contiguous data streams
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-wyq1fww">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.4. Improving the throughput of large amounts of contiguous data streams"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.4. Improving the throughput of large amounts of contiguous data streams"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-wyq1fww" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#considerations-before-configuring-jumbo-frames_improving-the-throughput-of-large-amounts-of-contiguous-data-streams" class="j-doc-nav__link ">
    31.4.1. Considerations before configuring jumbo frames
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-the-mtu-in-an-existing-networkmanager-connection-profile_improving-the-throughput-of-large-amounts-of-contiguous-data-streams" class="j-doc-nav__link ">
    31.4.2. Configuring the MTU in an existing NetworkManager connection profile
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#tuning-tcp-connections-for-high-throughput_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.5. Tuning TCP connections for high throughput
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-jwylfbz">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.5. Tuning TCP connections for high throughput"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.5. Tuning TCP connections for high throughput"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-jwylfbz" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#testing-the-tcp-throughput-using-iperf3_tuning-tcp-connections-for-high-throughput" class="j-doc-nav__link ">
    31.5.1. Testing the TCP throughput using iperf3
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-system-wide-tcp-socket-buffer-settings_tuning-tcp-connections-for-high-throughput" class="j-doc-nav__link ">
    31.5.2. The system-wide TCP socket buffer settings
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#increasing-the-system-wide-tcp-socket-buffers_tuning-tcp-connections-for-high-throughput" class="j-doc-nav__link ">
    31.5.3. Increasing the system-wide TCP socket buffers
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tcp-window-scaling_tuning-tcp-connections-for-high-throughput" class="j-doc-nav__link ">
    31.5.4. TCP Window Scaling
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#how-tcp-sack-reduces-the-packet-drop-rate_tuning-tcp-connections-for-high-throughput" class="j-doc-nav__link ">
    31.5.5. How TCP SACK reduces the packet drop rate
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#tuning-udp-connections_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.6. Tuning UDP connections
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-r87upgo">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.6. Tuning UDP connections"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.6. Tuning UDP connections"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-r87upgo" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#detecting-packet-drops_tuning-udp-connections" class="j-doc-nav__link ">
    31.6.1. Detecting packet drops
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#testing-the-udp-throughput-using-iperf3_tuning-udp-connections" class="j-doc-nav__link ">
    31.6.2. Testing the UDP throughput using iperf3
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#impact-of-the-mtu-size-on-udp-traffic-throughput_tuning-udp-connections" class="j-doc-nav__link ">
    31.6.3. Impact of the MTU size on UDP traffic throughput
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#impact-of-the-cpu-speed-on-udp-traffic-throughput_tuning-udp-connections" class="j-doc-nav__link ">
    31.6.4. Impact of the CPU speed on UDP traffic throughput
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#increasing-the-system-wide-udp-socket-buffers_tuning-udp-connections" class="j-doc-nav__link ">
    31.6.5. Increasing the system-wide UDP socket buffers
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#identifying-application-read-socket-buffer-bottlenecks_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.7. Identifying application read socket buffer bottlenecks
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-kfddp5r">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.7. Identifying application read socket buffer bottlenecks"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.7. Identifying application read socket buffer bottlenecks"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-kfddp5r" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#identifying-receive-buffer-collapsing-and-pruning_identifying-application-read-socket-buffer-bottlenecks" class="j-doc-nav__link ">
    31.7.1. Identifying receive buffer collapsing and pruning
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#tuning-applications-with-a-large-number-of-incoming-requests_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.8. Tuning applications with a large number of incoming requests
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-bsdp9nc">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.8. Tuning applications with a large number of incoming requests"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.8. Tuning applications with a large number of incoming requests"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-bsdp9nc" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tuning-the-tcp-listen-backlog-to-process-a-high-number-of-tcp-connection-attempts_tuning-applications-with-a-large-number-of-incoming-requests" class="j-doc-nav__link ">
    31.8.1. Tuning the TCP listen backlog to process a high number of TCP connection attempts
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#avoiding-listen-queue-lock-contention_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.9. Avoiding listen queue lock contention
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-oo01fln">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.9. Avoiding listen queue lock contention"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.9. Avoiding listen queue lock contention"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-oo01fln" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#avoiding-rx-queue-lock-contention-the-so_reuseport-and-so_reuseport_bpf-socket-options_avoiding-listen-queue-lock-contention" class="j-doc-nav__link ">
    31.9.1. Avoiding RX queue lock contention: The SO_REUSEPORT and SO_REUSEPORT_BPF socket options
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#avoiding-tx-queue-lock-contention-transmit-packet-steering_avoiding-listen-queue-lock-contention" class="j-doc-nav__link ">
    31.9.2. Avoiding TX queue lock contention: Transmit packet steering
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#disabling-the-generic-receive-offload-feature-on-servers-with-high-udp-traffic_avoiding-listen-queue-lock-contention" class="j-doc-nav__link ">
    31.9.3. Disabling the Generic Receive Offload feature on servers with high UDP traffic
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#tuning-the-device-driver-and-nic_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.10. Tuning the device driver and NIC
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-1or29e0">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.10. Tuning the device driver and NIC"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.10. Tuning the device driver and NIC"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-1or29e0" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-custom-nic-driver-parameters_tuning-the-device-driver-and-nic" class="j-doc-nav__link ">
    31.10.1. Configuring custom NIC driver parameters
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#configuring-network-adapter-offload-settings_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.11. Configuring network adapter offload settings
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-flednb7">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.11. Configuring network adapter offload settings"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.11. Configuring network adapter offload settings"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-flednb7" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#temporarily-setting-an-offload-feature_configuring-network-adapter-offload-settings" class="j-doc-nav__link ">
    31.11.1. Temporarily setting an offload feature
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#permanently-setting-an-offload-feature_configuring-network-adapter-offload-settings" class="j-doc-nav__link ">
    31.11.2. Permanently setting an offload feature
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                          

    <a href="#tuning-interrupt-coalescence-settings_tuning-the-network-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    31.12. Tuning interrupt coalescence settings
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-3fi9ris">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "31.12. Tuning interrupt coalescence settings"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "31.12. Tuning interrupt coalescence settings"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-3fi9ris" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#optimizing-rhel-for-latency-or-throughput-sensitive-services_tuning-interrupt-coalescence-settings" class="j-doc-nav__link ">
    31.12.1. Optimizing RHEL for latency or throughput-sensitive services
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#benefits-of-tcp-timestamps_tuning-the-network-performance" class="j-doc-nav__link ">
    31.13. Benefits of TCP Timestamps
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#ref_flow-control-in-ethernet-networks_tuning-the-network-performance" class="j-doc-nav__link ">
    31.14. Flow control for Ethernet networks
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#factors-affecting-i-o-and-file-system-performance_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    32. Factors affecting I/O and file system performance
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-aubbnjw">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "32. Factors affecting I/O and file system performance"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "32. Factors affecting I/O and file system performance"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-aubbnjw" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tools-for-monitoring-and-diagnosing-i-o-and-file-system-issues_factors-affecting-i-o-and-file-system-performance" class="j-doc-nav__link ">
    32.1. Tools for monitoring and diagnosing I/O and file system issues
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#available-tuning-options-for-formatting-a-file-system_factors-affecting-i-o-and-file-system-performance" class="j-doc-nav__link ">
    32.2. Available tuning options for formatting a file system
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#available-tuning-options-for-mounting-a-file-system_factors-affecting-i-o-and-file-system-performance" class="j-doc-nav__link ">
    32.3. Available tuning options for mounting a file system
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#types-of-discarding-unused-blocks_factors-affecting-i-o-and-file-system-performance" class="j-doc-nav__link ">
    32.4. Types of discarding unused blocks
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#solid-state-disks-tuning-considerations_factors-affecting-i-o-and-file-system-performance" class="j-doc-nav__link ">
    32.5. Solid-state disks tuning considerations
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#generic-block-device-tuning-parameters_factors-affecting-i-o-and-file-system-performance" class="j-doc-nav__link ">
    32.6. Generic block device tuning parameters
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#assembly_using-systemd-to-manage-resources-used-by-applications_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    33. Using systemd to manage resources used by applications
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-lf8slqr">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "33. Using systemd to manage resources used by applications"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "33. Using systemd to manage resources used by applications"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-lf8slqr" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_allocating-system-resources-using-systemd_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.1. Allocating system resources using systemd
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_role-of-systemd-in-resource-management_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.2. Role of systemd in resource management
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_overview-of-systemd-hierarchy-for-cgroups_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.3. Overview of systemd hierarchy for cgroups
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#listing-systemd_units_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.4. Listing systemd units
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#viewing-systemd-control-group-hierarchy_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.5. Viewing systemd control group hierarchy
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_viewing-cgroups-of-processes_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.6. Viewing cgroups of processes
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#monitoring-resource-consumption_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.7. Monitoring resource consumption
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_using-systemd-unit-files-to-set-limits-for-applications_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.8. Using systemd unit files to set limits for applications
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_using-systemctl-command-to-set-limits-to-applications_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.9. Using systemctl command to set limits to applications
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_setting-global-default-cpu-affinity-through-manager-configuration_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.10. Setting global default CPU affinity through manager configuration
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_configuring-numa-using-systemd_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.11. Configuring NUMA policies using systemd
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#ref_numa-policy-configuration-options-with-systemd_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.12. NUMA policy configuration options for systemd
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#creating-transient-control-groups_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.13. Creating transient cgroups using systemd-run command
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#removing-transient-control-groups_assembly_using-systemd-to-manage-resources-used-by-applications" class="j-doc-nav__link ">
    33.14. Removing transient control groups
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#setting-limits-for-applications_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    34. Understanding cgroups
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-n5z0y6g">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "34. Understanding cgroups"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "34. Understanding cgroups"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-n5z0y6g" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#understanding-control-groups_setting-limits-for-applications" class="j-doc-nav__link ">
    34.1. Understanding control groups
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#what-kernel-resource-controllers-are_setting-limits-for-applications" class="j-doc-nav__link ">
    34.2. What are kernel resource controllers
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#what-namespaces-are_setting-limits-for-applications" class="j-doc-nav__link ">
    34.3. What are namespaces
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#assembly_improving-system-performance-with-zswap_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    35. Improving system performance with zswap
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-i2kfdv7">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "35. Improving system performance with zswap"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "35. Improving system performance with zswap"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-i2kfdv7" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#con_what-is-zswap_assembly_improving-system-performance-with-zswap" class="j-doc-nav__link ">
    35.1. What is zswap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_enabling-zswap-at-runtime_assembly_improving-system-performance-with-zswap" class="j-doc-nav__link ">
    35.2. Enabling zswap at runtime
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_enabling-zswap-permanently_assembly_improving-system-performance-with-zswap" class="j-doc-nav__link ">
    35.3. Enabling zswap permanently
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#assembly_using-cgroupfs-to-manually-manage-cgroups_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    36. Using cgroupfs to manually manage cgroups
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-bwdmzef">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "36. Using cgroupfs to manually manage cgroups"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "36. Using cgroupfs to manually manage cgroups"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-bwdmzef" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_creating-cgroups-and-enabling-controllers-in-cgroups-v2-file-system_assembly_using-cgroupfs-to-manually-manage-cgroups" class="j-doc-nav__link ">
    36.1. Creating cgroups and enabling controllers in cgroups-v2 file system
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_controlling-distribution-of-cpu-time-for-applications-by-adjusting-cpu-weight_assembly_using-cgroupfs-to-manually-manage-cgroups" class="j-doc-nav__link ">
    36.2. Controlling distribution of CPU time for applications by adjusting CPU weight
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_mounting-cgroups-v1_assembly_using-cgroupfs-to-manually-manage-cgroups" class="j-doc-nav__link ">
    36.3. Mounting cgroups-v1
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-cpu-limits-to-applications-using-cgroups-v1_assembly_using-cgroupfs-to-manually-manage-cgroups" class="j-doc-nav__link ">
    36.4. Setting CPU limits to applications using cgroups-v1
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#analyzing-system-performance-with-bpf-compiler_collection_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    37. Analyzing system performance with BPF Compiler Collection
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-zeytioy">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "37. Analyzing system performance with BPF Compiler Collection"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "37. Analyzing system performance with BPF Compiler Collection"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-zeytioy" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-the-bcc-tools-package_analyzing-system-performance-with-bpf-compiler_collection" class="j-doc-nav__link ">
    37.1. Installing the bcc-tools package
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#using-selected-bcc-tools-for-performance-analyses_analyzing-system-performance-with-bpf-compiler_collection" class="j-doc-nav__link ">
    37.2. Using selected bcc-tools for performance analyses
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#configuring-an-operating-system-to-optimize-memory-access_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    38. Configuring an operating system to optimize memory access
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-khcj2t5">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "38. Configuring an operating system to optimize memory access"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "38. Configuring an operating system to optimize memory access"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-khcj2t5" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tools-for-monitoring-and-diagnosing-system-memory-issues_configuring-an-operating-system-to-optimize-memory-access" class="j-doc-nav__link ">
    38.1. Tools for monitoring and diagnosing system memory issues
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#overview-of-a-systems-memory_configuring-an-operating-system-to-optimize-memory-access" class="j-doc-nav__link ">
    38.2. Overview of a system’s memory
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#virtual-memory-parameters_configuring-an-operating-system-to-optimize-memory-access" class="j-doc-nav__link ">
    38.3. Virtual memory parameters
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#file-system-parameters_configuring-an-operating-system-to-optimize-memory-access" class="j-doc-nav__link ">
    38.4. File system parameters
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#kernel-parameters_configuring-an-operating-system-to-optimize-memory-access" class="j-doc-nav__link ">
    38.5. Kernel parameters
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#setting-memory-related-kernel-parameters_configuring-an-operating-system-to-optimize-memory-access" class="j-doc-nav__link ">
    38.6. Setting memory-related kernel parameters
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#configuring-huge-pages_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    39. Configuring huge pages
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-11yviqj">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "39. Configuring huge pages"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "39. Configuring huge pages"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-11yviqj" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#available-hugepage-features_configuring-huge-pages" class="j-doc-nav__link ">
    39.1. Available huge page features
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#parameters-for-reserving-hugetlb-pages-at-boot-time_configuring-huge-pages" class="j-doc-nav__link ">
    39.2. Parameters for reserving HugeTLB pages at boot time
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-hugetlb-at-boot-time_configuring-huge-pages" class="j-doc-nav__link ">
    39.3. Configuring HugeTLB at boot time
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#parameters-for-reserving-hugetlb-pages-at-run-time_configuring-huge-pages" class="j-doc-nav__link ">
    39.4. Parameters for reserving HugeTLB pages at run time
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#configuring-hugetlb-at-run-time_configuring-huge-pages" class="j-doc-nav__link ">
    39.5. Configuring HugeTLB at run time
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#enabling-transparent-hugepages_configuring-huge-pages" class="j-doc-nav__link ">
    39.6. Enabling transparent hugepages
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#disabling-transparent-hugepages_configuring-huge-pages" class="j-doc-nav__link ">
    39.7. Disabling transparent hugepages
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#impact-of-page-size-on-translation-lookaside-buffer-size_configuring-huge-pages" class="j-doc-nav__link ">
    39.8. Impact of page size on translation lookaside buffer size
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    40. Getting started with SystemTap
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-2vpaj74">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "40. Getting started with SystemTap"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "40. Getting started with SystemTap"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-2vpaj74" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#the-purpose-of-systemtap_getting-started-with-systemtap" class="j-doc-nav__link ">
    40.1. The purpose of SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#installing-systemtap_getting-started-with-systemtap" class="j-doc-nav__link ">
    40.2. Installing SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#privileges-to-run-systemtap_getting-started-with-systemtap" class="j-doc-nav__link ">
    40.3. Privileges to run SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#running-systemtap-scripts_getting-started-with-systemtap" class="j-doc-nav__link ">
    40.4. Running SystemTap scripts
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#cross-instrumentation-of-systemtap_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    41. Cross-instrumentation of SystemTap
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-wr3ls7u">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "41. Cross-instrumentation of SystemTap"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "41. Cross-instrumentation of SystemTap"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-wr3ls7u" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#systemtap-cross-instrumentation_cross-instrumentation-of-systemtap" class="j-doc-nav__link ">
    41.1. SystemTap cross-instrumentation
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#initializing-cross-instrumentation-of-systemtap_cross-instrumentation-of-systemtap" class="j-doc-nav__link ">
    41.2. Initializing cross-instrumentation of SystemTap
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#monitoring-network-activity-with-systemtap_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    42. Monitoring network activity with SystemTap
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-32tcgfg">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "42. Monitoring network activity with SystemTap"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "42. Monitoring network activity with SystemTap"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-32tcgfg" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#profiling-network-activity-with-systemtap_assembly_monitoring-network-activity-with-systemtap" class="j-doc-nav__link ">
    42.1. Profiling network activity with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#tracing-functions-called-in-network-socket-code-with-systemtap_assembly_monitoring-network-activity-with-systemtap" class="j-doc-nav__link ">
    42.2. Tracing functions called in network socket code with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_monitoring-network-packet-drops-with-systemtap_assembly_monitoring-network-activity-with-systemtap" class="j-doc-nav__link ">
    42.3. Monitoring network packet drops with SystemTap
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#assembly_profiling-kernel-activity-with-systemtap_monitoring-and-managing-system-status-and-performance" class="j-doc-nav__link j-doc-nav__link--has-children">
    43. Profiling kernel activity with SystemTap
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-h4dwngi">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "43. Profiling kernel activity with SystemTap"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "43. Profiling kernel activity with SystemTap"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-h4dwngi" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_counting-function-calls-with-systemtap_assembly_profiling-kernel-activity-with-systemtap" class="j-doc-nav__link ">
    43.1. Counting function calls with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_tracing-function-calls-with-systemtap_assembly_profiling-kernel-activity-with-systemtap" class="j-doc-nav__link ">
    43.2. Tracing function calls with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_determining-time-spent-in-kernel-and-user-space-with-systemtap_assembly_profiling-kernel-activity-with-systemtap" class="j-doc-nav__link ">
    43.3. Determining time spent in kernel and user space with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_monitoring-polling-applications-with-systemtap_assembly_profiling-kernel-activity-with-systemtap" class="j-doc-nav__link ">
    43.4. Monitoring polling applications with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_tracking-most-frequently-used-system-calls-with-systemtap_assembly_profiling-kernel-activity-with-systemtap" class="j-doc-nav__link ">
    43.5. Tracking most frequently used system calls with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_tracking-system-call-volume-per-process-with-systemtap_assembly_profiling-kernel-activity-with-systemtap" class="j-doc-nav__link ">
    43.6. Tracking system call volume per process with SystemTap
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                      

    <a href="#assembly_monitoring-disk-and-i-o-activity-with-systemtap_assembly_profiling-kernel-activity-with-systemtap" class="j-doc-nav__link j-doc-nav__link--has-children">
    44. Monitoring disk and I/O activity with SystemTap
  </a>
                    <button class="j-doc-nav__children-toggle content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-0rj1zid">
        <span class="visually-hidden j-doc-nav__children-toggle__expand-text">
          Expand section "44. Monitoring disk and I/O activity with SystemTap"
        </span>
        <span class="visually-hidden  j-doc-nav__children-toggle__collapse-text">
          Collapse section "44. Monitoring disk and I/O activity with SystemTap"
        </span>
      </button>

      <ol class="j-doc-nav__subnav j-superdoc-subnav content-expander content-expander--processed" id="content-expander-0rj1zid" aria-hidden="true">
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_summarizing-disk-read-write-traffic-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap" class="j-doc-nav__link ">
    44.1. Summarizing disk read/write traffic with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_tracking-i-o-time-for-each-file-read-or-write-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap" class="j-doc-nav__link ">
    44.2. Tracking I/O time for each file read or write with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_tracking-cumulative-i-o-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap" class="j-doc-nav__link ">
    44.3. Tracking cumulative I/O with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_monitoring-i-o-activity-on-a-specific-device-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap" class="j-doc-nav__link ">
    44.4. Monitoring I/O activity on a specific device with SystemTap
  </a>
  
          </li>
                  <li class="j-superdoc-subnav__item">
                        

    <a href="#proc_monitoring-reads-and-writes-to-a-file-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap" class="j-doc-nav__link ">
    44.5. Monitoring reads and writes to a file with SystemTap
  </a>
  
          </li>
              </ol>

  
          </li>
                  <li class="j-doc-nav__list-item">
                                    

    <a href="#idm140611482534224" class="j-doc-nav__link ">
    Legal Notice
  </a>
  
          </li>
              </ol>
    
  </div>
</nav>


              </div>
            </div>
            <div class="j-options-container j-options-container--mobile">
              <button class="j-sidebar__menu-trigger j-sidebar__menu-trigger--options content-expander__trigger content-expander__trigger--processed" aria-expanded="false" aria-controls="content-expander-8fc5a5t">
                <span class="j-sidebar__menu-trigger__open-headline">
                  Settings
                </span>
                <span class="j-sidebar__menu-trigger__close-text">Close</span>
              </button>
              

  <ul class="j-doc-options__list content-expander content-expander--processed" id="content-expander-8fc5a5t" aria-hidden="true">
    <li class="j-doc-options__item">
          <label class="j-doc-option__label j-doc-option__label--language" for="j-doc-language">
        Language:
      </label>
      <select id="j-doc-language" class="j-doc-option__select">
                  <option value="/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            简体中文
          </option>
                  <option value="/documentation/ko-kr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            한국어
          </option>
                  <option value="/documentation/ja-jp/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            日本語
          </option>
                  <option value="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance" selected="selected">
            English
          </option>
                  <option value="/documentation/fr-fr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            Français
          </option>
              </select>

            <noscript>
        <div class="j-doc-option__label j-doc-option__label--language" id="j-doc-option__label--language--nojs">
          Language:
        </div>
        <ul aria-labelledby="j-doc-option__label--language--nojs" class="j-doc-option__languages-list">
                      <li>
              <a href="/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">简体中文</a>
            </li>
                      <li>
              <a href="/documentation/ko-kr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">한국어</a>
            </li>
                      <li>
              <a href="/documentation/ja-jp/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">日本語</a>
            </li>
                      <li>
              <a href="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">English</a>
            </li>
                      <li>
              <a href="/documentation/fr-fr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">Français</a>
            </li>
                  </ul>
      </noscript>

      </li>

    <li class="j-doc-options__item">
    <label for="j-doc-mode" class="j-doc-option__label j-doc-option__label--format">
      Format:
    </label>
    <select id="j-doc-mode" class="j-doc-option__select">
              <option value="/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance" class="j-doc-options__option j-doc-options__option--multi-page">
          Multi-page
        </option>
              <option value="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance" selected="selected" class="j-doc-options__option j-doc-options__option--single-page">
          Single-page
        </option>
              <option value="/documentation/en-us/red_hat_enterprise_linux/9/pdf/monitoring_and_managing_system_status_and_performance/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US.pdf" class="j-doc-options__option j-doc-options__option--pdf">
          PDF
        </option>
          </select>

        <noscript>
      <div class="j-doc-option__label j-doc-option__label--format" id="j-doc-option__label--format--nojs">
        Format:
      </div>
      <ul class="j-doc-option__format-list" aria-labelledby="j-doc-option__label--format--nojs">
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--multi-page"><a href="/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance">Multi-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--single-page"><a href="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">Single-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--pdf"><a href="/documentation/en-us/red_hat_enterprise_linux/9/pdf/monitoring_and_managing_system_status_and_performance/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US.pdf">PDF</a></li>
              </ul>
    </noscript>
  </li>
</ul>


              </div>
          </div>
                <div class="pvof-doc__tertiary-sidebar j-doc__tertiary-sidebar j-doc__tertiary-sidebar--sticky">
          <div class="pvof-doc__tertiary-sidebar__inner j-doc__tertiary-sidebar__inner"><div id="j-reading-mode-toggle" class="j-switch__wrapper j-reading-mode__toggle"><input type="checkbox" name="reading-mode" value="false" id="reading-mode-checkbox" class="j-reading-mode j-switch__input visually-hidden"><label for="reading-mode-checkbox" class="j-switch__label">Focus mode<span class="j-reading-mode__shortcut-hint" hidden=""><kbd>F</kbd></span><div class="j-switch"></div></label></div>
            <div class="j-doc__doc-options">
              <div class="j-options-container j-options-container--desktop j-options-container--desktop--processed">
                <button class="j-sidebar__menu-trigger j-sidebar__menu-trigger--tablet content-expander__trigger content-expander__trigger--processed" aria-expanded="true" aria-controls="content-expander-25zjv2e">
                  <span class="j-sidebar__menu-trigger-icon"></span>
                  <h2 class="visually-hidden">Language and Page Formatting Options</h2>
                </button>
                  

  <ul class="j-doc-options__list content-expander content-expander--processed" id="content-expander-25zjv2e" open="">
    <li class="j-doc-options__item">
          <label class="j-doc-option__label j-doc-option__label--language" for="j-doc-language--2">
        Language:
      </label>
      <select id="j-doc-language--2" class="j-doc-option__select">
                  <option value="/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            简体中文
          </option>
                  <option value="/documentation/ko-kr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            한국어
          </option>
                  <option value="/documentation/ja-jp/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            日本語
          </option>
                  <option value="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance" selected="selected">
            English
          </option>
                  <option value="/documentation/fr-fr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">
            Français
          </option>
              </select>

            <noscript>
        <div class="j-doc-option__label j-doc-option__label--language" id="j-doc-option__label--language--nojs">
          Language:
        </div>
        <ul aria-labelledby="j-doc-option__label--language--nojs" class="j-doc-option__languages-list">
                      <li>
              <a href="/documentation/zh-cn/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">简体中文</a>
            </li>
                      <li>
              <a href="/documentation/ko-kr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">한국어</a>
            </li>
                      <li>
              <a href="/documentation/ja-jp/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">日本語</a>
            </li>
                      <li>
              <a href="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">English</a>
            </li>
                      <li>
              <a href="/documentation/fr-fr/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">Français</a>
            </li>
                  </ul>
      </noscript>

      </li>

    <li class="j-doc-options__item">
    <label for="j-doc-mode--2" class="j-doc-option__label j-doc-option__label--format">
      Format:
    </label>
    <select id="j-doc-mode--2" class="j-doc-option__select">
              <option value="/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance" class="j-doc-options__option j-doc-options__option--multi-page">
          Multi-page
        </option>
              <option value="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance" selected="selected" class="j-doc-options__option j-doc-options__option--single-page">
          Single-page
        </option>
              <option value="/documentation/en-us/red_hat_enterprise_linux/9/pdf/monitoring_and_managing_system_status_and_performance/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US.pdf" class="j-doc-options__option j-doc-options__option--pdf">
          PDF
        </option>
          </select>

        <noscript>
      <div class="j-doc-option__label j-doc-option__label--format" id="j-doc-option__label--format--nojs">
        Format:
      </div>
      <ul class="j-doc-option__format-list" aria-labelledby="j-doc-option__label--format--nojs">
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--multi-page"><a href="/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance">Multi-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--single-page"><a href="/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance">Single-page</a></li>
                  <li class="j-doc-mode-no-js__link j-doc-mode-no-js__link--pdf"><a href="/documentation/en-us/red_hat_enterprise_linux/9/pdf/monitoring_and_managing_system_status_and_performance/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US.pdf">PDF</a></li>
              </ul>
    </noscript>
  </li>
</ul>


                </div>
              </div>
          </div>
        </div>

                  <div class="doc-wrapper pvof-doc__wrapper j-superdoc__content-wrapper" id="doc-wrapper">
            

  <div class="pane-page-title">
    <h1 class="title" itemprop="name">Monitoring and managing system status and performance</h1>
  </div>


  <div xml:lang="en-US" class="book" id="idm140611475751616"><div class="titlepage"><div><div class="producttitle"><span class="productname">Red&nbsp;Hat Enterprise&nbsp;Linux</span> <span class="productnumber">9</span></div><div><h2 class="subtitle">Optimizing system throughput, latency, and power consumption</h2></div><div><div xml:lang="en-US" class="authorgroup"><span class="orgname">Red&nbsp;Hat</span> <span class="orgdiv">Customer Content Services</span></div></div><div><a href="#idm140611482534224">Legal Notice</a></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><div class="para">
				Monitor and optimize the throughput, latency, and power consumption 
of Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9 in different scenarios.
			</div></div></div></div><hr></div><section class="preface" id="making-open-source-more-inclusive"><div class="titlepage"><div><div><h1 class="title">Making open source more inclusive</h1></div></div></div><p class="_abstract _abstract">
			Red Hat is committed to replacing problematic language in our code, 
documentation, and web properties. We are beginning with these four 
terms: master, slave, blacklist, and whitelist. Because of the enormity 
of this endeavor, these changes will be implemented gradually over 
several upcoming releases. For more details, see <a class="link" href="https://www.redhat.com/en/blog/making-open-source-more-inclusive-eradicating-problematic-language">our CTO Chris Wright’s message</a>.
		</p></section><section class="preface" id="proc_providing-feedback-on-red-hat-documentation_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Providing feedback on Red Hat documentation</h1></div></div></div><p class="_abstract _abstract">
			We appreciate your feedback on our documentation. Let us know how we can improve it.
		</p><div class="orderedlist"><p class="title"><strong>Submitting comments on specific passages</strong></p><ol class="orderedlist" type="1"><li class="listitem">
					View the documentation in the <span class="strong strong"><strong>Multi-page HTML</strong></span> format and ensure that you see the <span class="strong strong"><strong>Feedback</strong></span> button in the upper right corner after the page fully loads.
				</li><li class="listitem">
					Use your cursor to highlight the part of the text that you want to comment on.
				</li><li class="listitem">
					Click the <span class="strong strong"><strong>Add Feedback</strong></span> button that appears near the highlighted text.
				</li><li class="listitem">
					Add your feedback and click <span class="strong strong"><strong>Submit</strong></span>.
				</li></ol></div><div class="orderedlist"><p class="title"><strong>Submitting feedback through Bugzilla (account required)</strong></p><ol class="orderedlist" type="1"><li class="listitem">
					Log in to the <a class="link" href="https://bugzilla.redhat.com/enter_bug.cgi?product=Red%20Hat%20Enterprise%20Linux%209&amp;component=Documentation">Bugzilla</a> website.
				</li><li class="listitem">
					Select the correct version from the <span class="strong strong"><strong>Version</strong></span> menu.
				</li><li class="listitem">
					Enter a descriptive title in the <span class="strong strong"><strong>Summary</strong></span> field.
				</li><li class="listitem">
					Enter your suggestion for improvement in the <span class="strong strong"><strong>Description</strong></span> field. Include links to the relevant parts of the documentation.
				</li><li class="listitem">
					Click <span class="strong strong"><strong>Submit Bug</strong></span>.
				</li></ol></div></section><section class="chapter" id="getting-started-with-tuned_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 1. Getting started with TuneD</h1></div></div></div><p class="_abstract _abstract">
			As a system administrator, you can use the <span class="strong strong"><strong>TuneD</strong></span> application to optimize the performance profile of your system for a variety of use cases.
		</p><section class="section" id="the-purpose-of-tuned_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.1. The purpose of TuneD</h2></div></div></div><p class="_abstract _abstract">
				<span class="strong strong"><strong>TuneD</strong></span> is a service that monitors your system and optimizes the performance under certain workloads. The core of <span class="strong strong"><strong>TuneD</strong></span> are <span class="emphasis"><em>profiles</em></span>, which tune your system for different use cases.
			</p><p>
				<span class="strong strong"><strong>TuneD</strong></span> is distributed with a number of predefined profiles for use cases such as:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						High throughput
					</li><li class="listitem">
						Low latency
					</li><li class="listitem">
						Saving power
					</li></ul></div><p>
				It is possible to modify the rules defined for each profile and 
customize how to tune a particular device. When you switch to another 
profile or deactivate <span class="strong strong"><strong>TuneD</strong></span>, all changes made to the system settings by the previous profile revert back to their original state.
			</p><p>
				You can also configure <span class="strong strong"><strong>TuneD</strong></span>
 to react to changes in device usage and adjusts settings to improve 
performance of active devices and reduce power consumption of inactive 
devices.
			</p></section><section class="section" id="tuned-profiles_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.2. TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				A detailed analysis of a system can be very time-consuming. <span class="strong strong"><strong>TuneD</strong></span> provides a number of predefined profiles for typical use cases. You can also create, modify, and delete profiles.
			</p><p>
				The profiles provided with <span class="strong strong"><strong>TuneD</strong></span> are divided into the following categories:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Power-saving profiles
					</li><li class="listitem">
						Performance-boosting profiles
					</li></ul></div><p>
				The performance-boosting profiles include profiles that focus on the following aspects:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Low latency for storage and network
					</li><li class="listitem">
						High throughput for storage and network
					</li><li class="listitem">
						Virtual machine performance
					</li><li class="listitem">
						Virtualization host performance
					</li></ul></div><h4 id="syntax_of_profile_configuration">Syntax of profile configuration</h4><p>
				The <code class="literal">tuned.conf</code> file can contain one <code class="literal">[main]</code> section and other sections for configuring plug-in instances. However, all sections are optional.
			</p><p>
				Lines starting with the hash sign (<code class="literal">#</code>) are comments.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page.
					</li></ul></div></section><section class="section" id="the-default-tuned-profile_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.3. The default TuneD profile</h2></div></div></div><p class="_abstract _abstract">
				During the installation, the best profile for your system is 
selected automatically. Currently, the default profile is selected 
according to the following customizable rules:
			</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="bczkf10" id="rh-table--bczkf10" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 29%; " class="col_1"><!--Empty--><col style="width: 29%; " class="col_2"><!--Empty--><col style="width: 43%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611489560208" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Environment</th><th id="idm140611492911280" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Default profile</th><th id="idm140611492910192" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">Goal</th></tr></thead><tbody><tr><td headers="idm140611489560208" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								Compute nodes
							</p>
							 </td><td headers="idm140611492911280" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">throughput-performance</code>
							</p>
							 </td><td headers="idm140611492910192" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
								The best throughput performance
							</p>
							 </td></tr><tr><td headers="idm140611489560208" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								Virtual machines
							</p>
							 </td><td headers="idm140611492911280" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">virtual-guest</code>
							</p>
							 </td><td headers="idm140611492910192" data-row="3" data-col="3" class="content--lg" valign="top" align="left"> <p>
								The best performance. If you are not interested in the best performance, you can change it to the <code class="literal">balanced</code> or <code class="literal">powersave</code> profile.
							</p>
							 </td></tr><tr><td headers="idm140611489560208" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								Other cases
							</p>
							 </td><td headers="idm140611492911280" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">balanced</code>
							</p>
							 </td><td headers="idm140611492910192" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
								Balanced performance and power consumption
							</p>
							 </td></tr></tbody></table></rh-table><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page.
					</li></ul></div></section><section class="section" id="merged-tuned-profiles_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.4. Merged TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				As an experimental feature, it is possible to select more profiles at once. <span class="strong strong"><strong>TuneD</strong></span> will try to merge them during the load.
			</p><p>
				If there are conflicts, the settings from the last specified profile takes precedence.
			</p><div class="example" id="idm140611485096240"><p class="title">Example 1.1. Low power consumption in a virtual guest</p><div class="example-contents"><p>
					The following example optimizes the system to run in a virtual 
machine for the best performance and concurrently tunes it for low power
 consumption, while the low power consumption is the priority:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--d27nhyp"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile virtual-guest powersave</pre></div></div></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Merging is done automatically without checking whether the 
resulting combination of parameters makes sense. Consequently, the 
feature might tune some parameters the opposite way, which might be 
counterproductive: for example, setting the disk for high throughput by 
using the <code class="literal">throughput-performance</code> profile and concurrently setting the disk spindown to the low value by the <code class="literal">spindown-disk</code> profile.
				</p></div></div><div class="_additional-resources _additional-resources"><p class="title"><strong>Additional resources</strong></p><p>
					*<code class="literal">tuned-adm</code> man page. * <code class="literal">tuned.conf(5)</code> man page.
				</p></div></section><section class="section" id="the-location-of-tuned-profiles_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.5. The location of TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				<span class="strong strong"><strong>TuneD</strong></span> stores profiles in the following directories:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal filename">/usr/lib/tuned/</code></span></dt><dd>
							Distribution-specific profiles are stored in the directory. Each 
profile has its own directory. The profile consists of the main 
configuration file called <code class="literal">tuned.conf</code>, and optionally other files, for example helper scripts.
						</dd><dt><span class="term"><code class="literal filename">/etc/tuned/</code></span></dt><dd>
							If you need to customize a profile, copy the profile directory 
into the directory, which is used for custom profiles. If there are two 
profiles of the same name, the custom profile located in <code class="literal filename">/etc/tuned/</code> is used.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page.
					</li></ul></div></section><section class="section" id="tuned-profiles-distributed-with-rhel_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.6. TuneD profiles distributed with RHEL</h2></div></div></div><p class="_abstract _abstract">
				The following is a list of profiles that are installed with <span class="strong strong"><strong>TuneD</strong></span> on Red&nbsp;Hat Enterprise&nbsp;Linux.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					There might be more product-specific or third-party <span class="strong strong"><strong>TuneD</strong></span> profiles available. Such profiles are usually provided by separate RPM packages.
				</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">balanced</code></span></dt><dd><p class="simpara">
							The default power-saving profile. It is intended to be a 
compromise between performance and power consumption. It uses 
auto-scaling and auto-tuning whenever possible. The only drawback is the
 increased latency. In the current <span class="strong strong"><strong>TuneD</strong></span> release, it enables the CPU, disk, audio, and video plugins, and activates the <code class="literal">conservative</code> CPU governor. The <code class="literal">radeon_powersave</code> option uses the <code class="literal">dpm-balanced</code> value if it is supported, otherwise it is set to <code class="literal">auto</code>.
						</p><p class="simpara">
							It changes the <code class="literal">energy_performance_preference</code> attribute to the <code class="literal">normal</code> energy setting. It also changes the <code class="literal">scaling_governor</code> policy attribute to either the <code class="literal">conservative</code> or <code class="literal">powersave</code> CPU governor.
						</p></dd><dt><span class="term"><code class="literal">powersave</code></span></dt><dd><p class="simpara">
							A profile for maximum power saving performance. It can throttle 
the performance in order to minimize the actual power consumption. In 
the current <span class="strong strong"><strong>TuneD</strong></span> 
release it enables USB autosuspend, WiFi power saving, and Aggressive 
Link Power Management (ALPM) power savings for SATA host adapters. It 
also schedules multi-core power savings for systems with a low wakeup 
rate and activates the <code class="literal">ondemand</code> governor. 
It enables AC97 audio power saving or, depending on your system, 
HDA-Intel power savings with a 10 seconds timeout. If your system 
contains a supported Radeon graphics card with enabled KMS, the profile 
configures it to automatic power saving. On ASUS Eee PCs, a dynamic 
Super Hybrid Engine is enabled.
						</p><p class="simpara">
							It changes the <code class="literal">energy_performance_preference</code> attribute to the <code class="literal">powersave</code> or <code class="literal">power</code> energy setting. It also changes the <code class="literal">scaling_governor</code> policy attribute to either the <code class="literal">ondemand</code> or <code class="literal">powersave</code> CPU governor.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								In certain cases, the <code class="literal">balanced</code> profile is more efficient compared to the <code class="literal">powersave</code> profile.
							</p><p>
								Consider there is a defined amount of work that needs to be 
done, for example a video file that needs to be transcoded. Your machine
 might consume less energy if the transcoding is done on the full power,
 because the task is finished quickly, the machine starts to idle, and 
it can automatically step-down to very efficient power save modes. On 
the other hand, if you transcode the file with a throttled machine, the 
machine consumes less power during the transcoding, but the process 
takes longer and the overall consumed energy can be higher.
							</p><p>
								That is why the <code class="literal">balanced</code> profile can be generally a better option.
							</p></div></div></dd><dt><span class="term"><code class="literal">throughput-performance</code></span></dt><dd><p class="simpara">
							A server profile optimized for high throughput. It disables power savings mechanisms and enables <code class="literal">sysctl</code> settings that improve the throughput performance of the disk and network IO. CPU governor is set to <code class="literal">performance</code>.
						</p><p class="simpara">
							It changes the <code class="literal">energy_performance_preference</code> and <code class="literal">scaling_governor</code> attribute to the <code class="literal">performance</code> profile.
						</p></dd><dt><span class="term"><code class="literal">accelerator-performance</code></span></dt><dd>
							The <code class="literal">accelerator-performance</code> profile contains the same tuning as the <code class="literal">throughput-performance</code>
 profile. Additionally, it locks the CPU to low C states so that the 
latency is less than 100us. This improves the performance of certain 
accelerators, such as GPUs.
						</dd><dt><span class="term"><code class="literal">latency-performance</code></span></dt><dd><p class="simpara">
							A server profile optimized for low latency. It disables power savings mechanisms and enables <code class="literal">sysctl</code> settings that improve latency. CPU governor is set to <code class="literal">performance</code> and the CPU is locked to the low C states (by PM QoS).
						</p><p class="simpara">
							It changes the <code class="literal">energy_performance_preference</code> and <code class="literal">scaling_governor</code> attribute to the <code class="literal">performance</code> profile.
						</p></dd><dt><span class="term"><code class="literal">network-latency</code></span></dt><dd><p class="simpara">
							A profile for low latency network tuning. It is based on the <code class="literal">latency-performance</code> profile. It additionally disables transparent huge pages and NUMA balancing, and tunes several other network-related <code class="literal">sysctl</code> parameters.
						</p><p class="simpara">
							It inherits the <code class="literal">latency-performance</code> profile which changes the <code class="literal">energy_performance_preference</code> and <code class="literal">scaling_governor</code> attribute to the <code class="literal">performance</code> profile.
						</p></dd><dt><span class="term"><code class="literal">hpc-compute</code></span></dt><dd>
							A profile optimized for high-performance computing. It is based on the <code class="literal">latency-performance</code> profile.
						</dd><dt><span class="term"><code class="literal">network-throughput</code></span></dt><dd><p class="simpara">
							A profile for throughput network tuning. It is based on the <code class="literal">throughput-performance</code> profile. It additionally increases kernel network buffers.
						</p><p class="simpara">
							It inherits either the <code class="literal">latency-performance</code> or <code class="literal">throughput-performance</code> profile, and changes the <code class="literal">energy_performance_preference</code> and <code class="literal">scaling_governor</code> attribute to the <code class="literal">performance</code> profile.
						</p></dd><dt><span class="term"><code class="literal">virtual-guest</code></span></dt><dd><p class="simpara">
							A profile designed for Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9 virtual machines and VMWare guests based on the <code class="literal">throughput-performance</code>
 profile that, among other tasks, decreases virtual memory swappiness 
and increases disk readahead values. It does not disable disk barriers.
						</p><p class="simpara">
							It inherits the <code class="literal">throughput-performance</code> profile and changes the <code class="literal">energy_performance_preference</code> and <code class="literal">scaling_governor</code> attribute to the <code class="literal">performance</code> profile.
						</p></dd><dt><span class="term"><code class="literal">virtual-host</code></span></dt><dd><p class="simpara">
							A profile designed for virtual hosts based on the <code class="literal">throughput-performance</code>
 profile that, among other tasks, decreases virtual memory swappiness, 
increases disk readahead values, and enables a more aggressive value of 
dirty pages writeback.
						</p><p class="simpara">
							It inherits the <code class="literal">throughput-performance</code> profile and changes the <code class="literal">energy_performance_preference</code> and <code class="literal">scaling_governor</code> attribute to the <code class="literal">performance</code> profile.
						</p></dd><dt><span class="term"><code class="literal">oracle</code></span></dt><dd>
							A profile optimized for Oracle databases loads based on <code class="literal">throughput-performance</code>
 profile. It additionally disables transparent huge pages and modifies 
other performance-related kernel parameters. This profile is provided by
 the <code class="literal package">tuned-profiles-oracle</code> package.
						</dd><dt><span class="term"><code class="literal">desktop</code></span></dt><dd>
							A profile optimized for desktops, based on the <code class="literal">balanced</code> profile. It additionally enables scheduler autogroups for better response of interactive applications.
						</dd><dt><span class="term"><code class="literal">optimize-serial-console</code></span></dt><dd><p class="simpara">
							A profile that tunes down I/O activity to the serial console by 
reducing the printk value. This should make the serial console more 
responsive. This profile is intended to be used as an overlay on other 
profiles. For example:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--pza5hml"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile throughput-performance optimize-serial-console</pre></div></div></dd><dt><span class="term"><code class="literal">mssql</code></span></dt><dd>
							A profile provided for Microsoft SQL Server. It is based on the <code class="literal">throughput-performance</code> profile.
						</dd><dt><span class="term"><code class="literal">intel-sst</code></span></dt><dd><p class="simpara">
							A profile optimized for systems with user-defined Intel Speed 
Select Technology configurations. This profile is intended to be used as
 an overlay on other profiles. For example:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--v3h1n0g"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile cpu-partitioning intel-sst</pre></div></div></dd></dl></div></section><section class="section" id="tuned-cpu-partitioning-profile_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.7. TuneD cpu-partitioning profile</h2></div></div></div><p class="_abstract _abstract">
				For tuning Red&nbsp;Hat Enterprise&nbsp;Linux 9 for latency-sensitive workloads, Red&nbsp;Hat recommends to use the <code class="literal">cpu-partitioning</code> TuneD profile.
			</p><p>
				Prior to Red&nbsp;Hat Enterprise&nbsp;Linux 9, the low-latency 
Red&nbsp;Hat documentation described the numerous low-level steps needed
 to achieve low-latency tuning. In Red&nbsp;Hat Enterprise&nbsp;Linux 9,
 you can perform low-latency tuning more efficiently by using the <code class="literal">cpu-partitioning</code> TuneD profile. This profile is easily customizable according to the requirements for individual low-latency applications.
			</p><p>
				The following figure is an example to demonstrate how to use the <code class="literal">cpu-partitioning</code> profile. This example uses the CPU and node layout.
			</p><div class="figure" id="cpu-partitioning_getting-started-with-tuned"><p class="title">Figure 1.1. Figure cpu-partitioning</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/367206bd2d1527d49965f718f51722e3/cpu-partitioning.png" class="rh_docs--zoom" title="cpu partitioning"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/cpu-partitioning.png" alt="cpu partitioning"></a></div></div></div><p>
				You can configure the cpu-partitioning profile in the <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file using the following configuration options:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Isolated CPUs with load balancing</span></dt><dd><p class="simpara">
							In the cpu-partitioning figure, the blocks numbered from 4 to 23,
 are the default isolated CPUs. The kernel scheduler’s process load 
balancing is enabled on these CPUs. It is designed for low-latency 
processes with multiple threads that need the kernel scheduler load 
balancing.
						</p><p class="simpara">
							You can configure the cpu-partitioning profile in the <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file using the <code class="literal">isolated_cores=cpu-list</code> option, which lists CPUs to isolate that will use the kernel scheduler load balancing.
						</p><p class="simpara">
							The list of isolated CPUs is comma-separated or you can specify a range using a dash, such as <code class="literal">3-5</code>. This option is mandatory. Any CPU missing from this list is automatically considered a housekeeping CPU.
						</p></dd><dt><span class="term">Isolated CPUs without load balancing</span></dt><dd><p class="simpara">
							In the cpu-partitioning figure, the blocks numbered 2 and 3, are 
the isolated CPUs that do not provide any additional kernel scheduler 
process load balancing.
						</p><p class="simpara">
							You can configure the cpu-partitioning profile in the <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file using the <code class="literal">no_balance_cores=cpu-list</code> option, which lists CPUs to isolate that will not use the kernel scheduler load balancing.
						</p><p class="simpara">
							Specifying the <code class="literal">no_balance_cores</code> option is optional, however any CPUs in this list must be a subset of the CPUs listed in the <code class="literal">isolated_cores</code> list.
						</p><p class="simpara">
							Application threads using these CPUs need to be pinned individually to each CPU.
						</p></dd><dt><span class="term">Housekeeping CPUs</span></dt><dd>
							Any CPU not isolated in the <code class="literal">cpu-partitioning-variables.conf</code>
 file is automatically considered a housekeeping CPU. On the 
housekeeping CPUs, all services, daemons, user processes, movable kernel
 threads, interrupt handlers, and kernel timers are permitted to 
execute.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-profiles-cpu-partitioning(7)</code> man page
					</li></ul></div></section><section class="section" id="using-the-tuned-cpu-partitioning-profile-for-low-latency-tuning_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.8. Using the TuneD cpu-partitioning profile for low-latency tuning</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to tune a system for low-latency using the TuneD’s <code class="literal">cpu-partitioning</code> profile. It uses the example of a low-latency application that can use <code class="literal">cpu-partitioning</code> and the CPU layout as mentioned in the <a class="link" href="#cpu-partitioning_getting-started-with-tuned" title="Figure&nbsp;1.1.&nbsp;Figure cpu-partitioning">cpu-partitioning</a> figure.
			</p><p>
				The application in this case uses:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						One dedicated reader thread that reads data from the network will be pinned to CPU 2.
					</li><li class="listitem">
						A large number of threads that process this network data will be pinned to CPUs 4-23.
					</li><li class="listitem">
						A dedicated writer thread that writes the processed data to the network will be pinned to CPU 3.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed the <code class="literal">cpu-partitioning</code> TuneD profile by using the <code class="literal">dnf install tuned-profiles-cpu-partitioning</code> command as root.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Edit <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file and add the following information:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fg9ztd4"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># Isolated CPUs with the kernel’s scheduler load balancing:
isolated_cores=2-23
# Isolated CPUs without the kernel’s scheduler load balancing:
no_balance_cores=2,3</pre></div></div></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">cpu-partitioning</code> TuneD profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ri2et6i"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile cpu-partitioning</pre></div></div></li><li class="listitem"><p class="simpara">
						Reboot
					</p><p class="simpara">
						After rebooting, the system is tuned for low-latency, according to
 the isolation in the cpu-partitioning figure. The application can use 
taskset to pin the reader and writer threads to CPUs 2 and 3, and the 
remaining application threads on CPUs 4-23.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-profiles-cpu-partitioning(7)</code> man page
					</li></ul></div></section><section class="section" id="customizing-the-cpu-partitioning-tuned-profile_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.9. Customizing the cpu-partitioning TuneD profile</h2></div></div></div><p class="_abstract _abstract">
				You can extend the TuneD profile to make additional tuning changes.
			</p><p>
				For example, the <code class="literal">cpu-partitioning</code> profile sets the CPUs to use <code class="literal">cstate=1</code>. In order to use the <code class="literal">cpu-partitioning</code>
 profile but to additionally change the CPU cstate from cstate1 to 
cstate0, the following procedure describes a new TuneD profile named <span class="emphasis"><em>my_profile</em></span>, which inherits the <code class="literal">cpu-partitioning</code> profile and then sets C state-0.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the <code class="literal">/etc/tuned/my_profile</code> directory:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--g90hrzm"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># mkdir /etc/tuned/<span class="emphasis"><em>my_profile</em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">tuned.conf</code> file in this directory, and add the following content:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--bcaittr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># vi /etc/tuned/<span class="emphasis"><em>my_profile</em></span>/tuned.conf
[main]
summary=Customized tuning on top of cpu-partitioning
include=cpu-partitioning
[cpu]
force_latency=cstate.id:0|1</pre></div></div></li><li class="listitem"><p class="simpara">
						Use the new profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--wd5pqll"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile <span class="emphasis"><em>my_profile</em></span></pre></div></div></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					In the shared example, a reboot is not required. However, if the changes in the <span class="emphasis"><em>my_profile</em></span> profile require a reboot to take effect, then reboot your machine.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-profiles-cpu-partitioning(7)</code> man page
					</li></ul></div></section><section class="section" id="real-time-tuned-profiles-distributed-with-rhel_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.10. Real-time TuneD profiles distributed with RHEL</h2></div></div></div><p class="_abstract _abstract">
				Real-time profiles are intended for systems running the real-time 
kernel. Without a special kernel build, they do not configure the system
 to be real-time. On RHEL, the profiles are available from additional 
repositories.
			</p><p>
				The following real-time profiles are available:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">realtime</code></span></dt><dd><p class="simpara">
							Use on bare-metal real-time systems.
						</p><p class="simpara">
							Provided by the <code class="literal package">tuned-profiles-realtime</code> package, which is available from the RT or NFV repositories.
						</p></dd><dt><span class="term"><code class="literal">realtime-virtual-host</code></span></dt><dd><p class="simpara">
							Use in a virtualization host configured for real-time.
						</p><p class="simpara">
							Provided by the <code class="literal package">tuned-profiles-nfv-host</code> package, which is available from the NFV repository.
						</p></dd><dt><span class="term"><code class="literal">realtime-virtual-guest</code></span></dt><dd><p class="simpara">
							Use in a virtualization guest configured for real-time.
						</p><p class="simpara">
							Provided by the <code class="literal package">tuned-profiles-nfv-guest</code> package, which is available from the NFV repository.
						</p></dd></dl></div></section><section class="section" id="static-and-dynamic-tuning-in-tuned_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.11. Static and dynamic tuning in TuneD</h2></div></div></div><p class="_abstract _abstract">
				Understanding the difference between the two categories of system tuning that <span class="strong strong"><strong>TuneD</strong></span> applies, <span class="emphasis"><em>static</em></span> and <span class="emphasis"><em>dynamic</em></span>, is important when determining which one to use for a given situation or purpose.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Static tuning</span></dt><dd>
							Mainly consists of the application of predefined <code class="literal">sysctl</code> and <code class="literal">sysfs</code> settings and one-shot activation of several configuration tools such as <code class="literal">ethtool</code>.
						</dd><dt><span class="term">Dynamic tuning</span></dt><dd><p class="simpara">
							Watches how various system components are used throughout the uptime of your system. <span class="strong strong"><strong>TuneD</strong></span> adjusts system settings dynamically based on that monitoring information.
						</p><p class="simpara">
							For example, the hard drive is used heavily during startup and 
login, but is barely used later when the user might mainly work with 
applications such as web browsers or email clients. Similarly, the CPU 
and network devices are used differently at different times. <span class="strong strong"><strong>TuneD</strong></span> monitors the activity of these components and reacts to the changes in their use.
						</p><p class="simpara">
							By default, dynamic tuning is disabled. To enable it, edit the <code class="literal filename">/etc/tuned/tuned-main.conf</code> file and change the <code class="literal option">dynamic_tuning</code> option to <code class="literal">1</code>. <span class="strong strong"><strong>TuneD</strong></span>
 then periodically analyzes system statistics and uses them to update 
your system tuning settings. To configure the time interval in seconds 
between these updates, use the <code class="literal option">update_interval</code> option.
						</p><p class="simpara">
							Currently implemented dynamic tuning algorithms try to balance 
the performance and powersave, and are therefore disabled in the 
performance profiles. Dynamic tuning for individual plug-ins can be 
enabled or disabled in the <span class="strong strong"><strong>TuneD</strong></span> profiles.
						</p></dd></dl></div><div class="example" id="idm140611494960896"><p class="title">Example 1.2. Static and dynamic tuning on a workstation</p><div class="example-contents"><p>
					On a typical office workstation, the Ethernet network interface is 
inactive most of the time. Only a few emails go in and out or some web 
pages might be loaded.
				</p><p>
					For those kinds of loads, the network interface does not have to run at full speed all the time, as it does by default. <span class="strong strong"><strong>TuneD</strong></span>
 has a monitoring and tuning plug-in for network devices that can detect
 this low activity and then automatically lower the speed of that 
interface, typically resulting in a lower power usage.
				</p><p>
					If the activity on the interface increases for a longer period of 
time, for example because a DVD image is being downloaded or an email 
with a large attachment is opened, <span class="strong strong"><strong>TuneD</strong></span> detects this and sets the interface speed to maximum to offer the best performance while the activity level is high.
				</p><p>
					This principle is used for other plug-ins for CPU and disks as well.
				</p></div></div></section><section class="section" id="tuned-no-daemon-mode_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.12. TuneD no-daemon mode</h2></div></div></div><p class="_abstract _abstract">
				You can run <span class="strong strong"><strong>TuneD</strong></span> in <code class="literal">no-daemon</code> mode, which does not require any resident memory. In this mode, <span class="strong strong"><strong>TuneD</strong></span> applies the settings and exits.
			</p><p>
				By default, <code class="literal">no-daemon</code> mode is disabled because a lot of <span class="strong strong"><strong>TuneD</strong></span> functionality is missing in this mode, including:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						D-Bus support
					</li><li class="listitem">
						Hot-plug support
					</li><li class="listitem">
						Rollback support for settings
					</li></ul></div><p>
				To enable <code class="literal">no-daemon</code> mode, include the following line in the <code class="literal filename">/etc/tuned/tuned-main.conf</code> file:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ev0dgm3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">daemon = 0</pre></div></div></section><section class="section" id="installing-and-enabling-tuned_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.13. Installing and enabling TuneD</h2></div></div></div><p class="_abstract _abstract">
				This procedure installs and enables the <span class="strong strong"><strong>TuneD</strong></span> application, installs <span class="strong strong"><strong>TuneD</strong></span> profiles, and presets a default <span class="strong strong"><strong>TuneD</strong></span> profile for your system.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal package">TuneD</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7xvojj8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install tuned</pre></div></div></li><li class="listitem"><p class="simpara">
						Enable and start the <code class="literal">TuneD</code> service:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--74z78wm"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl enable --now tuned</pre></div></div></li><li class="listitem"><p class="simpara">
						Optionally, install <span class="strong strong"><strong>TuneD</strong></span> profiles for real-time systems:
					</p><p class="simpara">
						For the <span class="strong strong"><strong>TuneD</strong></span> profiles for real-time systems enable <code class="literal">rhel-9</code> repository.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--92gadec"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># subscription-manager repos --enable=rhel-9-for-x86_64-nfv-beta-rpms</pre></div></div><p class="simpara">
						Install it.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--f9qw6sr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install tuned-profiles-realtime tuned-profiles-nfv</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify that a <span class="strong strong"><strong>TuneD</strong></span> profile is active and applied:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ub838ew"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm active

Current active profile: <span class="emphasis"><em><span class="replaceable replaceable">throughput-performance</span></em></span></pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The active profile TuneD automatically presets differs based on your machine type and system settings.
						</p></div></div><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--31t561v"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm verify

Verification succeeded, current system settings match the preset profile.
See tuned log file ('/var/log/tuned/tuned.log') for details.</pre></div></div></li></ol></div></section><section class="section" id="listing-available-tuned-profiles_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.14. Listing available TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				This procedure lists all <span class="strong strong"><strong>TuneD</strong></span> profiles that are currently available on your system.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To list all available <span class="strong strong"><strong>TuneD</strong></span> profiles on your system, use:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--orfcmjo"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen white-space-pre language-none codeblock codeblock--processed">$ <span class="strong strong"><strong>tuned-adm list</strong></span>

Available profiles:
- accelerator-performance - Throughput performance based tuning with disabled higher latency STOP states
- balanced                - General non-specialized TuneD profile
- desktop                 - Optimize for the desktop use-case
- latency-performance     - Optimize for deterministic performance at the cost of increased power consumption
- network-latency         - Optimize for deterministic performance at the cost of increased power consumption, focused on low latency network performance
- network-throughput      - Optimize for streaming network throughput, generally only necessary on older CPUs or 40G+ networks
- powersave               - Optimize for low power consumption
- throughput-performance  - Broadly applicable tuning that provides excellent performance across a variety of common server workloads
- virtual-guest           - Optimize for running inside a virtual guest
- virtual-host            - Optimize for running KVM guests
Current active profile: <span class="emphasis"><em><span class="replaceable replaceable">balanced</span></em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						To display only the currently active profile, use:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--u0g0ek8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ <span class="strong strong"><strong>tuned-adm active</strong></span>

Current active profile: <span class="emphasis"><em><span class="replaceable replaceable">throughput-performance</span></em></span></pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-adm(8)</code> man page.
					</li></ul></div></section><section class="section" id="setting-a-tuned-profile_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.15. Setting a TuneD profile</h2></div></div></div><p class="_abstract _abstract">
				This procedure activates a selected <span class="strong strong"><strong>TuneD</strong></span> profile on your system.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">TuneD</code> service is running. See <a class="link" href="#installing-and-enabling-tuned_getting-started-with-tuned" title="1.13.&nbsp;Installing and enabling TuneD">Installing and Enabling TuneD</a> for details.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Optionally, you can let <span class="strong strong"><strong>TuneD</strong></span> recommend the most suitable profile for your system:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--c9dcqxt"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm recommend

<span class="emphasis"><em><span class="replaceable replaceable">throughput-performance</span></em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Activate a profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--eehisfy"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile <span class="emphasis"><em><span class="replaceable replaceable">selected-profile</span></em></span></pre></div></div><p class="simpara">
						Alternatively, you can activate a combination of multiple profiles:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3l2lzqy"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile <span class="emphasis"><em><span class="replaceable replaceable">selected-profile1</span></em></span> <span class="emphasis"><em><span class="replaceable replaceable">selected-profile2</span></em></span></pre></div></div><div class="example" id="idm140611480264784"><p class="title">Example 1.3. A virtual machine optimized for low power consumption</p><div class="example-contents"><p>
							The following example optimizes the system to run in a virtual 
machine with the best performance and concurrently tunes it for low 
power consumption, while the low power consumption is the priority:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--1g5ip4e"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile virtual-guest powersave</pre></div></div></div></div></li><li class="listitem"><p class="simpara">
						View the current active <span class="strong strong"><strong>TuneD</strong></span> profile on your system:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--iewchdz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm active

Current active profile: <span class="emphasis"><em><span class="replaceable replaceable">selected-profile</span></em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Reboot the system:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7dwj31a"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># reboot</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify that the <span class="strong strong"><strong>TuneD</strong></span> profile is active and applied:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--689nnq4"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm verify

Verification succeeded, current system settings match the preset profile.
See tuned log file ('/var/log/tuned/tuned.log') for details.</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-adm(8)</code> man page
					</li></ul></div></section><section class="section" id="disabling-tuned_getting-started-with-tuned"><div class="titlepage"><div><div><h2 class="title">1.16. Disabling TuneD</h2></div></div></div><p class="_abstract _abstract">
				This procedure disables <span class="strong strong"><strong>TuneD</strong></span> and resets all affected system settings to their original state before <span class="strong strong"><strong>TuneD</strong></span> modified them.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To disable all tunings temporarily:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--rsyt7j0"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm off</pre></div></div><p class="simpara">
						The tunings are applied again after the <code class="literal">TuneD</code> service restarts.
					</p></li><li class="listitem"><p class="simpara">
						Alternatively, to stop and disable the <code class="literal">TuneD</code> service permanently:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fy4g8bk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl disable --now tuned</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-adm(8)</code> man page
					</li></ul></div></section></section><section class="chapter" id="customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 2. Customizing TuneD profiles</h1></div></div></div><p class="_abstract _abstract">
			You can create or modify <span class="strong strong"><strong>TuneD</strong></span> profiles to optimize system performance for your intended use case.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					Install and enable <span class="strong strong"><strong>TuneD</strong></span> as described in <a class="link" href="#installing-and-enabling-tuned_getting-started-with-tuned" title="1.13.&nbsp;Installing and enabling TuneD">Installing and Enabling TuneD</a> for details.
				</li></ul></div><section class="section" id="tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.1. TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				A detailed analysis of a system can be very time-consuming. <span class="strong strong"><strong>TuneD</strong></span> provides a number of predefined profiles for typical use cases. You can also create, modify, and delete profiles.
			</p><p>
				The profiles provided with <span class="strong strong"><strong>TuneD</strong></span> are divided into the following categories:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Power-saving profiles
					</li><li class="listitem">
						Performance-boosting profiles
					</li></ul></div><p>
				The performance-boosting profiles include profiles that focus on the following aspects:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Low latency for storage and network
					</li><li class="listitem">
						High throughput for storage and network
					</li><li class="listitem">
						Virtual machine performance
					</li><li class="listitem">
						Virtualization host performance
					</li></ul></div><h4 id="syntax_of_profile_configuration_2">Syntax of profile configuration</h4><p>
				The <code class="literal">tuned.conf</code> file can contain one <code class="literal">[main]</code> section and other sections for configuring plug-in instances. However, all sections are optional.
			</p><p>
				Lines starting with the hash sign (<code class="literal">#</code>) are comments.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page.
					</li></ul></div></section><section class="section" id="the-default-tuned-profile_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.2. The default TuneD profile</h2></div></div></div><p class="_abstract _abstract">
				During the installation, the best profile for your system is 
selected automatically. Currently, the default profile is selected 
according to the following customizable rules:
			</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="g1ci80t" id="rh-table--g1ci80t" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 29%; " class="col_1"><!--Empty--><col style="width: 29%; " class="col_2"><!--Empty--><col style="width: 43%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611483403968" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Environment</th><th id="idm140611483402880" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Default profile</th><th id="idm140611483401792" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">Goal</th></tr></thead><tbody><tr><td headers="idm140611483403968" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								Compute nodes
							</p>
							 </td><td headers="idm140611483402880" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">throughput-performance</code>
							</p>
							 </td><td headers="idm140611483401792" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
								The best throughput performance
							</p>
							 </td></tr><tr><td headers="idm140611483403968" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								Virtual machines
							</p>
							 </td><td headers="idm140611483402880" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">virtual-guest</code>
							</p>
							 </td><td headers="idm140611483401792" data-row="3" data-col="3" class="content--lg" valign="top" align="left"> <p>
								The best performance. If you are not interested in the best performance, you can change it to the <code class="literal">balanced</code> or <code class="literal">powersave</code> profile.
							</p>
							 </td></tr><tr><td headers="idm140611483403968" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								Other cases
							</p>
							 </td><td headers="idm140611483402880" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">balanced</code>
							</p>
							 </td><td headers="idm140611483401792" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
								Balanced performance and power consumption
							</p>
							 </td></tr></tbody></table></rh-table><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page.
					</li></ul></div></section><section class="section" id="merged-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.3. Merged TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				As an experimental feature, it is possible to select more profiles at once. <span class="strong strong"><strong>TuneD</strong></span> will try to merge them during the load.
			</p><p>
				If there are conflicts, the settings from the last specified profile takes precedence.
			</p><div class="example" id="idm140611486621920"><p class="title">Example 2.1. Low power consumption in a virtual guest</p><div class="example-contents"><p>
					The following example optimizes the system to run in a virtual 
machine for the best performance and concurrently tunes it for low power
 consumption, while the low power consumption is the priority:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--a6n6nz8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile virtual-guest powersave</pre></div></div></div></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Merging is done automatically without checking whether the 
resulting combination of parameters makes sense. Consequently, the 
feature might tune some parameters the opposite way, which might be 
counterproductive: for example, setting the disk for high throughput by 
using the <code class="literal">throughput-performance</code> profile and concurrently setting the disk spindown to the low value by the <code class="literal">spindown-disk</code> profile.
				</p></div></div><div class="_additional-resources _additional-resources"><p class="title"><strong>Additional resources</strong></p><p>
					*<code class="literal">tuned-adm</code> man page. * <code class="literal">tuned.conf(5)</code> man page.
				</p></div></section><section class="section" id="the-location-of-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.4. The location of TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				<span class="strong strong"><strong>TuneD</strong></span> stores profiles in the following directories:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal filename">/usr/lib/tuned/</code></span></dt><dd>
							Distribution-specific profiles are stored in the directory. Each 
profile has its own directory. The profile consists of the main 
configuration file called <code class="literal">tuned.conf</code>, and optionally other files, for example helper scripts.
						</dd><dt><span class="term"><code class="literal filename">/etc/tuned/</code></span></dt><dd>
							If you need to customize a profile, copy the profile directory 
into the directory, which is used for custom profiles. If there are two 
profiles of the same name, the custom profile located in <code class="literal filename">/etc/tuned/</code> is used.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page.
					</li></ul></div></section><section class="section" id="inheritance-between-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.5. Inheritance between TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				<span class="strong strong"><strong>TuneD</strong></span> profiles can be based on other profiles and modify only certain aspects of their parent profile.
			</p><p>
				The <code class="literal">[main]</code> section of <span class="strong strong"><strong>TuneD</strong></span> profiles recognizes the <code class="literal option">include</code> option:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2bsr6dc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[main]
include=<span class="emphasis"><em><span class="replaceable replaceable">parent</span></em></span></pre></div></div><p>
				All settings from the <span class="emphasis"><em><span class="replaceable replaceable">parent</span></em></span> profile are loaded in this <span class="emphasis"><em>child</em></span> profile. In the following sections, the <span class="emphasis"><em>child</em></span> profile can override certain settings inherited from the <span class="emphasis"><em><span class="replaceable replaceable">parent</span></em></span> profile or add new settings not present in the <span class="emphasis"><em><span class="replaceable replaceable">parent</span></em></span> profile.
			</p><p>
				You can create your own <span class="emphasis"><em>child</em></span> profile in the <code class="literal filename">/etc/tuned/</code> directory based on a pre-installed profile in <code class="literal filename">/usr/lib/tuned/</code> with only some parameters adjusted.
			</p><p>
				If the <span class="emphasis"><em><span class="replaceable replaceable">parent</span></em></span> profile is updated, such as after a <span class="strong strong"><strong>TuneD</strong></span> upgrade, the changes are reflected in the <span class="emphasis"><em>child</em></span> profile.
			</p><div class="example" id="idm140611495605952"><p class="title">Example 2.2. A power-saving profile based on balanced</p><div class="example-contents"><p>
					The following is an example of a custom profile that extends the <code class="literal">balanced</code> profile and sets Aggressive Link Power Management (ALPM) for all devices to the maximum powersaving.
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--blz17wn"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[main]
include=balanced

[scsi_host]
alpm=min_power</pre></div></div></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></section><section class="section" id="static-and-dynamic-tuning-in-tuned_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.6. Static and dynamic tuning in TuneD</h2></div></div></div><p class="_abstract _abstract">
				Understanding the difference between the two categories of system tuning that <span class="strong strong"><strong>TuneD</strong></span> applies, <span class="emphasis"><em>static</em></span> and <span class="emphasis"><em>dynamic</em></span>, is important when determining which one to use for a given situation or purpose.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Static tuning</span></dt><dd>
							Mainly consists of the application of predefined <code class="literal">sysctl</code> and <code class="literal">sysfs</code> settings and one-shot activation of several configuration tools such as <code class="literal">ethtool</code>.
						</dd><dt><span class="term">Dynamic tuning</span></dt><dd><p class="simpara">
							Watches how various system components are used throughout the uptime of your system. <span class="strong strong"><strong>TuneD</strong></span> adjusts system settings dynamically based on that monitoring information.
						</p><p class="simpara">
							For example, the hard drive is used heavily during startup and 
login, but is barely used later when the user might mainly work with 
applications such as web browsers or email clients. Similarly, the CPU 
and network devices are used differently at different times. <span class="strong strong"><strong>TuneD</strong></span> monitors the activity of these components and reacts to the changes in their use.
						</p><p class="simpara">
							By default, dynamic tuning is disabled. To enable it, edit the <code class="literal filename">/etc/tuned/tuned-main.conf</code> file and change the <code class="literal option">dynamic_tuning</code> option to <code class="literal">1</code>. <span class="strong strong"><strong>TuneD</strong></span>
 then periodically analyzes system statistics and uses them to update 
your system tuning settings. To configure the time interval in seconds 
between these updates, use the <code class="literal option">update_interval</code> option.
						</p><p class="simpara">
							Currently implemented dynamic tuning algorithms try to balance 
the performance and powersave, and are therefore disabled in the 
performance profiles. Dynamic tuning for individual plug-ins can be 
enabled or disabled in the <span class="strong strong"><strong>TuneD</strong></span> profiles.
						</p></dd></dl></div><div class="example" id="idm140611473146768"><p class="title">Example 2.3. Static and dynamic tuning on a workstation</p><div class="example-contents"><p>
					On a typical office workstation, the Ethernet network interface is 
inactive most of the time. Only a few emails go in and out or some web 
pages might be loaded.
				</p><p>
					For those kinds of loads, the network interface does not have to run at full speed all the time, as it does by default. <span class="strong strong"><strong>TuneD</strong></span>
 has a monitoring and tuning plug-in for network devices that can detect
 this low activity and then automatically lower the speed of that 
interface, typically resulting in a lower power usage.
				</p><p>
					If the activity on the interface increases for a longer period of 
time, for example because a DVD image is being downloaded or an email 
with a large attachment is opened, <span class="strong strong"><strong>TuneD</strong></span> detects this and sets the interface speed to maximum to offer the best performance while the activity level is high.
				</p><p>
					This principle is used for other plug-ins for CPU and disks as well.
				</p></div></div></section><section class="section" id="tuned-plug-ins_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.7. TuneD plug-ins</h2></div></div></div><p class="_abstract _abstract">
				Plug-ins are modules in <span class="strong strong"><strong>TuneD</strong></span> profiles that <span class="strong strong"><strong>TuneD</strong></span> uses to monitor or optimize different devices on the system.
			</p><p>
				<span class="strong strong"><strong>TuneD</strong></span> uses two types of plug-ins:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Monitoring plug-ins</span></dt><dd><p class="simpara">
							Monitoring plug-ins are used to get information from a running 
system. The output of the monitoring plug-ins can be used by tuning 
plug-ins for dynamic tuning.
						</p><p class="simpara">
							Monitoring plug-ins are automatically instantiated whenever their
 metrics are needed by any of the enabled tuning plug-ins. If two tuning
 plug-ins require the same data, only one instance of the monitoring 
plug-in is created and the data is shared.
						</p></dd><dt><span class="term">Tuning plug-ins</span></dt><dd>
							Each tuning plug-in tunes an individual subsystem and takes 
several parameters that are populated from the TuneD profiles. Each 
subsystem can have multiple devices, such as multiple CPUs or network 
cards, that are handled by individual instances of the tuning plug-ins. 
Specific settings for individual devices are also supported.
						</dd></dl></div><h4 id="syntax_for_plug_ins_in_tuned_profiles">Syntax for plug-ins in TuneD profiles</h4><p>
				Sections describing plug-in instances are formatted in the following way:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--0w2iepj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[<span class="emphasis"><em>NAME</em></span>]
type=<span class="emphasis"><em>TYPE</em></span>
devices=<span class="emphasis"><em>DEVICES</em></span></pre></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">NAME</span></dt><dd>
							is the name of the plug-in instance as it is used in the logs. It can be an arbitrary string.
						</dd><dt><span class="term">TYPE</span></dt><dd>
							is the type of the tuning plug-in.
						</dd><dt><span class="term">DEVICES</span></dt><dd><p class="simpara">
							is the list of devices that this plug-in instance handles.
						</p><p class="simpara">
							The <code class="literal">devices</code> line can contain a list, a wildcard (<code class="literal">*</code>), and negation (<code class="literal">!</code>). If there is no <code class="literal">devices</code> line, all devices present or later attached on the system of the <span class="emphasis"><em><span class="replaceable replaceable">TYPE</span></em></span> are handled by the plug-in instance. This is same as using the <code class="literal option">devices=*</code> option.
						</p><div class="example" id="idm140611494369184"><p class="title">Example 2.4. Matching block devices with a plug-in</p><div class="example-contents"><p>
								The following example matches all block devices starting with <code class="literal">sd</code>, such as <code class="literal">sda</code> or <code class="literal">sdb</code>, and does not disable barriers on them:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--v5zovn6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[data_disk]
type=disk
devices=sd*
disable_barriers=false</pre></div></div><p>
								The following example matches all block devices except <code class="literal">sda1</code> and <code class="literal">sda2</code>:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2z6l1f4"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[data_disk]
type=disk
devices=!sda1, !sda2
disable_barriers=false</pre></div></div></div></div></dd></dl></div><p>
				If no instance of a plug-in is specified, the plug-in is not enabled.
			</p><p>
				If the plug-in supports more options, they can be also specified in 
the plug-in section. If the option is not specified and it was not 
previously specified in the included plug-in, the default value is used.
			</p><h4 id="short_plug_in_syntax">Short plug-in syntax</h4><p>
				If you do not need custom names for the plug-in instance and there 
is only one definition of the instance in your configuration file, <span class="strong strong"><strong>TuneD</strong></span> supports the following short syntax:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8ru1age"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[<span class="emphasis"><em>TYPE</em></span>]
devices=<span class="emphasis"><em>DEVICES</em></span></pre></div></div><p>
				In this case, it is possible to omit the <code class="literal">type</code> line. The instance is then referred to with a name, same as the type. The previous example could be then rewritten into:
			</p><div class="example" id="idm140611472877648"><p class="title">Example 2.5. Matching block devices using the short syntax</p><div class="example-contents"><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ohc80lc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[disk]
devices=sdb*
disable_barriers=false</pre></div></div></div></div><h4 id="conflicting_plug_in_definitions_in_a_profile">Conflicting plug-in definitions in a profile</h4><p>
				If the same section is specified more than once using the <code class="literal">include</code>
 option, the settings are merged. If they cannot be merged due to a 
conflict, the last conflicting definition overrides the previous 
settings. If you do not know what was previously defined, you can use 
the <code class="literal option">replace</code> Boolean option and set it to <code class="literal">true</code>. This causes all the previous definitions with the same name to be overwritten and the merge does not happen.
			</p><p>
				You can also disable the plug-in by specifying the <code class="literal option">enabled=false</code>
 option. This has the same effect as if the instance was never defined. 
Disabling the plug-in is useful if you are redefining the previous 
definition from the <code class="literal option">include</code> option and do not want the plug-in to be active in your custom profile.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">NOTE</span></dt><dd><p class="simpara">
							<span class="strong strong"><strong>TuneD</strong></span> includes the ability to run any shell command as part of enabling or disabling a tuning profile. This enables you to extend <span class="strong strong"><strong>TuneD</strong></span> profiles with functionality that has not been integrated into TuneD yet.
						</p><p class="simpara">
							You can specify arbitrary shell commands using the <code class="literal">script</code> plug-in.
						</p></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></section><section class="section" id="available-tuned-plug-ins_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.8. Available TuneD plug-ins</h2></div></div></div><h4 id="monitoring_plug_ins">Monitoring plug-ins</h4><p>
				Currently, the following monitoring plug-ins are implemented:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">disk</code></span></dt><dd>
							Gets disk load (number of IO operations) per device and measurement interval.
						</dd><dt><span class="term"><code class="literal">net</code></span></dt><dd>
							Gets network load (number of transferred packets) per network card and measurement interval.
						</dd><dt><span class="term"><code class="literal">load</code></span></dt><dd>
							Gets CPU load per CPU and measurement interval.
						</dd></dl></div><h4 id="tuning_plug_ins">Tuning plug-ins</h4><p>
				Currently, the following tuning plug-ins are implemented. Only some 
of these plug-ins implement dynamic tuning. Options supported by 
plug-ins are also listed:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">cpu</code></span></dt><dd><p class="simpara">
							Sets the CPU governor to the value specified by the <code class="literal option">governor</code>
 option and dynamically changes the Power Management Quality of Service 
(PM QoS) CPU Direct Memory Access (DMA) latency according to the CPU 
load.
						</p><p class="simpara">
							If the CPU load is lower than the value specified by the <code class="literal option">load_threshold</code> option, the latency is set to the value specified by the <code class="literal option">latency_high</code> option, otherwise it is set to the value specified by <code class="literal option">latency_low</code>.
						</p><p class="simpara">
							You can also force the latency to a specific value and prevent it from dynamically changing further. To do so, set the <code class="literal option">force_latency</code> option to the required latency value.
						</p></dd><dt><span class="term"><code class="literal">eeepc_she</code></span></dt><dd><p class="simpara">
							Dynamically sets the front-side bus (FSB) speed according to the CPU load.
						</p><p class="simpara">
							This feature can be found on some netbooks and is also known as the ASUS Super Hybrid Engine (SHE).
						</p><p class="simpara">
							If the CPU load is lower or equal to the value specified by the <code class="literal option">load_threshold_powersave</code> option, the plug-in sets the FSB speed to the value specified by the <code class="literal option">she_powersave</code> option. If the CPU load is higher or equal to the value specified by the <code class="literal option">load_threshold_normal</code> option, it sets the FSB speed to the value specified by the <code class="literal option">she_normal</code> option.
						</p><p class="simpara">
							Static tuning is not supported and the plug-in is transparently disabled if <span class="strong strong"><strong>TuneD</strong></span> does not detect the hardware support for this feature.
						</p></dd><dt><span class="term"><code class="literal">net</code></span></dt><dd>
							Configures the Wake-on-LAN functionality to the values specified by the <code class="literal option">wake_on_lan</code> option. It uses the same syntax as the <code class="literal">ethtool</code> utility. It also dynamically changes the interface speed according to the interface utilization.
						</dd><dt><span class="term"><code class="literal">sysctl</code></span></dt><dd><p class="simpara">
							Sets various <code class="literal">sysctl</code> settings specified by the plug-in options.
						</p><p class="simpara">
							The syntax is <code class="literal"><span class="emphasis"><em><span class="replaceable replaceable">name</span></em></span>=<span class="emphasis"><em><span class="replaceable replaceable">value</span></em></span></code>, where <span class="emphasis"><em><span class="replaceable replaceable">name</span></em></span> is the same as the name provided by the <code class="literal">sysctl</code> utility.
						</p><p class="simpara">
							Use the <code class="literal">sysctl</code> plug-in if you need to change system settings that are not covered by other plug-ins available in <span class="strong strong"><strong>TuneD</strong></span>. If the settings are covered by some specific plug-ins, prefer these plug-ins.
						</p></dd><dt><span class="term"><code class="literal">usb</code></span></dt><dd><p class="simpara">
							Sets autosuspend timeout of USB devices to the value specified by the <code class="literal option">autosuspend</code> parameter.
						</p><p class="simpara">
							The value <code class="literal">0</code> means that autosuspend is disabled.
						</p></dd><dt><span class="term"><code class="literal">vm</code></span></dt><dd><p class="simpara">
							Enables or disables transparent huge pages depending on the value of the <code class="literal option">transparent_hugepages</code> option.
						</p><p class="simpara">
							Valid values of the <code class="literal option">transparent_hugepages</code> option are:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									"always"
								</li><li class="listitem">
									"never"
								</li><li class="listitem">
									"madvise"
								</li></ul></div></dd><dt><span class="term"><code class="literal">audio</code></span></dt><dd><p class="simpara">
							Sets the autosuspend timeout for audio codecs to the value specified by the <code class="literal option">timeout</code> option.
						</p><p class="simpara">
							Currently, the <code class="literal">snd_hda_intel</code> and <code class="literal">snd_ac97_codec</code> codecs are supported. The value <code class="literal">0</code> means that the autosuspend is disabled. You can also enforce the controller reset by setting the Boolean option <code class="literal option">reset_controller</code> to <code class="literal">true</code>.
						</p></dd><dt><span class="term"><code class="literal">disk</code></span></dt><dd><p class="simpara">
							Sets the disk elevator to the value specified by the <code class="literal option">elevator</code> option.
						</p><p class="simpara">
							It also sets:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									APM to the value specified by the <code class="literal option">apm</code> option
								</li><li class="listitem">
									Scheduler quantum to the value specified by the <code class="literal option">scheduler_quantum</code> option
								</li><li class="listitem">
									Disk spindown timeout to the value specified by the <code class="literal option">spindown</code> option
								</li><li class="listitem">
									Disk readahead to the value specified by the <code class="literal option">readahead</code> parameter
								</li><li class="listitem">
									The current disk readahead to a value multiplied by the constant specified by the <code class="literal option">readahead_multiply</code> option
								</li></ul></div><p class="simpara">
							In addition, this plug-in dynamically changes the advanced power 
management and spindown timeout setting for the drive according to the 
current drive utilization. The dynamic tuning can be controlled by the 
Boolean option <code class="literal option">dynamic</code> and is enabled by default.
						</p></dd><dt><span class="term"><code class="literal">scsi_host</code></span></dt><dd><p class="simpara">
							Tunes options for SCSI hosts.
						</p><p class="simpara">
							It sets Aggressive Link Power Management (ALPM) to the value specified by the <code class="literal option">alpm</code> option.
						</p></dd><dt><span class="term"><code class="literal">mounts</code></span></dt><dd>
							Enables or disables barriers for mounts according to the Boolean value of the <code class="literal option">disable_barriers</code> option.
						</dd><dt><span class="term"><code class="literal">script</code></span></dt><dd><p class="simpara">
							Executes an external script or binary when the profile is loaded or unloaded. You can choose an arbitrary executable.
						</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								The <code class="literal">script</code> plug-in is provided mainly for compatibility with earlier releases. Prefer other <span class="strong strong"><strong>TuneD</strong></span> plug-ins if they cover the required functionality.
							</p></div></div><p class="simpara">
							<span class="strong strong"><strong>TuneD</strong></span> calls the executable with one of the following arguments:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">start</code> when loading the profile
								</li><li class="listitem">
									<code class="literal">stop</code> when unloading the profile
								</li></ul></div><p class="simpara">
							You need to correctly implement the <code class="literal">stop</code> action in your executable and revert all settings that you changed during the <code class="literal">start</code> action. Otherwise, the roll-back step after changing your <span class="strong strong"><strong>TuneD</strong></span> profile will not work.
						</p><p class="simpara">
							Bash scripts can import the <code class="literal filename">/usr/lib/tuned/functions</code> Bash library and use the functions defined there. Use these functions only for functionality that is not natively provided by <span class="strong strong"><strong>TuneD</strong></span>. If a function name starts with an underscore, such as <code class="literal">_wifi_set_power_level</code>, consider the function private and do not use it in your scripts, because it might change in the future.
						</p><p class="simpara">
							Specify the path to the executable using the <code class="literal">script</code> parameter in the plug-in configuration.
						</p><div class="example" id="idm140611486953648"><p class="title">Example 2.6. Running a Bash script from a profile</p><div class="example-contents"><p>
								To run a Bash script named <code class="literal">script.sh</code> that is located in the profile directory, use:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--bgh5b9w"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[script]
script=${i:PROFILE_DIR}/script.sh</pre></div></div></div></div></dd><dt><span class="term"><code class="literal">sysfs</code></span></dt><dd><p class="simpara">
							Sets various <code class="literal">sysfs</code> settings specified by the plug-in options.
						</p><p class="simpara">
							The syntax is <code class="literal"><span class="emphasis"><em><span class="replaceable replaceable">name</span></em></span>=<span class="emphasis"><em><span class="replaceable replaceable">value</span></em></span></code>, where <span class="emphasis"><em><span class="replaceable replaceable">name</span></em></span> is the <code class="literal">sysfs</code> path to use.
						</p><p class="simpara">
							Use this plugin in case you need to change some settings that are
 not covered by other plug-ins. Prefer specific plug-ins if they cover 
the required settings.
						</p></dd><dt><span class="term"><code class="literal">video</code></span></dt><dd><p class="simpara">
							Sets various powersave levels on video cards. Currently, only the Radeon cards are supported.
						</p><p class="simpara">
							The powersave level can be specified by using the <code class="literal option">radeon_powersave</code> option. Supported values are:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">default</code>
								</li><li class="listitem">
									<code class="literal">auto</code>
								</li><li class="listitem">
									<code class="literal">low</code>
								</li><li class="listitem">
									<code class="literal">mid</code>
								</li><li class="listitem">
									<code class="literal">high</code>
								</li><li class="listitem">
									<code class="literal">dynpm</code>
								</li><li class="listitem">
									<code class="literal">dpm-battery</code>
								</li><li class="listitem">
									<code class="literal">dpm-balanced</code>
								</li><li class="listitem">
									<code class="literal">dpm-perfomance</code>
								</li></ul></div><p class="simpara">
							For details, see <a class="link" href="http://www.x.org/wiki/RadeonFeature#KMS_Power_Management_Options">www.x.org</a>. Note that this plug-in is experimental and the option might change in future releases.
						</p></dd><dt><span class="term"><code class="literal">bootloader</code></span></dt><dd><p class="simpara">
							Adds options to the kernel command line. This plug-in supports only the GRUB 2 boot loader.
						</p><p class="simpara">
							Customized non-standard location of the GRUB 2 configuration file can be specified by the <code class="literal option">grub2_cfg_file</code> option.
						</p><p class="simpara">
							The kernel options are added to the current GRUB configuration 
and its templates. The system needs to be rebooted for the kernel 
options to take effect.
						</p><p class="simpara">
							Switching to another profile or manually stopping the <code class="literal">TuneD</code> service removes the additional options. If you shut down or reboot the system, the kernel options persist in the <code class="literal filename">grub.cfg</code> file.
						</p><p class="simpara">
							The kernel options can be specified by the following syntax:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fg6bb1p"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">cmdline=<span class="emphasis"><em><span class="replaceable replaceable">arg1</span></em></span> <span class="emphasis"><em><span class="replaceable replaceable">arg2</span></em></span> ... <span class="emphasis"><em><span class="replaceable replaceable">argN</span></em></span></pre></div></div><div class="example" id="idm140611495549936"><p class="title">Example 2.7. Modifying the kernel command line</p><div class="example-contents"><p>
								For example, to add the <code class="literal option">quiet</code> kernel option to a <span class="strong strong"><strong>TuneD</strong></span> profile, include the following lines in the <code class="literal filename">tuned.conf</code> file:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gx633ne"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[bootloader]
cmdline=quiet</pre></div></div><p>
								The following is an example of a custom profile that adds the <code class="literal option">isolcpus=2</code> option to the kernel command line:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--iidr60m"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[bootloader]
cmdline=isolcpus=2</pre></div></div></div></div></dd><dt><span class="term"><code class="literal">service</code></span></dt><dd><p class="simpara">
							Handles various <code class="literal">sysvinit</code>, <code class="literal">sysv-rc</code>, <code class="literal">openrc</code>, and <code class="literal">systemd</code> services specified by the plug-in options.
						</p><p class="simpara">
							The syntax is <code class="literal">service.<span class="emphasis"><em>service_name</em></span>=<span class="emphasis"><em>command</em></span>[,file:<span class="emphasis"><em>file</em></span>]</code>.
						</p><p class="simpara">
							Supported service-handling commands are:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">start</code>
								</li><li class="listitem">
									<code class="literal">stop</code>
								</li><li class="listitem">
									<code class="literal">enable</code>
								</li><li class="listitem">
									<code class="literal">disable</code>
								</li></ul></div><p class="simpara">
							Separate multiple commands using either a comma (<code class="literal">,</code>) or a semicolon (<code class="literal">;</code>). If the directives conflict, the <code class="literal">service</code> plugin uses the last listed one.
						</p><p class="simpara">
							Use the optional <code class="literal">file:<span class="emphasis"><em>file</em></span></code> directive to install an overlay configuration file, <code class="literal"><span class="emphasis"><em>file</em></span></code>, for <code class="literal">systemd</code> only. Other init systems ignore this directive. The <code class="literal">service</code> plugin copies overlay configuration files to <code class="literal">/etc/systemd/system/<span class="emphasis"><em>service_name</em></span>.service.d/</code> directories. Once profiles are unloaded, the <code class="literal">service</code> plugin removes these directories if they are empty.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								The <code class="literal">service</code> plugin only operates on the current runlevel with non-<code class="literal">systemd</code> init systems.
							</p></div></div><div class="example" id="idm140611491764208"><p class="title">Example 2.8. Starting and enabling the sendmail sendmail service with an overlay file</p><div class="example-contents"><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--dnr6zlg"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[service]
service.sendmail=start,enable,file:${i:PROFILE_DIR}/tuned-sendmail.conf</pre></div></div><p>
								The internal variable <code class="literal">${i:PROFILE_DIR}</code> points to the directory the plugin loads the profile from.
							</p></div></div></dd><dt><span class="term"><code class="literal">scheduler</code></span></dt><dd>
							Offers a variety of options for the tuning of scheduling 
priorities, CPU core isolation, and process, thread, and IRQ affinities.
						</dd></dl></div><p>
				For specifics of the different options available, see <a class="link" href="#functionalities-of-the-scheduler-tuned-plug-in_customizing-tuned-profiles" title="2.9.&nbsp;Functionalities of the scheduler TuneD plugin">Functionalities of the <code class="literal">scheduler</code> TuneD plug-in</a>.
			</p></section><section class="section" id="functionalities-of-the-scheduler-tuned-plug-in_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.9. Functionalities of the scheduler TuneD plugin</h2></div></div></div><p>
				Use the <code class="literal">scheduler</code> <span class="strong strong"><strong>TuneD</strong></span> plugin to control and tune scheduling priorities, CPU core isolation, and process, thread, and IRQ afinities.
			</p><div class="formalpara"><p class="title"><strong>CPU isolation</strong></p><p>
					To prevent processes, threads, and IRQs from using certain CPUs, use the <code class="literal option">isolated_cores</code> option. It changes process and thread affinities, IRQ affinities, and sets the <code class="literal">default_smp_affinity</code> parameter for IRQs.
				</p></div><p>
				The CPU affinity mask is adjusted for all processes and threads matching the <code class="literal option">ps_whitelist</code> option, subject to success of the <code class="literal">sched_setaffinity()</code> system call. The default setting of the <code class="literal option">ps_whitelist</code> regular expression is <code class="literal">.*</code> to match all processes and thread names. To exclude certain processes and threads, use the <code class="literal option">ps_blacklist</code>
 option. The value of this option is also interpreted as a regular 
expression. Process and thread names are matched against that 
expression. Profile rollback enables all matching processes and threads 
to run on all CPUs, and restores the IRQ settings prior to the profile 
application.
			</p><p>
				Multiple regular expressions separated by <code class="literal">;</code> for the <code class="literal option">ps_whitelist</code> and <code class="literal option">ps_blacklist</code> options are supported. Escaped semicolon <code class="literal">\;</code> is taken literally.
			</p><div class="example" id="idm140611480774928"><p class="title">Example 2.9. Isolate CPUs 2-4</p><div class="example-contents"><p>
					The following configuration isolates CPUs 2-4. Processes and threads that match the <code class="literal">ps_blacklist</code> regular expression can use any CPUs regardless of the isolation:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5gvhtr3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
isolated_cores=2-4
ps_blacklist=.*pmd.*;.*PMD.*;^DPDK;.*qemu-kvm.*</pre></div></div></div></div><div class="formalpara"><p class="title"><strong>IRQ SMP affinity</strong></p><p>
					The <code class="literal">/proc/irq/default_smp_affinity</code> 
file contains a bitmask representing the default target CPU cores on a 
system for all inactive interrupt request (IRQ) sources. Once an IRQ is 
activated or allocated, the value in the <code class="literal">/proc/irq/default_smp_affinity</code> file determines the IRQ’s affinity bitmask.
				</p></div><p>
				The <code class="literal">default_irq_smp_affinity</code> parameter controls what <span class="strong strong"><strong>TuneD</strong></span> writes to the <code class="literal">/proc/irq/default_smp_affinity</code> file. The <code class="literal">default_irq_smp_affinity</code> parameter supports the following values and behaviors:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">calc</code></span></dt><dd><p class="simpara">
							Calculates the content of the <code class="literal">/proc/irq/default_smp_affinity</code> file from the <code class="literal">isolated_cores</code> parameter. An inversion of the <code class="literal">isolated_cores</code> parameter calculates the non-isolated cores.
						</p><p class="simpara">
							The intersection of the non-isolated cores and the previous content of the <code class="literal">/proc/irq/default_smp_affinity</code> file is then written to the <code class="literal">/proc/irq/default_smp_affinity</code> file.
						</p><p class="simpara">
							This is the default behavior if the <code class="literal">default_irq_smp_affinity</code> parameter is omitted.
						</p></dd><dt><span class="term"><code class="literal">ignore</code></span></dt><dd>
							<span class="strong strong"><strong>TuneD</strong></span> does not modify the <code class="literal">/proc/irq/default_smp_affinity</code> file.
						</dd><dt><span class="term">A CPU list</span></dt><dd><p class="simpara">
							Takes the form of a single number such as <code class="literal">1</code>, a comma separated list such as <code class="literal">1,3</code>, or a range such as <code class="literal">3-5</code>.
						</p><p class="simpara">
							Unpacks the CPU list and writes it directly to the <code class="literal">/proc/irq/default_smp_affinity</code> file.
						</p></dd></dl></div><div class="example" id="idm140611487946032"><p class="title">Example 2.10. Setting the default IRQ smp affinity using an explicit CPU list</p><div class="example-contents"><p>
					The following example uses an explicit CPU list to set the default IRQ SMP affinity to CPUs 0 and 2:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--9jihya3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
isolated_cores=1,3
default_irq_smp_affinity=0,2</pre></div></div></div></div><div class="formalpara"><p class="title"><strong>Scheduling policy</strong></p><p>
					To adjust scheduling policy, priority and affinity for a group of processes or threads, use the following syntax:
				</p></div><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--1z4nau6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">group.<span class="emphasis"><em>groupname</em></span>=<span class="emphasis"><em>rule_prio</em></span>:<span class="emphasis"><em>sched</em></span>:<span class="emphasis"><em>prio</em></span>:<span class="emphasis"><em>affinity</em></span>:<span class="emphasis"><em>regex</em></span></pre></div></div><p>
				where <code class="literal"><span class="emphasis"><em>rule_prio</em></span></code> defines internal <span class="strong strong"><strong>TuneD</strong></span>
 priority of the rule. Rules are sorted based on priority. This is 
needed for inheritance to be able to reorder previously defined rules. 
Equal <code class="literal"><span class="emphasis"><em>rule_prio</em></span></code>
 rules should be processed in the order they were defined. However, this
 is Python interpreter dependent. To disable an inherited rule for <code class="literal"><span class="emphasis"><em>groupname</em></span></code>, use:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gf8se95"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">group.<span class="emphasis"><em>groupname</em></span>=</pre></div></div><p>
				<code class="literal"><span class="emphasis"><em>sched</em></span></code> must be one of the following:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">f</code></span></dt><dd>
							for first in, first out (FIFO)
						</dd><dt><span class="term"><code class="literal">b</code></span></dt><dd>
							for batch
						</dd><dt><span class="term"><code class="literal">r</code></span></dt><dd>
							for round robin
						</dd><dt><span class="term"><code class="literal">o</code></span></dt><dd>
							for other
						</dd><dt><span class="term"><code class="literal">*</code></span></dt><dd>
							for do not change
						</dd></dl></div><p>
				<code class="literal"><span class="emphasis"><em>affinity</em></span></code> is CPU affinity in hexadecimal. Use <code class="literal">*</code> for no change.
			</p><p>
				<code class="literal"><span class="emphasis"><em>prio</em></span></code> is scheduling priority (see <code class="literal">chrt -m</code>).
			</p><p>
				<code class="literal"><span class="emphasis"><em>regex</em></span></code> is Python regular expression. It is matched against the output of the <code class="literal">ps -eo cmd</code> command.
			</p><p>
				Any given process name can match more than one group. In such cases, the last matching <code class="literal"><span class="emphasis"><em>regex</em></span></code> determines the priority and scheduling policy.
			</p><div class="example" id="idm140611480497248"><p class="title">Example 2.11. Setting scheduling policies and priorities</p><div class="example-contents"><p>
					The following example sets the scheduling policy and priorities to kernel threads and watchdog:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--czrxitk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
group.kthreads=0:*:1:*:\[.*\]$
group.watchdog=0:f:99:*:\[watchdog.*\]</pre></div></div></div></div><p>
				The <code class="literal">scheduler</code> plugin uses a <code class="literal">perf</code> event loop to identify newly created processes. By default, it listens to <code class="literal">perf.RECORD_COMM</code> and <code class="literal">perf.RECORD_EXIT</code> events.
			</p><p>
				Setting the <code class="literal">perf_process_fork</code> parameter to <code class="literal">true</code> tells the plug-in to also listen to <code class="literal">perf.RECORD_FORK</code> events, meaning that child processes created by the <code class="literal">fork()</code> system call are processed.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Processing <code class="literal">perf</code> events can pose a significant CPU overhead.
				</p></div></div><p>
				The CPU overhead of the scheduler plugin can be mitigated by using the scheduler <code class="literal option">runtime</code> option and setting it to <code class="literal">0</code>.
 This completely disables the dynamic scheduler functionality and the 
perf events are not monitored and acted upon. The disadvantage of this 
is that the process and thread tuning will be done only at profile 
application.
			</p><div class="example" id="idm140611494927616"><p class="title">Example 2.12. Disabling the dynamic scheduler functionality</p><div class="example-contents"><p>
					The following example disables the dynamic scheduler functionality while also isolating CPUs 1 and 3:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--24kleil"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
runtime=0
isolated_cores=1,3</pre></div></div></div></div><p>
				The <code class="literal">mmapped</code> buffer is used for <code class="literal">perf</code>
 events. Under heavy loads, this buffer might overflow and as a result 
the plugin might start missing events and not processing some newly 
created processes. In such cases, use the <code class="literal">perf_mmap_pages</code> parameter to increase the buffer size. The value of the <code class="literal">perf_mmap_pages</code> parameter must be a power of 2. If the <code class="literal">perf_mmap_pages</code> parameter is not manually set, a default value of 128 is used.
			</p><div class="formalpara"><p class="title"><strong>Confinement using <code class="literal">cgroups</code></strong></p><p>
					The <code class="literal">scheduler</code> plugin supports process and thread confinement using <code class="literal">cgroups</code> v1.
				</p></div><p>
				The <code class="literal option">cgroup_mount_point</code> option specifies the path to mount the cgroup file system, or, where <span class="strong strong"><strong>TuneD</strong></span> expects it to be mounted. If it is unset, <code class="literal">/sys/fs/cgroup/cpuset</code> is expected.
			</p><p>
				If the <code class="literal option">cgroup_groups_init</code> option is set to <code class="literal">1</code>, <span class="strong strong"><strong>TuneD</strong></span> creates and removes all <code class="literal">cgroups</code> defined with the <code class="literal">cgroup*</code> options. This is the default behavior. If the <code class="literal option">cgroup_mount_point</code> option is set to <code class="literal">0</code>, the <code class="literal">cgroups</code> must be preset by other means.
			</p><p>
				If the <code class="literal option">cgroup_mount_point_init</code> option is set to <code class="literal">1</code>, <span class="strong strong"><strong>TuneD</strong></span> creates and removes the cgroup mount point. It implies <code class="literal">cgroup_groups_init = 1</code>. If the <code class="literal option">cgroup_mount_point_init</code> option is set to <code class="literal">0</code>, you must preset the <code class="literal">cgroups</code> mount point by other means. This is the default behavior.
			</p><p>
				The <code class="literal option">cgroup_for_isolated_cores</code> option is the <code class="literal">cgroup</code> name for the <code class="literal option">isolated_cores</code> option functionality. For example, if a system has 4 CPUs, <code class="literal">isolated_cores=1</code> means that <span class="strong strong"><strong>Tuned</strong></span> moves all processes and threads to CPUs 0, 2, and 3. The <code class="literal">scheduler</code> plug-in isolates the specified core by writing the calculated CPU affinity to the <code class="literal">cpuset.cpus</code>
 control file of the specified cgroup and moves all the matching 
processes and threads to this group. If this option is unset, classic 
cpuset affinity using <code class="literal">sched_setaffinity()</code> sets the CPU affinity.
			</p><p>
				The <code class="literal option">cgroup.<span class="emphasis"><em>cgroup_name</em></span></code> option defines affinities for arbitrary <code class="literal">cgroups</code>. You can even use hierarchic cgroups, but you must specify the hierarchy in the correct order. <span class="strong strong"><strong>TuneD</strong></span> does not do any sanity checks here, with the exception that it forces the <code class="literal">cgroup</code> to be in the location specified by the <code class="literal option">cgroup_mount_point</code> option.
			</p><p>
				The syntax of the scheduler option starting with <code class="literal">group.</code> has been augmented to use <code class="literal">cgroup.<span class="emphasis"><em>cgroup_name</em></span></code> instead of the hexadecimal <code class="literal"><span class="emphasis"><em>affinity</em></span></code>. The matching processes are moved to the <code class="literal">cgroup</code> <code class="literal"><span class="emphasis"><em>cgroup_name</em></span></code>. You can also use cgroups not defined by the <code class="literal option">cgroup.</code> option as described above. For example, <code class="literal">cgroups</code> not managed by <span class="strong strong"><strong>TuneD</strong></span>.
			</p><p>
				All <code class="literal">cgroup</code> names are sanitized by replacing all periods (<code class="literal">.</code>) with slashes (<code class="literal">/</code>). This prevents the plugin from writing outside the location specified by the <code class="literal option">cgroup_mount_point</code> option.
			</p><div class="example" id="idm140611494887824"><p class="title">Example 2.13. Using cgroups v1 with the scheduler plug-in</p><div class="example-contents"><p>
					The following example creates 2 <code class="literal">cgroups</code>, <code class="literal">group1</code> and <code class="literal">group2</code>. It sets the cgroup <code class="literal">group1</code> affinity to CPU 2 and the <code class="literal">cgroup</code> <code class="literal">group2</code> to CPUs 0 and 2. Given a 4 CPU setup, the <code class="literal option">isolated_cores=1</code> option moves all processes and threads to CPU cores 0, 2, and 3. Processes and threads specified by the <code class="literal option">ps_blacklist</code> regular expression are not moved.
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--u6h9ch1"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
cgroup_mount_point=/sys/fs/cgroup/cpuset
cgroup_mount_point_init=1
cgroup_groups_init=1
cgroup_for_isolated_cores=group
cgroup.group1=2
cgroup.group2=0,2

group.ksoftirqd=0:f:2:cgroup.group1:ksoftirqd.*
ps_blacklist=ksoftirqd.*;rcuc.*;rcub.*;ktimersoftd.*
isolated_cores=1</pre></div></div></div></div><p>
				The <code class="literal option">cgroup_ps_blacklist</code> option excludes processes belonging to the specified <code class="literal">cgroups</code>. The regular expression specified by this option is matched against <code class="literal">cgroup</code> hierarchies from <code class="literal">/proc/<span class="emphasis"><em>PID</em></span>/cgroups</code>. Commas (<code class="literal">,</code>) separate <code class="literal">cgroups</code> v1 hierarchies from <code class="literal">/proc/<span class="emphasis"><em>PID</em></span>/cgroups</code> before regular expression matching. The following is an example of content the regular expression is matched against:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fjp7o0t"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">10:hugetlb:/,9:perf_event:/,8:blkio:/</pre></div></div><p>
				Multiple regular expressions can be separated by semicolons (<code class="literal">;</code>). The semicolon represents a logical 'or' operator.
			</p><div class="example" id="idm140611481877824"><p class="title">Example 2.14. Excluding processes from the scheduler using cgroups</p><div class="example-contents"><p>
					In the following example, the <code class="literal">scheduler</code> plug-in moves all processes away from core 1, except for processes which belong to cgroup <code class="literal">/daemons</code>. The <code class="literal">\b</code> string is a regular expression metacharacter that matches a word boundary.
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--501s8co"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
isolated_cores=1
cgroup_ps_blacklist=:/daemons\b</pre></div></div><p>
					In the following example, the <code class="literal">scheduler</code> plugin excludes all processes which belong to a cgroup with a hierarchy-ID of 8 and controller-list <code class="literal">blkio</code>.
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--81dnc5k"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
isolated_cores=1
cgroup_ps_blacklist=\b8:blkio:</pre></div></div></div></div><p>
				Recent kernels moved some <code class="literal">sched_</code> and <code class="literal">numa_balancing_</code> kernel run-time parameters from the <code class="literal">/proc/sys/kernel</code> directory managed by the <code class="literal">sysctl</code> utility, to <code class="literal">debugfs</code>, typically mounted under the <code class="literal">/sys/kernel/debug</code> directory. <span class="strong strong"><strong>TuneD</strong></span> provides an abstraction mechanism for the following parameters via the <code class="literal">scheduler</code> plugin where, based on the kernel used, <span class="strong strong"><strong>TuneD</strong></span> writes the specified value to the correct location:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal option">sched_min_granularity_ns</code>
					</li><li class="listitem">
						<code class="literal option">sched_latency_ns</code>,
					</li><li class="listitem">
						<code class="literal option">sched_wakeup_granularity_ns</code>
					</li><li class="listitem">
						<code class="literal option">sched_tunable_scaling</code>,
					</li><li class="listitem">
						<code class="literal option">sched_migration_cost_ns</code>
					</li><li class="listitem">
						<code class="literal option">sched_nr_migrate</code>
					</li><li class="listitem">
						<code class="literal option">numa_balancing_scan_delay_ms</code>
					</li><li class="listitem">
						<code class="literal option">numa_balancing_scan_period_min_ms</code>
					</li><li class="listitem">
						<code class="literal option">numa_balancing_scan_period_max_ms</code>
					</li><li class="listitem"><p class="simpara">
						<code class="literal option">numa_balancing_scan_size_mb</code>
					</p><div class="example" id="idm140611495811056"><p class="title">Example 2.15. Set tasks' "cache hot" value for migration decisions.</p><div class="example-contents"><p>
							On the old kernels, setting the following parameter meant that <code class="literal">sysctl</code> wrote a value of <code class="literal">500000</code> to the <code class="literal">/proc/sys/kernel/sched_migration_cost_ns</code> file:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zzpouna"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[sysctl]
kernel.sched_migration_cost_ns=500000</pre></div></div><p>
							This is, on more recent kernels, equivalent to setting the following parameter via the <code class="literal">scheduler</code> plugin:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--q0804ce"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[scheduler]
sched_migration_cost_ns=500000</pre></div></div><p>
							Meaning <span class="strong strong"><strong>TuneD</strong></span> writes a value of <code class="literal">500000</code> to the <code class="literal">/sys/kernel/debug/sched/migration_cost_ns</code> file.
						</p></div></div></li></ul></div></section><section class="section" id="variables-in-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.10. Variables in TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				Variables expand at run time when a <span class="strong strong"><strong>TuneD</strong></span> profile is activated.
			</p><p>
				Using <span class="strong strong"><strong>TuneD</strong></span> variables reduces the amount of necessary typing in <span class="strong strong"><strong>TuneD</strong></span> profiles.
			</p><p>
				There are no predefined variables in <span class="strong strong"><strong>TuneD</strong></span> profiles. You can define your own variables by creating the <code class="literal">[variables]</code> section in a profile and using the following syntax:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--kt9rdbs"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[variables]

<span class="emphasis"><em><span class="replaceable replaceable">variable_name</span></em></span>=<span class="emphasis"><em><span class="replaceable replaceable">value</span></em></span></pre></div></div><p>
				To expand the value of a variable in a profile, use the following syntax:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5wyv30s"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">${<span class="emphasis"><em><span class="replaceable replaceable">variable_name</span></em></span>}</pre></div></div><div class="example" id="idm140611463012752"><p class="title">Example 2.16. Isolating CPU cores using variables</p><div class="example-contents"><p>
					In the following example, the <code class="literal">${isolated_cores}</code> variable expands to <code class="literal">1,2</code>; hence the kernel boots with the <code class="literal option">isolcpus=1,2</code> option:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--iu99gp9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[variables]
isolated_cores=1,2

[bootloader]
cmdline=isolcpus=${isolated_cores}</pre></div></div><p>
					The variables can be specified in a separate file. For example, you can add the following lines to <code class="literal filename">tuned.conf</code>:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--wrw7vaw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[variables]
include=/etc/tuned/<span class="emphasis"><em><span class="replaceable replaceable">my-variables.conf</span></em></span>

[bootloader]
cmdline=isolcpus=${isolated_cores}</pre></div></div><p>
					If you add the <code class="literal option">isolated_cores=1,2</code> option to the <code class="literal filename">/etc/tuned/my-variables.conf</code> file, the kernel boots with the <code class="literal option">isolcpus=1,2</code> option.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></section><section class="section" id="built-in-functions-in-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.11. Built-in functions in TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				Built-in functions expand at run time when a <span class="strong strong"><strong>TuneD</strong></span> profile is activated.
			</p><p>
				You can:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Use various built-in functions together with <span class="strong strong"><strong>TuneD</strong></span> variables
					</li><li class="listitem">
						Create custom functions in Python and add them to <span class="strong strong"><strong>TuneD</strong></span> in the form of plug-ins
					</li></ul></div><p>
				To call a function, use the following syntax:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2jly4el"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">${f:<span class="emphasis"><em><span class="replaceable replaceable">function_name</span></em></span>:<span class="emphasis"><em><span class="replaceable replaceable">argument_1</span></em></span>:<span class="emphasis"><em><span class="replaceable replaceable">argument_2</span></em></span>}</pre></div></div><p>
				To expand the directory path where the profile and the <code class="literal">tuned.conf</code> file are located, use the <code class="literal">PROFILE_DIR</code> function, which requires special syntax:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mw9i9td"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">${i:PROFILE_DIR}</pre></div></div><div class="example" id="idm140611486584816"><p class="title">Example 2.17. Isolating CPU cores using variables and built-in functions</p><div class="example-contents"><p>
					In the following example, the <code class="literal">${non_isolated_cores}</code> variable expands to <code class="literal">0,3-5</code>, and the <code class="literal">cpulist_invert</code> built-in function is called with the <code class="literal">0,3-5</code> argument:
				</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--tauv00h"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[variables]
non_isolated_cores=0,3-5

[bootloader]
cmdline=isolcpus=${f:cpulist_invert:${non_isolated_cores}}</pre></div></div><p>
					The <code class="literal">cpulist_invert</code> function inverts the list of CPUs. For a 6-CPU machine, the inversion is <code class="literal">1,2</code>, and the kernel boots with the <code class="literal option">isolcpus=1,2</code> command-line option.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></section><section class="section" id="built-in-functions-available-in-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.12. Built-in functions available in TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				The following built-in functions are available in all <span class="strong strong"><strong>TuneD</strong></span> profiles:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">PROFILE_DIR</code></span></dt><dd>
							Returns the directory path where the profile and the <code class="literal">tuned.conf</code> file are located.
						</dd><dt><span class="term"><code class="literal">exec</code></span></dt><dd>
							Executes a process and returns its output.
						</dd><dt><span class="term"><code class="literal">assertion</code></span></dt><dd>
							Compares two arguments. If they <span class="emphasis"><em>do not match</em></span>, the function logs text from the first argument and aborts profile loading.
						</dd><dt><span class="term"><code class="literal">assertion_non_equal</code></span></dt><dd>
							Compares two arguments. If they <span class="emphasis"><em>match</em></span>, the function logs text from the first argument and aborts profile loading.
						</dd><dt><span class="term"><code class="literal">kb2s</code></span></dt><dd>
							Converts kilobytes to disk sectors.
						</dd><dt><span class="term"><code class="literal">s2kb</code></span></dt><dd>
							Converts disk sectors to kilobytes.
						</dd><dt><span class="term"><code class="literal">strip</code></span></dt><dd>
							Creates a string from all passed arguments and deletes both leading and trailing white space.
						</dd><dt><span class="term"><code class="literal">virt_check</code></span></dt><dd><p class="simpara">
							Checks whether <span class="strong strong"><strong>TuneD</strong></span> is running inside a virtual machine (VM) or on bare metal:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Inside a VM, the function returns the first argument.
								</li><li class="listitem">
									On bare metal, the function returns the second argument, even in case of an error.
								</li></ul></div></dd><dt><span class="term"><code class="literal">cpulist_invert</code></span></dt><dd>
							Inverts a list of CPUs to make its complement. For example, on a 
system with 4 CPUs, numbered from 0 to 3, the inversion of the list <code class="literal">0,2,3</code> is <code class="literal">1</code>.
						</dd><dt><span class="term"><code class="literal">cpulist2hex</code></span></dt><dd>
							Converts a CPU list to a hexadecimal CPU mask.
						</dd><dt><span class="term"><code class="literal">cpulist2hex_invert</code></span></dt><dd>
							Converts a CPU list to a hexadecimal CPU mask and inverts it.
						</dd><dt><span class="term"><code class="literal">hex2cpulist</code></span></dt><dd>
							Converts a hexadecimal CPU mask to a CPU list.
						</dd><dt><span class="term"><code class="literal">cpulist_online</code></span></dt><dd>
							Checks whether the CPUs from the list are online. Returns the list containing only online CPUs.
						</dd><dt><span class="term"><code class="literal">cpulist_present</code></span></dt><dd>
							Checks whether the CPUs from the list are present. Returns the list containing only present CPUs.
						</dd><dt><span class="term"><code class="literal">cpulist_unpack</code></span></dt><dd>
							Unpacks a CPU list in the form of <code class="literal">1-3,4</code> to <code class="literal">1,2,3,4</code>.
						</dd><dt><span class="term"><code class="literal">cpulist_pack</code></span></dt><dd>
							Packs a CPU list in the form of <code class="literal">1,2,3,5</code> to <code class="literal">1-3,5</code>.
						</dd></dl></div></section><section class="section" id="creating-new-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.13. Creating new TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				This procedure creates a new <span class="strong strong"><strong>TuneD</strong></span> profile with custom performance rules.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">TuneD</code> service is running. See <a class="link" href="#installing-and-enabling-tuned_getting-started-with-tuned" title="1.13.&nbsp;Installing and enabling TuneD">Installing and Enabling TuneD</a> for details.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the <code class="literal filename">/etc/tuned/</code> directory, create a new directory named the same as the profile that you want to create:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--p9obcrt"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># mkdir /etc/tuned/<span class="emphasis"><em><span class="replaceable replaceable">my-profile</span></em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						In the new directory, create a file named <code class="literal filename">tuned.conf</code>. Add a <code class="literal">[main]</code> section and plug-in definitions in it, according to your requirements.
					</p><p class="simpara">
						For example, see the configuration of the <code class="literal">balanced</code> profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xt9y1ng"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[main]
summary=General non-specialized TuneD profile

[cpu]
governor=conservative
energy_perf_bias=normal

[audio]
timeout=10

[video]
radeon_powersave=dpm-balanced, auto

[scsi_host]
alpm=medium_power</pre></div></div></li><li class="listitem"><p class="simpara">
						To activate the profile, use:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ngreh60"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile <span class="emphasis"><em><span class="replaceable replaceable">my-profile</span></em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Verify that the <span class="strong strong"><strong>TuneD</strong></span> profile is active and the system settings are applied:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6i8qucc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm active

Current active profile: <span class="emphasis"><em><span class="replaceable replaceable">my-profile</span></em></span></pre></div></div><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--a6ukacj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm verify

Verification succeeded, current system settings match the preset profile.
See tuned log file ('/var/log/tuned/tuned.log') for details.</pre></div></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></section><section class="section" id="modifying-existing-tuned-profiles_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.14. Modifying existing TuneD profiles</h2></div></div></div><p class="_abstract _abstract">
				This procedure creates a modified child profile based on an existing <span class="strong strong"><strong>TuneD</strong></span> profile.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">TuneD</code> service is running. See <a class="link" href="#installing-and-enabling-tuned_getting-started-with-tuned" title="1.13.&nbsp;Installing and enabling TuneD">Installing and Enabling TuneD</a> for details.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						In the <code class="literal filename">/etc/tuned/</code> directory, create a new directory named the same as the profile that you want to create:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8el3kfx"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># mkdir /etc/tuned/<span class="emphasis"><em><span class="replaceable replaceable">modified-profile</span></em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						In the new directory, create a file named <code class="literal filename">tuned.conf</code>, and set the <code class="literal">[main]</code> section as follows:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--qbivdrm"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[main]
include=<span class="emphasis"><em><span class="replaceable replaceable">parent-profile</span></em></span></pre></div></div><p class="simpara">
						Replace <span class="emphasis"><em><span class="replaceable replaceable">parent-profile</span></em></span> with the name of the profile you are modifying.
					</p></li><li class="listitem"><p class="simpara">
						Include your profile modifications.
					</p><div class="example" id="idm140611481717488"><p class="title">Example 2.18. Lowering swappiness in the throughput-performance profile</p><div class="example-contents"><p>
							To use the settings from the <code class="literal">throughput-performance</code> profile and change the value of <code class="literal">vm.swappiness</code> to 5, instead of the default 10, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zw8dwpg"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[main]
include=throughput-performance

[sysctl]
vm.swappiness=5</pre></div></div></div></div></li><li class="listitem"><p class="simpara">
						To activate the profile, use:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--scxy7vm"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile <span class="emphasis"><em><span class="replaceable replaceable">modified-profile</span></em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Verify that the <span class="strong strong"><strong>TuneD</strong></span> profile is active and the system settings are applied:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--bratkvt"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm active

Current active profile: <span class="emphasis"><em><span class="replaceable replaceable">my-profile</span></em></span></pre></div></div><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--0eyynj2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm verify

Verification succeeded, current system settings match the preset profile.
See tuned log file ('/var/log/tuned/tuned.log') for details.</pre></div></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned.conf(5)</code> man page
					</li></ul></div></section><section class="section" id="setting-the-disk-scheduler-using-tuned_customizing-tuned-profiles"><div class="titlepage"><div><div><h2 class="title">2.15. Setting the disk scheduler using TuneD</h2></div></div></div><p class="_abstract _abstract">
				This procedure creates and enables a <span class="strong strong"><strong>TuneD</strong></span> profile that sets a given disk scheduler for selected block devices. The setting persists across system reboots.
			</p><p>
				In the following commands and configuration, replace:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="emphasis"><em>device</em></span> with the name of the block device, for example <code class="literal">sdf</code>
					</li><li class="listitem">
						<span class="emphasis"><em>selected-scheduler</em></span> with the disk scheduler that you want to set for the device, for example <code class="literal">bfq</code>
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">TuneD</code> service is installed and enabled. For details, see <a class="link" href="#installing-and-enabling-tuned_getting-started-with-tuned" title="1.13.&nbsp;Installing and enabling TuneD">Installing and enabling TuneD</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Optional: Select an existing <span class="strong strong"><strong>TuneD</strong></span> profile on which your profile will be based. For a list of available profiles, see <a class="link" href="#tuned-profiles-distributed-with-rhel_getting-started-with-tuned" title="1.6.&nbsp;TuneD profiles distributed with RHEL">TuneD profiles distributed with RHEL</a>.
					</p><p class="simpara">
						To see which profile is currently active, use:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6tl1rjo"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm active</pre></div></div></li><li class="listitem"><p class="simpara">
						Create a new directory to hold your <span class="strong strong"><strong>TuneD</strong></span> profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--r8zxe6t"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># mkdir /etc/tuned/<span class="emphasis"><em>my-profile</em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Find the system unique identifier of the selected block device:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2aevw80"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ udevadm info --query=property --name=/dev/<span class="emphasis"><em>device</em></span> | grep -E '(WWN|SERIAL)'

ID_WWN=<span class="emphasis"><em>0x5002538d00000000_</em></span>
ID_SERIAL=<span class="emphasis"><em>Generic-_SD_MMC_20120501030900000-0:0</em></span>
ID_SERIAL_SHORT=<span class="emphasis"><em>20120501030900000</em></span></pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The command in the this example will return all values identified
 as a World Wide Name (WWN) or serial number associated with the 
specified block device. Although it is preferred to use a WWN, the WWN 
is not always available for a given device and any values returned by 
the example command are acceptable to use as the <span class="emphasis"><em>device system unique ID</em></span>.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Create the <code class="literal">/etc/tuned/<span class="emphasis"><em>my-profile</em></span>/tuned.conf</code> configuration file. In the file, set the following options:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Optional: Include an existing profile:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--f7p0mun"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[main]
include=<span class="emphasis"><em>existing-profile</em></span></pre></div></div></li><li class="listitem"><p class="simpara">
								Set the selected disk scheduler for the device that matches the WWN identifier:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gepqhwa"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[disk]
devices_udev_regex=<span class="emphasis"><em>IDNAME</em></span>=<span class="emphasis"><em>device system unique id</em></span>
elevator=<span class="emphasis"><em>selected-scheduler</em></span></pre></div></div><p class="simpara">
								Here:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Replace <span class="emphasis"><em>IDNAME</em></span> with the name of the identifier being used (for example, <code class="literal">ID_WWN</code>).
									</li><li class="listitem"><p class="simpara">
										Replace <span class="emphasis"><em>device system unique id</em></span> with the value of the chosen identifier (for example, <code class="literal">0x5002538d00000000</code>).
									</p><p class="simpara">
										To match multiple devices in the <code class="literal">devices_udev_regex</code> option, enclose the identifiers in parentheses and separate them with vertical bars:
									</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--khdfhca"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">devices_udev_regex=(ID_WWN=<span class="emphasis"><em>0x5002538d00000000</em></span>)|(ID_WWN=<span class="emphasis"><em>0x1234567800000000</em></span>)</pre></div></div></li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Enable your profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--nuk188q"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile <span class="emphasis"><em>my-profile</em></span></pre></div></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification steps</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Verify that the TuneD profile is active and applied:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gxmvvbj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm active

Current active profile: <span class="emphasis"><em>my-profile</em></span></pre></div></div><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--wehlmrb"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm verify

Verification succeeded, current system settings match the preset profile.
See TuneD log file ('/var/log/tuned/tuned.log') for details.</pre></div></div></li><li class="listitem"><p class="simpara">
						Read the contents of the <code class="literal">/sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--720a3h6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cat /sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler

[mq-deadline] kyber bfq none</pre></div></div><p class="simpara">
						In the file name, replace <span class="emphasis"><em>device</em></span> with the block device name, for example <code class="literal">sdc</code>.
					</p><p class="simpara">
						The active scheduler is listed in square brackets (<code class="literal">[]</code>).
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance" title="Chapter&nbsp;2.&nbsp;Customizing TuneD profiles">Customizing TuneD profiles</a>.
					</li></ul></div></section></section><section class="chapter" id="reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 3. Reviewing a system using tuna interface</h1></div></div></div><p class="_abstract _abstract">
			Use the <code class="literal">tuna</code> tool to adjust scheduler 
tunables, tune thread priority, IRQ handlers, and isolate CPU cores and 
sockets. Tuna reduces the complexity of performing tuning tasks.
		</p><p>
			The <code class="literal">tuna</code> tool performs the following operations:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Lists the CPUs on a system
				</li><li class="listitem">
					Lists the interrupt requests (IRQs) currently running on a system
				</li><li class="listitem">
					Changes policy and priority information about threads
				</li><li class="listitem">
					Displays the current policies and priorities of a system
				</li></ul></div><section class="section" id="installing-tuna-tool_reviewing-a-system-using-tuna-interface"><div class="titlepage"><div><div><h2 class="title">3.1. Installing tuna tool</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">tuna</code> tool is designed to be used on
 a running system. This allows application-specific measurement tools to
 see and analyze system performance immediately after changes have been 
made.
			</p><p>
				This procedure describes how to install the <code class="literal">tuna</code> tool.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Install the <code class="literal">tuna</code> tool:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--irnxfza"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install tuna</pre></div></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						View the available <code class="literal">tuna</code> CLI options:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--96t8v9c"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna -h</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuna(8)</code> man page
					</li></ul></div></section><section class="section" id="viewing-the-system-status-using-tuna-tool_reviewing-a-system-using-tuna-interface"><div class="titlepage"><div><div><h2 class="title">3.2. Viewing the system status using tuna tool</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to view the system status using the <code class="literal">tuna</code> command-line interface (CLI) tool.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The tuna tool is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance#installing-tuna-tool_reviewing-a-system-using-tuna-interface">Installing tuna tool</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To view the current policies and priorities:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--dhd0iwa"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --show_threads
            thread
pid   SCHED_ rtpri affinity             cmd
1      OTHER     0      0,1            init
2       FIFO    99        0     migration/0
3      OTHER     0        0     ksoftirqd/0
4       FIFO    99        0      watchdog/0</pre></div></div></li><li class="listitem"><p class="simpara">
						To view a specific thread corresponding to a PID or matching a command name:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--as2hju3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --threads=<span class="emphasis"><em>pid_or_cmd_list</em></span> --show_threads</pre></div></div><p class="simpara">
						The <span class="emphasis"><em>pid_or_cmd_list</em></span> argument is a list of comma-separated PIDs or command-name patterns.
					</p></li><li class="listitem">
						To tune CPUs using the <code class="literal">tuna</code> CLI, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance#tuning-cpus-using-tuna-tool_reviewing-a-system-using-tuna-interface">Tuning CPUs using tuna tool</a>.
					</li><li class="listitem">
						To tune the IRQs using the <code class="literal">tuna</code> tool, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance#tuning-irqs-using-tuna-tool_reviewing-a-system-using-tuna-interface">Tuning IRQs using tuna tool</a>.
					</li><li class="listitem"><p class="simpara">
						To save the changed configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--x9j2ou6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --save=filename</pre></div></div><p class="simpara">
						This command saves only currently running kernel threads. Processes that are not running are not saved.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuna(8)</code> man page
					</li></ul></div></section><section class="section" id="tuning-cpus-using-tuna-tool_reviewing-a-system-using-tuna-interface"><div class="titlepage"><div><div><h2 class="title">3.3. Tuning CPUs using tuna tool</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">tuna</code> tool commands can target individual CPUs.
			</p><p>
				Using the tuna tool, you can:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Isolate CPUs</code></span></dt><dd>
							All tasks running on the specified CPU move to the next available
 CPU. Isolating a CPU makes it unavailable by removing it from the 
affinity mask of all threads.
						</dd><dt><span class="term"><code class="literal">Include CPUs</code></span></dt><dd>
							Allows tasks to run on the specified CPU
						</dd><dt><span class="term"><code class="literal">Restore CPUs</code></span></dt><dd>
							Restores the specified CPU to its previous configuration.
						</dd></dl></div><p>
				This procedure describes how to tune CPUs using the <code class="literal">tuna</code> CLI.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The tuna tool is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance#installing-tuna-tool_reviewing-a-system-using-tuna-interface">Installing tuna tool</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To specify the list of CPUs to be affected by a command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--he439vc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --cpus=<span class="emphasis"><em>cpu_list</em></span> [<span class="emphasis"><em>command</em></span>]</pre></div></div><p class="simpara">
						The <span class="emphasis"><em>cpu_list</em></span> argument is a list of comma-separated CPU numbers. For example, <code class="literal">--cpus=<span class="emphasis"><em>0,2</em></span></code>. CPU lists can also be specified in a range, for example <code class="literal">--cpus=”<span class="emphasis"><em>1-3</em></span>”</code>, which would select CPUs 1, 2, and 3.
					</p><p class="simpara">
						To add a specific CPU to the current <span class="emphasis"><em>cpu_list</em></span>, for example, use <code class="literal">--cpus=+0</code>.
					</p><p class="simpara">
						Replace [<span class="emphasis"><em>command</em></span>] with, for example, <code class="literal">--isolate</code>.
					</p></li><li class="listitem"><p class="simpara">
						To isolate a CPU:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--0nh58wx"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --cpus=cpu_list --isolate</pre></div></div></li><li class="listitem"><p class="simpara">
						To include a CPU:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zixcwws"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --cpus=cpu_list --include</pre></div></div></li><li class="listitem"><p class="simpara">
						To use a system with four or more processors, display how to make all the ssh threads run on CPU <span class="emphasis"><em>0</em></span> and <span class="emphasis"><em>1</em></span>, and all the <code class="literal">http</code> threads on CPU <span class="emphasis"><em>2</em></span> and <span class="emphasis"><em>3</em></span>:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--tv2wi6i"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen white-space-pre language-none codeblock codeblock--processed"># tuna --cpus=<span class="emphasis"><em>0,1</em></span> --threads=ssh\* \
--move --cpus=<span class="emphasis"><em>2,3</em></span> --threads=http\* --move</pre></div></div><p class="simpara">
						This command performs the following operations sequentially:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Selects CPUs <span class="emphasis"><em>0</em></span> and <span class="emphasis"><em>1</em></span>.
							</li><li class="listitem">
								Selects all threads that begin with <code class="literal">ssh</code>.
							</li><li class="listitem">
								Moves the selected threads to the selected CPUs. Tuna sets the affinity mask of threads starting with <code class="literal">ssh</code> to the appropriate CPUs. The CPUs can be expressed numerically as <span class="emphasis"><em>0</em></span> and <span class="emphasis"><em>1</em></span>, in hex mask as 0x3, or in binary as 11.
							</li><li class="listitem">
								Resets the CPU list to <span class="emphasis"><em>2</em></span> and <span class="emphasis"><em>3</em></span>.
							</li><li class="listitem">
								Selects all threads that begin with <code class="literal">http</code>.
							</li><li class="listitem">
								Moves the selected threads to the specified CPUs. Tuna sets the affinity mask of threads starting with <code class="literal">http</code> to the specified CPUs. The CPUs can be expressed numerically as <span class="emphasis"><em>2</em></span> and <span class="emphasis"><em>3</em></span>, in hex mask as 0xC, or in binary as 1100.
							</li></ol></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the current configuration and verify that the changes were performed as expected:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ymnxngu"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen white-space-pre language-none codeblock codeblock--processed"># tuna --threads=gnome-sc\* --show_threads \
--cpus=<span class="emphasis"><em>0</em></span> --move --show_threads --cpus=<span class="emphasis"><em>1</em></span> \
--move --show_threads --cpus=<span class="emphasis"><em>+0</em></span> --move --show_threads

                       thread       ctxt_switches
     pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd
   3861   OTHER     0      0,1     33997           58 gnome-screensav
                       thread       ctxt_switches
     pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd
   3861   OTHER     0        0     33997           58 gnome-screensav
                       thread       ctxt_switches
     pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd
   3861   OTHER     0        1     33997           58 gnome-screensav
                       thread       ctxt_switches
     pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd
   3861   OTHER     0      0,1     33997           58 gnome-screensav</pre></div></div><p class="simpara">
						This command performs the following operations sequentially:
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
								Selects all threads that begin with the <code class="literal">gnome-sc</code> threads.
							</li><li class="listitem">
								Displays the selected threads to enable the user to verify their affinity mask and RT priority.
							</li><li class="listitem">
								Selects CPU <span class="emphasis"><em>0</em></span>.
							</li><li class="listitem">
								Moves the <code class="literal">gnome-sc</code> threads to the specified CPU, CPU <span class="emphasis"><em>0</em></span>.
							</li><li class="listitem">
								Shows the result of the move.
							</li><li class="listitem">
								Resets the CPU list to CPU <span class="emphasis"><em>1</em></span>.
							</li><li class="listitem">
								Moves the <code class="literal">gnome-sc</code> threads to the specified CPU, CPU <span class="emphasis"><em>1</em></span>.
							</li><li class="listitem">
								Displays the result of the move.
							</li><li class="listitem">
								Adds CPU <span class="emphasis"><em>0</em></span> to the CPU list.
							</li><li class="listitem">
								Moves the <code class="literal">gnome-sc</code> threads to the specified CPUs, CPUs <span class="emphasis"><em>0</em></span> and <span class="emphasis"><em>1</em></span>.
							</li><li class="listitem">
								Displays the result of the move.
							</li></ol></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">/proc/cpuinfo</code> file
					</li><li class="listitem">
						<code class="literal">tuna(8)</code> man page
					</li></ul></div></section><section class="section" id="tuning-irqs-using-tuna-tool_reviewing-a-system-using-tuna-interface"><div class="titlepage"><div><div><h2 class="title">3.4. Tuning IRQs using tuna tool</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">/proc/interrupts</code> file records the number of interrupts per IRQ, the type of interrupt, and the name of the device that is located at that IRQ.
			</p><p>
				This procedure describes how to tune the IRQs using the <code class="literal">tuna</code> tool.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The tuna tool is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance#installing-tuna-tool_reviewing-a-system-using-tuna-interface">Installing tuna tool</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To view the current IRQs and their affinity:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mt6gys7"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --show_irqs
# users            affinity
0 timer                   0
1 i8042                   0
7 parport0                0</pre></div></div></li><li class="listitem"><p class="simpara">
						To specify the list of IRQs to be affected by a command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--bzyvamk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --irqs=<span class="emphasis"><em>irq_list</em></span> [<span class="emphasis"><em>command</em></span>]</pre></div></div><p class="simpara">
						The <span class="emphasis"><em>irq_list</em></span> argument is a list of comma-separated IRQ numbers or user-name patterns.
					</p><p class="simpara">
						Replace [<span class="emphasis"><em>command</em></span>] with, for example, <code class="literal">--spread</code>.
					</p></li><li class="listitem"><p class="simpara">
						To move an interrupt to a specified CPU:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5wscwql"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --irqs=<span class="emphasis"><em>128</em></span> --show_irqs
   # users            affinity
 128 iwlwifi           0,1,2,3

# tuna --irqs=<span class="emphasis"><em>128</em></span> --cpus=3 --move</pre></div></div><p class="simpara">
						Replace <span class="emphasis"><em>128</em></span> with the irq_list argument and <span class="emphasis"><em>3</em></span> with the cpu_list argument.
					</p><p class="simpara">
						The <span class="emphasis"><em>cpu_list</em></span> argument is a list of comma-separated CPU numbers, for example, <code class="literal">--cpus=<span class="emphasis"><em>0,2</em></span></code>. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/reviewing-a-system-using-tuna-interface_monitoring-and-managing-system-status-and-performance#tuning-cpus-using-tuna-tool_reviewing-a-system-using-tuna-interface">Tuning CPUs using tuna tool</a>.
					</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Compare the state of the selected IRQs before and after moving any interrupt to a specified CPU:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ctk85tr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuna --irqs=<span class="emphasis"><em>128</em></span> --show_irqs
   # users            affinity
 128 iwlwifi                 3</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">/procs/interrupts</code> file
					</li><li class="listitem">
						<code class="literal">tuna(8)</code> man page
					</li></ul></div></section></section><section class="chapter" id="monitoring-performance-using-rhel-system-roles_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 4. Monitoring performance using RHEL System Roles</h1></div></div></div><p class="_abstract _abstract">
			As a system administrator, you can use the <code class="literal">metrics</code> RHEL&nbsp;System&nbsp;Role to monitor the performance of a system.
		</p><section class="section" id="assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles_monitoring-performance-using-rhel-system-roles"><div class="titlepage"><div><div><h2 class="title">4.1. Preparing a control node and managed nodes to use RHEL System Roles</h2></div></div></div><p>
				Before you can use individual RHEL&nbsp;System&nbsp;Roles to manage 
services and settings, you must prepare the control node and managed 
nodes.
			</p><section class="section" id="proc_preparing-a-control-node_assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles"><div class="titlepage"><div><div><h3 class="title">4.1.1. Preparing a control node on RHEL 9</h3></div></div></div><p>
					Before using RHEL System Roles, you must configure a control node. 
This system then configures the managed hosts from the inventory 
according to the playbooks.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							RHEL 8.6 or later is installed. For more information about installing RHEL, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/performing_a_standard_rhel_9_installation/index">Performing a standard RHEL 9 installation</a>.
						</li><li class="listitem">
							The system is registered to the Customer Portal.
						</li><li class="listitem">
							A <code class="literal">Red Hat Enterprise Linux Server</code> subscription is attached to the system.
						</li><li class="listitem">
							If available in your Customer Portal account, an <code class="literal">Ansible Automation Platform</code> subscription is attached to the system.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Install the <code class="literal">rhel-system-roles</code> package:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--rrtdrto"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[root@control-node]# <span class="strong strong"><strong>dnf install rhel-system-roles</strong></span></pre></div></div><p class="simpara">
							This command installs the <code class="literal">ansible-core</code> package as a dependency.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								In RHEL 8.5 and earlier versions, Ansible packages were provided
 through Ansible Engine instead of Ansible Core, and with a different 
level of support. Do not use Ansible Engine because the packages might 
not be compatible with Ansible automation content in RHEL 8.6 and later.
 For more information, see <a class="link" href="https://access.redhat.com/articles/6325611">Scope of support for the Ansible Core package included in the RHEL 9 and RHEL 8.6 and later AppStream repositories</a>.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Create a user named <code class="literal">ansible</code> to manage and run playbooks:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--nu03uy5"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[root@control-node]# <span class="strong strong"><strong>useradd ansible</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Switch to the newly created <code class="literal">ansible</code> user:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--en9j1q2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[root@control-node]# <span class="strong strong"><strong>su - ansible</strong></span></pre></div></div><p class="simpara">
							Perform the rest of the procedure as this user.
						</p></li><li class="listitem"><p class="simpara">
							Create an SSH public and private key:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--b5arz2z"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[ansible@control-node]$ <span class="strong strong"><strong>ssh-keygen</strong></span>
Generating public/private rsa key pair.
Enter file in which to save the key (/home/ansible/.ssh/id_rsa): <span class="strong strong"><strong><span class="emphasis"><em>&lt;password&gt;</em></span></strong></span>
...</pre></div></div><p class="simpara">
							Use the suggested default location for the key file.
						</p></li><li class="listitem">
							Optional: To prevent Ansible from prompting you for the SSH key 
password each time you establish a connection, configure an SSH agent.
						</li><li class="listitem"><p class="simpara">
							Create the <code class="literal">~/.ansible.cfg</code> file with the following content:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--wjocmjc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"><span class="strong strong"><strong>[defaults]</strong></span>
<span class="strong strong"><strong>inventory = <span class="emphasis"><em>/home/ansible/inventory</em></span></strong></span>
<span class="strong strong"><strong>remote_user = ansible</strong></span>

<span class="strong strong"><strong>[privilege_escalation]</strong></span>
<span class="strong strong"><strong>become = <span class="emphasis"><em>True</em></span></strong></span>
<span class="strong strong"><strong>become_method = <span class="emphasis"><em>sudo</em></span></strong></span>
<span class="strong strong"><strong>become_user = <span class="emphasis"><em>root</em></span></strong></span>
<span class="strong strong"><strong>become_ask_pass = <span class="emphasis"><em>True</em></span></strong></span></pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Settings in the <code class="literal">~/.ansible.cfg</code> file have a higher priority and override settings from the global <code class="literal">/etc/ansible/ansible.cfg</code> file.
							</p></div></div><p class="simpara">
							With these settings, Ansible performs the following actions:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Manages hosts in the specified inventory file.
								</li><li class="listitem">
									Uses the account set in the <code class="literal">remote_user</code> parameter when it establishes SSH connections to managed nodes.
								</li><li class="listitem">
									Uses the <code class="literal">sudo</code> utility to execute tasks on managed nodes as the <code class="literal">root</code> user.
								</li><li class="listitem">
									Prompts for the root password of the remote user every time you
 apply a playbook. This is recommended for security reasons.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Create an <code class="literal">~/inventory</code> file in INI or
 YAML format that lists the hostnames of managed hosts. You can also 
define groups of hosts in the inventory file. For example, the following
 is an inventory file in the INI format with three hosts and one host 
group named <code class="literal">US</code>:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--lfwyjkk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"><span class="strong strong"><strong>managed-node-01.example.com</strong></span>

<span class="strong strong"><strong>[US]</strong></span>
<span class="strong strong"><strong>managed-node-02.example.com ansible_host=192.0.2.100</strong></span>
<span class="strong strong"><strong>managed-node-03.example.com</strong></span></pre></div></div><p class="simpara">
							Note that the control node must be able to resolve the hostnames.
 If the DNS server cannot resolve certain hostnames, add the <code class="literal">ansible_host</code> parameter next to the host entry to specify its IP address.
						</p></li></ol></div><div class="itemizedlist"><p class="title"><strong>Next steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							Prepare the managed nodes. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/automating_system_administration_by_using_rhel_system_roles/assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles_automating-system-administration-by-using-rhel-system-roles#proc_preparing-a-managed-node_assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles">Preparing a managed node</a>.
						</li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/articles/6325611">Scope of support for the Ansible Core package included in the RHEL 9 and RHEL 8.6 and later AppStream repositories</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/253273">How to register and subscribe a system to the Red Hat Customer Portal using subscription-manager</a>
						</li><li class="listitem">
							The <code class="literal">ssh-keygen(1)</code> man page
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/securing_networks/assembly_using-secure-communications-between-two-systems-with-openssh_securing-networks#connecting-to-remote-machines-with-ssh-keys-using-ssh-agent_assembly_using-secure-communications-between-two-systems-with-openssh">Connecting to remote machines with SSH keys using ssh-agent</a>
						</li><li class="listitem">
							<a class="link" href="https://docs.ansible.com/ansible/2.9/reference_appendices/config.html">Ansible configuration settings</a>
						</li><li class="listitem">
							<a class="link" href="https://docs.ansible.com/ansible/2.9/user_guide/intro_inventory.html">How to build your inventory</a>
						</li></ul></div></section><section class="section" id="proc_preparing-a-managed-node_assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles"><div class="titlepage"><div><div><h3 class="title">4.1.2. Preparing a managed node</h3></div></div></div><p>
					Managed nodes are the systems listed in the inventory and which 
will be configured by the control node according to the playbook. You do
 not have to install Ansible on managed hosts.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You prepared the control node. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/automating_system_administration_by_using_rhel_system_roles/assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles_automating-system-administration-by-using-rhel-system-roles#proc_preparing-a-control-node_assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles">Preparing a control node on RHEL 9</a>.
						</li><li class="listitem"><p class="simpara">
							You have SSH access from the control node.
						</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								Direct SSH access as the <code class="literal">root</code> user is a security risk. To reduce this risk, you will create a local user on this node and configure a <code class="literal">sudo</code>
 policy when preparing a managed node. Ansible on the control node can 
then use the local user account to log in to the managed node and run 
playbooks as different users, such as <code class="literal">root</code>.
							</p></div></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a user named <code class="literal">ansible</code>:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5adw7o2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[root@managed-node-01]# <span class="strong strong"><strong>useradd ansible</strong></span></pre></div></div><p class="simpara">
							The control node later uses this user to establish an SSH connection to this host.
						</p></li><li class="listitem"><p class="simpara">
							Set a password for the <code class="literal">ansible</code> user:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2tlt5tq"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[root@managed-node-01]# <span class="strong strong"><strong>passwd ansible</strong></span>
Changing password for user ansible.
New password: <span class="emphasis"><em>&lt;password&gt;</em></span>
Retype new password: <span class="emphasis"><em>&lt;password&gt;</em></span>
passwd: all authentication tokens updated successfully.</pre></div></div><p class="simpara">
							You must enter this password when Ansible uses <code class="literal">sudo</code> to perform tasks as the <code class="literal">root</code> user.
						</p></li><li class="listitem"><p class="simpara">
							Install the <code class="literal">ansible</code> user’s SSH public key on the managed node:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Log in to the control node as the <code class="literal">ansible</code> user, and copy the SSH public key to the managed node:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ilg103r"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[ansible@control-node]$ <span class="strong strong"><strong>ssh-copy-id managed-node-01.example.com</strong></span>
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/home/ansible/.ssh/id_rsa.pub"
The authenticity of host '<span class="emphasis"><em>managed-node-01.example.com</em></span> (<span class="emphasis"><em>192.0.2.100</em></span>)' can't be established.
<span class="emphasis"><em>ECDSA</em></span> key fingerprint is <span class="emphasis"><em>SHA256:9bZ33GJNODK3zbNhybokN/6Mq7hu3vpBXDrCxe7NAvo</em></span>.</pre></div></div></li><li class="listitem"><p class="simpara">
									When prompted, connect by entering <code class="literal">yes</code>:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ubauomq"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">Are you sure you want to continue connecting (yes/no/[fingerprint])? <span class="strong strong"><strong>yes</strong></span>
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</pre></div></div></li><li class="listitem"><p class="simpara">
									When prompted, enter the password:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--wu9zbef"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">ansible@<span class="emphasis"><em>managed-node-01.example.com</em></span>'s password: <span class="strong strong"><strong><span class="emphasis"><em>&lt;password&gt;</em></span></strong></span>

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh '<span class="emphasis"><em>&lt;managed-node-01.example.com&gt;</em></span>'"
and check to make sure that only the key(s) you wanted were added.</pre></div></div></li><li class="listitem"><p class="simpara">
									Verify the SSH connection by remotely executing a command on the control node:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zz28igl"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[ansible@control-node]$ <span class="strong strong"><strong>ssh <span class="emphasis"><em>&lt;managed-node-01.example.com&gt;</em></span> whoami</strong></span>
ansible</pre></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Create a <code class="literal">sudo</code> configuration for the <code class="literal">ansible</code> user:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Create and edit the <code class="literal">/etc/sudoers.d/ansible</code> file by using the <code class="literal">visudo</code> command:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ea4re1e"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[root@managed-node-01]# <span class="strong strong"><strong>visudo /etc/sudoers.d/ansible</strong></span></pre></div></div><p class="simpara">
									The benefit of using <code class="literal">visudo</code> over a normal editor is that this utility provides basic sanity checks and checks for parse errors before installing the file.
								</p></li><li class="listitem"><p class="simpara">
									Configure a <code class="literal">sudoers</code> policy in the <code class="literal">/etc/sudoers.d/ansible</code> file that meets your requirements, for example:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
											To grant permissions to the <code class="literal">ansible</code> user to run all commands as any user and group on this host after entering the <code class="literal">ansible</code> user’s password, use:
										</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l8an704"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"><span class="strong strong"><strong>ansible ALL=(ALL) ALL</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
											To grant permissions to the <code class="literal">ansible</code> user to run all commands as any user and group on this host without entering the <code class="literal">ansible</code> user’s password, use:
										</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3kqtcw3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"><span class="strong strong"><strong>ansible ALL=(ALL) NOPASSWD: ALL</strong></span></pre></div></div></li></ul></div></li></ol></div><p class="simpara">
							Alternatively, configure a more fine-granular policy that matches your security requirements. For further details on <code class="literal">sudoers</code> policies, see the <code class="literal">sudoers(5)</code> man page.
						</p></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Verify that you can execute commands from the control node on an all managed nodes:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gkw5574"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[ansible@control-node]$ <span class="strong strong"><strong>ansible all -m ping</strong></span>
BECOME password: <span class="strong strong"><strong><span class="emphasis"><em>&lt;password&gt;</em></span></strong></span>
managed-node-01.example.com | <span class="strong strong"><strong>SUCCESS</strong></span> =&gt; {
    	"ansible_facts": {
    	    "discovered_interpreter_python": "/usr/bin/python3"
    	},
    	"changed": false,
    	"ping": "pong"
}
...</pre></div></div><p class="simpara">
							The hard-coded all group dynamically contains all hosts listed in the inventory file.
						</p></li><li class="listitem"><p class="simpara">
							Verify that privilege escalation works correctly by running the <code class="literal">whoami</code> utility on a managed host by using the Ansible <code class="literal">command</code> module:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--09yl9m7"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">[ansible@control-node]$ <span class="strong strong"><strong>ansible managed-node-01.example.com -m command -a whoami</strong></span>
BECOME password: <span class="strong strong"><strong><span class="emphasis"><em>&lt;password&gt;</em></span></strong></span>
managed-node-01.example.com | CHANGED | rc=0 &gt;&gt;
<span class="strong strong"><strong>root</strong></span></pre></div></div><p class="simpara">
							If the command returns root, you configured <code class="literal">sudo</code> on the managed nodes correctly.
						</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/automating_system_administration_by_using_rhel_system_roles/assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles_automating-system-administration-by-using-rhel-system-roles#proc_preparing-a-control-node_assembly_preparing-a-control-node-and-managed-nodes-to-use-rhel-system-roles">Preparing a control node on RHEL 9</a>.
						</li><li class="listitem">
							The <code class="literal">sudoers(5)</code> man page
						</li></ul></div></section></section><section class="section" id="introduction-to-the-metrics-role_monitoring-performance-using-rhel-system-roles"><div class="titlepage"><div><div><h2 class="title">4.2. Introduction to the metrics System Role</h2></div></div></div><p class="_abstract _abstract">
				RHEL&nbsp;System&nbsp;Roles is a collection of Ansible roles and 
modules that provide a consistent configuration interface to remotely 
manage multiple RHEL systems. The <code class="literal">metrics</code> 
System Role configures performance analysis services for the local 
system and, optionally, includes a list of remote systems to be 
monitored by the local system. The <code class="literal">metrics</code> System Role enables you to use <code class="literal">pcp</code> to monitor your systems performance without having to configure <code class="literal">pcp</code> separately, as the set-up and deployment of <code class="literal">pcp</code> is handled by the playbook.
			</p><div class="table" id="idm140611472913120"><p class="title">Table 4.1. metrics system role variables</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="1dpin8p" id="rh-table--1dpin8p" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--><col style="width: 33%; " class="col_2"><!--Empty--><col style="width: 33%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611480060544" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Role variable</th><th id="idm140611493845600" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Description</th><th id="idm140611493844512" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">Example usage</th></tr></thead><tbody><tr><td headers="idm140611480060544" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								metrics_monitored_hosts
							</p>
							 </td><td headers="idm140611493845600" data-row="2" data-col="2" class="content--lg" valign="top" align="left"> <p>
								List of remote hosts to be analyzed by the target host. These 
hosts will have metrics recorded on the target host, so ensure enough 
disk space exists below <code class="literal">/var/log</code> for each host.
							</p>
							 </td><td headers="idm140611493844512" data-row="2" data-col="3" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">metrics_monitored_hosts: ["<span class="emphasis"><em>webserver.example.com</em></span>", "<span class="emphasis"><em>database.example.com</em></span>"]</code>
							</p>
							 </td></tr><tr><td headers="idm140611480060544" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								metrics_retention_days
							</p>
							 </td><td headers="idm140611493845600" data-row="3" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Configures the number of days for performance data retention before deletion.
							</p>
							 </td><td headers="idm140611493844512" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
								<code class="literal">metrics_retention_days: 14</code>
							</p>
							 </td></tr><tr><td headers="idm140611480060544" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								metrics_graph_service
							</p>
							 </td><td headers="idm140611493845600" data-row="4" data-col="2" class="content--lg" valign="top" align="left"> <p>
								A boolean flag that enables the host to be set up with services for performance data visualization via <code class="literal">pcp</code> and <code class="literal">grafana</code>. Set to false by default.
							</p>
							 </td><td headers="idm140611493844512" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
								<code class="literal">metrics_graph_service: no</code>
							</p>
							 </td></tr><tr><td headers="idm140611480060544" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								metrics_query_service
							</p>
							 </td><td headers="idm140611493845600" data-row="5" data-col="2" class="content--lg" valign="top" align="left"> <p>
								A boolean flag that enables the host to be set up with time series query services for querying recorded <code class="literal">pcp</code> metrics via <code class="literal">redis</code>. Set to false by default.
							</p>
							 </td><td headers="idm140611493844512" data-row="5" data-col="3" class="content--md" valign="top" align="left"> <p>
								<code class="literal">metrics_query_service: no</code>
							</p>
							 </td></tr><tr><td headers="idm140611480060544" data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								metrics_provider
							</p>
							 </td><td headers="idm140611493845600" data-row="6" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Specifies which metrics collector to use to provide metrics. Currently, <code class="literal">pcp</code> is the only supported metrics provider.
							</p>
							 </td><td headers="idm140611493844512" data-row="6" data-col="3" class="content--md" valign="top" align="left"> <p>
								<code class="literal">metrics_provider: "pcp"</code>
							</p>
							 </td></tr><tr><td headers="idm140611480060544" data-row="7" data-col="1" class="content--md" valign="top" align="left"> <p>
								metrics_manage_firewall
							</p>
							 </td><td headers="idm140611493845600" data-row="7" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Uses the <code class="literal">firewall</code> role to manage port access directly from the <code class="literal">metrics</code> role. Set to false by default.
							</p>
							 </td><td headers="idm140611493844512" data-row="7" data-col="3" class="content--md" valign="top" align="left"> <p>
								<code class="literal">metrics_manage_firewall: true</code>
							</p>
							 </td></tr><tr><td headers="idm140611480060544" data-row="8" data-col="1" class="content--md" valign="top" align="left"> <p>
								metrics_manage_selinux
							</p>
							 </td><td headers="idm140611493845600" data-row="8" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Uses the <code class="literal">selinux</code> role to manage port access directly from the <code class="literal">metrics</code> role. Set to false by default.
							</p>
							 </td><td headers="idm140611493844512" data-row="8" data-col="3" class="content--md" valign="top" align="left"> <p>
								<code class="literal">metrics_manage_selinux: true</code>
							</p>
							 </td></tr></tbody></table></rh-table></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					For details about the parameters used in <code class="literal">metrics_connections</code> and additional information about the <code class="literal">metrics</code> System Role, see the <code class="literal">/usr/share/ansible/roles/rhel-system-roles.metrics/README.md</code> file.
				</p></div></div></section><section class="section" id="using-the-metrics-role-to-monitor-your-local-system-with-visualization_monitoring-performance-using-rhel-system-roles"><div class="titlepage"><div><div><h2 class="title">4.3. Using the metrics System Role to monitor your local system with visualization</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to use the <code class="literal">metrics</code> RHEL&nbsp;System&nbsp;Role to monitor your local system while simultaneously provisioning data visualization via <code class="literal">Grafana</code>.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The Ansible Core package is installed on the control machine.
					</li><li class="listitem">
						You have the <code class="literal">rhel-system-roles</code> package installed on the machine you want to monitor.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure <code class="literal">localhost</code> in the <code class="literal">/etc/ansible/hosts</code> Ansible inventory by adding the following content to the inventory:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--rt2dffb"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">localhost ansible_connection=local</pre></div></div></li><li class="listitem"><p class="simpara">
						Create an Ansible playbook with the following content:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--k41e42w"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">---
- name: Manage metrics
  hosts: localhost
  vars:
    metrics_graph_service: yes
    metrics_manage_firewall: true
    metrics_manage_selinux: true
  roles:
    - rhel-system-roles.metrics</pre></div></div></li><li class="listitem"><p class="simpara">
						Run the Ansible playbook:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--n7uivky"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>ansible-playbook <span class="emphasis"><em>name_of_your_playbook</em></span>.yml</strong></span></pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Because the <code class="literal">metrics_graph_service</code> boolean is set to <code class="literal">value="yes"</code>, <code class="literal">Grafana</code> is automatically installed and provisioned with <code class="literal">pcp</code> added as a data source. Because <code class="literal">metrics_manage_firewall</code> and <code class="literal">metrics_manage_selinux</code> are both set to <code class="literal">true</code>, the metrics role uses the <code class="literal">firewall</code> and <code class="literal">selinux</code> system roles to manage the ports used by the metrics role.
						</p></div></div></li><li class="listitem">
						To view visualization of the metrics being collected on your machine, access the <code class="literal">grafana</code> web interface as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#accessing-the-grafana-web-UI_setting-up-graphical-representation-of-pcp-metrics">Accessing the Grafana web UI</a>.
					</li></ol></div></section><section class="section" id="using-the-metrics-role-to-monitor-a-fleet-of-machines-remotely_monitoring-performance-using-rhel-system-roles"><div class="titlepage"><div><div><h2 class="title">4.4. Using the metrics System Role to set up a fleet of individual systems to monitor themselves</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to use the <code class="literal">metrics</code> System Role to set up a fleet of machines to monitor themselves.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The Ansible Core package is installed on the control machine.
					</li><li class="listitem">
						You have the <code class="literal">rhel-system-roles</code> package installed on the machine you want to use to run the playbook.
					</li><li class="listitem">
						You have the SSH connection established.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Add the name or IP address of the machines you want to monitor via the playbook to the <code class="literal">/etc/ansible/hosts</code> Ansible inventory file under an identifying group name enclosed in brackets:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fj92hf8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[remotes]
<span class="emphasis"><em>webserver.example.com</em></span>
<span class="emphasis"><em>database.example.com</em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Create an Ansible playbook with the following content:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--v7cs30a"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">---
- hosts: remotes
  vars:
    metrics_retention_days: 0
    metrics_manage_firewall: true
    metrics_manage_selinux: true
  roles:
    - rhel-system-roles.metrics</pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Because <code class="literal">metrics_manage_firewall</code> and <code class="literal">metrics_manage_selinux</code> are both set to <code class="literal">true</code>, the metrics role uses the <code class="literal">firewall</code> and <code class="literal">selinux</code> roles to manage the ports used by the <code class="literal">metrics</code> role.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Run the Ansible playbook:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--q2ulnlr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>ansible-playbook <span class="emphasis"><em>name_of_your_playbook</em></span>.yml -k</strong></span></pre></div></div><p class="simpara">
						Where the <code class="literal">-k</code> prompt for password to connect to remote system.
					</p></li></ol></div></section><section class="section" id="using-the-metrics-role-to-monitor-a-fleet-of-machines-centrally-via-your-local-machine_monitoring-performance-using-rhel-system-roles"><div class="titlepage"><div><div><h2 class="title">4.5. Using the metrics System Role to monitor a fleet of machines centrally via your local machine</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to use the <code class="literal">metrics</code>
 System Role to set up your local machine to centrally monitor a fleet 
of machines while also provisioning visualization of the data via <code class="literal">grafana</code> and querying of the data via <code class="literal">redis</code>.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The Ansible Core package is installed on the control machine.
					</li><li class="listitem">
						You have the <code class="literal">rhel-system-roles</code> package installed on the machine you want to use to run the playbook.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create an Ansible playbook with the following content:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--sxyiio7"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">---
- hosts: localhost
  vars:
    metrics_graph_service: yes
    metrics_query_service: yes
    metrics_retention_days: 10
    metrics_monitored_hosts: ["<span class="emphasis"><em>database.example.com</em></span>", "<span class="emphasis"><em>webserver.example.com</em></span>"]
    metrics_manage_firewall: yes
    metrics_manage_selinux: yes
  roles:
    - rhel-system-roles.metrics</pre></div></div></li><li class="listitem"><p class="simpara">
						Run the Ansible playbook:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5j00cth"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># ansible-playbook <span class="emphasis"><em>name_of_your_playbook</em></span>.yml</pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Because the <code class="literal">metrics_graph_service</code> and <code class="literal">metrics_query_service</code> booleans are set to <code class="literal">value="yes"</code>, <code class="literal">grafana</code> is automatically installed and provisioned with <code class="literal">pcp</code> added as a data source with the <code class="literal">pcp</code> data recording indexed into <code class="literal">redis</code>, allowing the <code class="literal">pcp</code> querying language to be used for complex querying of the data. Because <code class="literal">metrics_manage_firewall</code> and <code class="literal">metrics_manage_selinux</code> are both set to <code class="literal">true</code>, the <code class="literal">metrics</code> role uses the <code class="literal">firewall</code> and <code class="literal">selinux</code> roles to manage the ports used by the <code class="literal">metrics</code> role.
						</p></div></div></li><li class="listitem">
						To view a graphical representation of the metrics being collected 
centrally by your machine and to query the data, access the <code class="literal">grafana</code> web interface as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#accessing-the-grafana-web-UI_setting-up-graphical-representation-of-pcp-metrics">Accessing the Grafana web UI</a>.
					</li></ol></div></section><section class="section" id="setting-up-authentication-while-monitoring-a-system-using-the-metrics-system-role_monitoring-performance-using-rhel-system-roles"><div class="titlepage"><div><div><h2 class="title">4.6. Setting up authentication while monitoring a system using the metrics System Role</h2></div></div></div><p class="_abstract _abstract">
				PCP supports the <code class="literal">scram-sha-256</code> authentication mechanism through the Simple Authentication Security Layer (SASL) framework. The <code class="literal">metrics</code> RHEL&nbsp;System&nbsp;Role automates the steps to setup authentication using the <code class="literal">scram-sha-256</code> authentication mechanism. This procedure describes how to setup authentication using the <code class="literal">metrics</code> RHEL&nbsp;System&nbsp;Role.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The Ansible Core package is installed on the control machine.
					</li><li class="listitem">
						You have the <code class="literal">rhel-system-roles</code> package installed on the machine you want to use to run the playbook.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Include the following variables in the Ansible playbook you want to setup authentication for:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--c964s7e"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">---
  vars:
    metrics_username: <span class="emphasis"><em>your_username</em></span>
    metrics_password: <span class="emphasis"><em>your_password</em></span>
    metrics_manage_firewall: true
    metrics_manage_selinux: true</pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Because <code class="literal">metrics_manage_firewall</code> and <code class="literal">metrics_manage_selinux</code> are both set to <code class="literal">true</code>, the <code class="literal">metrics</code> role uses the <code class="literal">firewall</code> and <code class="literal">selinux</code> roles to manage the ports used by the <code class="literal">metrics</code> role.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Run the Ansible playbook:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7nxvggy"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>ansible-playbook <span class="emphasis"><em>name_of_your_playbook</em></span>.yml</strong></span></pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify the <code class="literal">sasl</code> configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--uqlbu1l"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo -f -h "pcp://<span class="emphasis"><em>ip_adress</em></span>?username=<span class="emphasis"><em>your_username</em></span>" disk.dev.read
Password:
disk.dev.read
inst [0 or "sda"] value 19540</pre></div></div><p class="simpara">
						<span class="emphasis"><em>ip_adress</em></span> should be replaced by the IP address of the host.
					</p></li></ul></div></section><section class="section" id="using-the-metrics-system-role-to-configure-and-enable-metrics-collection-for-sql-server_monitoring-performance-using-rhel-system-roles"><div class="titlepage"><div><div><h2 class="title">4.7. Using the metrics System Role to configure and enable metrics collection for SQL Server</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to use the <code class="literal">metrics</code> RHEL&nbsp;System&nbsp;Role to automate the configuration and enabling of metrics collection for Microsoft SQL Server via <code class="literal">pcp</code> on your local system.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The Ansible Core package is installed on the control machine.
					</li><li class="listitem">
						You have the <code class="literal">rhel-system-roles</code> package installed on the machine you want to monitor.
					</li><li class="listitem">
						You have installed Microsoft SQL Server for Red&nbsp;Hat 
Enterprise&nbsp;Linux and established a 'trusted' connection to an SQL 
server. See <a class="link" href="https://docs.microsoft.com/en-us/sql/linux/quickstart-install-connect-red-hat?view=sql-server-ver15">Install SQL Server and create a database on Red Hat</a>.
					</li><li class="listitem">
						You have installed the Microsoft ODBC driver for SQL Server for Red&nbsp;Hat Enterprise&nbsp;Linux. See <a class="link" href="https://docs.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-ver15#redhat17">Red Hat Enterprise Server and Oracle Linux</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure <code class="literal">localhost</code> in the <code class="literal">/etc/ansible/hosts</code> Ansible inventory by adding the following content to the inventory:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--grqpcjw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">localhost ansible_connection=local</pre></div></div></li><li class="listitem"><p class="simpara">
						Create an Ansible playbook that contains the following content:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--tqh2xav"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">---
- hosts: localhost
  vars:
   metrics_from_mssql: true
   metrics_manage_firewall: true
   metrics_manage_selinux: true
  roles:
   - role: rhel-system-roles.metrics</pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Because <code class="literal">metrics_manage_firewall</code> and <code class="literal">metrics_manage_selinux</code> are both set to <code class="literal">true</code>, the <code class="literal">metrics</code> role uses the <code class="literal">firewall</code> and <code class="literal">selinux</code> roles to manage the ports used by the <code class="literal">metrics</code> role.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Run the Ansible playbook:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7ruzqxg"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>ansible-playbook <span class="emphasis"><em>name_of_your_playbook</em></span>.yml</strong></span></pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Use the <code class="literal">pcp</code> command to verify that SQL Server PMDA agent (mssql) is loaded and running:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--73b4cte"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pcp
platform: Linux rhel82-2.local 4.18.0-167.el8.x86_64 #1 SMP Sun Dec 15 01:24:23 UTC 2019 x86_64
 hardware: 2 cpus, 1 disk, 1 node, 2770MB RAM
 timezone: PDT+7
 services: pmcd pmproxy
     pmcd: Version 5.0.2-1, 12 agents, 4 clients
     pmda: root pmcd proc pmproxy xfs linux nfsclient mmv kvm <span class="strong strong"><strong>mssql</strong></span>
           jbd2 dm
 pmlogger: primary logger: /var/log/pcp/pmlogger/rhel82-2.local/20200326.16.31
     pmie: primary engine: /var/log/pcp/pmie/rhel82-2.local/pmie.log</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://www.redhat.com/en/blog/performance-co-pilot-microsoft-sql-server-rhel-82">For more information about using Performance Co-Pilot for Microsoft SQL Server, see this Red Hat Developers Blog post.</a>
					</li></ul></div></section></section><section class="chapter" id="setting-up-pcp_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 5. Setting up PCP</h1></div></div></div><p class="_abstract _abstract">
			Performance Co-Pilot (PCP) is a suite of tools, services, and 
libraries for monitoring, visualizing, storing, and analyzing 
system-level performance measurements.
		</p><section class="section" id="overview-of-pcp_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.1. Overview of PCP</h2></div></div></div><p class="_abstract _abstract">
				You can add performance metrics using Python, Perl, C++, and C 
interfaces. Analysis tools can use the Python, C++, C client APIs 
directly, and rich web applications can explore all available 
performance data using a JSON interface.
			</p><p>
				You can analyze data patterns by comparing live results with archived data.
			</p><p>
				Features of PCP:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Light-weight distributed architecture, which is useful during the centralized analysis of complex systems.
					</li><li class="listitem">
						It allows the monitoring and management of real-time data.
					</li><li class="listitem">
						It allows logging and retrieval of historical data.
					</li></ul></div><p>
				PCP has the following components:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The Performance Metric Collector Daemon (<code class="literal">pmcd</code>) collects performance data from the installed Performance Metric Domain Agents (<code class="literal">pmda</code>). <span class="strong strong"><strong>PMDAs</strong></span> can be individually loaded or unloaded on the system and are controlled by the <span class="strong strong"><strong>PMCD</strong></span> on the same host.
					</li><li class="listitem">
						Various client tools, such as <code class="literal">pminfo</code> or <code class="literal">pmstat</code>, can retrieve, display, archive, and process this data on the same host or over the network.
					</li><li class="listitem">
						The <code class="literal">pcp</code> package provides the command-line tools and underlying functionality.
					</li><li class="listitem">
						The <code class="literal">pcp-gui</code> package provides the graphical application. Install the <code class="literal">pcp-gui</code> package by executing the <code class="literal">dnf install pcp-gui</code> command. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/monitoring-performance-with-performance-co-pilot_monitoring-and-managing-system-status-and-performance#visually-tracing-pcp-log-archives-with-pcp-charts_monitoring-performance-with-performance-co-pilot">Visually tracing PCP log archives with the PCP Charts application</a>.
					</li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pcp(1)</code> man page
					</li><li class="listitem">
						<code class="literal">/usr/share/doc/pcp-doc/</code> directory
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/articles/1145953">Index of Performance Co-Pilot (PCP) articles, solutions, tutorials, and white papers fromon Red&nbsp;Hat Customer Portal</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/articles/2372811">Side-by-side comparison of PCP tools with legacy tools Red&nbsp;Hat Knowledgebase article</a>
					</li><li class="listitem">
						<a class="link" href="http://pcp.io/documentation.html">PCP upstream documentation</a>
					</li></ul></div></section><section class="section" id="installing-and-enabling-pcp_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.2. Installing and enabling PCP</h2></div></div></div><p class="_abstract _abstract">
				To begin using PCP, install all the required packages and enable the PCP monitoring services.
			</p><p>
				This procedure describes how to install PCP using the <code class="literal">pcp</code> package. If you want to automate the PCP installation, install it using the <code class="literal">pcp-zeroconf</code> package. For more information about installing PCP by using <code class="literal">pcp-zeroconf</code>, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics">Setting up PCP with pcp-zeroconf</a>.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l7f6wsz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp</pre></div></div></li><li class="listitem"><p class="simpara">
						Enable and start the <code class="literal">pmcd</code> service on the host machine:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--k4aw0zi"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl enable pmcd

# systemctl start pmcd</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify if the <code class="literal">pmcd</code> process is running on the host:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2bi2b44"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pcp

Performance Co-Pilot configuration on workstation:

platform: Linux workstation 4.18.0-80.el8.x86_64 #1 SMP Wed Mar 13 12:02:46 UTC 2019 x86_64
hardware: 12 cpus, 2 disks, 1 node, 36023MB RAM
timezone: CEST-2
services: pmcd
pmcd: Version 4.3.0-1, 8 agents
pmda: root pmcd proc xfs linux mmv kvm jbd2</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmcd(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li></ul></div></section><section class="section" id="deploying-a-minimal-pcp-setup_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.3. Deploying a minimal PCP setup</h2></div></div></div><p class="_abstract _abstract">
				The minimal PCP setup collects performance statistics on 
Red&nbsp;Hat Enterprise&nbsp;Linux. The setup involves adding the 
minimum number of packages on a production system needed to gather data 
for further analysis.
			</p><p>
				You can analyze the resulting <code class="literal">tar.gz</code> file and the archive of the <code class="literal">pmlogger</code> output using various PCP tools and compare them with other sources of performance information.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Update the <code class="literal">pmlogger</code> configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--016dhw3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pmlogconf -r /var/lib/pcp/config/pmlogger/config.default</pre></div></div></li><li class="listitem"><p class="simpara">
						Start the <code class="literal">pmcd</code> and <code class="literal">pmlogger</code> services:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--n74auss"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl start pmcd.service

# systemctl start pmlogger.service</pre></div></div></li><li class="listitem">
						Execute the required operations to record the performance data.
					</li><li class="listitem"><p class="simpara">
						Stop the <code class="literal">pmcd</code> and <code class="literal">pmlogger</code> services:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--tuq0evk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl stop pmcd.service

# systemctl stop pmlogger.service</pre></div></div></li><li class="listitem"><p class="simpara">
						Save the output and save it to a <code class="literal">tar.gz</code> file named based on the host name and the current date and time:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--a5mputc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cd /var/log/pcp/pmlogger/

# tar -czf $(hostname).$(date +%F-%Hh%M).pcp.tar.gz $(hostname)</pre></div></div><p class="simpara">
						Extract this file and analyze the data using PCP tools.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogconf(1)</code>, <code class="literal">pmlogger(1)</code>, and <code class="literal">pmcd(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li></ul></div></section><section class="section" id="system-services-distributed-with-pcp_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.4. System services distributed with PCP</h2></div></div></div><p class="_abstract _abstract">
				The following table describes roles of various system services, which are distributed with PCP.
			</p><div class="table" id="idm140611487756160"><p class="title">Table 5.1. Roles of system services distributed with PCP</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="mxg9dsq" id="rh-table--mxg9dsq"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><tbody><tr><td data-row="1" data-col="1" class="content--md" valign="top" align="left"> <p>
								Name
							</p>
							 </td><td data-row="1" data-col="2" class="content--md" valign="top" align="left"> <p>
								Description
							</p>
							 </td></tr><tr><td data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmcd</code>
							</p>
							 </td><td data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								The Performance Metric Collector Daemon (PMCD).
							</p>
							 </td></tr><tr><td data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmie</code>
							</p>
							 </td><td data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								The Performance Metrics Inference Engine.
							</p>
							 </td></tr><tr><td data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogger</code>
							</p>
							 </td><td data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								The performance metrics logger.
							</p>
							 </td></tr><tr><td data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmproxy</code>
							</p>
							 </td><td data-row="5" data-col="2" class="content--lg" valign="top" align="left"> <p>
								The realtime and historical performance metrics proxy, time series query and REST API service.
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="tools-distributed-with-pcp_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.5. Tools distributed with PCP</h2></div></div></div><p class="_abstract _abstract">
				The following table describes usage of various tools, which are distributed with PCP.
			</p><div class="table" id="idm140611464447888"><p class="title">Table 5.2. Usage of tools distributed with PCP</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="y969zh3" id="rh-table--y969zh3" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><tbody><tr><td data-row="1" data-col="1" class="content--md" valign="top" align="left"> <p>
								Name
							</p>
							 </td><td data-row="1" data-col="2" class="content--md" valign="top" align="left"> <p>
								Description
							</p>
							 </td></tr><tr><td data-row="2" data-col="1" class="content--sm" valign="top" align="left"> <p>
								<code class="literal">pcp</code>
							</p>
							 </td><td data-row="2" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays the current status of a Performance Co-Pilot installation.
							</p>
							 </td></tr><tr><td data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-atop</code>
							</p>
							 </td><td data-row="3" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Shows the system-level occupation of the most critical hardware 
resources from the performance point of view: CPU, memory, disk, and 
network.
							</p>
							 </td></tr><tr><td data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-atopsar</code>
							</p>
							 </td><td data-row="4" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Generates a system-level activity report over a variety of 
system resource utilization. The report is generated from a raw logfile 
previously recorded using pmlogger or the -w option of pcp-atop.
							</p>
							 </td></tr><tr><td data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-dmcache</code>
							</p>
							 </td><td data-row="5" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays information about configured Device Mapper Cache 
targets, such as: device IOPs, cache and metadata device utilization, as
 well as hit and miss rates and ratios for both reads and writes for 
each cache device.
							</p>
							 </td></tr><tr><td data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-dstat</code>
							</p>
							 </td><td data-row="6" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays metrics of one system at a time. To display metrics of multiple systems, use <code class="literal">--host</code> option.
							</p>
							 </td></tr><tr><td data-row="7" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-free</code>
							</p>
							 </td><td data-row="7" data-col="2" class="content--md" valign="top" align="left"> <p>
								Reports on free and used memory in a system.
							</p>
							 </td></tr><tr><td data-row="8" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-htop</code>
							</p>
							 </td><td data-row="8" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays all processes running on a system along with their command line arguments in a manner similar to the <code class="literal">top</code>
 command, but allows you to scroll vertically and horizontally as well 
as interact using a mouse. You can also view processes in a tree format 
and select and act on multiple processes at once.
							</p>
							 </td></tr><tr><td data-row="9" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-ipcs</code>
							</p>
							 </td><td data-row="9" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays information about the inter-process communication (IPC)
 facilities that the calling process has read access for.
							</p>
							 </td></tr><tr><td data-row="10" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-numastat</code>
							</p>
							 </td><td data-row="10" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays NUMA allocation statistics from the kernel memory allocator.
							</p>
							 </td></tr><tr><td data-row="11" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-pidstat</code>
							</p>
							 </td><td data-row="11" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays information about individual tasks or processes running
 on the system such as: CPU percentage, memory and stack usage, 
scheduling, and priority. Reports live data for the local host by 
default.
							</p>
							 </td></tr><tr><td data-row="12" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-ss</code>
							</p>
							 </td><td data-row="12" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays socket statistics collected by the pmdasockets Performance Metrics Domain Agent (PMDA).
							</p>
							 </td></tr><tr><td data-row="13" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-uptime</code>
							</p>
							 </td><td data-row="13" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays how long the system has been running, how many users 
are currently logged on, and the system load averages for the past 1, 5,
 and 15 minutes.
							</p>
							 </td></tr><tr><td data-row="14" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pcp-vmstat</code>
							</p>
							 </td><td data-row="14" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Provides a high-level system performance overview every 5 
seconds. Displays information about processes, memory, paging, block IO,
 traps, and CPU activity.
							</p>
							 </td></tr><tr><td data-row="15" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmchart</code>
							</p>
							 </td><td data-row="15" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Plots performance metrics values available through the facilities of the Performance Co-Pilot.
							</p>
							 </td></tr><tr><td data-row="16" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmclient</code>
							</p>
							 </td><td data-row="16" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays high-level system performance metrics by using the 
Performance Metrics Application Programming Interface (PMAPI).
							</p>
							 </td></tr><tr><td data-row="17" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmconfig</code>
							</p>
							 </td><td data-row="17" data-col="2" class="content--md" valign="top" align="left"> <p>
								Displays the values of configuration parameters.
							</p>
							 </td></tr><tr><td data-row="18" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmdbg</code>
							</p>
							 </td><td data-row="18" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays available Performance Co-Pilot debug control flags and their values.
							</p>
							 </td></tr><tr><td data-row="19" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmdiff</code>
							</p>
							 </td><td data-row="19" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Compares the average values for every metric in either one or 
two archives, in a given time window, for changes that are likely to be 
of interest when searching for performance regressions.
							</p>
							 </td></tr><tr><td data-row="20" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmdumplog</code>
							</p>
							 </td><td data-row="20" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays control, metadata, index, and state information from a Performance Co-Pilot archive file.
							</p>
							 </td></tr><tr><td data-row="21" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmdumptext</code>
							</p>
							 </td><td data-row="21" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Outputs the values of performance metrics collected live or from a Performance Co-Pilot archive.
							</p>
							 </td></tr><tr><td data-row="22" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmerr</code>
							</p>
							 </td><td data-row="22" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays available Performance Co-Pilot error codes and their corresponding error messages.
							</p>
							 </td></tr><tr><td data-row="23" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmfind</code>
							</p>
							 </td><td data-row="23" data-col="2" class="content--md" valign="top" align="left"> <p>
								Finds PCP services on the network.
							</p>
							 </td></tr><tr><td data-row="24" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmie</code>
							</p>
							 </td><td data-row="24" data-col="2" class="content--lg" valign="top" align="left"> <p>
								An inference engine that periodically evaluates a set of 
arithmetic, logical, and rule expressions. The metrics are collected 
either from a live system, or from a Performance Co-Pilot archive file.
							</p>
							 </td></tr><tr><td data-row="25" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmieconf</code>
							</p>
							 </td><td data-row="25" data-col="2" class="content--md" valign="top" align="left"> <p>
								Displays or sets configurable pmie variables.
							</p>
							 </td></tr><tr><td data-row="26" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmiectl</code>
							</p>
							 </td><td data-row="26" data-col="2" class="content--md" valign="top" align="left"> <p>
								Manages non-primary instances of pmie.
							</p>
							 </td></tr><tr><td data-row="27" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pminfo</code>
							</p>
							 </td><td data-row="27" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays information about performance metrics. The metrics are 
collected either from a live system, or from a Performance Co-Pilot 
archive file.
							</p>
							 </td></tr><tr><td data-row="28" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmiostat</code>
							</p>
							 </td><td data-row="28" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Reports I/O statistics for SCSI devices (by default) or device-mapper devices (with the -x dm option).
							</p>
							 </td></tr><tr><td data-row="29" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlc</code>
							</p>
							 </td><td data-row="29" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Interactively configures active pmlogger instances.
							</p>
							 </td></tr><tr><td data-row="30" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogcheck</code>
							</p>
							 </td><td data-row="30" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Identifies invalid data in a Performance Co-Pilot archive file.
							</p>
							 </td></tr><tr><td data-row="31" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogconf</code>
							</p>
							 </td><td data-row="31" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Creates and modifies a pmlogger configuration file.
							</p>
							 </td></tr><tr><td data-row="32" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogctl</code>
							</p>
							 </td><td data-row="32" data-col="2" class="content--md" valign="top" align="left"> <p>
								Manages non-primary instances of pmlogger.
							</p>
							 </td></tr><tr><td data-row="33" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmloglabel</code>
							</p>
							 </td><td data-row="33" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Verifies, modifies, or repairs the label of a Performance Co-Pilot archive file.
							</p>
							 </td></tr><tr><td data-row="34" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogsummary</code>
							</p>
							 </td><td data-row="34" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Calculates statistical information about performance metrics stored in a Performance Co-Pilot archive file.
							</p>
							 </td></tr><tr><td data-row="35" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmprobe</code>
							</p>
							 </td><td data-row="35" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Determines the availability of performance metrics.
							</p>
							 </td></tr><tr><td data-row="36" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmrep</code>
							</p>
							 </td><td data-row="36" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Reports on selected, easily customizable, performance metrics values.
							</p>
							 </td></tr><tr><td data-row="37" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmsocks</code>
							</p>
							 </td><td data-row="37" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Allows access to a Performance Co-Pilot hosts through a firewall.
							</p>
							 </td></tr><tr><td data-row="38" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmstat</code>
							</p>
							 </td><td data-row="38" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Periodically displays a brief summary of system performance.
							</p>
							 </td></tr><tr><td data-row="39" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmstore</code>
							</p>
							 </td><td data-row="39" data-col="2" class="content--md" valign="top" align="left"> <p>
								Modifies the values of performance metrics.
							</p>
							 </td></tr><tr><td data-row="40" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmtrace</code>
							</p>
							 </td><td data-row="40" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Provides a command line interface to the trace PMDA.
							</p>
							 </td></tr><tr><td data-row="41" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmval</code>
							</p>
							 </td><td data-row="41" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Displays the current value of a performance metric.
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="pcp-deployment-architectures_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.6. PCP deployment architectures</h2></div></div></div><p class="_abstract _abstract">
				Performance Co-Pilot (PCP) supports multiple deployment 
architectures, based on the scale of the PCP deployment, and offers many
 options to accomplish advanced setups.
			</p><p>
				Available scaling deployment setup variants based on the recommended
 deployment set up by Red&nbsp;Hat, sizing factors, and configuration 
options include:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Localhost</code></span></dt><dd><p class="simpara">
							Each service runs locally on the monitored machine. When you 
start a service without any configuration changes, this is the default 
deployment. Scaling beyond the individual node is not possible in this 
case.
						</p><p class="simpara">
							By default, the deployment setup for Redis is standalone, 
localhost. However, Redis can optionally perform in a highly-available 
and highly scalable clustered fashion, where data is shared across 
multiple hosts. Another viable option is to deploy a Redis cluster in 
the cloud, or to utilize a managed Redis cluster from a cloud vendor.
						</p></dd><dt><span class="term"><code class="literal">Decentralized</code></span></dt><dd><p class="simpara">
							The only difference between localhost and decentralized setup is 
the centralized Redis service. In this model, the host executes <code class="literal">pmlogger</code> service on each monitored host and retrieves metrics from a local <code class="literal">pmcd</code> instance. A local <code class="literal">pmproxy</code> service then exports the performance metrics to a central Redis instance.
						</p><div class="figure" id="idm140611489150240"><p class="title">Figure 5.1. Decentralized logging</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/8e69aa84f8186f3fa2ee8f1787c2dc17/173_RHEL_instaling_PCP_0721_decentralized.png" class="rh_docs--zoom" title="Decentralized logging"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/173_RHEL_instaling_PCP_0721_decentralized.png" alt="Decentralized logging"></a></div></div></div></dd><dt><span class="term"><code class="literal">Centralized logging - pmlogger farm</code></span></dt><dd><p class="simpara">
							When the resource usage on the monitored hosts is constrained, another deployment option is a <code class="literal">pmlogger</code> farm, which is also known as centralized logging. In this setup, a single logger host executes multiple <code class="literal">pmlogger</code> processes, and each is configured to retrieve performance metrics from a different remote <code class="literal">pmcd</code> host. The centralized logger host is also configured to execute the <code class="literal">pmproxy</code> service, which discovers the resulting PCP archives logs and loads the metric data into a Redis instance.
						</p><div class="figure" id="idm140611491840432"><p class="title">Figure 5.2. Centralized logging - pmlogger farm</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/6a30238925dab26408092ae39258801e/173_RHEL_instaling_PCP_0721_centralized.png" class="rh_docs--zoom" title="Centralized logging - pmlogger farm"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/173_RHEL_instaling_PCP_0721_centralized.png" alt="Centralized logging - pmlogger farm"></a></div></div></div></dd><dt><span class="term"><code class="literal">Federated - multiple pmlogger farms</code></span></dt><dd><p class="simpara">
							For large scale deployments, Red&nbsp;Hat recommends to deploy multiple <code class="literal">pmlogger</code> farms in a federated fashion. For example, one <code class="literal">pmlogger</code> farm per rack or data center. Each <code class="literal">pmlogger</code> farm loads the metrics into a central Redis instance.
						</p><div class="figure" id="idm140611473215072"><p class="title">Figure 5.3. Federated - multiple pmlogger farms</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/0184fc52d4cf8596c8a0927914cab33c/173_RHEL_instaling_PCP_0721_federated.png" class="rh_docs--zoom" title="Federated - multiple pmlogger farms"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/173_RHEL_instaling_PCP_0721_federated.png" alt="Federated - multiple pmlogger farms"></a></div></div></div></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					By default, the deployment setup for Redis is standalone, 
localhost. However, Redis can optionally perform in a highly-available 
and highly scalable clustered fashion, where data is shared across 
multiple hosts. Another viable option is to deploy a Redis cluster in 
the cloud, or to utilize a managed Redis cluster from a cloud vendor.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pcp(1)</code>, <code class="literal">pmlogger(1)</code>, <code class="literal">pmproxy(1)</code>, and <code class="literal">pmcd(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#recommended-deployment-architecture_setting-up-pcp">Recommended deployment architecture</a>
					</li></ul></div></section><section class="section" id="recommended-deployment-architecture_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.7. Recommended deployment architecture</h2></div></div></div><p class="_abstract _abstract">
				The following table describes the recommended deployment architectures based on the number of monitored hosts.
			</p><div class="table" id="idm140611480077616"><p class="title">Table 5.3. Recommended deployment architecture</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="go87g17" id="rh-table--go87g17" style="--rh-table--scrollbar--width: 0px;"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--><col style="width: 25%; " class="col_2"><!--Empty--><col style="width: 25%; " class="col_3"><!--Empty--><col style="width: 25%; " class="col_4"><!--Empty--></colgroup><thead><tr><th id="idm140611485377520" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Number of hosts (N)</th><th id="idm140611489054352" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">1-10</th><th id="idm140611489053264" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">10-100</th><th id="idm140611489052176" scope="col" data-row="1" data-col="4" class="content--sm" valign="top" align="left">100-1000</th></tr></thead><tbody><tr><td headers="idm140611485377520" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmcd</code> servers
							</p>
							 </td><td headers="idm140611489054352" data-row="2" data-col="2" class="content--sm" valign="top" align="left"> <p>
								N
							</p>
							 </td><td headers="idm140611489053264" data-row="2" data-col="3" class="content--sm" valign="top" align="left"> <p>
								N
							</p>
							 </td><td headers="idm140611489052176" data-row="2" data-col="4" class="content--sm" valign="top" align="left"> <p>
								N
							</p>
							 </td></tr><tr><td headers="idm140611485377520" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogger</code> servers
							</p>
							 </td><td headers="idm140611489054352" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								1 to N
							</p>
							 </td><td headers="idm140611489053264" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
								N/10 to N
							</p>
							 </td><td headers="idm140611489052176" data-row="3" data-col="4" class="content--md" valign="top" align="left"> <p>
								N/100 to N
							</p>
							 </td></tr><tr><td headers="idm140611485377520" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmproxy</code> servers
							</p>
							 </td><td headers="idm140611489054352" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								1 to N
							</p>
							 </td><td headers="idm140611489053264" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
								1 to N
							</p>
							 </td><td headers="idm140611489052176" data-row="4" data-col="4" class="content--md" valign="top" align="left"> <p>
								N/100 to N
							</p>
							 </td></tr><tr><td headers="idm140611485377520" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								Redis servers
							</p>
							 </td><td headers="idm140611489054352" data-row="5" data-col="2" class="content--md" valign="top" align="left"> <p>
								1 to N
							</p>
							 </td><td headers="idm140611489053264" data-row="5" data-col="3" class="content--md" valign="top" align="left"> <p>
								1 to N/10
							</p>
							 </td><td headers="idm140611489052176" data-row="5" data-col="4" class="content--md" valign="top" align="left"> <p>
								N/100 to N/10
							</p>
							 </td></tr><tr><td headers="idm140611485377520" data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								Redis cluster
							</p>
							 </td><td headers="idm140611489054352" data-row="6" data-col="2" class="content--sm" valign="top" align="left"> <p>
								No
							</p>
							 </td><td headers="idm140611489053264" data-row="6" data-col="3" class="content--md" valign="top" align="left"> <p>
								Maybe
							</p>
							 </td><td headers="idm140611489052176" data-row="6" data-col="4" class="content--sm" valign="top" align="left"> <p>
								Yes
							</p>
							 </td></tr><tr><td headers="idm140611485377520" data-row="7" data-col="1" class="content--md" valign="top" align="left"> <p>
								Recommended deployment setup
							</p>
							 </td><td headers="idm140611489054352" data-row="7" data-col="2" class="content--md" valign="top" align="left"> <p>
								Localhost, Decentralized, or Centralized logging
							</p>
							 </td><td headers="idm140611489053264" data-row="7" data-col="3" class="content--md" valign="top" align="left"> <p>
								Decentralized, Centralized logging, or Federated
							</p>
							 </td><td headers="idm140611489052176" data-row="7" data-col="4" class="content--md" valign="top" align="left"> <p>
								Decentralized or Federated
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="sizing-factors_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.8. Sizing factors</h2></div></div></div><p class="_abstract _abstract">
				The following are the sizing factors required for scaling:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Remote system size</code></span></dt><dd>
							The number of CPUs, disks, network interfaces, and other hardware resources affects the amount of data collected by each <code class="literal">pmlogger</code> on the centralized logging host.
						</dd><dt><span class="term"><code class="literal">Logged Metrics</code></span></dt><dd>
							The number and types of logged metrics play an important role. In particular, the <code class="literal">per-process proc.*</code> metrics require a large amount of disk space, for example, with the standard <code class="literal">pcp-zeroconf</code>
 setup, 10s logging interval, 11 MB without proc metrics versus 155 MB 
with proc metrics - a factor of 10 times more. Additionally, the number 
of instances for each metric, for example the number of CPUs, block 
devices, and network interfaces also impacts the required storage 
capacity.
						</dd><dt><span class="term"><code class="literal">Logging Interval</code></span></dt><dd>
							The interval how often metrics are logged, affects the storage 
requirements. The expected daily PCP archive file sizes are written to 
the <code class="literal">pmlogger.log</code> file for each <code class="literal">pmlogger</code>
 instance. These values are uncompressed estimates. Since PCP archives 
compress very well, approximately 10:1, the actual long term disk space 
requirements can be determined for a particular site.
						</dd><dt><span class="term"><code class="literal">pmlogrewrite</code></span></dt><dd>
							After every PCP upgrade, the <code class="literal">pmlogrewrite</code>
 tool is executed and rewrites old archives if there were changes in the
 metric metadata from the previous version and the new version of PCP. 
This process duration scales linear with the number of archives stored.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogrewrite(1)</code> and <code class="literal">pmlogger(1)</code> man pages
					</li></ul></div></section><section class="section" id="configuration-options-for-pcp-scaling_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.9. Configuration options for PCP scaling</h2></div></div></div><p class="_abstract _abstract">
				The following are the configuration options, which are required for scaling:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">sysctl and rlimit settings</code></span></dt><dd>
							When archive discovery is enabled, <code class="literal">pmproxy</code> requires four descriptors for every <code class="literal">pmlogger</code> that it is monitoring or log-tailing, along with the additional file descriptors for the service logs and <code class="literal">pmproxy</code> client sockets, if any. Each <code class="literal">pmlogger</code> process uses about 20 file descriptors for the remote <code class="literal">pmcd</code>
 socket, archive files, service logs, and others. In total, this can 
exceed the default 1024 soft limit on a system running around 200 <code class="literal">pmlogger</code> processes. The <code class="literal">pmproxy</code> service in <code class="literal">pcp-5.3.0</code>
 and later automatically increases the soft limit to the hard limit. On 
earlier versions of PCP, tuning is required if a high number of <code class="literal">pmlogger</code> processes are to be deployed, and this can be accomplished by increasing the soft or hard limits for <code class="literal">pmlogger</code>. For more information, see <a class="link" href="https://access.redhat.com/solutions/1346533">How to set limits (ulimit) for services run by systemd</a>.
						</dd><dt><span class="term"><code class="literal">Local Archives</code></span></dt><dd>
							The <code class="literal">pmlogger</code> service stores metrics of local and remote <code class="literal">pmcds</code> in the <code class="literal">/var/log/pcp/pmlogger/</code> directory. To control the logging interval of the local system, update the <code class="literal">/etc/pcp/pmlogger/control.d/<span class="emphasis"><em>configfile</em></span></code> file and add <code class="literal">-t <span class="emphasis"><em>X</em></span></code> in the arguments, where <span class="emphasis"><em>X</em></span> is the logging interval in seconds. To configure which metrics should be logged, execute <code class="literal">pmlogconf /var/lib/pcp/config/pmlogger/config.<span class="emphasis"><em>clienthostname</em></span></code>.
 This command deploys a configuration file with a default set of 
metrics, which can optionally be further customized. To specify 
retention settings, that is when to purge old PCP archives, update the <code class="literal">/etc/sysconfig/pmlogger_timers</code> file and specify <code class="literal">PMLOGGER_DAILY_PARAMS="-E -k <span class="emphasis"><em>X</em></span>"</code>, where <span class="emphasis"><em>X</em></span> is the amount of days to keep PCP archives.
						</dd><dt><span class="term"><code class="literal">Redis</code></span></dt><dd><p class="simpara">
							The <code class="literal">pmproxy</code> service sends logged metrics from <code class="literal">pmlogger</code> to a Redis instance. The following are the available two options to specify the retention settings in the <code class="literal">/etc/pcp/pmproxy/pmproxy.conf</code> configuration file:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">stream.expire</code> specifies the 
duration when stale metrics should be removed, that is metrics which 
were not updated in a specified amount of time in seconds.
								</li><li class="listitem">
									<code class="literal">stream.maxlen</code> specifies the 
maximum number of metric values for one metric per host. This setting 
should be the retention time divided by the logging interval, for 
example 20160 for 14 days of retention and 60s logging interval 
(60*60*24*14/60)
								</li></ul></div></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmproxy(1)</code>, <code class="literal">pmlogger(1)</code>, and <code class="literal">sysctl(8)</code> man pages
					</li></ul></div></section><section class="section" id="example-analyzing-the-centralized-logging-deployment_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.10. Example: Analyzing the centralized logging deployment</h2></div></div></div><p class="_abstract _abstract">
				The following results were gathered on a centralized logging setup, also known as pmlogger farm deployment, with a default <code class="literal">pcp-zeroconf 5.3.0</code> installation, where each remote host is an identical container instance running <code class="literal">pmcd</code> on a server with 64 CPU cores, 376 GB RAM, and one disk attached.
			</p><p>
				The logging interval is 10s, proc metrics of remote nodes are not 
included, and the memory values refer to the Resident Set Size (RSS) 
value.
			</p><div class="table" id="idm140611473112912"><p class="title">Table 5.4. Detailed utilization statistics for 10s logging interval</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="rb7sk68" id="rh-table--rb7sk68"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--><col style="width: 33%; " class="col_2"><!--Empty--><col style="width: 33%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611485299600" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Number of Hosts</th><th id="idm140611485298512" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">10</th><th id="idm140611485297424" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">50</th></tr></thead><tbody><tr><td headers="idm140611485299600" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								PCP Archives Storage per Day
							</p>
							 </td><td headers="idm140611485298512" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								91 MB
							</p>
							 </td><td headers="idm140611485297424" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
								522 MB
							</p>
							 </td></tr><tr><td headers="idm140611485299600" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogger</code> Memory
							</p>
							 </td><td headers="idm140611485298512" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								160 MB
							</p>
							 </td><td headers="idm140611485297424" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
								580 MB
							</p>
							 </td></tr><tr><td headers="idm140611485299600" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogger</code> Network per Day (In)
							</p>
							 </td><td headers="idm140611485298512" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								2 MB
							</p>
							 </td><td headers="idm140611485297424" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
								9 MB
							</p>
							 </td></tr><tr><td headers="idm140611485299600" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmproxy</code> Memory
							</p>
							 </td><td headers="idm140611485298512" data-row="5" data-col="2" class="content--md" valign="top" align="left"> <p>
								1.4 GB
							</p>
							 </td><td headers="idm140611485297424" data-row="5" data-col="3" class="content--md" valign="top" align="left"> <p>
								6.3 GB
							</p>
							 </td></tr><tr><td headers="idm140611485299600" data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								Redis Memory per Day
							</p>
							 </td><td headers="idm140611485298512" data-row="6" data-col="2" class="content--md" valign="top" align="left"> <p>
								2.6 GB
							</p>
							 </td><td headers="idm140611485297424" data-row="6" data-col="3" class="content--md" valign="top" align="left"> <p>
								12 GB
							</p>
							 </td></tr></tbody></table></rh-table></div><div class="table" id="idm140611481372640"><p class="title">Table 5.5. Used resources depending on monitored hosts for 60s logging interval</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="v0742y5" id="rh-table--v0742y5" style="--rh-table--scrollbar--width: 0px;"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 25%; " class="col_1"><!--Empty--><col style="width: 25%; " class="col_2"><!--Empty--><col style="width: 25%; " class="col_3"><!--Empty--><col style="width: 25%; " class="col_4"><!--Empty--></colgroup><thead><tr><th id="idm140611492825040" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Number of Hosts</th><th id="idm140611492823952" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">10</th><th id="idm140611492822864" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">50</th><th id="idm140611492821776" scope="col" data-row="1" data-col="4" class="content--sm" valign="top" align="left">100</th></tr></thead><tbody><tr><td headers="idm140611492825040" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								PCP Archives Storage per Day
							</p>
							 </td><td headers="idm140611492823952" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								20 MB
							</p>
							 </td><td headers="idm140611492822864" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
								120 MB
							</p>
							 </td><td headers="idm140611492821776" data-row="2" data-col="4" class="content--md" valign="top" align="left"> <p>
								271 MB
							</p>
							 </td></tr><tr><td headers="idm140611492825040" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogger</code> Memory
							</p>
							 </td><td headers="idm140611492823952" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								104 MB
							</p>
							 </td><td headers="idm140611492822864" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
								524 MB
							</p>
							 </td><td headers="idm140611492821776" data-row="3" data-col="4" class="content--md" valign="top" align="left"> <p>
								1049 MB
							</p>
							 </td></tr><tr><td headers="idm140611492825040" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmlogger</code> Network per Day (In)
							</p>
							 </td><td headers="idm140611492823952" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								0.38 MB
							</p>
							 </td><td headers="idm140611492822864" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
								1.75 MB
							</p>
							 </td><td headers="idm140611492821776" data-row="4" data-col="4" class="content--md" valign="top" align="left"> <p>
								3.48 MB
							</p>
							 </td></tr><tr><td headers="idm140611492825040" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">pmproxy</code> Memory
							</p>
							 </td><td headers="idm140611492823952" data-row="5" data-col="2" class="content--md" valign="top" align="left"> <p>
								2.67 GB
							</p>
							 </td><td headers="idm140611492822864" data-row="5" data-col="3" class="content--md" valign="top" align="left"> <p>
								5.5GB
							</p>
							 </td><td headers="idm140611492821776" data-row="5" data-col="4" class="content--md" valign="top" align="left"> <p>
								9 GB
							</p>
							 </td></tr><tr><td headers="idm140611492825040" data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								Redis Memory per Day
							</p>
							 </td><td headers="idm140611492823952" data-row="6" data-col="2" class="content--md" valign="top" align="left"> <p>
								0.54 GB
							</p>
							 </td><td headers="idm140611492822864" data-row="6" data-col="3" class="content--md" valign="top" align="left"> <p>
								2.65 GB
							</p>
							 </td><td headers="idm140611492821776" data-row="6" data-col="4" class="content--md" valign="top" align="left"> <p>
								5.3 GB
							</p>
							 </td></tr></tbody></table></rh-table></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The <code class="literal">pmproxy</code> queues Redis requests and 
employs Redis pipelining to speed up Redis queries. This can result in 
high memory usage. For troubleshooting this issue, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#troubleshooting-high-memory-usage_setting-up-pcp">Troubleshooting high memory usage</a>.
				</p></div></div></section><section class="section" id="example-analyzing-the-federated-setup-deployment_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.11. Example: Analyzing the federated setup deployment</h2></div></div></div><p class="_abstract _abstract">
				The following results were observed on a federated setup, also known as multiple <code class="literal">pmlogger</code> farms, consisting of three centralized logging (<code class="literal">pmlogger</code> farm) setups, where each <code class="literal">pmlogger</code> farm was monitoring 100 remote hosts, that is 300 hosts in total.
			</p><p>
				This setup of the <code class="literal">pmlogger</code> farms is identical to the configuration mentioned in the
			</p><p>
				<a class="link" href="#example-analyzing-the-centralized-logging-deployment_setting-up-pcp" title="5.10.&nbsp;Example: Analyzing the centralized logging deployment">Example: Analyzing the centralized logging deployment</a> for 60s logging interval, except that the Redis servers were operating in cluster mode.
			</p><div class="table" id="idm140611485145280"><p class="title">Table 5.6. Used resources depending on federated hosts for 60s logging interval</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="x0nwnw3" id="rh-table--x0nwnw3" style="--rh-table--scrollbar--width: 0px;"><table class="gt-4-cols lt-7-rows"><colgroup><col style="width: 20%; " class="col_1"><!--Empty--><col style="width: 20%; " class="col_2"><!--Empty--><col style="width: 20%; " class="col_3"><!--Empty--><col style="width: 20%; " class="col_4"><!--Empty--><col style="width: 20%; " class="col_5"><!--Empty--></colgroup><thead><tr><th id="idm140611478556672" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">PCP Archives Storage per Day</th><th id="idm140611479099792" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left"><code class="literal">pmlogger</code> Memory</th><th id="idm140611479098496" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">Network per Day (In/Out)</th><th id="idm140611479097392" scope="col" data-row="1" data-col="4" class="content--sm" valign="top" align="left"><code class="literal">pmproxy</code> Memory</th><th id="idm140611479095984" scope="col" data-row="1" data-col="5" class="content--sm" valign="top" align="left">Redis Memory per Day</th></tr></thead><tbody><tr><td headers="idm140611478556672" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								277 MB
							</p>
							 </td><td headers="idm140611479099792" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								1058 MB
							</p>
							 </td><td headers="idm140611479098496" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
								15.6 MB / 12.3 MB
							</p>
							 </td><td headers="idm140611479097392" data-row="2" data-col="4" class="content--md" valign="top" align="left"> <p>
								6-8 GB
							</p>
							 </td><td headers="idm140611479095984" data-row="2" data-col="5" class="content--md" valign="top" align="left"> <p>
								5.5 GB
							</p>
							 </td></tr></tbody></table></rh-table></div><p>
				Here, all values are per host. The network bandwidth is higher due to the inter-node communication of the Redis cluster.
			</p></section><section class="section" id="establishing-secure-pcp-connections_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.12. Establishing secure PCP connections</h2></div></div></div><p class="_abstract _abstract">
				You can configure PCP collector and monitoring components to participate in secure PCP protocol exchanges.
			</p><section class="section" id="secure-pcp-connections_establishing-secure-pcp-connections"><div class="titlepage"><div><div><h3 class="title">5.12.1. Secure PCP connections</h3></div></div></div><p>
					You can establish secure connections between Performance Co-Pilot 
(PCP) collector and monitoring components. PCP collector components are 
the parts of PCP that collect and extract performance data from 
different sources. PCP monitor components are the parts of PCP that 
display data collected from hosts or archives that have the PCP 
collector components installed. Establishing secure connections between 
these components helps prevent unauthorized parties from accessing or 
modifying the data being collected and monitored.
				</p><p>
					All connections with the Performance Metrics Collector Daemon (<code class="literal">pmcd</code>) are made using the TCP/IP based PCP protocol. Protocol proxying and the PCP REST APIs are served by the <code class="literal">pmproxy</code> daemon - the REST API can be accessed over HTTPS, ensuring a secure connection.
				</p><p>
					Both the <code class="literal">pmcd</code> and <code class="literal">pmproxy</code> daemons are capable of simultaneous TLS and non-TLS communications on a single port. The default port for <code class="literal">pmcd</code> is 44321 and 44322 for <code class="literal">pmproxy</code>.
 This means that you do not have to choose between TLS or non-TLS 
communications for your PCP collector systems and can use both at the 
same time.
				</p></section><section class="section" id="configuring-secure-connections-for-pcp-collector-components_establishing-secure-pcp-connections"><div class="titlepage"><div><div><h3 class="title">5.12.2. Configuring secure connections for PCP collector components</h3></div></div></div><p>
					All PCP collector systems must have valid certificates in order to participate in secure PCP protocol exchanges.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						the <code class="literal">pmproxy</code> daemon operates as both a client and a server from the perspective of TLS.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
						</li><li class="listitem"><p class="simpara">
							The private client key is stored in the <code class="literal">/etc/pcp/tls/client.key</code> file. If you use a different path, adapt the corresponding steps of the procedure.
						</p><p class="simpara">
							For details about creating a private key and certificate signing 
request (CSR), as well as how to request a certificate from a 
certificate authority (CA), see your CA’s documentation.
						</p></li><li class="listitem">
							The TLS client certificate is stored in the <code class="literal">/etc/pcp/tls/client.crt</code> file. If you use a different path, adapt the corresponding steps of the procedure.
						</li><li class="listitem">
							The CA certificate is stored in the <code class="literal">/etc/pcp/tls/ca.crt</code> file. If you use a different path, adapt the corresponding steps of the procedure. Additionally, for the <code class="literal">pmproxy</code> daemon:
						</li><li class="listitem">
							The private server key is stored in the <code class="literal">/etc/pcp/tls/server.key</code> file. If you use a different path, adapt the corresponding steps of the procedure
						</li><li class="listitem">
							The TLS server certificate is stored in the <code class="literal">/etc/pcp/tls/server.crt</code> file. If you use a different path, adapt the corresponding steps of the procedure.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Update the PCP TLS configuration file on the collector systems to
 use the CA issued certificates to establish a secure connection:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--an5tokz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cat &gt; /etc/pcp/tls.conf &lt;&lt; END
tls-ca-cert-file = /etc/pcp/tls/ca.crt
tls-key-file = /etc/pcp/tls/server.key
tls-cert-file = /etc/pcp/tls/server.crt
tls-client-key-file = /etc/pcp/tls/client.key
tls-client-cert-file = /etc/pcp/tls/client.crt
END</pre></div></div></li><li class="listitem"><p class="simpara">
							Restart the PCP collector infrastructure:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--0oybwxr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart pmcd.service
# systemctl restart pmproxy.service</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Verify the TLS configuration:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
									On the <code class="literal">pmcd</code> service:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--e2t80lw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># grep 'Info:' /var/log/pcp/pmcd/pmcd.log
[Tue Feb 07 11:47:33] pmcd(6558) Info: OpenSSL 3.0.7 setup</pre></div></div></li><li class="listitem"><p class="simpara">
									On the <code class="literal">pmproxy</code> service:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mctgxdr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># grep 'Info:' /var/log/pcp/pmproxy/pmproxy.log
[Tue Feb 07 11:44:13] pmproxy(6014) Info: OpenSSL 3.0.7 setup</pre></div></div></li></ul></div></li></ul></div></section><section class="section" id="configuring-secure-connections-for-pcp-monitoring-components_establishing-secure-pcp-connections"><div class="titlepage"><div><div><h3 class="title">5.12.3. Configuring secure connections for PCP monitoring components</h3></div></div></div><p>
					Configure your PCP monitoring components to participate in secure PCP protocol exchanges.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
						</li><li class="listitem"><p class="simpara">
							The private client key is stored in the <code class="literal">~/.pcp/tls/client.key</code> file. If you use a different path, adapt the corresponding steps of the procedure.
						</p><p class="simpara">
							For details about creating a private key and certificate signing 
request (CSR), as well as how to request a certificate from a 
certificate authority (CA), see your CA’s documentation.
						</p></li><li class="listitem">
							The TLS client certificate is stored in the <code class="literal">~/.pcp/tls/client.crt</code> file. If you use a different path, adapt the corresponding steps of the procedure.
						</li><li class="listitem">
							The CA certificate is stored in the <code class="literal">/etc/pcp/tls/ca.crt</code> file. If you use a different path, adapt the corresponding steps of the procedure.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a TLS configuration file with the following information:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l696ubo"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ home=<code class="literal">echo ~</code>
$ cat &gt; ~/.pcp/tls.conf &lt;&lt; END
tls-ca-cert-file = /etc/pcp/tls/ca.crt
tls-key-file = $home/.pcp/tls/client.key
tls-cert-file = $home/.pcp/tls/client.crt
END</pre></div></div></li><li class="listitem"><p class="simpara">
							Establish the secure connection:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--br73koz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ export PCP_SECURE_SOCKETS=enforce
$ export PCP_TLSCONF_PATH=~/.pcp/tls.conf</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Verify the secure connection is configured:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--cww73c0"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pminfo --fetch --host pcps://localhost kernel.all.load

kernel.all.load
    inst [1 or "1 minute"] value 1.26
    inst [5 or "5 minute"] value 1.29
    inst [15 or "15 minute"] value 1.28</pre></div></div></li></ul></div></section></section><section class="section" id="troubleshooting-high-memory-usage_setting-up-pcp"><div class="titlepage"><div><div><h2 class="title">5.13. Troubleshooting high memory usage</h2></div></div></div><p class="_abstract _abstract">
				The following scenarios can result in high memory usage:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">pmproxy</code> process is busy processing new PCP archives and does not have spare CPU cycles to process Redis requests and responses.
					</li><li class="listitem">
						The Redis node or cluster is overloaded and cannot process incoming requests on time.
					</li></ul></div><p>
				The <code class="literal">pmproxy</code> service daemon uses Redis 
streams and supports the configuration parameters, which are PCP tuning 
parameters and affects Redis memory usage and key retention. The <code class="literal">/etc/pcp/pmproxy/pmproxy.conf</code> file lists the available configuration options for <code class="literal">pmproxy</code> and the associated APIs.
			</p><p>
				The following procedure describes how to troubleshoot high memory usage issue.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-pmda-redis</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--o2qqisa"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-pmda-redis</pre></div></div></li><li class="listitem"><p class="simpara">
						Install the redis PMDA:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--h2nfd9g"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cd /var/lib/pcp/pmdas/redis &amp;&amp; ./Install</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To troubleshoot high memory usage, execute the following command and observe the <code class="literal">inflight</code> column:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zvnoo7r"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ pmrep :pmproxy
         backlog  inflight  reqs/s  resp/s   wait req err  resp err  changed  throttled
          byte     count   count/s  count/s  s/s  count/s   count/s  count/s   count/s
14:59:08   0         0       N/A       N/A   N/A    N/A      N/A      N/A        N/A
14:59:09   0         0    2268.9    2268.9    28     0        0       2.0        4.0
14:59:10   0         0       0.0       0.0     0     0        0       0.0        0.0
14:59:11   0         0       0.0       0.0     0     0        0       0.0        0.0</pre></div></div><p class="simpara">
						This column shows how many Redis requests are in-flight, which 
means they are queued or sent, and no reply was received so far.
					</p><p class="simpara">
						A high number indicates one of the following conditions:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								The <code class="literal">pmproxy</code> process is busy processing new PCP archives and does not have spare CPU cycles to process Redis requests and responses.
							</li><li class="listitem">
								The Redis node or cluster is overloaded and cannot process incoming requests on time.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						To troubleshoot the high memory usage issue, reduce the number of <code class="literal">pmlogger</code> processes for this farm, and add another pmlogger farm. Use the federated - multiple pmlogger farms setup.
					</p><p class="simpara">
						If the Redis node is using 100% CPU for an extended amount of 
time, move it to a host with better performance or use a clustered Redis
 setup instead.
					</p></li><li class="listitem"><p class="simpara">
						To view the <code class="literal">pmproxy.redis.*</code> metrics, use the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--x02w06z"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pminfo -ftd pmproxy.redis
pmproxy.redis.responses.wait [wait time for responses]
    Data Type: 64-bit unsigned int  InDom: PM_INDOM_NULL 0xffffffff
    Semantics: counter  Units: microsec
    value 546028367374
pmproxy.redis.responses.error [number of error responses]
    Data Type: 64-bit unsigned int  InDom: PM_INDOM_NULL 0xffffffff
    Semantics: counter  Units: count
    value 1164
[...]
pmproxy.redis.requests.inflight.bytes [bytes allocated for inflight requests]
    Data Type: 64-bit int  InDom: PM_INDOM_NULL 0xffffffff
    Semantics: discrete  Units: byte
    value 0

pmproxy.redis.requests.inflight.total [inflight requests]
    Data Type: 64-bit unsigned int  InDom: PM_INDOM_NULL 0xffffffff
    Semantics: discrete  Units: count
    value 0
[...]</pre></div></div><p class="simpara">
						To view how many Redis requests are inflight, see the <code class="literal">pmproxy.redis.requests.inflight.total</code> metric and <code class="literal">pmproxy.redis.requests.inflight.bytes</code> metric to view how many bytes are occupied by all current inflight Redis requests.
					</p><p class="simpara">
						In general, the redis request queue would be zero but can build up
 based on the usage of large pmlogger farms, which limits scalability 
and can cause high latency for <code class="literal">pmproxy</code> clients.
					</p></li><li class="listitem"><p class="simpara">
						Use the <code class="literal">pminfo</code> command to view information about performance metrics. For example, to view the <code class="literal">redis.*</code> metrics, use the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7hinmsq"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pminfo -ftd redis
redis.redis_build_id [Build ID]
    Data Type: string  InDom: 24.0 0x6000000
    Semantics: discrete  Units: count
    inst [0 or "localhost:6379"] value "87e335e57cffa755"
redis.total_commands_processed [Total number of commands processed by the server]
    Data Type: 64-bit unsigned int  InDom: 24.0 0x6000000
    Semantics: counter  Units: count
    inst [0 or "localhost:6379"] value 595627069
[...]

redis.used_memory_peak [Peak memory consumed by Redis (in bytes)]
    Data Type: 32-bit unsigned int  InDom: 24.0 0x6000000
    Semantics: instant  Units: count
    inst [0 or "localhost:6379"] value 572234920
[...]</pre></div></div><p class="simpara">
						To view the peak memory usage, see the <code class="literal">redis.used_memory_peak</code> metric.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmdaredis(1)</code>, <code class="literal">pmproxy(1)</code>, and <code class="literal">pminfo(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="#pcp-deployment-architectures_setting-up-pcp" title="5.6.&nbsp;PCP deployment architectures">PCP deployment architectures</a>
					</li></ul></div></section></section><section class="chapter" id="logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 6. Logging performance data with pmlogger</h1></div></div></div><p class="_abstract _abstract">
			With the PCP tool you can log the performance metric values and 
replay them later. This allows you to perform a retrospective 
performance analysis.
		</p><p>
			Using the <code class="literal">pmlogger</code> tool, you can:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Create the archived logs of selected metrics on the system
				</li><li class="listitem">
					Specify which metrics are recorded on the system and how often
				</li></ul></div><section class="section" id="modifying-the-pmlogger-configuration-file-with-pmlogconf_logging-performance-data-with-pmlogger"><div class="titlepage"><div><div><h2 class="title">6.1. Modifying the pmlogger configuration file with pmlogconf</h2></div></div></div><p class="_abstract _abstract">
				When the <code class="literal">pmlogger</code> service is running, PCP logs a default set of metrics on the host.
			</p><p>
				Use the <code class="literal">pmlogconf</code> utility to check the default configuration. If the <code class="literal">pmlogger</code> configuration file does not exist, <code class="literal">pmlogconf</code> creates it with a default metric values.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create or modify the <code class="literal">pmlogger</code> configuration file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--n8m0nq5"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pmlogconf -r /var/lib/pcp/config/pmlogger/config.default</pre></div></div></li><li class="listitem">
						Follow <code class="literal">pmlogconf</code> prompts to enable or disable groups of related performance metrics and to control the logging interval for each enabled group.
					</li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogconf(1)</code> and <code class="literal">pmlogger(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li></ul></div></section><section class="section" id="editing-the-pmlogger-configuration-file-manually_logging-performance-data-with-pmlogger"><div class="titlepage"><div><div><h2 class="title">6.2. Editing the pmlogger configuration file manually</h2></div></div></div><p class="_abstract _abstract">
				To create a tailored logging configuration with specific metrics and given intervals, edit the <code class="literal">pmlogger</code> configuration file manually. The default <code class="literal">pmlogger</code> configuration file is <code class="literal">/var/lib/pcp/config/pmlogger/config.default</code>. The configuration file specifies which metrics are logged by the primary logging instance.
			</p><p>
				In manual configuration, you can:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Record metrics which are not listed in the automatic configuration.
					</li><li class="listitem">
						Choose custom logging frequencies.
					</li><li class="listitem">
						Add <span class="strong strong"><strong>PMDA</strong></span> with the application metrics.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Open and edit the <code class="literal">/var/lib/pcp/config/pmlogger/config.default</code> file to add specific metrics:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--82oalr2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># It is safe to make additions from here on ...
#

log mandatory on every 5 seconds {
    xfs.write
    xfs.write_bytes
    xfs.read
    xfs.read_bytes
}

log mandatory on every 10 seconds {
    xfs.allocs
    xfs.block_map
    xfs.transactions
    xfs.log

}

[access]
disallow * : all;
allow localhost : enquire;</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogger(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li></ul></div></section><section class="section" id="enabling-the-pmlogger-service_logging-performance-data-with-pmlogger"><div class="titlepage"><div><div><h2 class="title">6.3. Enabling the pmlogger service</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">pmlogger</code> service must be started and enabled to log the metric values on the local machine.
			</p><p>
				This procedure describes how to enable the <code class="literal">pmlogger</code> service.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Start and enable the <code class="literal">pmlogger</code> service:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--9l4c7lt"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl start pmlogger

# systemctl enable pmlogger</pre></div></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify if the <code class="literal">pmlogger</code> service is enabled:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zh9ke54"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pcp

Performance Co-Pilot configuration on workstation:

platform: Linux workstation 4.18.0-80.el8.x86_64 #1 SMP Wed Mar 13 12:02:46 UTC 2019 x86_64
hardware: 12 cpus, 2 disks, 1 node, 36023MB RAM
timezone: CEST-2
services: pmcd
pmcd: Version 4.3.0-1, 8 agents, 1 client
pmda: root pmcd proc xfs linux mmv kvm jbd2
pmlogger: primary logger: /var/log/pcp/pmlogger/workstation/20190827.15.54</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogger(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li><li class="listitem">
						<code class="literal">/var/lib/pcp/config/pmlogger/config.default</code> file
					</li></ul></div></section><section class="section" id="setting-up-a-client-system-for-metrics-collection_logging-performance-data-with-pmlogger"><div class="titlepage"><div><div><h2 class="title">6.4. Setting up a client system for metrics collection</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to set up a client system so that a 
central server can collect metrics from clients running PCP.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-system-tools</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--iev3tow"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-system-tools</pre></div></div></li><li class="listitem"><p class="simpara">
						Configure an IP address for <code class="literal">pmcd</code>:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--cfe9m6x"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># echo "-i <span class="emphasis"><em>192.168.4.62</em></span>" &gt;&gt;/etc/pcp/pmcd/pmcd.options</pre></div></div><p class="simpara">
						Replace <span class="emphasis"><em>192.168.4.62</em></span> with the IP address, the client should listen on.
					</p><p class="simpara">
						By default, <code class="literal">pmcd</code> is listening on the localhost.
					</p></li><li class="listitem"><p class="simpara">
						Configure the firewall to add the public <code class="literal">zone</code> permanently:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zxnayp4"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># firewall-cmd --permanent --zone=public --add-port=44321/tcp
success

# firewall-cmd --reload
success</pre></div></div></li><li class="listitem"><p class="simpara">
						Set an SELinux boolean:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--kcnc2q9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># setsebool -P pcp_bind_all_unreserved_ports on</pre></div></div></li><li class="listitem"><p class="simpara">
						Enable the <code class="literal">pmcd</code> and <code class="literal">pmlogger</code> services:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ugwss87"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl enable pmcd pmlogger
# systemctl restart pmcd pmlogger</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify if the <code class="literal">pmcd</code> is correctly listening on the configured IP address:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--p2w1lb8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># ss -tlp | grep 44321
LISTEN   0   5     127.0.0.1:44321   0.0.0.0:*   users:(("pmcd",pid=151595,fd=6))
LISTEN   0   5  <span class="emphasis"><em>192.168.4.62:44321</em></span>   0.0.0.0:*   users:(("pmcd",pid=151595,fd=0))
LISTEN   0   5         [::1]:44321      [::]:*   users:(("pmcd",pid=151595,fd=7))</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogger(1)</code>, <code class="literal">firewall-cmd(1)</code>, <code class="literal">ss(8)</code>, and <code class="literal">setsebool(8)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li><li class="listitem">
						<code class="literal">/var/lib/pcp/config/pmlogger/config.default</code> file
					</li></ul></div></section><section class="section" id="setting-up-the-central-server-to-collect-data_logging-performance-data-with-pmlogger"><div class="titlepage"><div><div><h2 class="title">6.5. Setting up a central server to collect data</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to create a central server to collect metrics from clients running PCP.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li><li class="listitem">
						Client is configured for metrics collection. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance#setting-up-a-client-system-for-metrics-collection_logging-performance-data-with-pmlogger">Setting up a client system for metrics collection</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-system-tools</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gztgmlv"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-system-tools</pre></div></div></li><li class="listitem"><p class="simpara">
						Create the <code class="literal">/etc/pcp/pmlogger/control.d/remote</code> file with the following content:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ufptd61"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># DO NOT REMOVE OR EDIT THE FOLLOWING LINE
$version=1.1

<span class="emphasis"><em>192.168.4.13</em></span> n n PCP_ARCHIVE_DIR/rhel7u4a -r -T24h10m -c config.rhel7u4a
<span class="emphasis"><em>192.168.4.14</em></span> n n PCP_ARCHIVE_DIR/rhel6u10a -r -T24h10m -c config.rhel6u10a
<span class="emphasis"><em>192.168.4.62</em></span> n n PCP_ARCHIVE_DIR/rhel8u1a -r -T24h10m -c config.rhel8u1a
<span class="emphasis"><em>192.168.4.69</em></span> n n PCP_ARCHIVE_DIR/rhel9u3a -r -T24h10m -c config.rhel9u3a</pre></div></div><p class="simpara">
						Replace <span class="emphasis"><em>192.168.4.13</em></span>, <span class="emphasis"><em>192.168.4.14</em></span>, <span class="emphasis"><em>192.168.4.62</em></span> and <span class="emphasis"><em>192.168.4.69</em></span> with the client IP addresses.
					</p></li><li class="listitem"><p class="simpara">
						Enable the <code class="literal">pmcd</code> and <code class="literal">pmlogger</code> services:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--22uelrm"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl enable pmcd pmlogger
# systemctl restart pmcd pmlogger</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Ensure that you can access the latest archive file from each directory:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2ppi7hv"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># for i in /var/log/pcp/pmlogger/rhel*/*.0; do pmdumplog -L $i; done
Log Label (Log Format Version 2)
Performance metrics from host rhel6u10a.local
  commencing Mon Nov 25 21:55:04.851 2019
  ending     Mon Nov 25 22:06:04.874 2019
Archive timezone: JST-9
PID for pmlogger: 24002
Log Label (Log Format Version 2)
Performance metrics from host rhel7u4a
  commencing Tue Nov 26 06:49:24.954 2019
  ending     Tue Nov 26 07:06:24.979 2019
Archive timezone: CET-1
PID for pmlogger: 10941
[..]</pre></div></div><p class="simpara">
						The archive files from the <code class="literal">/var/log/pcp/pmlogger/</code> directory can be used for further analysis and graphing.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogger(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li><li class="listitem">
						<code class="literal">/var/lib/pcp/config/pmlogger/config.default</code> file
					</li></ul></div></section><section class="section" id="replaying-the-pcp-log-archives_logging-performance-data-with-pmlogger"><div class="titlepage"><div><div><h2 class="title">6.6. Replaying the PCP log archives with pmrep</h2></div></div></div><p class="_abstract _abstract">
				After recording the metric data, you can replay the PCP log 
archives. To export the logs to text files and import them into 
spreadsheets, use PCP utilities such as <code class="literal">pcp2csv</code>, <code class="literal">pcp2xml</code>, <code class="literal">pmrep</code> or <code class="literal">pmlogsummary</code>.
			</p><p>
				Using the <code class="literal">pmrep</code> tool, you can:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						View the log files
					</li><li class="listitem">
						Parse the selected PCP log archive and export the values into an ASCII table
					</li><li class="listitem">
						Extract the entire archive log or only select metric values from 
the log by specifying individual metrics on the command line
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li><li class="listitem">
						The <code class="literal">pmlogger</code> service is enabled. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance#enabling-the-pmlogger-service_logging-performance-data-with-pmlogger">Enabling the pmlogger service</a>.
					</li><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-system-tools</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2xltcua"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-gui</pre></div></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the data on the metric:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--uts3gc5"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pmrep --start @3:00am --archive 20211128 --interval 5seconds --samples 10 --output csv disk.dev.write
Time,"disk.dev.write-sda","disk.dev.write-sdb"
2021-11-28 03:00:00,,
2021-11-28 03:00:05,4.000,5.200
2021-11-28 03:00:10,1.600,7.600
2021-11-28 03:00:15,0.800,7.100
2021-11-28 03:00:20,16.600,8.400
2021-11-28 03:00:25,21.400,7.200
2021-11-28 03:00:30,21.200,6.800
2021-11-28 03:00:35,21.000,27.600
2021-11-28 03:00:40,12.400,33.800
2021-11-28 03:00:45,9.800,20.600</pre></div></div><p class="simpara">
						The mentioned example displays the data on the <code class="literal">disk.dev.write</code> metric collected in an archive at a <span class="emphasis"><em>5 second</em></span> interval in comma-separated-value format.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Replace <code class="literal">20211128</code> in this example with a filename containing the <code class="literal">pmlogger</code> archive you want to display data for.
						</p></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogger(1)</code>, <code class="literal">pmrep(1)</code>, and <code class="literal">pmlogsummary(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li></ul></div></section><section class="section" id="enabling-pcp-version-3-archives_logging-performance-data-with-pmlogger"><div class="titlepage"><div><div><h2 class="title">6.7. Enabling PCP version 3 archives</h2></div></div></div><p>
				Performance Co-Pilot (PCP) archives store historical values of PCP 
metrics recorded from a single host and support retrospective 
performance analysis. PCP archives contain all the important metric data
 and metadata needed for offline or offsite analysis. These archives can
 be read by most PCP client tools or dumped raw by the <code class="literal">pmdumplog</code> tool.
			</p><p>
				From PCP 6.0, version 3 archives are supported in addition to 
version 2 archives. Version 2 archives remain the default and will 
continue to receive long-term support for backwards compatibility 
purposes in addition to version 3 archives receiving long-term support 
from RHEL 9.2 and on.
			</p><p>
				Using PCP version 3 archives offers the following benefits over version 2:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Support for instance domain change-deltas
					</li><li class="listitem">
						Y2038-safe timestamps
					</li><li class="listitem">
						Nanosecond-precision timestamps
					</li><li class="listitem">
						Arbitrary timezones support
					</li><li class="listitem">
						64-bit file offsets used for individual volumes larger than 2GB
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Open the <code class="literal">/etc/pcp.conf</code> file in a text editor of your choice and set the PCP archive version:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3csmy18"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">PCP_ARCHIVE_VERSION=3</pre></div></div></li><li class="listitem"><p class="simpara">
						Restart the <code class="literal">pmlogger</code> service to apply your configuration changes:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jqzl1kd"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart pmlogger.service</pre></div></div></li><li class="listitem">
						Create a new PCP archive log using your new configuration. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance">Logging performance data with pmlogger</a>.
					</li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify the version of the archive created with your new configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--uamn21m"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pmloglabel -l /var/log/pcp/pmlogger/<span class="emphasis"><em>20230208</em></span>
Log Label (Log Format Version 3)
Performance metrics from host <span class="emphasis"><em>host1</em></span>
        commencing Wed Feb   08 00:11:09.396 2023
        ending           Thu  Feb   07 00:13:54.347 2023</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">logarchive(5)</code> man page
					</li><li class="listitem">
						<code class="literal">pmlogger(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance">Logging performance data with pmlogger</a>
					</li></ul></div></section></section><section class="chapter" id="monitoring-performance-with-performance-co-pilot_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 7. Monitoring performance with Performance Co-Pilot</h1></div></div></div><p class="_abstract _abstract">
			Performance Co-Pilot (PCP) is a suite of tools, services, and 
libraries for monitoring, visualizing, storing, and analyzing 
system-level performance measurements.
		</p><p>
			As a system administrator, you can monitor the system’s performance 
using the PCP application in Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9.
		</p><section class="section" id="monitoring-postfix-with-pmda-postfix_monitoring-performance-with-performance-co-pilot"><div class="titlepage"><div><div><h2 class="title">7.1. Monitoring postfix with pmda-postfix</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to monitor performance metrics of the <code class="literal">postfix</code> mail server with <code class="literal">pmda-postfix</code>. It helps to check how many emails are received per second.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li><li class="listitem">
						The <code class="literal">pmlogger</code> service is enabled. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance#enabling-the-pmlogger-service_logging-performance-data-with-pmlogger">Enabling the pmlogger service</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the following packages:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Install the <code class="literal">pcp-system-tools</code>:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fl2i89y"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-system-tools</pre></div></div></li><li class="listitem"><p class="simpara">
								Install the <code class="literal">pmda-postfix</code> package to monitor <code class="literal">postfix</code>:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--qxjruw1"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-pmda-postfix postfix</pre></div></div></li><li class="listitem"><p class="simpara">
								Install the logging daemon:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--r5l6s3o"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install rsyslog</pre></div></div></li><li class="listitem"><p class="simpara">
								Install the mail client for testing:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--lavxj7f"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install mutt</pre></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Enable the <code class="literal">postfix</code> and <code class="literal">rsyslog</code> services:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--k36l8a0"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl enable postfix rsyslog
# systemctl restart postfix rsyslog</pre></div></div></li><li class="listitem"><p class="simpara">
						Enable the SELinux boolean, so that <code class="literal">pmda-postfix</code> can access the required log files:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2bsbmjk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># setsebool -P pcp_read_generic_logs=on</pre></div></div></li><li class="listitem"><p class="simpara">
						Install the <code class="literal">PMDA</code>:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--qiwaj38"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cd /var/lib/pcp/pmdas/postfix/

# ./Install

Updating the Performance Metrics Name Space (PMNS) ...
Terminate PMDA if already installed ...
Updating the PMCD control file, and notifying PMCD ...
Waiting for pmcd to terminate ...
Starting pmcd ...
Check postfix metrics have appeared ... 7 metrics and 58 values</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify the <code class="literal">pmda-postfix</code> operation:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--f8rf8ra"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">echo testmail | mutt root</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify the available metrics:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mkiw61f"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo postfix

postfix.received
postfix.sent
postfix.queues.incoming
postfix.queues.maildrop
postfix.queues.hold
postfix.queues.deferred
postfix.queues.active</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">rsyslogd(8)</code>, <code class="literal">postfix(1)</code>, and <code class="literal">setsebool(8)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#system-services-distributed-with-pcp_setting-up-pcp">System services distributed with PCP</a>
					</li><li class="listitem">
						<code class="literal">/var/lib/pcp/config/pmlogger/config.default</code> file
					</li></ul></div></section><section class="section" id="visually-tracing-pcp-log-archives-with-pcp-charts_monitoring-performance-with-performance-co-pilot"><div class="titlepage"><div><div><h2 class="title">7.2. Visually tracing PCP log archives with the PCP Charts application</h2></div></div></div><p class="_abstract _abstract">
				After recording metric data, you can replay the PCP log archives as 
graphs. The metrics are sourced from one or more live hosts with 
alternative options to use metric data from PCP log archives as a source
 of historical data. To customize the <span class="strong strong"><strong>PCP Charts</strong></span>
 application interface to display the data from the performance metrics,
 you can use line plot, bar graphs, or utilization graphs.
			</p><p>
				Using the <span class="strong strong"><strong>PCP Charts</strong></span> application, you can:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Replay the data in the <span class="strong strong"><strong>PCP Charts</strong></span> application application and use graphs to visualize the retrospective data alongside live data of the system.
					</li><li class="listitem">
						Plot performance metric values into graphs.
					</li><li class="listitem">
						Display multiple charts simultaneously.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li><li class="listitem">
						Logged performance data with the <code class="literal">pmlogger</code>. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#logging-performance-data-with-pmlogger_monitoring-and-managing-system-status-and-performance">Logging performance data with pmlogger</a>.
					</li><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-gui</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--pok0k94"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-gui</pre></div></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Launch the <span class="strong strong"><strong>PCP Charts</strong></span> application from the command line:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xuntlmr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pmchart</pre></div></div><div class="figure" id="idm140611466477008"><p class="title">Figure 7.1. PCP Charts application</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/804544b6996d4a37ca90b153dab642ea/pmchart_started.png" class="rh_docs--zoom" title="pmchart started"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pmchart_started.png" alt="pmchart started"></a></div></div></div><p class="simpara">
						The <code class="literal">pmtime</code> server settings are located at the bottom. The <span class="strong strong"><strong>start</strong></span> and <span class="strong strong"><strong>pause</strong></span> button allows you to control:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								The interval in which PCP polls the metric data
							</li><li class="listitem">
								The date and time for the metrics of historical data
							</li></ul></div></li><li class="listitem">
						Click <span class="strong strong"><strong>File</strong></span> and then <span class="strong strong"><strong>New Chart</strong></span>
 to select metric from both the local machine and remote machines by 
specifying their host name or address. Advanced configuration options 
include the ability to manually set the axis values for the chart, and 
to manually choose the color of the plots.
					</li><li class="listitem"><p class="simpara">
						Record the views created in the <span class="strong strong"><strong>PCP Charts</strong></span> application:
					</p><p class="simpara">
						Following are the options to take images or record the views created in the <span class="strong strong"><strong>PCP Charts</strong></span> application:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Click <span class="strong strong"><strong>File</strong></span> and then <span class="strong strong"><strong>Export</strong></span> to save an image of the current view.
							</li><li class="listitem">
								Click <span class="strong strong"><strong>Record</strong></span> and then <span class="strong strong"><strong>Start</strong></span> to start a recording. Click <span class="strong strong"><strong>Record</strong></span> and then <span class="strong strong"><strong>Stop</strong></span> to stop the recording. After stopping the recording, the recorded metrics are archived to be viewed later.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Optional: In the <span class="strong strong"><strong>PCP Charts</strong></span> application, the main configuration file, known as the <span class="strong strong"><strong>view</strong></span>,
 allows the metadata associated with one or more charts to be saved. 
This metadata describes all chart aspects, including the metrics used 
and the chart columns. Save the custom <span class="strong strong"><strong>view</strong></span> configuration by clicking <span class="strong strong"><strong>File</strong></span> and then <span class="strong strong"><strong>Save View</strong></span>, and load the <span class="strong strong"><strong>view</strong></span> configuration later.
					</p><p class="simpara">
						The following example of the <span class="strong strong"><strong>PCP Charts</strong></span>
 application view configuration file describes a stacking chart graph 
showing the total number of bytes read and written to the given XFS file
 system <code class="literal">loop1</code>:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l4eqs3o"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">#kmchart
version 1

chart title "Filesystem Throughput /loop1" style stacking antialiasing off
    plot legend "Read rate"   metric xfs.read_bytes   instance  "loop1"
    plot legend "Write rate"  metric xfs.write_bytes  instance  "loop1"</pre></div></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmchart(1)</code> and <code class="literal">pmtime(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li></ul></div></section><section class="section" id="collecting-data-from-sql-server-using-pcp_monitoring-performance-with-performance-co-pilot"><div class="titlepage"><div><div><h2 class="title">7.3. Collecting data from SQL server using PCP</h2></div></div></div><p class="_abstract _abstract">
				The SQL Server agent is available in Performance Co-Pilot (PCP), 
which helps you to monitor and analyze database performance issues.
			</p><p>
				This procedure describes how to collect data for Microsoft SQL Server via <code class="literal">pcp</code> on your system.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed Microsoft SQL Server for Red&nbsp;Hat 
Enterprise&nbsp;Linux and established a 'trusted' connection to an SQL 
server.
					</li><li class="listitem">
						You have installed the Microsoft ODBC driver for SQL Server for Red&nbsp;Hat Enterprise&nbsp;Linux.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install PCP:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l0bczv2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-zeroconf</pre></div></div></li><li class="listitem"><p class="simpara">
						Install packages required for the <code class="literal">pyodbc</code> driver:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l5dkqrp"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install python3-pyodbc</pre></div></div></li><li class="listitem"><p class="simpara">
						Install the <code class="literal">mssql</code> agent:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Install the Microsoft SQL Server domain agent for PCP:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--4zjzytf"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-pmda-mssql</pre></div></div></li><li class="listitem"><p class="simpara">
								Edit the <code class="literal">/etc/pcp/mssql/mssql.conf</code> file to configure the SQL server account’s username and password for the <code class="literal">mssql</code> agent. Ensure that the account you configure has access rights to performance data.
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--tbdl349"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">username: <span class="emphasis"><em>user_name</em></span>
password: <span class="emphasis"><em>user_password</em></span></pre></div></div><p class="simpara">
								Replace <span class="emphasis"><em>user_name</em></span> with the SQL Server account and <span class="emphasis"><em>user_password</em></span> with the SQL Server user password for this account.
							</p></li></ol></div></li><li class="listitem"><p class="simpara">
						Install the agent:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--inozcuu"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cd /var/lib/pcp/pmdas/mssql
# ./Install
Updating the Performance Metrics Name Space (PMNS) ...
Terminate PMDA if already installed ...
Updating the PMCD control file, and notifying PMCD ...
Check mssql metrics have appeared ... 168 metrics and 598 values
[...]</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Using the <code class="literal">pcp</code> command, verify if the SQL Server PMDA (<code class="literal">mssql</code>) is loaded and running:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--cl5dfx9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pcp
Performance Co-Pilot configuration on rhel.local:

platform: Linux rhel.local 4.18.0-167.el8.x86_64 #1 SMP Sun Dec 15 01:24:23 UTC 2019 x86_64
 hardware: 2 cpus, 1 disk, 1 node, 2770MB RAM
 timezone: PDT+7
 services: pmcd pmproxy
     pmcd: Version 5.0.2-1, 12 agents, 4 clients
     pmda: root pmcd proc pmproxy xfs linux nfsclient mmv kvm mssql
           jbd2 dm
 pmlogger: primary logger: /var/log/pcp/pmlogger/rhel.local/20200326.16.31
     pmie: primary engine: /var/log/pcp/pmie/rhel.local/pmie.log</pre></div></div></li><li class="listitem"><p class="simpara">
						View the complete list of metrics that PCP can collect from the SQL Server:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--4y3n9ea"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo mssql</pre></div></div></li><li class="listitem"><p class="simpara">
						After viewing the list of metrics, you can report the rate of 
transactions. For example, to report on the overall transaction count 
per second, over a five second time window:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--hpbeqli"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pmval -t 1 -T 5 mssql.databases.transactions</pre></div></div></li><li class="listitem">
						View the graphical chart of these metrics on your system by using the <code class="literal">pmchart</code> command. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/monitoring-performance-with-performance-co-pilot_monitoring-and-managing-system-status-and-performance#visually-tracing-pcp-log-archives-with-pcp-charts_monitoring-performance-with-performance-co-pilot">Visually tracing PCP log archives with the PCP Charts application</a>.
					</li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pcp(1)</code>, <code class="literal">pminfo(1)</code>, <code class="literal">pmval(1)</code>, <code class="literal">pmchart(1)</code>, and <code class="literal">pmdamssql(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://www.redhat.com/en/blog/performance-co-pilot-microsoft-sql-server-rhel-82">Performance Co-Pilot for Microsoft SQL Server with RHEL 8.2 Red Hat Developers Blog post</a>
					</li></ul></div></section><section class="section" id="proc_generating-pcp-archives-from-sadc-archives_monitoring-performance-with-performance-co-pilot"><div class="titlepage"><div><div><h2 class="title">7.4. Generating PCP archives from sadc archives</h2></div></div></div><p class="_abstract _abstract">
				You can use the <code class="literal">sadf</code> tool provided by the <code class="literal">sysstat</code> package to generate PCP archives from native <code class="literal">sadc</code> archives.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						A <code class="literal">sadc</code> archive has been created:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5493x3h"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># /usr/lib64/sa/sadc 1 5 -</pre></div></div><p class="simpara">
						In this example, <code class="literal">sadc</code> is sampling system data 1 time in a 5 second interval. The outfile is specified as <code class="literal">-</code> which results in <code class="literal">sadc</code>
 writing the data to the standard system activity daily data file. This 
file is named saDD and is located in the /var/log/sa directory by 
default.
					</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Generate a PCP archive from a <code class="literal">sadc</code> archive:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jdd9ok1"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># sadf -l -O pcparchive=/tmp/recording -2</pre></div></div><p class="simpara">
						In this example, using the <code class="literal">-2</code> option results in <code class="literal">sadf</code> generating a PCP archive from a <code class="literal">sadc</code> archive recorded 2 days ago.
					</p></li></ul></div><div class="formalpara"><p class="title"><strong>Verification steps</strong></p><p>
					You can use PCP commands to inspect and analyze the PCP archive generated from a <code class="literal">sadc</code> archive as you would a native PCP archive. For example:
				</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To show a list of metrics in the PCP archive generated from an <code class="literal">sadc</code> archive archive, run:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--x5s70if"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pminfo --archive /tmp/recording
Disk.dev.avactive
Disk.dev.read
Disk.dev.write
Disk.dev.blkread
[...]</pre></div></div></li><li class="listitem"><p class="simpara">
						To show the timespace of the archive and hostname of the PCP archive, run:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--j2bqvus"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pmdumplog --label /tmp/recording
Log Label (Log Format Version 2)
Performance metrics from host shard
        commencing Tue Jul 20 00:10:30.642477 2021
        ending     Wed Jul 21 00:10:30.222176 2021</pre></div></div></li><li class="listitem"><p class="simpara">
						To plot performance metrics values into graphs, run:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zgd41sx"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pmchart --archive /tmp/recording</pre></div></div></li></ul></div></section></section><section class="chapter" id="performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 8. Performance analysis of XFS with PCP</h1></div></div></div><p class="_abstract _abstract">
			The XFS PMDA ships as part of the <code class="literal">pcp</code> 
package and is enabled by default during the installation. It is used to
 gather performance metric data of XFS file systems in Performance 
Co-Pilot (PCP).
		</p><p>
			You can use PCP to analyze XFS file system’s performance.
		</p><section class="section" id="installing-xfs-pmda-manually_performance-analysis-of-xfs-with-pcp"><div class="titlepage"><div><div><h2 class="title">8.1. Installing XFS PMDA manually</h2></div></div></div><p class="_abstract _abstract">
				If the XFS PMDA is not listed in the <code class="literal">pcp</code> configuration output, install the PMDA agent manually.
			</p><p>
				This procedure describes how to manually install the PMDA agent.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Navigate to the xfs directory:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8ei3v6z"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cd /var/lib/pcp/pmdas/xfs/</pre></div></div></li><li class="listitem"><p class="simpara">
						Install the XFS PMDA manually:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--qs22urd"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">xfs]# ./Install
Updating the Performance Metrics Name Space (PMNS) ...
Terminate PMDA if already installed ...
Updating the PMCD control file, and notifying PMCD ...
Check xfs metrics have appeared ... 387 metrics and 387 values</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify that the <code class="literal">pmcd</code> process is running on the host and the XFS PMDA is listed as enabled in the configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--u1k3six"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pcp

Performance Co-Pilot configuration on workstation:

platform: Linux workstation 4.18.0-80.el8.x86_64 #1 SMP Wed Mar 13 12:02:46 UTC 2019 x86_64
hardware: 12 cpus, 2 disks, 1 node, 36023MB RAM
timezone: CEST-2
services: pmcd
pmcd: Version 4.3.0-1, 8 agents
pmda: root pmcd proc xfs linux mmv kvm jbd2</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmcd(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li></ul></div></section><section class="section" id="examining-xfs-performance-metrics-with-pminfo_performance-analysis-of-xfs-with-pcp"><div class="titlepage"><div><div><h2 class="title">8.2. Examining XFS performance metrics with pminfo</h2></div></div></div><p class="_abstract _abstract">
				PCP enables XFS PMDA to allow the reporting of certain XFS metrics 
per each of the mounted XFS file systems. This makes it easier to 
pinpoint specific mounted file system issues and evaluate performance.
			</p><p>
				The <code class="literal">pminfo</code> command provides per-device XFS metrics for each mounted XFS file system.
			</p><p>
				This procedure displays a list of all available metrics provided by the XFS PMDA.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the list of all available metrics provided by the XFS PMDA:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ryiet8g"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo xfs</pre></div></div></li><li class="listitem"><p class="simpara">
						Display information for the individual metrics. The following examples examine specific XFS <code class="literal">read</code> and <code class="literal">write</code> metrics using the <code class="literal">pminfo</code> tool:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								Display a short description of the <code class="literal">xfs.write_bytes</code> metric:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--juvdm3l"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo --oneline xfs.write_bytes

xfs.write_bytes [number of bytes written in XFS file system write operations]</pre></div></div></li><li class="listitem"><p class="simpara">
								Display a long description of the <code class="literal">xfs.read_bytes</code> metric:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--c51vwfg"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo --helptext xfs.read_bytes

xfs.read_bytes
Help:
This is the number of bytes read via read(2) system calls to files in
XFS file systems. It can be used in conjunction with the read_calls
count to calculate the average size of the read operations to file in
XFS file systems.</pre></div></div></li><li class="listitem"><p class="simpara">
								Obtain the current performance value of the <code class="literal">xfs.read_bytes</code> metric:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--b7yrl00"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo --fetch xfs.read_bytes

xfs.read_bytes
    value 4891346238</pre></div></div></li><li class="listitem"><p class="simpara">
								Obtain per-device XFS metrics with <code class="literal">pminfo</code>:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ggzwkvr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pminfo --fetch --oneline xfs.perdev.read xfs.perdev.write

xfs.perdev.read [number of XFS file system read operations]
inst [0 or "loop1"] value 0
inst [0 or "loop2"] value 0

xfs.perdev.write [number of XFS file system write operations]
inst [0 or "loop1"] value 86
inst [0 or "loop2"] value 0</pre></div></div></li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pminfo(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#pcp-metric-groups-for-xfs_performance-analysis-of-xfs-with-pcp">PCP metric groups for XFS</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#per-device-pcp-metric-groups-for-xfs_performance-analysis-of-xfs-with-pcp">Per-device PCP metric groups for XFS</a>
					</li></ul></div></section><section class="section" id="resetting-xfs-performance-metrics-with-pmstore_performance-analysis-of-xfs-with-pcp"><div class="titlepage"><div><div><h2 class="title">8.3. Resetting XFS performance metrics with pmstore</h2></div></div></div><p class="_abstract _abstract">
				With PCP, you can modify the values of certain metrics, especially if the metric acts as a control variable, such as the <code class="literal">xfs.control.reset</code> metric. To modify a metric value, use the <code class="literal">pmstore</code> tool.
			</p><p>
				This procedure describes how to reset XFS metrics using the <code class="literal">pmstore</code> tool.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Display the value of a metric:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7ct0ynr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pminfo -f xfs.write

xfs.write
    value 325262</pre></div></div></li><li class="listitem"><p class="simpara">
						Reset all the XFS metrics:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--cg9h860"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pmstore xfs.control.reset 1

xfs.control.reset old value=0 new value=1</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						View the information after resetting the metric:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--q6ph189"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ pminfo --fetch xfs.write

xfs.write
    value 0</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmstore(1)</code> and <code class="literal">pminfo(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#tools-distributed-with-pcp_setting-up-pcp">Tools distributed with PCP</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/performance-analysis-of-xfs-with-pcp_monitoring-and-managing-system-status-and-performance#pcp-metric-groups-for-xfs_performance-analysis-of-xfs-with-pcp">PCP metric groups for XFS</a>
					</li></ul></div></section><section class="section" id="pcp-metric-groups-for-xfs_performance-analysis-of-xfs-with-pcp"><div class="titlepage"><div><div><h2 class="title">8.4. PCP metric groups for XFS</h2></div></div></div><p class="_abstract _abstract">
				The following table describes the available PCP metric groups for XFS.
			</p><div class="table" id="idm140611481280528"><p class="title">Table 8.1. Metric groups for XFS</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="m7kz105" id="rh-table--m7kz105" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><tbody><tr><td data-row="1" data-col="1" class="content--md" valign="top" align="left"> <p>
								Metric Group
							</p>
							 </td><td data-row="1" data-col="2" class="content--md" valign="top" align="left"> <p>
								Metrics provided
							</p>
							 </td></tr><tr><td data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.*</code>
							</p>
							 </td><td data-row="2" data-col="2" class="content--lg" valign="top" align="left"> <p>
								General XFS metrics including the read and write operation 
counts, read and write byte counts. Along with counters for the number 
of times inodes are flushed, clustered and number of failure to cluster.
							</p>
							 </td></tr><tr><td data-row="3" data-col="1" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">xfs.allocs.*</code>
							</p>
							 <p>
								<code class="literal">xfs.alloc_btree.*</code>
							</p>
							 </td><td data-row="3" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Range of metrics regarding the allocation of objects in the file
 system, these include number of extent and block creations/frees. 
Allocation tree lookup and compares along with extend record creation 
and deletion from the btree.
							</p>
							 </td></tr><tr><td data-row="4" data-col="1" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">xfs.block_map.*</code>
							</p>
							 <p>
								<code class="literal">xfs.bmap_btree.*</code>
							</p>
							 </td><td data-row="4" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Metrics include the number of block map read/write and block 
deletions, extent list operations for insertion, deletions and lookups. 
Also operations counters for compares, lookups, insertions and deletion 
operations from the blockmap.
							</p>
							 </td></tr><tr><td data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.dir_ops.*</code>
							</p>
							 </td><td data-row="5" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for directory operations on XFS file systems for creation, entry deletions, count of “getdent” operations.
							</p>
							 </td></tr><tr><td data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.transactions.*</code>
							</p>
							 </td><td data-row="6" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for the number of meta-data transactions, these include
 the count for the number of synchronous and asynchronous transactions 
along with the number of empty transactions.
							</p>
							 </td></tr><tr><td data-row="7" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.inode_ops.*</code>
							</p>
							 </td><td data-row="7" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for the number of times that the operating system 
looked for an XFS inode in the inode cache with different outcomes. 
These count cache hits, cache misses, and so on.
							</p>
							 </td></tr><tr><td data-row="8" data-col="1" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">xfs.log.*</code>
							</p>
							 <p>
								<code class="literal">xfs.log_tail.*</code>
							</p>
							 </td><td data-row="8" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for the number of log buffer writes over XFS file 
sytems includes the number of blocks written to disk. Metrics also for 
the number of log flushes and pinning.
							</p>
							 </td></tr><tr><td data-row="9" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.xstrat.*</code>
							</p>
							 </td><td data-row="9" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counts for the number of bytes of file data flushed out by the 
XFS flush deamon along with counters for number of buffers flushed to 
contiguous and non-contiguous space on disk.
							</p>
							 </td></tr><tr><td data-row="10" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.attr.*</code>
							</p>
							 </td><td data-row="10" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counts for the number of attribute get, set, remove and list operations over all XFS file systems.
							</p>
							 </td></tr><tr><td data-row="11" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.quota.*</code>
							</p>
							 </td><td data-row="11" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Metrics for quota operation over XFS file systems, these include
 counters for number of quota reclaims, quota cache misses, cache hits 
and quota data reclaims.
							</p>
							 </td></tr><tr><td data-row="12" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.buffer.*</code>
							</p>
							 </td><td data-row="12" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Range of metrics regarding XFS buffer objects. Counters include 
the number of requested buffer calls, successful buffer locks, waited 
buffer locks, miss_locks, miss_retries and buffer hits when looking up 
pages.
							</p>
							 </td></tr><tr><td data-row="13" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.btree.*</code>
							</p>
							 </td><td data-row="13" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Metrics regarding the operations of the XFS btree.
							</p>
							 </td></tr><tr><td data-row="14" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.control.reset</code>
							</p>
							 </td><td data-row="14" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Configuration metrics which are used to reset the metric 
counters for the XFS stats. Control metrics are toggled by means of the 
pmstore tool.
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="per-device-pcp-metric-groups-for-xfs_performance-analysis-of-xfs-with-pcp"><div class="titlepage"><div><div><h2 class="title">8.5. Per-device PCP metric groups for XFS</h2></div></div></div><p class="_abstract _abstract">
				The following table describes the available per-device PCP metric group for XFS.
			</p><div class="table" id="idm140611487190624"><p class="title">Table 8.2. Per-device PCP metric groups for XFS</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="iy6cbxr" id="rh-table--iy6cbxr" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><tbody><tr><td data-row="1" data-col="1" class="content--md" valign="top" align="left"> <p>
								Metric Group
							</p>
							 </td><td data-row="1" data-col="2" class="content--md" valign="top" align="left"> <p>
								Metrics provided
							</p>
							 </td></tr><tr><td data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.*</code>
							</p>
							 </td><td data-row="2" data-col="2" class="content--lg" valign="top" align="left"> <p>
								General XFS metrics including the read and write operation 
counts, read and write byte counts. Along with counters for the number 
of times inodes are flushed, clustered and number of failure to cluster.
							</p>
							 </td></tr><tr><td data-row="3" data-col="1" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.allocs.*</code>
							</p>
							 <p>
								<code class="literal">xfs.perdev.alloc_btree.*</code>
							</p>
							 </td><td data-row="3" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Range of metrics regarding the allocation of objects in the file
 system, these include number of extent and block creations/frees. 
Allocation tree lookup and compares along with extend record creation 
and deletion from the btree.
							</p>
							 </td></tr><tr><td data-row="4" data-col="1" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.block_map.*</code>
							</p>
							 <p>
								<code class="literal">xfs.perdev.bmap_btree.*</code>
							</p>
							 </td><td data-row="4" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Metrics include the number of block map read/write and block 
deletions, extent list operations for insertion, deletions and lookups. 
Also operations counters for compares, lookups, insertions and deletion 
operations from the blockmap.
							</p>
							 </td></tr><tr><td data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.dir_ops.*</code>
							</p>
							 </td><td data-row="5" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for directory operations of XFS file systems for creation, entry deletions, count of “getdent” operations.
							</p>
							 </td></tr><tr><td data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.transactions.*</code>
							</p>
							 </td><td data-row="6" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for the number of meta-data transactions, these include
 the count for the number of synchronous and asynchronous transactions 
along with the number of empty transactions.
							</p>
							 </td></tr><tr><td data-row="7" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.inode_ops.*</code>
							</p>
							 </td><td data-row="7" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for the number of times that the operating system 
looked for an XFS inode in the inode cache with different outcomes. 
These count cache hits, cache misses, and so on.
							</p>
							 </td></tr><tr><td data-row="8" data-col="1" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.log.*</code>
							</p>
							 <p>
								<code class="literal">xfs.perdev.log_tail.*</code>
							</p>
							 </td><td data-row="8" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counters for the number of log buffer writes over XFS filesytems
 includes the number of blocks written to disk. Metrics also for the 
number of log flushes and pinning.
							</p>
							 </td></tr><tr><td data-row="9" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.xstrat.*</code>
							</p>
							 </td><td data-row="9" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counts for the number of bytes of file data flushed out by the 
XFS flush deamon along with counters for number of buffers flushed to 
contiguous and non-contiguous space on disk.
							</p>
							 </td></tr><tr><td data-row="10" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.attr.*</code>
							</p>
							 </td><td data-row="10" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Counts for the number of attribute get, set, remove and list operations over all XFS file systems.
							</p>
							 </td></tr><tr><td data-row="11" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.quota.*</code>
							</p>
							 </td><td data-row="11" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Metrics for quota operation over XFS file systems, these include
 counters for number of quota reclaims, quota cache misses, cache hits 
and quota data reclaims.
							</p>
							 </td></tr><tr><td data-row="12" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.buffer.*</code>
							</p>
							 </td><td data-row="12" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Range of metrics regarding XFS buffer objects. Counters include 
the number of requested buffer calls, successful buffer locks, waited 
buffer locks, miss_locks, miss_retries and buffer hits when looking up 
pages.
							</p>
							 </td></tr><tr><td data-row="13" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">xfs.perdev.btree.*</code>
							</p>
							 </td><td data-row="13" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Metrics regarding the operations of the XFS btree.
							</p>
							 </td></tr></tbody></table></rh-table></div></section></section><section class="chapter" id="setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 9. Setting up graphical representation of PCP metrics</h1></div></div></div><p class="_abstract _abstract">
			Using a combination of <code class="literal">pcp</code>, <code class="literal">grafana</code>, <code class="literal">pcp redis</code>, <code class="literal">pcp bpftrace</code>, and <code class="literal">pcp vector</code> provides provides graphical representation of the live data or data collected by Performance Co-Pilot (PCP).
		</p><section class="section" id="setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.1. Setting up PCP with pcp-zeroconf</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to set up PCP on a system with the <code class="literal">pcp-zeroconf</code> package. Once the <code class="literal">pcp-zeroconf</code> package is installed, the system records the default set of metrics into archived files.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-zeroconf</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--e9hrdkw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-zeroconf</pre></div></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Ensure that the <code class="literal">pmlogger</code> service is active, and starts archiving the metrics:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3hhzwue"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># pcp | grep pmlogger
 pmlogger: primary logger: /var/log/pcp/pmlogger/<span class="emphasis"><em>localhost.localdomain/20200401.00.12</em></span></pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmlogger</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#monitoring-performance-with-performance-co-pilot_monitoring-and-managing-system-status-and-performance">Monitoring performance with Performance Co-Pilot</a>
					</li></ul></div></section><section class="section" id="setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.2. Setting up a grafana-server</h2></div></div></div><p class="_abstract _abstract">
				Grafana generates graphs that are accessible from a browser. The <code class="literal">grafana-server</code>
 is a back-end server for the Grafana dashboard. It listens, by default,
 on all interfaces, and provides web services accessed through the web 
browser. The <code class="literal">grafana-pcp</code> plugin interacts with the <code class="literal">pmproxy</code> protocol in the backend.
			</p><p>
				This procedure describes how to set up a <code class="literal">grafana-server</code>.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics">Setting up PCP with pcp-zeroconf</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the following packages:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--sb44ihl"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install grafana grafana-pcp</pre></div></div></li><li class="listitem"><p class="simpara">
						Restart and enable the following service:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mqwh47x"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart grafana-server
# systemctl enable grafana-server</pre></div></div></li><li class="listitem"><p class="simpara">
						Open the server’s firewall for network traffic to the Grafana service.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--i9ofxzq"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># firewall-cmd --permanent --add-service=grafana
success

# firewall-cmd --reload
success</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Ensure that the <code class="literal">grafana-server</code> is listening and responding to requests:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ao4f0lu"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># ss -ntlp | grep 3000
LISTEN  0  128  *:3000  *:*  users:(("grafana-server",pid=19522,fd=7))</pre></div></div></li><li class="listitem"><p class="simpara">
						Ensure that the <code class="literal">grafana-pcp</code> plugin is installed:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--v66d554"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># grafana-cli plugins ls | grep performancecopilot-pcp-app

performancecopilot-pcp-app @ 3.1.0</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmproxy(1)</code> and <code class="literal">grafana-server</code> man pages
					</li></ul></div></section><section class="section" id="accessing-the-grafana-web-ui_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.3. Accessing the Grafana web UI</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to access the Grafana web interface.
			</p><p>
				Using the Grafana web interface, you can:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						add PCP Redis, PCP bpftrace, and PCP Vector data sources
					</li><li class="listitem">
						create dashboard
					</li><li class="listitem">
						view an overview of any useful metrics
					</li><li class="listitem">
						create alerts in PCP Redis
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						PCP is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics">Setting up PCP with pcp-zeroconf</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics">Setting up a grafana-server</a>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						On the client system, open a browser and access the <code class="literal">grafana-server</code> on port <code class="literal">3000</code>, using <span class="emphasis"><em>http://192.0.2.0</em></span>:3000 link.
					</p><p class="simpara">
						Replace <span class="emphasis"><em>192.0.2.0</em></span> with your machine IP.
					</p></li><li class="listitem"><p class="simpara">
						For the first login, enter <span class="strong strong"><strong>admin</strong></span> in both the <span class="strong strong"><strong>Email or username</strong></span> and <span class="strong strong"><strong>Password</strong></span> field.
					</p><p class="simpara">
						Grafana prompts to set a <span class="strong strong"><strong>New password</strong></span> to create a secured account. If you want to set it later, click <span class="strong strong"><strong>Skip</strong></span>.
					</p></li><li class="listitem">
						From the menu, hover over the &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/grafana-gear-icon.png" alt="grafana gear icon"></span>
						 &nbsp;&nbsp; <span class="strong strong"><strong>Configuration</strong></span> icon and then click <span class="strong strong"><strong>Plugins</strong></span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Plugins</strong></span> tab, type performance co-pilot in the <span class="strong strong"><strong>Search by name or type</strong></span> text box and then click <span class="strong strong"><strong>Performance Co-Pilot</strong></span> (PCP) plugin.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Plugins / Performance Co-Pilot</strong></span> pane, click <span class="guibutton">Enable</span>.
					</li><li class="listitem"><p class="simpara">
						Click Grafana &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/grafana-home-page-whirl-icon.png" alt="grafana home page whirl icon"></span>
						 &nbsp;&nbsp; icon. The Grafana <span class="strong strong"><strong>Home</strong></span> page is displayed.
					</p><div class="figure" id="idm140611480121968"><p class="title">Figure 9.1. Home Dashboard</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/eaee6d13d94c418da9458c1e3cba883e/grafana-home-dashboard.png" class="rh_docs--zoom" title="grafana home dashboard"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/grafana-home-dashboard.png" alt="grafana home dashboard"></a></div></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The top corner of the screen has a similar &nbsp;&nbsp; 
							<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/grafana-top-corner-settings-icon.png" alt="grafana top corner settings icon"></span>
							 &nbsp;&nbsp; icon, but it controls the general <span class="strong strong"><strong>Dashboard settings</strong></span>.
						</p></div></div></li><li class="listitem"><p class="simpara">
						In the Grafana <span class="strong strong"><strong>Home</strong></span> page, click <span class="strong strong"><strong>Add your first data source</strong></span> to add PCP Redis, PCP bpftrace, and PCP Vector data sources. For more information about adding data source, see:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								To add pcp redis data source, view default dashboard, create a panel, and an alert rule, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#creating-panel-and-alerts-in-pcp-redis-data-source_setting-up-graphical-representation-of-pcp-metrics">Creating panels and alert in PCP Redis data source</a>.
							</li><li class="listitem">
								To add pcp bpftrace data source and view the default dashboard, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#viewing-the-pcp-bpftrace-system-analysis-dashboard_setting-up-graphical-representation-of-pcp-metrics">Viewing the PCP bpftrace System Analysis dashboard</a>.
							</li><li class="listitem">
								To add pcp vector data source, view the default dashboard, and to view the vector checklist, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#viewing-the-pcp-vector-checklist_setting-up-graphical-representation-of-pcp-metrics">Viewing the PCP Vector Checklist</a>.
							</li></ul></div></li><li class="listitem">
						Optional: From the menu, hover over the <span class="strong strong"><strong>admin</strong></span> profile &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/grafana-logout-option-icon.png" alt="grafana logout option icon"></span>
						 &nbsp;&nbsp; icon to change the <span class="strong strong"><strong>Preferences</strong></span> including <span class="strong strong"><strong>Edit Profile</strong></span>, <span class="strong strong"><strong>Change Password</strong></span>, or to <span class="strong strong"><strong>Sign out</strong></span>.
					</li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">grafana-cli</code> and <code class="literal">grafana-server</code> man pages
					</li></ul></div></section><section class="section" id="configuring-secure-connections-for-grafana_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.4. Configuring secure connections for Grafana</h2></div></div></div><p>
				You can establish secure connections between Grafana and Performance
 Co-Pilot (PCP) components. Establishing secure connections between 
these components helps prevent unauthorized parties from accessing or 
modifying the data being collected and monitored.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/%7BProductNumberLink]/html/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics">Setting up a grafana-server</a>.
					</li><li class="listitem"><p class="simpara">
						The private client key is stored in the <code class="literal">/etc/grafana/grafana.key</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</p><p class="simpara">
						For details about creating a private key and certificate signing 
request (CSR), as well as how to request a certificate from a 
certificate authority (CA), see your CA’s documentation.
					</p></li><li class="listitem">
						The TLS client certificate is stored in the <code class="literal">/etc/grafana/grafana.crt</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						As a root user, open the <code class="literal">/etc/grafana/grana.ini</code> file and adjust the following options in the <code class="literal">[server]</code> section to reflect the following:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--sau83yj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">protocol = https
cert_key = /etc/grafana/grafana.key
cert_file = /etc/grafana/grafana.crt</pre></div></div></li><li class="listitem"><p class="simpara">
						Ensure grafana can access the certificates:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--y92dlbj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># su grafana -s /bin/bash -c \
  'ls -1 /etc/grafana/grafana.crt /etc/grafana/grafana.key'
/etc/grafana/grafana.crt
/etc/grafana/grafana.key</pre></div></div></li><li class="listitem"><p class="simpara">
						Restart and enable the Grafana service to apply the configuration changes:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--cf69x8g"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart grafana-server
# systemctl enable grafana-server</pre></div></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						On the client system, open a browser and access the <code class="literal">grafana-server</code> machine on port 3000, using the <span class="emphasis"><em>https://192.0.2.0:3000</em></span> link. Replace 192.0.2.0 with your machine IP.
					</li><li class="listitem"><p class="simpara">
						Confirm the &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/lock_icon.png" alt="lock icon"></span>
						 &nbsp;&nbsp; lock icon is displayed beside the address bar.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							If the protocol is set to <code class="literal">http</code> and an HTTPS connection is attempted, you will receive a <code class="literal">ERR_SSL_PROTOCOL_ERROR</code> error. If the protocol is set to <code class="literal">https</code>
 and an HTTP connection is attempted, the Grafana server responds with a
 “Client sent an HTTP request to an HTTPS server” message.
						</p></div></div></li></ol></div></section><section class="section" id="configuring-pcp-redis_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.5. Configuring PCP Redis</h2></div></div></div><p class="_abstract _abstract">
				Use the PCP Redis data source to:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						View data archives
					</li><li class="listitem">
						Query time series using pmseries language
					</li><li class="listitem">
						Analyze data across multiple hosts
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						PCP is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics">Setting up PCP with pcp-zeroconf</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics">Setting up a grafana-server</a>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">redis</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jz61pbr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install redis</pre></div></div></li><li class="listitem"><p class="simpara">
						Start and enable the following services:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--93murge"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl start pmproxy redis
# systemctl enable pmproxy redis</pre></div></div></li><li class="listitem">
						Mail transfer agent, for example, <code class="literal">sendmail</code> or <code class="literal">postfix</code> is installed and configured.
					</li><li class="listitem"><p class="simpara">
						Ensure that the <code class="literal">allow_loading_unsigned_plugins</code> parameter is set to PCP Redis database in the <code class="literal">grafana.ini</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mg0g1cx"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># vi /etc/grafana/grafana.ini

allow_loading_unsigned_plugins = pcp-redis-datasource</pre></div></div></li><li class="listitem"><p class="simpara">
						Restart the <code class="literal">grafana-server</code>:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--yc163rm"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart grafana-server</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Ensure that the <code class="literal">pmproxy</code> and <code class="literal">redis</code> are working:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ea0xz1o"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># pmseries disk.dev.read
2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df</pre></div></div><p class="simpara">
						This command does not return any data if the <code class="literal">redis</code> package is not installed.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmseries(1)</code> man page
					</li></ul></div></section><section class="section" id="configuring-secure-connections-for-pcp-redis_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.6. Configuring secure connections for PCP redis</h2></div></div></div><p>
				You can establish secure connections between performance co-pilot 
(PCP), Grafana, and PCP redis. Establishing secure connections between 
these components helps prevent unauthorized parties from accessing or 
modifying the data being collected and monitored.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						PCP is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-pcp_monitoring-and-managing-system-status-and-performance#installing-and-enabling-pcp_setting-up-pcp">Installing and enabling PCP</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/%7BProductNumberLink]/html/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics">Setting up a grafana-server</a>.
					</li><li class="listitem">
						PCP redis is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#configuring-pcp-redis_setting-up-graphical-representation-of-pcp-metrics">Configuring PCP Redis</a>.
					</li><li class="listitem"><p class="simpara">
						The private client key is stored in the <code class="literal">/etc/redis/client.key</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</p><p class="simpara">
						For details about creating a private key and certificate signing 
request (CSR), as well as how to request a certificate from a 
certificate authority (CA), see your CA’s documentation.
					</p></li><li class="listitem">
						The TLS client certificate is stored in the <code class="literal">/etc/redis/client.crt</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</li><li class="listitem">
						The TLS server key is stored in the <code class="literal">/etc/redis/redis.key</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</li><li class="listitem">
						The TLS server certificate is stored in the <code class="literal">/etc/redis/redis.crt</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</li><li class="listitem">
						The CA certificate is stored in the <code class="literal">/etc/redis/ca.crt</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</li></ul></div><p>
				Additionally, for the <code class="literal">pmproxy</code> daemon:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The private server key is stored in the <code class="literal">/etc/pcp/tls/server.key</code> file. If you use a different path, modify the path in the corresponding steps of the procedure.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						As a root user, open the <code class="literal">/etc/redis/redis.conf</code> file and adjust the TLS/SSL options to reflect the following properties:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--934thzh"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">port 0
tls-port 6379
tls-cert-file /etc/redis/redis.crt
tls-key-file /etc/redis/redis.key
tls-client-key-file /etc/redis/client.key
tls-client-cert-file /etc/redis/client.crt
tls-ca-cert-file /etc/redis/ca.crt</pre></div></div></li><li class="listitem"><p class="simpara">
						Ensure <code class="literal">redis</code> can access the TLS certificates:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5qp2owp"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># su redis -s /bin/bash -c \
  'ls -1 /etc/redis/ca.crt /etc/redis/redis.key /etc/redis/redis.crt'
/etc/redis/ca.crt
/etc/redis/redis.crt
/etc/redis/redis.key</pre></div></div></li><li class="listitem"><p class="simpara">
						Restart the <code class="literal">redis</code> server to apply the configuration changes:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3dqxmrk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart redis</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Confirm the TLS configuration works:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--lzhj2zh"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># redis-cli --tls --cert /etc/redis/client.crt \
    --key /etc/redis/client.key \
    --cacert /etc/redis/ca.crt &lt;&lt;&lt; "PING"
PONG</pre></div></div><p class="simpara">
						Unsuccessful TLS configuration might result in the following error message:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ezqe2ah"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">Could not negotiate a TLS connection: Invalid CA Certificate File/Directory</pre></div></div></li></ul></div></section><section class="section" id="creating-panel-and-alerts-in-pcp-redis-data-source_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.7. Creating panels and alert in PCP Redis data source</h2></div></div></div><p class="_abstract _abstract">
				After adding the PCP Redis data source, you can view the dashboard 
with an overview of useful metrics, add a query to visualize the load 
graph, and create alerts that help you to view the system issues after 
they occur.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						The PCP Redis is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#configuring-pcp-redis_setting-up-graphical-representation-of-pcp-metrics">Configuring PCP Redis</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is accessible. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#accessing-the-grafana-web-ui_setting-up-graphical-representation-of-pcp-metrics">Accessing the Grafana web UI</a>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Log into the Grafana web UI.
					</li><li class="listitem">
						In the Grafana <span class="strong strong"><strong>Home</strong></span> page, click <span class="strong strong"><strong>Add your first data source</strong></span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Add data source</strong></span> pane, type redis in the <span class="strong strong"><strong>Filter by name or type</strong></span> text box and then click <span class="strong strong"><strong>PCP Redis</strong></span>.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong>Data Sources / PCP Redis</strong></span> pane, perform the following:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Add <code class="literal">http://localhost:44322</code> in the <span class="strong strong"><strong>URL</strong></span> field and then click <span class="guibutton">Save &amp; Test</span>.
							</li><li class="listitem"><p class="simpara">
								Click <span class="guimenu">Dashboards tab</span> → <span class="guisubmenu">Import</span> → <span class="guimenuitem">PCP Redis: Host Overview</span> to see a dashboard with an overview of any useful metrics.
							</p><div class="figure" id="idm140611482087552"><p class="title">Figure 9.2. PCP Redis: Host Overview</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/5e71183edc2279c3f6833bb840e50b66/pcp-redis-host-overview.png" class="rh_docs--zoom" title="pcp redis host overview"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-redis-host-overview.png" alt="pcp redis host overview"></a></div></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Add a new panel:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								From the menu, hover over the &nbsp;&nbsp; 
								<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/grafana-plus-sign.png" alt="grafana plus sign"></span>
								 &nbsp;&nbsp; <span class="guimenu">Create icon</span> → <span class="guisubmenu">Dashboard</span> → <span class="guimenuitem">Add new panel icon</span> to add a panel.
							</li><li class="listitem">
								In the <span class="strong strong"><strong>Query</strong></span> tab, select the <span class="strong strong"><strong>PCP Redis</strong></span> from the query list instead of the selected <span class="strong strong"><strong>default</strong></span> option and in the text field of <span class="strong strong"><strong>A</strong></span>, enter metric, for example, <code class="literal">kernel.all.load</code> to visualize the kernel load graph.
							</li><li class="listitem">
								Optional: Add <span class="strong strong"><strong>Panel title</strong></span> and <span class="strong strong"><strong>Description</strong></span>, and update other options from the <span class="strong strong"><strong>Settings</strong></span>.
							</li><li class="listitem">
								Click <span class="guibutton">Save</span> to apply changes and save the dashboard. Add <span class="strong strong"><strong>Dashboard name</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Click <span class="guibutton">Apply</span> to apply changes and go back to the dashboard.
							</p><div class="figure" id="idm140611482493296"><p class="title">Figure 9.3. PCP Redis query panel</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/564dac8e9860e0361b40c6cb8d98483b/pcp-redis-query-panel.png" class="rh_docs--zoom" title="pcp redis query panel"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-redis-query-panel.png" alt="pcp redis query panel"></a></div></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Create an alert rule:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								In the <span class="strong strong"><strong>PCP Redis query panel</strong></span>, click &nbsp;&nbsp; 
								<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/redis-alert-icon.png" alt="redis alert icon"></span>
								 &nbsp;&nbsp; <span class="strong strong"><strong>Alert</strong></span> and then click <span class="strong strong"><strong>Create Alert</strong></span>.
							</li><li class="listitem">
								Edit the <span class="strong strong"><strong>Name</strong></span>, <span class="strong strong"><strong>Evaluate query</strong></span>, and <span class="strong strong"><strong>For</strong></span> fields from the <span class="strong strong"><strong>Rule</strong></span>, and specify the <span class="strong strong"><strong>Conditions</strong></span> for your alert.
							</li><li class="listitem"><p class="simpara">
								Click <span class="guibutton">Save</span> to apply changes and save the dashboard. Click <span class="guibutton">Apply</span> to apply changes and go back to the dashboard.
							</p><div class="figure" id="idm140611472842416"><p class="title">Figure 9.4. Creating alerts in the PCP Redis panel</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/bc80cbc0cd4bc46d8fcae30ae166e573/pcp-redis-query-alert-panel.png" class="rh_docs--zoom" title="pcp redis query alert panel"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-redis-query-alert-panel.png" alt="pcp redis query alert panel"></a></div></div></div></li><li class="listitem">
								Optional: In the same panel, scroll down and click <span class="guibutton">Delete</span> icon to delete the created rule.
							</li><li class="listitem"><p class="simpara">
								Optional: From the menu, click &nbsp;&nbsp; 
								<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/alerting-bell-icon.png" alt="alerting bell icon"></span>
								 &nbsp;&nbsp; <span class="strong strong"><strong>Alerting</strong></span>
 icon to view the created alert rules with different alert statuses, to 
edit the alert rule, or to pause the existing rule from the <span class="strong strong"><strong>Alert Rules</strong></span> tab.
							</p><p class="simpara">
								To add a notification channel for the created alert rule to receive an alert notification from Grafana, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#adding-notification-channels-for-alerts_setting-up-graphical-representation-of-pcp-metrics">Adding notification channels for alerts</a>.
							</p></li></ol></div></li></ol></div></section><section class="section" id="adding-notification-channels-for-alerts_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.8. Adding notification channels for alerts</h2></div></div></div><p class="_abstract _abstract">
				By adding notification channels, you can receive an alert 
notification from Grafana whenever the alert rule conditions are met and
 the system needs further monitoring.
			</p><p>
				You can receive these alerts after selecting any one type from the supported list of notifiers, which includes <span class="strong strong"><strong>DingDing</strong></span>, <span class="strong strong"><strong>Discord</strong></span>, <span class="strong strong"><strong>Email</strong></span>, <span class="strong strong"><strong>Google Hangouts Chat</strong></span>, <span class="strong strong"><strong>HipChat</strong></span>, <span class="strong strong"><strong>Kafka REST Proxy</strong></span>, <span class="strong strong"><strong>LINE</strong></span>, <span class="strong strong"><strong>Microsoft Teams</strong></span>, <span class="strong strong"><strong>OpsGenie</strong></span>, <span class="strong strong"><strong>PagerDuty</strong></span>, <span class="strong strong"><strong>Prometheus Alertmanager</strong></span>, <span class="strong strong"><strong>Pushover</strong></span>, <span class="strong strong"><strong>Sensu</strong></span>, <span class="strong strong"><strong>Slack</strong></span>, <span class="strong strong"><strong>Telegram</strong></span>, <span class="strong strong"><strong>Threema Gateway</strong></span>, <span class="strong strong"><strong>VictorOps</strong></span>, and <span class="strong strong"><strong>webhook</strong></span>.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						The <code class="literal">grafana-server</code> is accessible. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#accessing-the-grafana-web-ui_setting-up-graphical-representation-of-pcp-metrics">Accessing the Grafana web UI</a>.
					</li><li class="listitem">
						An alert rule is created. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#creating-panel-and-alerts-in-pcp-redis-data-source_setting-up-graphical-representation-of-pcp-metrics">Creating panels and alert in PCP Redis data source</a>.
					</li><li class="listitem"><p class="simpara">
						Configure SMTP and add a valid sender’s email address in the <code class="literal">grafana/grafana.ini</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5x6kgyz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># vi /etc/grafana/grafana.ini

[smtp]
enabled = true
from_address = <span class="emphasis"><em>abc@gmail.com</em></span></pre></div></div><p class="simpara">
						Replace <span class="emphasis"><em>abc@gmail.com</em></span> by a valid email address.
					</p></li><li class="listitem"><p class="simpara">
						Restart <code class="literal">grafana-server</code>
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--v26epnu"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart grafana-server.service</pre></div></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						From the menu, hover over the &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/alerting-bell-icon.png" alt="alerting bell icon"></span>
						 &nbsp;&nbsp; <span class="guimenu">Alerting icon</span> → <span class="guisubmenu">click Contact Points</span> → <span class="guimenuitem">New contact point</span>.
					</li><li class="listitem"><p class="simpara">
						In the <code class="literal">New contact point</code> details view, perform the following:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Enter your name in the <span class="strong strong"><strong>Name</strong></span> text box
							</li><li class="listitem">
								Select the <span class="strong strong"><strong>Contact point type</strong></span>, for example, Email and enter the email address. You can add many email addresses by using the <code class="literal">;</code> separator.
							</li><li class="listitem">
								Optional: Configure <span class="strong strong"><strong>Optional Email settings</strong></span> and <span class="strong strong"><strong>Notification settings</strong></span>.
							</li></ol></div></li><li class="listitem">
						Click <span class="guibutton">Save contact point</span>.
					</li><li class="listitem"><p class="simpara">
						Select a notification channel in the alert rule:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								From the menu, select <span class="strong strong"><strong>Notification policies</strong></span> icon and then click <span class="strong strong"><strong>+ New specific policy</strong></span>.
							</li><li class="listitem">
								Choose the <span class="strong strong"><strong>Contact point</strong></span> you have just created
							</li><li class="listitem">
								Click the <span class="strong strong"><strong>Save policy</strong></span> button
							</li></ol></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://grafana.com/docs/grafana/v9.0/alerting/notifications/">Upstream Grafana documentation for alert notifications</a>
					</li></ul></div></section><section class="section" id="setting-up-authentication-between-pcp-components_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.9. Setting up authentication between PCP components</h2></div></div></div><p class="_abstract _abstract">
				You can setup authentication using the <code class="literal">scram-sha-256</code> authentication mechanism, which is supported by PCP through the Simple Authentication Security Layer (SASL) framework.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">sasl</code> framework for the <code class="literal">scram-sha-256</code> authentication mechanism:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--r5sutpp"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install cyrus-sasl-scram cyrus-sasl-lib</pre></div></div></li><li class="listitem"><p class="simpara">
						Specify the supported authentication mechanism and the user database path in the <code class="literal">pmcd.conf</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--hflstm6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># vi /etc/sasl2/pmcd.conf

mech_list: scram-sha-256

sasldb_path: /etc/pcp/passwd.db</pre></div></div></li><li class="listitem"><p class="simpara">
						Create a new user:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--msbskxl"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># useradd -r <span class="emphasis"><em>metrics</em></span></pre></div></div><p class="simpara">
						Replace <span class="emphasis"><em>metrics</em></span> by your user name.
					</p></li><li class="listitem"><p class="simpara">
						Add the created user in the user database:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--iovv89o"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># saslpasswd2 -a pmcd <span class="emphasis"><em>metrics</em></span>

Password:
Again (for verification):</pre></div></div><p class="simpara">
						To add the created user, you are required to enter the <span class="emphasis"><em>metrics</em></span> account password.
					</p></li><li class="listitem"><p class="simpara">
						Set the permissions of the user database:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--cyaq081"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># chown root:pcp /etc/pcp/passwd.db
# chmod 640 /etc/pcp/passwd.db</pre></div></div></li><li class="listitem"><p class="simpara">
						Restart the <code class="literal">pmcd</code> service:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xh55sem"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># systemctl restart pmcd</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify the <code class="literal">sasl</code> configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--j3eetuq"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># pminfo -f -h "pcp://127.0.0.1?username=<span class="emphasis"><em>metrics</em></span>" disk.dev.read
Password:
disk.dev.read
inst [0 or "sda"] value 19540</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">saslauthd(8)</code>, <code class="literal">pminfo(1)</code>, and <code class="literal">sha256</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/5041891">How can I setup authentication between PCP components, like PMDAs and pmcd in RHEL 8.2?</a>
					</li></ul></div></section><section class="section" id="installing-pcp-bpftrace_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.10. Installing PCP bpftrace</h2></div></div></div><p class="_abstract _abstract">
				Install the PCP <code class="literal">bpftrace</code> agent to introspect a system and to gather metrics from the kernel and user-space tracepoints.
			</p><p>
				The <code class="literal">bpftrace</code> agent uses bpftrace scripts to gather the metrics. The <code class="literal">bpftrace</code> scripts use the enhanced Berkeley Packet Filter (<code class="literal">eBPF</code>).
			</p><p>
				This procedure describes how to install a <code class="literal">pcp bpftrace</code>.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						PCP is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics">Setting up PCP with pcp-zeroconf</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics">Setting up a grafana-server</a>.
					</li><li class="listitem">
						The <code class="literal">scram-sha-256</code> authentication mechanism is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-authentication-between-pcp-components_setting-up-graphical-representation-of-pcp-metrics">Setting up authentication between PCP components</a>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-pmda-bpftrace</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2dqao0q"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install pcp-pmda-bpftrace</pre></div></div></li><li class="listitem"><p class="simpara">
						Edit the <code class="literal">bpftrace.conf</code> file and add the user that you have created in the {setting-up-authentication-between-pcp-components}:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--1szwh82"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># vi /var/lib/pcp/pmdas/bpftrace/bpftrace.conf

[dynamic_scripts]
enabled = true
auth_enabled = true
allowed_users = root,<span class="emphasis"><em>metrics</em></span></pre></div></div><p class="simpara">
						Replace <span class="emphasis"><em>metrics</em></span> by your user name.
					</p></li><li class="listitem"><p class="simpara">
						Install <code class="literal">bpftrace</code> PMDA:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8fe3n73"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cd /var/lib/pcp/pmdas/bpftrace/
# ./Install
Updating the Performance Metrics Name Space (PMNS) ...
Terminate PMDA if already installed ...
Updating the PMCD control file, and notifying PMCD ...
Check bpftrace metrics have appeared ... 7 metrics and 6 values</pre></div></div><p class="simpara">
						The <code class="literal">pmda-bpftrace</code> is now installed, and can only be used after authenticating your user. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#viewing-the-pcp-bpftrace-system-analysis-dashboard_setting-up-graphical-representation-of-pcp-metrics">Viewing the PCP bpftrace System Analysis dashboard</a>.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmdabpftrace(1)</code> and <code class="literal">bpftrace</code> man pages
					</li></ul></div></section><section class="section" id="viewing-the-pcp-bpftrace-system-analysis-dashboard_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.11. Viewing the PCP bpftrace System Analysis dashboard</h2></div></div></div><p class="_abstract _abstract">
				Using the PCP bpftrace data source, you can access the live data 
from sources which are not available as normal data from the <code class="literal">pmlogger</code> or archives
			</p><p>
				In the PCP bpftrace data source, you can view the dashboard with an overview of useful metrics.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						The PCP bpftrace is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#installing-pcp-bpftrace_setting-up-graphical-representation-of-pcp-metrics">Installing PCP bpftrace</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is accessible. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#accessing-the-grafana-web-ui_setting-up-graphical-representation-of-pcp-metrics">Accessing the Grafana web UI</a>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Log into the Grafana web UI.
					</li><li class="listitem">
						In the Grafana <span class="strong strong"><strong>Home</strong></span> page, click <span class="strong strong"><strong>Add your first data source</strong></span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Add data source</strong></span> pane, type bpftrace in the <span class="strong strong"><strong>Filter by name or type</strong></span> text box and then click <span class="strong strong"><strong>PCP bpftrace</strong></span>.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong>Data Sources / PCP bpftrace</strong></span> pane, perform the following:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Add <code class="literal">http://localhost:44322</code> in the <span class="strong strong"><strong>URL</strong></span> field.
							</li><li class="listitem">
								Toggle the <span class="strong strong"><strong>Basic Auth</strong></span> option and add the created user credentials in the <span class="strong strong"><strong>User</strong></span> and <span class="strong strong"><strong>Password</strong></span> field.
							</li><li class="listitem"><p class="simpara">
								Click <span class="guibutton">Save &amp; Test</span>.
							</p><div class="figure" id="idm140611476037536"><p class="title">Figure 9.5. Adding PCP bpftrace in the data source</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/6e66a9bb305eab59cdc7d9173914b416/bpftrace-auth.png" class="rh_docs--zoom" title="bpftrace auth"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/bpftrace-auth.png" alt="bpftrace auth"></a></div></div></div></li><li class="listitem"><p class="simpara">
								Click <span class="guimenu">Dashboards tab</span> → <span class="guisubmenu">Import</span> → <span class="guimenuitem">PCP bpftrace: System Analysis</span> to see a dashboard with an overview of any useful metrics.
							</p><div class="figure" id="idm140611472286560"><p class="title">Figure 9.6. PCP bpftrace: System Analysis</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/d56998db4c7d90a0936471b9c592b405/pcp-bpftrace-bpftrace-system-analysis.png" class="rh_docs--zoom" title="pcp bpftrace bpftrace system analysis"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-bpftrace-bpftrace-system-analysis.png" alt="pcp bpftrace bpftrace system analysis"></a></div></div></div></li></ol></div></li></ol></div></section><section class="section" id="installing-pcp-vector_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.12. Installing PCP Vector</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to install a <code class="literal">pcp vector</code>.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						PCP is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics">Setting up PCP with pcp-zeroconf</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is configured. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics">Setting up a grafana-server</a>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the <code class="literal">pcp-pmda-bcc</code> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--bh8r9rr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># dnf install pcp-pmda-bcc</pre></div></div></li><li class="listitem"><p class="simpara">
						Install the <code class="literal">bcc</code> PMDA:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--znb1ql2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cd /var/lib/pcp/pmdas/bcc
# ./Install
[Wed Apr  1 00:27:48] pmdabcc(22341) Info: Initializing, currently in 'notready' state.
[Wed Apr  1 00:27:48] pmdabcc(22341) Info: Enabled modules:
[Wed Apr  1 00:27:48] pmdabcc(22341) Info: ['biolatency', 'sysfork',
[...]
Updating the Performance Metrics Name Space (PMNS) ...
Terminate PMDA if already installed ...
Updating the PMCD control file, and notifying PMCD ...
Check bcc metrics have appeared ... 1 warnings, 1 metrics and 0 values</pre></div></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">pmdabcc(1)</code> man page
					</li></ul></div></section><section class="section" id="viewing-the-pcp-vector-checklist_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.13. Viewing the PCP Vector Checklist</h2></div></div></div><p class="_abstract _abstract">
				The PCP Vector data source displays live metrics and uses the <code class="literal">pcp</code> metrics. It analyzes data for individual hosts.
			</p><p>
				After adding the PCP Vector data source, you can view the dashboard 
with an overview of useful metrics and view the related troubleshooting 
or reference links in the checklist.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						The PCP Vector is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#installing-pcp-vector_setting-up-graphical-representation-of-pcp-metrics">Installing PCP Vector</a>.
					</li><li class="listitem">
						The <code class="literal">grafana-server</code> is accessible. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#accessing-the-grafana-web-ui_setting-up-graphical-representation-of-pcp-metrics">Accessing the Grafana web UI</a>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Log into the Grafana web UI.
					</li><li class="listitem">
						In the Grafana <span class="strong strong"><strong>Home</strong></span> page, click <span class="strong strong"><strong>Add your first data source</strong></span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Add data source</strong></span> pane, type vector in the <span class="strong strong"><strong>Filter by name or type</strong></span> text box and then click <span class="strong strong"><strong>PCP Vector</strong></span>.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong>Data Sources / PCP Vector</strong></span> pane, perform the following:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
								Add <code class="literal">http://localhost:44322</code> in the <span class="strong strong"><strong>URL</strong></span> field and then click <span class="guibutton">Save &amp; Test</span>.
							</li><li class="listitem"><p class="simpara">
								Click <span class="guimenu">Dashboards tab</span> → <span class="guisubmenu">Import</span> → <span class="guimenuitem">PCP Vector: Host Overview</span> to see a dashboard with an overview of any useful metrics.
							</p><div class="figure" id="idm140611472796080"><p class="title">Figure 9.7. PCP Vector: Host Overview</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/f3b1467c30f51abc865910b8bf8fd22f/pcp-vector-host-overview.png" class="rh_docs--zoom" title="pcp vector host overview"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-vector-host-overview.png" alt="pcp vector host overview"></a></div></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						From the menu, hover over the &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-plugin-in-grafana.png" alt="pcp plugin in grafana"></span>
						 &nbsp;&nbsp; <span class="strong strong"><strong>Performance Co-Pilot</strong></span> plugin and then click <span class="strong strong"><strong>PCP Vector Checklist</strong></span>.
					</p><p class="simpara">
						In the PCP checklist, click &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-vector-checklist-troubleshooting-doc.png" alt="pcp vector checklist troubleshooting doc"></span>
						 &nbsp;&nbsp; help or &nbsp;&nbsp; 
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-vector-checklist-warning.png" alt="pcp vector checklist warning"></span>
						 &nbsp;&nbsp; warning icon to view the related troubleshooting or reference links.
					</p><div class="figure" id="idm140611483651776"><p class="title">Figure 9.8. Performance Co-Pilot / PCP Vector Checklist</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/6f429418d2dffd6fe95bf3040f5b2c7d/pcp-vector-checklist.png" class="rh_docs--zoom" title="pcp vector checklist"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/pcp-vector-checklist.png" alt="pcp vector checklist"></a></div></div></div></li></ol></div></section><section class="section" id="troubleshooting-grafana-issues_setting-up-graphical-representation-of-pcp-metrics"><div class="titlepage"><div><div><h2 class="title">9.14. Troubleshooting Grafana issues</h2></div></div></div><p class="_abstract _abstract">
				It is sometimes neccesary to troubleshoot Grafana issues, such as, 
Grafana does not display any data, the dashboard is black, or similar 
issues.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify that the <code class="literal">pmlogger</code> service is up and running by executing the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--souaib7"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ systemctl status pmlogger</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify if files were created or modified to the disk by executing the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2s0xueu"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ ls /var/log/pcp/pmlogger/$(hostname)/ -rlt
total 4024
-rw-r--r--. 1 pcp pcp   45996 Oct 13  2019 20191013.20.07.meta.xz
-rw-r--r--. 1 pcp pcp     412 Oct 13  2019 20191013.20.07.index
-rw-r--r--. 1 pcp pcp   32188 Oct 13  2019 20191013.20.07.0.xz
-rw-r--r--. 1 pcp pcp   44756 Oct 13  2019 20191013.20.30-00.meta.xz
[..]</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify that the <code class="literal">pmproxy</code> service is running by executing the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2wgdi7w"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ systemctl status pmproxy</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify that <code class="literal">pmproxy</code> is running, time series support is enabled, and a connection to Redis is established by viewing the <code class="literal">/var/log/pcp/pmproxy/pmproxy.log</code> file and ensure that it contains the following text:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6qa9uge"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">pmproxy(1716) Info: Redis slots, command keys, schema version setup</pre></div></div><p class="simpara">
						Here, <span class="strong strong"><strong>1716</strong></span> is the PID of pmproxy, which will be different for every invocation of <code class="literal">pmproxy</code>.
					</p></li><li class="listitem"><p class="simpara">
						Verify if the Redis database contains any keys by executing the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--j45ygtx"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ redis-cli dbsize
(integer) 34837</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify if any PCP metrics are in the Redis database and <code class="literal">pmproxy</code> is able to access them by executing the following commands:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--qa4xhtj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ pmseries disk.dev.read
2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df

$ pmseries "disk.dev.read[count:10]"
2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df
    [Mon Jul 26 12:21:10.085468000 2021] 117971 70e83e88d4e1857a3a31605c6d1333755f2dd17c
    [Mon Jul 26 12:21:00.087401000 2021] 117758 70e83e88d4e1857a3a31605c6d1333755f2dd17c
    [Mon Jul 26 12:20:50.085738000 2021] 116688 70e83e88d4e1857a3a31605c6d1333755f2dd17c
[...]</pre></div></div><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xiazuv2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ redis-cli --scan --pattern "*$(pmseries 'disk.dev.read')"

pcp:metric.name:series:2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df
pcp:values:series:2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df
pcp:desc:series:2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df
pcp:labelvalue:series:2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df
pcp:instances:series:2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df
pcp:labelflags:series:2eb3e58d8f1e231361fb15cf1aa26fe534b4d9df</pre></div></div></li><li class="listitem"><p class="simpara">
						Verify if there are any errors in the Grafana logs by executing the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8ru8meg"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ journalctl -e -u grafana-server
-- Logs begin at Mon 2021-07-26 11:55:10 IST, end at Mon 2021-07-26 12:30:15 IST. --
Jul 26 11:55:17 localhost.localdomain systemd[1]: Starting Grafana instance...
Jul 26 11:55:17 localhost.localdomain grafana-server[1171]: t=2021-07-26T11:55:17+0530 lvl=info msg="Starting Grafana" logger=server version=7.3.6 c&gt;
Jul 26 11:55:17 localhost.localdomain grafana-server[1171]: t=2021-07-26T11:55:17+0530 lvl=info msg="Config loaded from" logger=settings file=/usr/s&gt;
Jul 26 11:55:17 localhost.localdomain grafana-server[1171]: t=2021-07-26T11:55:17+0530 lvl=info msg="Config loaded from" logger=settings file=/etc/g&gt;
[...]</pre></div></div></li></ul></div></section></section><section class="chapter" id="using-the-web-console-for-selecting-performance-profiles_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 10. Optimizing the system performance using the web console</h1></div></div></div><p class="_abstract _abstract">
			Learn how to set a performance profile in the RHEL web console to optimize the performance of the system for a selected task.
		</p><section class="section" id="performance-tuning-options-in-the-web-console_optimizing-the-system-performance-using-the-web-console"><div class="titlepage"><div><div><h2 class="title">10.1. Performance tuning options in the web console</h2></div></div></div><p class="_abstract _abstract">
				Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9 provides several 
performance profiles that optimize the system for the following tasks:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Systems using the desktop
					</li><li class="listitem">
						Throughput performance
					</li><li class="listitem">
						Latency performance
					</li><li class="listitem">
						Network performance
					</li><li class="listitem">
						Low power consumption
					</li><li class="listitem">
						Virtual machines
					</li></ul></div><p>
				The <code class="literal">TuneD</code> service optimizes system options to match the selected profile.
			</p><p>
				In the web console, you can set which performance profile your system uses.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-tuned_monitoring-and-managing-system-status-and-performance">Getting started with TuneD</a>
					</li></ul></div></section><section class="section" id="setting-a-performance-profile-in-the-web-console_optimizing-the-system-performance-using-the-web-console"><div class="titlepage"><div><div><h2 class="title">10.2. Setting a performance profile in the web console</h2></div></div></div><p class="_abstract _abstract">
				This procedure uses the web console to optimize the system performance for a selected task.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Make sure the web console is installed and accessible. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/getting-started-with-the-rhel-9-web-console_system-management-using-the-rhel-9-web-console#installing-the-web-console_getting-started-with-the-rhel-9-web-console">Installing the web console</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Log into the RHEL web console. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/getting-started-with-the-rhel-9-web-console_system-management-using-the-rhel-9-web-console#logging-in-to-the-web-console_getting-started-with-the-rhel-9-web-console">Logging in to the web console</a>.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Overview</strong></span>.
					</li><li class="listitem"><p class="simpara">
						In the <span class="strong strong"><strong>Performance Profile</strong></span> field, click the current performance profile.
					</p><p class="simpara">
						<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/3ea97976404610a779d097346ee6e4ab/cockpit-performance-profile-pf4.png" class="rh_docs--zoom" title="cockpit performance profile pf4"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/cockpit-performance-profile-pf4.png" alt="cockpit performance profile pf4"></a></span>

					</p></li><li class="listitem">
						In the <span class="strong strong"><strong>Change Performance Profile</strong></span> dialog box, change the profile if necessary.
					</li><li class="listitem"><p class="simpara">
						Click <span class="strong strong"><strong>Change Profile</strong></span>.
					</p><p class="simpara">
						<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/27ca9aeb62a34964f25d2da2f573f2e7/cockpit-performance-profile-change-pf4.png" class="rh_docs--zoom" title="cockpit performance profile change pf4"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/cockpit-performance-profile-change-pf4.png" alt="cockpit performance profile change pf4"></a></span>

					</p></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <span class="strong strong"><strong>Overview</strong></span> tab now shows the selected performance profile.
					</li></ul></div></section><section class="section" id="monitoring-performance-using-the-web-console_optimizing-the-system-performance-using-the-web-console"><div class="titlepage"><div><div><h2 class="title">10.3. Monitoring performance on the local system using the web console</h2></div></div></div><p>
				Red&nbsp;Hat Enterprise&nbsp;Linux web console uses the Utilization 
Saturation and Errors (USE) Method for troubleshooting. The new 
performance metrics page has a historical view of your data organized 
chronologically with the newest data at the top.
			</p><p>
				In the <span class="strong strong"><strong>Metrics and history</strong></span> page, you can view events, errors, and graphical representation for resource utilization and saturation.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The web console is installed and accessible. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/getting-started-with-the-rhel-9-web-console_system-management-using-the-rhel-9-web-console#installing-the-web-console_getting-started-with-the-rhel-9-web-console">Installing the web console</a>.
					</li><li class="listitem"><p class="simpara">
						The <code class="literal">cockpit-pcp</code> package, which enables collecting the performance metrics, is installed:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								To install the package from the web console interface:
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
										Log in to the web console with administrative privileges. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/getting-started-with-the-rhel-9-web-console_system-management-using-the-rhel-9-web-console#logging-in-to-the-web-console_getting-started-with-the-rhel-9-web-console">Logging in to the web console</a>.
									</li><li class="listitem">
										In the <span class="strong strong"><strong>Overview</strong></span> page, click <span class="strong strong"><strong>View metrics and history</strong></span>.
									</li><li class="listitem">
										Click the <span class="guibutton">Install cockpit-pcp</span> button.
									</li><li class="listitem">
										In the <span class="strong strong"><strong>Install software</strong></span> dialog window, click <span class="strong strong"><strong>Install</strong></span>.
									</li></ol></div></li><li class="listitem"><p class="simpara">
								To install the package from the command-line interface, use:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7r5pvfa"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>dnf install cockpit-pcp</strong></span></pre></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						The Performance Co-Pilot (PCP) service is enabled:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2h6ccyp"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl enable --now pmlogger.service pmproxy.service</strong></span></pre></div></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Log into the RHEL 9 web console. In the <span class="strong strong"><strong>Overview</strong></span> page click <span class="strong strong"><strong>View metrics and history</strong></span> to view the <span class="strong strong"><strong>Metrics and history</strong></span> page.
					</p><p class="simpara">
						<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/1f5c28252c509175c428841310638bfa/webconsole-view-details.png" class="rh_docs--zoom" title="View metrics and history"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/webconsole-view-details.png" alt="View metrics and history"></a></span>

					</p><p class="simpara">
						<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/df4127a2ccf8bfae1e08f971a40f2854/webconsole-performance-metrics.png" class="rh_docs--zoom" title="Performance metrics in the web console"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/webconsole-performance-metrics.png" alt="Performance metrics in the web console"></a></span>

					</p></li></ol></div></section><section class="section" id="proc_enabling-performance-metrics-export-with-pcp-from-the-web-console_optimizing-the-system-performance-using-the-web-console"><div class="titlepage"><div><div><h2 class="title">10.4. Monitoring performance on several systems using the web console and Grafana</h2></div></div></div><p>
				Grafana enables you to collect data from several systems at once and
 review a graphical representation of their collected Performance 
Co-Pilot (PCP) metrics. You can set up performance metrics monitoring 
and export for several systems in the web console interface.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The web console must be installed and accessible. For details, see link:<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/getting-started-with-the-rhel-9-web-console_system-management-using-the-rhel-9-web-console#installing-the-web-console_getting-started-with-the-rhel-9-web-console">Installing the web console</a>.
					</li><li class="listitem"><p class="simpara">
						Install the <code class="literal">cockpit-pcp</code> package.
					</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
								From the web console interface:
							</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
										Log in to the web console with administrative privileges. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_systems_using_the_rhel_9_web_console/getting-started-with-the-rhel-9-web-console_system-management-using-the-rhel-9-web-console#logging-in-to-the-web-console_getting-started-with-the-rhel-9-web-console">Logging in to the web console</a>.
									</li><li class="listitem">
										In the <span class="strong strong"><strong>Overview</strong></span> page, click <span class="strong strong"><strong>View details and history</strong></span>.
									</li><li class="listitem">
										Click the <span class="guibutton">Install cockpit-pcp</span> button.
									</li><li class="listitem">
										In the <span class="strong strong"><strong>Install software</strong></span> dialog window, click <span class="strong strong"><strong>Install</strong></span>.
									</li><li class="listitem">
										Log out and in again to see the metrics history.
									</li></ol></div></li><li class="listitem"><p class="simpara">
								To install the package from the command-line interface, use:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--wqqherv"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>dnf install cockpit-pcp</strong></span></pre></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Enable the PCP service:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7adrowz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl enable --now pmlogger.service pmproxy.service</strong></span></pre></div></div></li><li class="listitem">
						Set up Grafana dashboard. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-a-grafana-server_setting-up-graphical-representation-of-pcp-metrics">Setting up a grafana-server</a>.
					</li><li class="listitem"><p class="simpara">
						Install the <code class="literal">redis</code> package.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--m7krrlc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>dnf install redis</strong></span></pre></div></div><p class="simpara">
						Alternatively, you can install the package from the web console interface later in the procedure.
					</p></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						In the <span class="strong strong"><strong>Overview</strong></span> page, click <span class="strong strong"><strong>View metrics and history</strong></span> in the <span class="strong strong"><strong>Usage</strong></span> table.
					</li><li class="listitem">
						Click the <span class="guibutton">Metrics settings</span> button.
					</li><li class="listitem"><p class="simpara">
						Move the <span class="strong strong"><strong>Export to network</strong></span> slider to active position.
					</p><p class="simpara">
						<span class="inlinemediaobject"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/cockpit-export-to-network-slider.png" alt="Metrics settings"></span>

					</p><p class="simpara">
						If you do not have the <code class="literal">redis</code> package installed, the web console prompts you to install it.
					</p></li><li class="listitem">
						To open the <code class="literal">pmproxy</code> service, select a zone from a drop-down list and click the <span class="guibutton">Add pmproxy</span> button.
					</li><li class="listitem">
						Click <span class="strong strong"><strong>Save</strong></span>.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Click <span class="strong strong"><strong>Networking</strong></span>.
					</li><li class="listitem">
						In the <span class="strong strong"><strong>Firewall</strong></span> table, click the <span class="guibutton">Edit rules and zones</span> button.
					</li><li class="listitem">
						Search for <code class="literal">pmproxy</code> in your selected zone.
					</li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Repeat this procedure on all the systems you want to watch.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#setting-up-pcp-with-pcp-zeroconf_setting-up-graphical-representation-of-pcp-metrics">Setting up graphical representation of PCP metrics</a>
					</li></ul></div></section></section><section class="chapter" id="setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 11. Setting the disk scheduler</h1></div></div></div><p class="_abstract _abstract">
			The disk scheduler is responsible for ordering the I/O requests submitted to a storage device.
		</p><p>
			You can configure the scheduler in several different ways:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Set the scheduler using <span class="strong strong"><strong>TuneD</strong></span>, as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance#setting-the-disk-scheduler-using-tuned_setting-the-disk-scheduler">Setting the disk scheduler using TuneD</a>
				</li><li class="listitem">
					Set the scheduler using <code class="literal">udev</code>, as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance#setting-the-disk-scheduler-using-udev-rules_setting-the-disk-scheduler">Setting the disk scheduler using udev rules</a>
				</li><li class="listitem">
					Temporarily change the scheduler on a running system, as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance#temporarily-setting-a-scheduler-for-a-specific-disk_setting-the-disk-scheduler">Temporarily setting a scheduler for a specific disk</a>
				</li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				In Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9, block devices support 
only multi-queue scheduling. This enables the block layer performance to
 scale well with fast solid-state drives (SSDs) and multi-core systems.
			</p><p>
				The traditional, single-queue schedulers, which were available in 
Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;7 and earlier versions, have 
been removed.
			</p></div></div><section class="section" id="available-disk-schedulers_setting-the-disk-scheduler"><div class="titlepage"><div><div><h2 class="title">11.1. Available disk schedulers</h2></div></div></div><p class="_abstract _abstract">
				The following multi-queue disk schedulers are supported in Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">none</code></span></dt><dd>
							Implements a first-in first-out (FIFO) scheduling algorithm. It 
merges requests at the generic block layer through a simple last-hit 
cache.
						</dd><dt><span class="term"><code class="literal">mq-deadline</code></span></dt><dd><p class="simpara">
							Attempts to provide a guaranteed latency for requests from the point at which requests reach the scheduler.
						</p><p class="simpara">
							The <code class="literal">mq-deadline</code> scheduler sorts 
queued I/O requests into a read or write batch and then schedules them 
for execution in increasing logical block addressing (LBA) order. By 
default, read batches take precedence over write batches, because 
applications are more likely to block on read I/O operations. After <code class="literal">mq-deadline</code>
 processes a batch, it checks how long write operations have been 
starved of processor time and schedules the next read or write batch as 
appropriate.
						</p><p class="simpara">
							This scheduler is suitable for most use cases, but particularly 
those in which the write operations are mostly asynchronous.
						</p></dd><dt><span class="term"><code class="literal">bfq</code></span></dt><dd><p class="simpara">
							Targets desktop systems and interactive tasks.
						</p><p class="simpara">
							The <code class="literal">bfq</code> scheduler ensures that a 
single application is never using all of the bandwidth. In effect, the 
storage device is always as responsive as if it was idle. In its default
 configuration, <code class="literal">bfq</code> focuses on delivering the lowest latency rather than achieving the maximum throughput.
						</p><p class="simpara">
							<code class="literal">bfq</code> is based on <code class="literal">cfq</code> code. It does not grant the disk to each process for a fixed time slice but assigns a <span class="emphasis"><em>budget</em></span> measured in number of sectors to the process.
						</p><p class="simpara">
							This scheduler is suitable while copying large files and the system does not become unresponsive in this case.
						</p></dd><dt><span class="term"><code class="literal">kyber</code></span></dt><dd><p class="simpara">
							The scheduler tunes itself to achieve a latency goal by 
calculating the latencies of every I/O request submitted to the block 
I/O layer. You can configure the target latencies for read, in the case 
of cache-misses, and synchronous write requests.
						</p><p class="simpara">
							This scheduler is suitable for fast devices, for example NVMe, SSD, or other low latency devices.
						</p></dd></dl></div></section><section class="section" id="different-disk-schedulers-for-different-use-cases_setting-the-disk-scheduler"><div class="titlepage"><div><div><h2 class="title">11.2. Different disk schedulers for different use cases</h2></div></div></div><p class="_abstract _abstract">
				Depending on the task that your system performs, the following disk 
schedulers are recommended as a baseline prior to any analysis and 
tuning tasks:
			</p><div class="table" id="idm140611480585104"><p class="title">Table 11.1. Disk schedulers for different use cases</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="48r7rua" id="rh-table--48r7rua"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><thead><tr><th id="idm140611483117376" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Use case</th><th id="idm140611483116288" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Disk scheduler</th></tr></thead><tbody><tr><td headers="idm140611483117376" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								Traditional HDD with a SCSI interface
							</p>
							 </td><td headers="idm140611483116288" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								Use <code class="literal">mq-deadline</code> or <code class="literal">bfq</code>.
							</p>
							 </td></tr><tr><td headers="idm140611483117376" data-row="3" data-col="1" class="content--lg" valign="top" align="left"> <p>
								High-performance SSD or a CPU-bound system with fast storage
							</p>
							 </td><td headers="idm140611483116288" data-row="3" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Use <code class="literal">none</code>, especially when running enterprise applications. Alternatively, use <code class="literal">kyber</code>.
							</p>
							 </td></tr><tr><td headers="idm140611483117376" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								Desktop or interactive tasks
							</p>
							 </td><td headers="idm140611483116288" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								Use <code class="literal">bfq</code>.
							</p>
							 </td></tr><tr><td headers="idm140611483117376" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								Virtual guest
							</p>
							 </td><td headers="idm140611483116288" data-row="5" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Use <code class="literal">mq-deadline</code>. With a host bus adapter (HBA) driver that is multi-queue capable, use <code class="literal">none</code>.
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="the-default-disk-scheduler_setting-the-disk-scheduler"><div class="titlepage"><div><div><h2 class="title">11.3. The default disk scheduler</h2></div></div></div><p class="_abstract _abstract">
				Block devices use the default disk scheduler unless you specify another scheduler.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					For <code class="literal">non-volatile Memory Express (NVMe)</code> block devices specifically, the default scheduler is <code class="literal">none</code> and Red&nbsp;Hat recommends not changing this.
				</p></div></div><p>
				The kernel selects a default disk scheduler based on the type of 
device. The automatically selected scheduler is typically the optimal 
setting. If you require a different scheduler, Red&nbsp;Hat recommends 
to use <code class="literal">udev</code> rules or the <span class="strong strong"><strong>TuneD</strong></span> application to configure it. Match the selected devices and switch the scheduler only for those devices.
			</p></section><section class="section" id="determining-the-active-disk-scheduler_setting-the-disk-scheduler"><div class="titlepage"><div><div><h2 class="title">11.4. Determining the active disk scheduler</h2></div></div></div><p class="_abstract _abstract">
				This procedure determines which disk scheduler is currently active on a given block device.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Read the content of the <code class="literal">/sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--vhb0vdj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cat /sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler

[mq-deadline] kyber bfq none</pre></div></div><p class="simpara">
						In the file name, replace <span class="emphasis"><em>device</em></span> with the block device name, for example <code class="literal">sdc</code>.
					</p><p class="simpara">
						The active scheduler is listed in square brackets (<code class="literal">[ ]</code>).
					</p></li></ul></div></section><section class="section" id="setting-the-disk-scheduler-using-tuned_setting-the-disk-scheduler"><div class="titlepage"><div><div><h2 class="title">11.5. Setting the disk scheduler using TuneD</h2></div></div></div><p class="_abstract _abstract">
				This procedure creates and enables a <span class="strong strong"><strong>TuneD</strong></span> profile that sets a given disk scheduler for selected block devices. The setting persists across system reboots.
			</p><p>
				In the following commands and configuration, replace:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="emphasis"><em>device</em></span> with the name of the block device, for example <code class="literal">sdf</code>
					</li><li class="listitem">
						<span class="emphasis"><em>selected-scheduler</em></span> with the disk scheduler that you want to set for the device, for example <code class="literal">bfq</code>
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">TuneD</code> service is installed and enabled. For details, see <a class="link" href="#installing-and-enabling-tuned_getting-started-with-tuned" title="1.13.&nbsp;Installing and enabling TuneD">Installing and enabling TuneD</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Optional: Select an existing <span class="strong strong"><strong>TuneD</strong></span> profile on which your profile will be based. For a list of available profiles, see <a class="link" href="#tuned-profiles-distributed-with-rhel_getting-started-with-tuned" title="1.6.&nbsp;TuneD profiles distributed with RHEL">TuneD profiles distributed with RHEL</a>.
					</p><p class="simpara">
						To see which profile is currently active, use:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--tszx3rj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm active</pre></div></div></li><li class="listitem"><p class="simpara">
						Create a new directory to hold your <span class="strong strong"><strong>TuneD</strong></span> profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mtwsino"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># mkdir /etc/tuned/<span class="emphasis"><em>my-profile</em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Find the system unique identifier of the selected block device:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--dqovoi9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ udevadm info --query=property --name=/dev/<span class="emphasis"><em>device</em></span> | grep -E '(WWN|SERIAL)'

ID_WWN=<span class="emphasis"><em>0x5002538d00000000_</em></span>
ID_SERIAL=<span class="emphasis"><em>Generic-_SD_MMC_20120501030900000-0:0</em></span>
ID_SERIAL_SHORT=<span class="emphasis"><em>20120501030900000</em></span></pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The command in the this example will return all values identified
 as a World Wide Name (WWN) or serial number associated with the 
specified block device. Although it is preferred to use a WWN, the WWN 
is not always available for a given device and any values returned by 
the example command are acceptable to use as the <span class="emphasis"><em>device system unique ID</em></span>.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Create the <code class="literal">/etc/tuned/<span class="emphasis"><em>my-profile</em></span>/tuned.conf</code> configuration file. In the file, set the following options:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Optional: Include an existing profile:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3b3lrur"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[main]
include=<span class="emphasis"><em>existing-profile</em></span></pre></div></div></li><li class="listitem"><p class="simpara">
								Set the selected disk scheduler for the device that matches the WWN identifier:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xusrhqy"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">[disk]
devices_udev_regex=<span class="emphasis"><em>IDNAME</em></span>=<span class="emphasis"><em>device system unique id</em></span>
elevator=<span class="emphasis"><em>selected-scheduler</em></span></pre></div></div><p class="simpara">
								Here:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										Replace <span class="emphasis"><em>IDNAME</em></span> with the name of the identifier being used (for example, <code class="literal">ID_WWN</code>).
									</li><li class="listitem"><p class="simpara">
										Replace <span class="emphasis"><em>device system unique id</em></span> with the value of the chosen identifier (for example, <code class="literal">0x5002538d00000000</code>).
									</p><p class="simpara">
										To match multiple devices in the <code class="literal">devices_udev_regex</code> option, enclose the identifiers in parentheses and separate them with vertical bars:
									</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6rlrkp0"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">devices_udev_regex=(ID_WWN=<span class="emphasis"><em>0x5002538d00000000</em></span>)|(ID_WWN=<span class="emphasis"><em>0x1234567800000000</em></span>)</pre></div></div></li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
						Enable your profile:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jpc1vcv"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># tuned-adm profile <span class="emphasis"><em>my-profile</em></span></pre></div></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification steps</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Verify that the TuneD profile is active and applied:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--htrtqff"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm active

Current active profile: <span class="emphasis"><em>my-profile</em></span></pre></div></div><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ntysuf9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ tuned-adm verify

Verification succeeded, current system settings match the preset profile.
See TuneD log file ('/var/log/tuned/tuned.log') for details.</pre></div></div></li><li class="listitem"><p class="simpara">
						Read the contents of the <code class="literal">/sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fxl2t9o"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cat /sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler

[mq-deadline] kyber bfq none</pre></div></div><p class="simpara">
						In the file name, replace <span class="emphasis"><em>device</em></span> with the block device name, for example <code class="literal">sdc</code>.
					</p><p class="simpara">
						The active scheduler is listed in square brackets (<code class="literal">[]</code>).
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance" title="Chapter&nbsp;2.&nbsp;Customizing TuneD profiles">Customizing TuneD profiles</a>.
					</li></ul></div></section><section class="section" id="setting-the-disk-scheduler-using-udev-rules_setting-the-disk-scheduler"><div class="titlepage"><div><div><h2 class="title">11.6. Setting the disk scheduler using udev rules</h2></div></div></div><p class="_abstract _abstract">
				This procedure sets a given disk scheduler for specific block devices using <code class="literal">udev</code> rules. The setting persists across system reboots.
			</p><p>
				In the following commands and configuration, replace:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="emphasis"><em>device</em></span> with the name of the block device, for example <code class="literal">sdf</code>
					</li><li class="listitem">
						<span class="emphasis"><em>selected-scheduler</em></span> with the disk scheduler that you want to set for the device, for example <code class="literal">bfq</code>
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Find the system unique identifier of the block device:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zxt1y1y"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ udevadm info --name=/dev/<span class="emphasis"><em>device</em></span> | grep -E '(WWN|SERIAL)'
E: ID_WWN=<span class="emphasis"><em>0x5002538d00000000</em></span>
E: ID_SERIAL=<span class="emphasis"><em>Generic-_SD_MMC_20120501030900000-0:0</em></span>
E: ID_SERIAL_SHORT=<span class="emphasis"><em>20120501030900000</em></span></pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The command in the this example will return all values identified
 as a World Wide Name (WWN) or serial number associated with the 
specified block device. Although it is preferred to use a WWN, the WWN 
is not always available for a given device and any values returned by 
the example command are acceptable to use as the <span class="emphasis"><em>device system unique ID</em></span>.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Configure the <code class="literal">udev</code> rule. Create the <code class="literal">/etc/udev/rules.d/99-scheduler.rules</code> file with the following content:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8gb5pqf"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">ACTION=="add|change", SUBSYSTEM=="block", ENV{<span class="emphasis"><em>IDNAME</em></span>}=="<span class="emphasis"><em>device system unique id</em></span>", ATTR{queue/scheduler}="<span class="emphasis"><em>selected-scheduler</em></span>"</pre></div></div><p class="simpara">
						Here:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								Replace <span class="emphasis"><em>IDNAME</em></span> with the name of the identifier being used (for example, <code class="literal">ID_WWN</code>).
							</li><li class="listitem">
								Replace <span class="emphasis"><em>device system unique id</em></span> with the value of the chosen identifier (for example, <code class="literal">0x5002538d00000000</code>).
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Reload <code class="literal">udev</code> rules:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l7sllt4"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># udevadm control --reload-rules</pre></div></div></li><li class="listitem"><p class="simpara">
						Apply the scheduler configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gvvv3cy"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># udevadm trigger --type=devices --action=change</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify the active scheduler:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--uooms21"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cat /sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler</pre></div></div></li></ul></div></section><section class="section" id="temporarily-setting-a-scheduler-for-a-specific-disk_setting-the-disk-scheduler"><div class="titlepage"><div><div><h2 class="title">11.7. Temporarily setting a scheduler for a specific disk</h2></div></div></div><p class="_abstract _abstract">
				This procedure sets a given disk scheduler for specific block devices. The setting does not persist across system reboots.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Write the name of the selected scheduler to the <code class="literal">/sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ewdff0s"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># echo <span class="emphasis"><em>selected-scheduler</em></span> &gt; /sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler</pre></div></div><p class="simpara">
						In the file name, replace <span class="emphasis"><em>device</em></span> with the block device name, for example <code class="literal">sdc</code>.
					</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify that the scheduler is active on the device:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--1su7ny5"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cat /sys/block/<span class="emphasis"><em>device</em></span>/queue/scheduler</pre></div></div></li></ul></div></section></section><section class="chapter" id="assembly_tuning-the-performance-of-a-samba-server_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 12. Tuning the performance of a Samba server</h1></div></div></div><p class="_abstract _abstract">
			Learn what settings can improve the performance of Samba in certain 
situations, and which settings can have a negative performance impact.
		</p><p>
			Parts of this section were adopted from the <a class="link" href="https://wiki.samba.org/index.php/Performance_Tuning">Performance Tuning</a> documentation published in the Samba Wiki. License: <a class="link" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Authors and contributors: See the <a class="link" href="https://wiki.samba.org/index.php?title=Performance_Tuning&amp;action=history">history</a> tab on the Wiki page.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					Samba is set up as a file or print server
				</li></ul></div><section class="section" id="proc_setting-the-smb-protocol-version_assembly_tuning-the-performance-of-a-samba-server"><div class="titlepage"><div><div><h2 class="title">12.1. Setting the SMB protocol version</h2></div></div></div><p class="_abstract _abstract">
				Each new SMB version adds features and improves the performance of 
the protocol. The recent Windows and Windows Server operating systems 
always supports the latest protocol version. If Samba also uses the 
latest protocol version, Windows clients connecting to Samba benefit 
from the performance improvements. In Samba, the default value of the 
server max protocol is set to the latest supported stable SMB protocol 
version.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					To always have the latest stable SMB protocol version enabled, do not set the <code class="literal">server max protocol</code>
 parameter. If you set the parameter manually, you will need to modify 
the setting with each new version of the SMB protocol, to have the 
latest protocol version enabled.
				</p></div></div><p>
				The following procedure explains how to use the default value in the <code class="literal">server max protocol</code> parameter.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Remove the <code class="literal">server max protocol</code> parameter from the <code class="literal">[global]</code> section in the <code class="literal filename">/etc/samba/smb.conf</code> file.
					</li><li class="listitem"><p class="simpara">
						Reload the Samba configuration
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--h17sa9d"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># <span class="strong strong"><strong>smbcontrol all reload-config</strong></span></pre></div></div></li></ol></div></section><section class="section" id="proc_tuning-shares-with-directories-that-contain-a-large-number-of-files_assembly_tuning-the-performance-of-a-samba-server"><div class="titlepage"><div><div><h2 class="title">12.2. Tuning shares with directories that contain a large number of files</h2></div></div></div><p class="_abstract _abstract">
				Linux supports case-sensitive file names. For this reason, Samba 
needs to scan directories for uppercase and lowercase file names when 
searching or accessing a file. You can configure a share to create new 
files only in lowercase or uppercase, which improves the performance.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Samba is configured as a file server
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Rename all files on the share to lowercase.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							Using the settings in this procedure, files with names other than in lowercase will no longer be displayed.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Set the following parameters in the share’s section:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ws15q9n"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">case sensitive = true
default case = lower
preserve case = no
short preserve case = no</pre></div></div><p class="simpara">
						For details about the parameters, see their descriptions in the <code class="literal">smb.conf(5)</code> man page.
					</p></li><li class="listitem"><p class="simpara">
						Verify the <code class="literal filename">/etc/samba/smb.conf</code> file:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--hrik0eh"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># <span class="strong strong"><strong>testparm</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Reload the Samba configuration:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6mvoyel"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># <span class="strong strong"><strong>smbcontrol all reload-config</strong></span></pre></div></div></li></ol></div><p>
				After you applied these settings, the names of all newly created 
files on this share use lowercase. Because of these settings, Samba no 
longer needs to scan the directory for uppercase and lowercase, which 
improves the performance.
			</p></section><section class="section" id="con_settings-that-can-have-a-negative-performance-impact_assembly_tuning-the-performance-of-a-samba-server"><div class="titlepage"><div><div><h2 class="title">12.3. Settings that can have a negative performance impact</h2></div></div></div><p class="_abstract _abstract">
				By default, the kernel in Red&nbsp;Hat Enterprise&nbsp;Linux is 
tuned for high network performance. For example, the kernel uses an 
auto-tuning mechanism for buffer sizes. Setting the <code class="literal">socket options</code> parameter in the <code class="literal filename">/etc/samba/smb.conf</code>
 file overrides these kernel settings. As a result, setting this 
parameter decreases the Samba network performance in most cases.
			</p><p>
				To use the optimized settings from the Kernel, remove the <code class="literal">socket options</code> parameter from the <code class="literal">[global]</code> section in the <code class="literal filename">/etc/samba/smb.conf</code>.
			</p></section></section><section class="chapter" id="optimizing-virtual-machine-performance-in-rhel_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 13. Optimizing virtual machine performance</h1></div></div></div><p>
			Virtual machines (VMs) always experience some degree of performance 
deterioration in comparison to the host. The following sections explain 
the reasons for this deterioration and provide instructions on how to 
minimize the performance impact of virtualization in RHEL 9, so that 
your hardware infrastructure resources can be used as efficiently as 
possible.
		</p><section class="section" id="what-influences-virtual-machine-performance_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.1. What influences virtual machine performance</h2></div></div></div><p>
				VMs are run as user-space processes on the host. The hypervisor 
therefore needs to convert the host’s system resources so that the VMs 
can use them. As a consequence, a portion of the resources is consumed 
by the conversion, and the VM therefore cannot achieve the same 
performance efficiency as the host.
			</p><h4 id="the_impact_of_virtualization_on_system_performance">The impact of virtualization on system performance</h4><p>
				More specific reasons for VM performance loss include:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Virtual CPUs (vCPUs) are implemented as threads on the host, handled by the Linux scheduler.
					</li><li class="listitem">
						VMs do not automatically inherit optimization features, such as NUMA or huge pages, from the host kernel.
					</li><li class="listitem">
						Disk and network I/O settings of the host might have a significant performance impact on the VM.
					</li><li class="listitem">
						Network traffic typically travels to a VM through a software-based bridge.
					</li><li class="listitem">
						Depending on the host devices and their models, there might be 
significant overhead due to emulation of particular hardware.
					</li></ul></div><p>
				The severity of the virtualization impact on the VM performance is influenced by a variety factors, which include:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The number of concurrently running VMs.
					</li><li class="listitem">
						The amount of virtual devices used by each VM.
					</li><li class="listitem">
						The device types used by the VMs.
					</li></ul></div><h4 id="reducing_vm_performance_loss">Reducing VM performance loss</h4><p>
				RHEL 9 provides a number of features you can use to reduce the negative performance effects of virtualization. Notably:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="#optimizing-virtual-machine-performance-using-tuned_optimizing-virtual-machine-performance-in-rhel" title="13.2.&nbsp;Optimizing virtual machine performance using TuneD">The <code class="literal">TuneD</code> service</a> can automatically optimize the resource distribution and performance of your VMs.
					</li><li class="listitem">
						<a class="link" href="#optimizing-virtual-machine-i-o-performance_optimizing-virtual-machine-performance-in-rhel" title="13.5.&nbsp;Optimizing virtual machine I/O performance">Block I/O tuning</a> can improve the performances of the VM’s block devices, such as disks.
					</li><li class="listitem">
						<a class="link" href="#optimizing-virtual-machine-cpu-performance_optimizing-virtual-machine-performance-in-rhel" title="13.6.&nbsp;Optimizing virtual machine CPU performance">NUMA tuning</a> can increase vCPU performance.
					</li><li class="listitem">
						<a class="link" href="#optimizing-virtual-machine-network-performance_optimizing-virtual-machine-performance-in-rhel" title="13.7.&nbsp;Optimizing virtual machine network performance">Virtual networking</a> can be optimized in various ways.
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Tuning VM performance can have adverse effects on other 
virtualization functions. For example, it can make migrating the 
modified VM more difficult.
				</p></div></div></section><section class="section" id="optimizing-virtual-machine-performance-using-tuned_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.2. Optimizing virtual machine performance using TuneD</h2></div></div></div><p>
				The <code class="literal">TuneD</code> utility is a tuning profile 
delivery mechanism that adapts RHEL for certain workload 
characteristics, such as requirements for CPU-intensive tasks or 
storage-network throughput responsiveness. It provides a number of 
tuning profiles that are pre-configured to enhance performance and 
reduce power consumption in a number of specific use cases. You can edit
 these profiles or create new profiles to create performance solutions 
tailored to your environment, including virtualized environments.
			</p><p>
				To optimize RHEL&nbsp;9 for virtualization, use the following profiles:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						For RHEL&nbsp;9 virtual machines, use the <span class="strong strong"><strong>virtual-guest</strong></span> profile. It is based on the generally applicable <code class="literal"><span class="emphasis"><em>throughput-performance</em></span></code> profile, but also decreases the swappiness of virtual memory.
					</li><li class="listitem">
						For RHEL&nbsp;9 virtualization hosts, use the <span class="strong strong"><strong>virtual-host</strong></span> profile. This enables more aggressive writeback of dirty memory pages, which benefits the host performance.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">TuneD</code> service is <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-tuned_monitoring-and-managing-system-status-and-performance#installing-and-enabling-tuned_getting-started-with-tuned">installed and enabled</a>.
					</li></ul></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					To enable a specific <code class="literal">TuneD</code> profile:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						List the available <code class="literal">TuneD</code> profiles.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--358alnw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>tuned-adm list</strong></span>

Available profiles:
- balanced             - General non-specialized TuneD profile
- desktop              - Optimize for the desktop use-case
[...]
- virtual-guest        - Optimize for running inside a virtual guest
- virtual-host         - Optimize for running KVM guests
Current active profile: <span class="emphasis"><em>balanced</em></span></pre></div></div></li><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Optional:</strong></span> Create a new <code class="literal">TuneD</code> profile or edit an existing <code class="literal">TuneD</code> profile.
					</p><p class="simpara">
						For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance">Customizing TuneD profiles</a>.
					</p></li><li class="listitem"><p class="simpara">
						Activate a <code class="literal">TuneD</code> profile.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--d56jntw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>tuned-adm profile <span class="emphasis"><em>selected-profile</em></span></strong></span></pre></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								To optimize a virtualization host, use the <span class="emphasis"><em>virtual-host</em></span> profile.
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3wo9581"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>tuned-adm profile virtual-host</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
								On a RHEL guest operating system, use the <span class="emphasis"><em>virtual-guest</em></span> profile.
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--9kmrgub"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>tuned-adm profile virtual-guest</strong></span></pre></div></div></li></ul></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/">Monitoring and managing system status and performance</a>
					</li></ul></div></section><section class="section" id="assembly_optimizing-libvirt-daemons_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.3. Optimizing libvirt daemons</h2></div></div></div><p>
				The <code class="literal">libvirt</code> virtualization suite works as a management layer for the RHEL hypervisor, and your <code class="literal">libvirt</code> configuration significantly impacts your virtualization host. Notably, RHEL 9 contains two different types of <code class="literal">libvirt</code>
 daemons, monolithic or modular, and which type of daemons you use 
affects how granularly you can configure individual virtualization 
drivers.
			</p><section class="section" id="con_types-of-libvirt-daemons_assembly_optimizing-libvirt-daemons"><div class="titlepage"><div><div><h3 class="title">13.3.1. Types of libvirt daemons</h3></div></div></div><p>
					RHEL 9 supports the following <code class="literal">libvirt</code> daemon types:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Monolithic libvirt</span></dt><dd><p class="simpara">
								The traditional <code class="literal">libvirt</code> daemon, <code class="literal">libvirtd</code>, controls a wide variety of virtualization drivers, using a single configuration file - <code class="literal">/etc/libvirt/libvirtd.conf</code>.
							</p><p class="simpara">
								As such, <code class="literal">libvirtd</code> allows for centralized hypervisor configuration, but may use system resources inefficiently. Therefore, <code class="literal">libvirtd</code> will become unsupported in a future major release of RHEL.
							</p><p class="simpara">
								However, if you updated to RHEL 9 from RHEL 8, your host still uses <code class="literal">libvirtd</code> by default.
							</p></dd><dt><span class="term">Modular libvirt</span></dt><dd><p class="simpara">
								Newly introduced in RHEL 9, modular <code class="literal">libvirt</code> provides a specific daemon for each virtualization driver. These include the following:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
										<span class="strong strong"><strong>virtqemud</strong></span> - A primary daemon for hypervisor management
									</li><li class="listitem">
										<span class="strong strong"><strong>virtinterfaced</strong></span> - A secondary daemon for host NIC management
									</li><li class="listitem">
										<span class="strong strong"><strong>virtnetworkd</strong></span> - A secondary daemon for virtual network management
									</li><li class="listitem">
										<span class="strong strong"><strong>virtnodedevd</strong></span> - A secondary daemon for host physical device management
									</li><li class="listitem">
										<span class="strong strong"><strong>virtnwfilterd</strong></span> - A secondary daemon for host firewall management
									</li><li class="listitem">
										<span class="strong strong"><strong>virtsecretd</strong></span> - A secondary daemon for host secret management
									</li><li class="listitem">
										<span class="strong strong"><strong>virtstoraged</strong></span> - A secondary daemon for storage management
									</li></ul></div><p class="simpara">
								Each of the daemons has a separate configuration file - for example <code class="literal">/etc/libvirt/virtqemud.conf</code>. As such, modular <code class="literal">libvirt</code> daemons provide better options for fine-tuning <code class="literal">libvirt</code> resource management.
							</p><p class="simpara">
								If you performed a fresh install of RHEL 9, modular <code class="literal">libvirt</code> is configured by default.
							</p></dd></dl></div><div class="itemizedlist"><p class="title"><strong>Next steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							If your RHEL 9 uses <code class="literal">libvirtd</code>, Red Hat recommends switching to modular daemons. For instructions, see <a class="link" href="#proc_enabling-modular-libvirt-daemons_assembly_optimizing-libvirt-daemons" title="13.3.2.&nbsp;Enabling modular libvirt daemons">Enabling modular libvirt daemons</a>.
						</li></ul></div></section><section class="section" id="proc_enabling-modular-libvirt-daemons_assembly_optimizing-libvirt-daemons"><div class="titlepage"><div><div><h3 class="title">13.3.2. Enabling modular libvirt daemons</h3></div></div></div><p>
					In RHEL 9, the <code class="literal">libvirt</code> library uses modular daemons that handle individual virtualization driver sets on your host. For example, the <code class="literal">virtqemud</code> daemon handles QEMU drivers.
				</p><p>
					If you performed a fresh install of a RHEL 9 host, your hypervisor uses modular <code class="literal">libvirt</code> daemons by default. However, if you upgraded your host from RHEL 8 to RHEL 9, your hypervisor uses the monolithic <code class="literal">libvirtd</code> daemon, which is the default in RHEL 8.
				</p><p>
					If that is the case, Red&nbsp;Hat recommends enabling the modular <code class="literal">libvirt</code> daemons instead, because they provide better options for fine-tuning <code class="literal">libvirt</code> resource management. In addition, <code class="literal">libvirtd</code> will become unsupported in a future major release of RHEL.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Your hypervisor is using the monolithic <code class="literal">libvirtd</code> service.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--kg30tf9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl is-active libvirtd.service</strong></span>
active</pre></div></div><p class="simpara">
							If this command displays <code class="literal">active</code>, you are using <code class="literal">libvirtd</code>.
						</p></li><li class="listitem">
							Your virtual machines are shut down.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Stop <code class="literal">libvirtd</code> and its sockets.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--i0l6caa"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl stop libvirtd.service</strong></span>
# <span class="strong strong"><strong>systemctl stop libvirtd{,-ro,-admin,-tcp,-tls}.socket</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Disable <code class="literal">libvirtd</code> to prevent it from starting on boot.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ko0us0z"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ <span class="strong strong"><strong>systemctl disable libvirtd.service</strong></span>
$ <span class="strong strong"><strong>systemctl disable libvirtd{,-ro,-admin,-tcp,-tls}.socket</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Enable the modular <code class="literal">libvirt</code> daemons.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--vhsw0uq"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>for drv in qemu interface network nodedev nwfilter secret storage; do systemctl unmask virt${drv}d.service; systemctl unmask virt${drv}d{,-ro,-admin}.socket; systemctl enable virt${drv}d.service; systemctl enable virt${drv}d{,-ro,-admin}.socket; done</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Start the sockets for the modular daemons.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zs3idgj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>for drv in qemu network nodedev nwfilter secret storage; do systemctl start virt${drv}d{,-ro,-admin}.socket; done</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Optional:</strong></span> If you require connecting to your host from remote hosts, enable and start the virtualization proxy daemon.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Check whether the <code class="literal">libvirtd-tls.socket</code> service is enabled on your system.
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--78drrw4"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>cat /etc/libvirt/libvirt.conf | grep listen_tls</strong></span>

listen_tls = 0</pre></div></div></li><li class="listitem"><p class="simpara">
									If <code class="literal">libvirtd-tls.socket</code> is not enabled (<code class="literal">listen_tls = 0</code>), activate <code class="literal">virtproxyd</code> as follows:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--p7pvj10"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl unmask virtproxyd.service</strong></span>
# <span class="strong strong"><strong>systemctl unmask virtproxyd{,-ro,-admin}.socket</strong></span>
# <span class="strong strong"><strong>systemctl enable virtproxyd.service</strong></span>
# <span class="strong strong"><strong>systemctl enable virtproxyd{,-ro,-admin}.socket</strong></span>
# <span class="strong strong"><strong>systemctl start virtproxyd{,-ro,-admin}.socket</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
									If <code class="literal">libvirtd-tls.socket</code> is enabled (<code class="literal">listen_tls = 1</code>), activate <code class="literal">virtproxyd</code> as follows:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2wp8prp"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl unmask virtproxyd.service</strong></span>
# <span class="strong strong"><strong>systemctl unmask virtproxyd{,-ro,-admin,-tls}.socket</strong></span>
# <span class="strong strong"><strong>systemctl enable virtproxyd.service</strong></span>
# <span class="strong strong"><strong>systemctl enable virtproxyd{,-ro,-admin,-tls}.socket</strong></span>
# <span class="strong strong"><strong>systemctl start virtproxyd{,-ro,-admin,-tls}.socket</strong></span></pre></div></div><p class="simpara">
									To enable the TLS socket of <code class="literal">virtproxyd</code>, your host must have TLS certificates configured to work with <code class="literal">libvirt</code>. For more information, see the <a class="link" href="https://libvirt.org/kbase/tlscerts.html">Upstream libvirt documentation</a>.
								</p></li></ol></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Activate the enabled virtualization daemons.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--nfh2hvl"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh uri</strong></span>
qemu:///system</pre></div></div></li><li class="listitem"><p class="simpara">
							Verify that your host is using the <code class="literal">virtqemud</code> modular daemon.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l581vum"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl is-active virtqemud.service</strong></span>
active</pre></div></div><p class="simpara">
							If the status is <code class="literal">active</code>, you have successfully enabled modular <code class="literal">libvirt</code> daemons.
						</p></li></ol></div></section></section><section class="section" id="configuring-virtual-machine-ram_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.4. Configuring virtual machine memory</h2></div></div></div><p>
				To improve the performance of a virtual machine (VM), you can assign
 additional host RAM to the VM. Similarly, you can decrease the amount 
of memory allocated to a VM so the host memory can be allocated to other
 VMs or tasks.
			</p><p>
				To perform these actions, you can use <a class="link" href="#adding-and-removing-virtual-machine-ram-using-the-web-console_configuring-virtual-machine-ram" title="13.4.1.&nbsp;Adding and removing virtual machine memory using the web console">the web console</a> or <a class="link" href="#adding-and-removing-virtual-machine-ram-using-the-command-line-interface_configuring-virtual-machine-ram" title="13.4.2.&nbsp;Adding and removing virtual machine memory using the command-line interface">the command-line interface</a>.
			</p><section class="section" id="adding-and-removing-virtual-machine-ram-using-the-web-console_configuring-virtual-machine-ram"><div class="titlepage"><div><div><h3 class="title">13.4.1. Adding and removing virtual machine memory using the web console</h3></div></div></div><p>
					To improve the performance of a virtual machine (VM) or to free up 
the host resources it is using, you can use the web console to adjust 
amount of memory allocated to the VM.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The guest OS is running the memory balloon drivers. To verify this is the case:
						</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
									Ensure the VM’s configuration includes the <code class="literal">memballoon</code> device:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--f3c3ucn"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh dumpxml <span class="emphasis"><em>testguest</em></span> | grep memballoon</strong></span>
&lt;memballoon model='virtio'&gt;
    &lt;/memballoon&gt;</pre></div></div><p class="simpara">
									If this commands displays any output and the model is not set to <code class="literal">none</code>, the <code class="literal">memballoon</code> device is present.
								</p></li><li class="listitem"><p class="simpara">
									Ensure the balloon drivers are running in the guest OS.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											In Windows guests, the drivers are installed as a part of the <code class="literal">virtio-win</code> driver package. For instructions, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/installing-and-managing-windows-virtual-machines-on-rhel_configuring-and-managing-virtualization#installing-kvm-paravirtualized-drivers-for-rhel-virtual-machines_optimizing-windows-virtual-machines-on-rhel">Installing paravirtualized KVM drivers for Windows virtual machines</a>.
										</li><li class="listitem">
											In Linux guests, the drivers are generally included by default and activate when the <code class="literal">memballoon</code> device is present.
										</li></ul></div></li></ol></div></li><li class="listitem">
							The web console VM plug-in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/managing-virtual-machines-in-the-web-console_configuring-and-managing-virtualization">is installed on your system</a>.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Optional:</strong></span> 
Obtain the information about the maximum memory and currently used 
memory for a VM. This will serve as a baseline for your changes, and 
also for verification.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--uyzpecf"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh dominfo <span class="emphasis"><em>testguest</em></span></strong></span>
Max memory:     2097152 KiB
Used memory:    2097152 KiB</pre></div></div></li><li class="listitem"><p class="simpara">
							In the <span class="guimenu">Virtual Machines</span> interface, click the VM whose information you want to see.
						</p><p class="simpara">
							A new page opens with an Overview section with basic information 
about the selected VM and a Console section to access the VM’s graphical
 interface.
						</p></li><li class="listitem"><p class="simpara">
							Click <span class="guibutton">edit</span> next to the <code class="literal">Memory</code> line in the Overview pane.
						</p><p class="simpara">
							The <code class="literal">Memory Adjustment</code> dialog appears.
						</p><div class="informalfigure"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/839e2ecc24d24759503df5eeb06e6888/virt-cockpit-memory.png" class="rh_docs--zoom" title="Image displaying the VM memory adjustment dialog box."><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/virt-cockpit-memory.png" alt="Image displaying the VM memory adjustment dialog box." width="540"></a></div></div></li><li class="listitem"><p class="simpara">
							Configure the virtual CPUs for the selected VM.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Maximum allocation</strong></span>
 - Sets the maximum amount of host memory that the VM can use for its 
processes. You can specify the maximum memory when creating the VM or 
increase it later. You can specify memory as multiples of MiB or GiB.
								</p><p class="simpara">
									Adjusting maximum memory allocation is only possible on a shut-off VM.
								</p></li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Current allocation</strong></span>
 - Sets the actual amount of memory allocated to the VM. This value can 
be less than the Maximum allocation but cannot exceed it. You can adjust
 the value to regulate the memory available to the VM for its processes.
 You can specify memory as multiples of MiB or GiB.
								</p><p class="simpara">
									If you do not specify this value, the default allocation is the <span class="strong strong"><strong>Maximum allocation</strong></span> value.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							Click <span class="guibutton">Save</span>.
						</p><p class="simpara">
							The memory allocation of the VM is adjusted.
						</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#adding-and-removing-virtual-machine-ram-using-the-command-line-interface_configuring-virtual-machine-ram">Adding and removing virtual machine memory using the command-line interface</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#optimizing-virtual-machine-cpu-performance_optimizing-virtual-machine-performance-in-rhel">Optimizing virtual machine CPU performance</a>
						</li></ul></div></section><section class="section" id="adding-and-removing-virtual-machine-ram-using-the-command-line-interface_configuring-virtual-machine-ram"><div class="titlepage"><div><div><h3 class="title">13.4.2. Adding and removing virtual machine memory using the command-line interface</h3></div></div></div><p>
					To improve the performance of a virtual machine (VM) or to free up 
the host resources it is using, you can use the CLI to adjust amount of 
memory allocated to the VM.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The guest OS is running the memory balloon drivers. To verify this is the case:
						</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
									Ensure the VM’s configuration includes the <code class="literal">memballoon</code> device:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ichikim"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh dumpxml <span class="emphasis"><em>testguest</em></span> | grep memballoon</strong></span>
&lt;memballoon model='virtio'&gt;
    &lt;/memballoon&gt;</pre></div></div><p class="simpara">
									If this commands displays any output and the model is not set to <code class="literal">none</code>, the <code class="literal">memballoon</code> device is present.
								</p></li><li class="listitem"><p class="simpara">
									Ensure the ballon drivers are running in the guest OS.
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											In Windows guests, the drivers are installed as a part of the <code class="literal">virtio-win</code> driver package. For instructions, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/installing-and-managing-windows-virtual-machines-on-rhel_configuring-and-managing-virtualization#installing-kvm-paravirtualized-drivers-for-rhel-virtual-machines_optimizing-windows-virtual-machines-on-rhel">Installing paravirtualized KVM drivers for Windows virtual machines</a>.
										</li><li class="listitem">
											In Linux guests, the drivers are generally included by default and activate when the <code class="literal">memballoon</code> device is present.
										</li></ul></div></li></ol></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Optional:</strong></span> 
Obtain the information about the maximum memory and currently used 
memory for a VM. This will serve as a baseline for your changes, and 
also for verification.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6ddaspk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh dominfo <span class="emphasis"><em>testguest</em></span></strong></span>
Max memory:     2097152 KiB
Used memory:    2097152 KiB</pre></div></div></li><li class="listitem"><p class="simpara">
							Adjust the maximum memory allocated to a VM. Increasing this 
value improves the performance potential of the VM, and reducing the 
value lowers the performance footprint the VM has on your host. Note 
that this change can only be performed on a shut-off VM, so adjusting a 
running VM requires a reboot to take effect.
						</p><p class="simpara">
							For example, to change the maximum memory that the <span class="emphasis"><em>testguest</em></span> VM can use to 4096 MiB:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fxlk1p3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virt-xml <span class="emphasis"><em>testguest</em></span> --edit --memory memory=4096,currentMemory=4096</strong></span>
Domain 'testguest' defined successfully.
Changes will take effect after the domain is fully powered off.</pre></div></div><p class="simpara">
							To increase the maximum memory of a running VM, you can attach a memory device to the VM. This is also referred to as <span class="strong strong"><strong>memory hot plug</strong></span>. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/managing-virtual-devices_configuring-and-managing-virtualization#attaching-devices-to-virtual-machines_assembly_managing-virtual-devices-using-the-cli">Attaching devices to virtual machines</a>.
						</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
								Removing memory devices from a running VM (also referred as a 
memory hot unplug) is not supported, and highly discouraged by 
Red&nbsp;Hat.
							</p></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Optional:</strong></span> You
 can also adjust the memory currently used by the VM, up to the maximum 
allocation. This regulates the memory load that the VM has on the host 
until the next reboot, without changing the maximum VM allocation.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ty61zf9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh setmem <span class="emphasis"><em>testguest</em></span> --current 2048</strong></span></pre></div></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Confirm that the memory used by the VM has been updated:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--vio7wsi"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh dominfo <span class="emphasis"><em>testguest</em></span></strong></span>
Max memory:     4194304 KiB
Used memory:    2097152 KiB</pre></div></div></li><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Optional:</strong></span> If 
you adjusted the current VM memory, you can obtain the memory balloon 
statistics of the VM to evaluate how effectively it regulates its memory
 use.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--a52uhqb"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"> # <span class="strong strong"><strong>virsh domstats --balloon <span class="emphasis"><em>testguest</em></span></strong></span>
Domain: 'testguest'
  balloon.current=365624
  balloon.maximum=4194304
  balloon.swap_in=0
  balloon.swap_out=0
  balloon.major_fault=306
  balloon.minor_fault=156117
  balloon.unused=3834448
  balloon.available=4035008
  balloon.usable=3746340
  balloon.last-update=1587971682
  balloon.disk_caches=75444
  balloon.hugetlb_pgalloc=0
  balloon.hugetlb_pgfail=0
  balloon.rss=1005456</pre></div></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#adding-and-removing-virtual-machine-ram-using-the-web-console_configuring-virtual-machine-ram">Adding and removing virtual machine memory using the web console</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#optimizing-virtual-machine-cpu-performance_optimizing-virtual-machine-performance-in-rhel">Optimizing virtual machine CPU performance</a>
						</li></ul></div></section><section class="section _additional-resources" id="additional_resources"><div class="titlepage"><div><div><h3 class="title">13.4.3. ADDITIONAL RESOURCES</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Attaching devices to virtual machines <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/managing-virtual-devices_configuring-and-managing-virtualization#attaching-devices-to-virtual-machines_assembly_managing-virtual-devices-using-the-cli">Attaching devices to virtual machines</a>.
						</li></ul></div></section></section><section class="section" id="optimizing-virtual-machine-i-o-performance_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.5. Optimizing virtual machine I/O performance</h2></div></div></div><p>
				The input and output (I/O) capabilities of a virtual machine (VM) 
can significantly limit the VM’s overall efficiency. To address this, 
you can optimize a VM’s I/O by configuring block I/O parameters.
			</p><section class="section" id="tuning-block-i-o-in-virtual-machines_optimizing-virtual-machine-i-o-performance"><div class="titlepage"><div><div><h3 class="title">13.5.1. Tuning block I/O in virtual machines</h3></div></div></div><p>
					When multiple block devices are being used by one or more VMs, it 
might be important to adjust the I/O priority of specific virtual 
devices by modifying their <span class="emphasis"><em>I/O weights</em></span>.
				</p><p>
					Increasing the I/O weight of a device increases its priority for 
I/O bandwidth, and therefore provides it with more host resources. 
Similarly, reducing a device’s weight makes it consume less host 
resources.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Each device’s <code class="literal">weight</code> value must be within the <code class="literal">100</code> to <code class="literal">1000</code> range. Alternatively, the value can be <code class="literal">0</code>, which removes that device from per-device listings.
					</p></div></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
						To display and set a VM’s block I/O parameters:
					</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the current <code class="literal">&lt;blkio&gt;</code> parameters for a VM:
						</p><p class="simpara">
							<code class="literal"># <span class="strong strong"><strong>virsh dumpxml <span class="emphasis"><em>VM-name</em></span></strong></span></code>
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--io9jlhe"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>domain</span><span class="token punctuation">&gt;</span></span>
  [...]
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blkiotune</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>weight</span><span class="token punctuation">&gt;</span></span>800<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>weight</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>device</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">&gt;</span></span>/dev/sda<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>weight</span><span class="token punctuation">&gt;</span></span>1000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>weight</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>device</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>device</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">&gt;</span></span>/dev/sdb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>weight</span><span class="token punctuation">&gt;</span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>weight</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>device</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>blkiotune</span><span class="token punctuation">&gt;</span></span>
  [...]
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>domain</span><span class="token punctuation">&gt;</span></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Edit the I/O weight of a specified device:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--lqayc32"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh blkiotune <span class="emphasis"><em>VM-name</em></span> --device-weights <span class="emphasis"><em>device</em></span>, <span class="emphasis"><em>I/O-weight</em></span></strong></span></pre></div></div><p class="simpara">
							For example, the following changes the weight of the <span class="emphasis"><em>/dev/sda</em></span> device in the <span class="emphasis"><em>liftrul</em></span> VM to 500.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5s94ukg"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh blkiotune liftbrul --device-weights /dev/sda, 500</strong></span></pre></div></div></li></ol></div></section><section class="section" id="disk-i-o-throttling-in-virtual-machines_optimizing-virtual-machine-i-o-performance"><div class="titlepage"><div><div><h3 class="title">13.5.2. Disk I/O throttling in virtual machines</h3></div></div></div><p>
					When several VMs are running simultaneously, they can interfere 
with system performance by using excessive disk I/O. Disk I/O throttling
 in KVM virtualization provides the ability to set a limit on disk I/O 
requests sent from the VMs to the host machine. This can prevent a VM 
from over-utilizing shared resources and impacting the performance of 
other VMs.
				</p><p>
					To enable disk I/O throttling, set a limit on disk I/O requests 
sent from each block device attached to VMs to the host machine.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Use the <code class="literal">virsh domblklist</code> command to list the names of all the disk devices on a specified VM.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--du0nid2"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh domblklist rollin-coal</strong></span>
Target     Source
------------------------------------------------
vda        /var/lib/libvirt/images/rollin-coal.qcow2
sda        -
sdb        /home/horridly-demanding-processes.iso</pre></div></div></li><li class="listitem"><p class="simpara">
							Find the host block device where the virtual disk that you want to throttle is mounted.
						</p><p class="simpara">
							For example, if you want to throttle the <code class="literal">sdb</code> virtual disk from the previous step, the following output shows that the disk is mounted on the <code class="literal">/dev/nvme0n1p3</code> partition.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--c2n5aye"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ <span class="strong strong"><strong>lsblk</strong></span>
NAME                                          MAJ:MIN RM   SIZE RO TYPE  MOUNTPOINT
zram0                                         252:0    0     4G  0 disk  [SWAP]
nvme0n1                                       259:0    0 238.5G  0 disk
├─nvme0n1p1                                   259:1    0   600M  0 part  /boot/efi
├─nvme0n1p2                                   259:2    0     1G  0 part  /boot
└─nvme0n1p3                                   259:3    0 236.9G  0 part
  └─luks-a1123911-6f37-463c-b4eb-fxzy1ac12fea 253:0    0 236.9G  0 crypt /home</pre></div></div></li><li class="listitem"><p class="simpara">
							Set I/O limits for the block device using the <code class="literal">virsh blkiotune</code> command.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--qhut72s"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh blkiotune <span class="emphasis"><em>VM-name</em></span> --parameter <span class="emphasis"><em>device</em></span>,<span class="emphasis"><em>limit</em></span></strong></span></pre></div></div><p class="simpara">
							The following example throttles the <code class="literal">sdb</code> disk on the <code class="literal">rollin-coal</code> VM to 1000 read and write I/O operations per second and to 50 MB per second read and write throughput.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--w27dvql"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh blkiotune rollin-coal --device-read-iops-sec /dev/nvme0n1p3,1000 --device-write-iops-sec /dev/nvme0n1p3,1000 --device-write-bytes-sec /dev/nvme0n1p3,52428800 --device-read-bytes-sec /dev/nvme0n1p3,52428800</strong></span></pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional information</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							Disk I/O throttling can be useful in various situations, for 
example when VMs belonging to different customers are running on the 
same host, or when quality of service guarantees are given for different
 VMs. Disk I/O throttling can also be used to simulate slower disks.
						</li><li class="listitem">
							I/O throttling can be applied independently to each block device 
attached to a VM and supports limits on throughput and I/O operations.
						</li><li class="listitem">
							Red&nbsp;Hat does not support using the <code class="literal">virsh blkdeviotune</code>
 command to configure I/O throttling in VMs. For more information about 
unsupported features when using RHEL 9 as a VM host, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/feature-support-and-limitations-in-rhel-9-virtualization_configuring-and-managing-virtualization#unsupported-features-in-rhel-9-virtualization_feature-support-and-limitations-in-rhel-9-virtualization">Unsupported features in RHEL&nbsp;9 virtualization</a>.
						</li></ul></div></section><section class="section" id="configuring-multi-queue-virtio-scsi_optimizing-virtual-machine-i-o-performance"><div class="titlepage"><div><div><h3 class="title">13.5.3. Enabling multi-queue virtio-scsi</h3></div></div></div><p>
					When using <code class="literal">virtio-scsi</code> storage devices in your virtual machines (VMs), the <span class="emphasis"><em>multi-queue virtio-scsi</em></span>
 feature provides improved storage performance and scalability. It 
enables each virtual CPU (vCPU) to have a separate queue and interrupt 
to use without affecting other vCPUs.
				</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							To enable multi-queue virtio-scsi support for a specific VM, add the following to the VM’s XML configuration, where <span class="emphasis"><em>N</em></span> is the total number of vCPU queues:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--uw1vb9u"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>controller</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>scsi<span class="token punctuation">'</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0<span class="token punctuation">'</span></span> <span class="token attr-name">model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>virtio-scsi<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driver</span> <span class="token attr-name">queues</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>N<span class="token punctuation">'</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>controller</span><span class="token punctuation">&gt;</span></span></pre></div></div></li></ul></div></section></section><section class="section" id="optimizing-virtual-machine-cpu-performance_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.6. Optimizing virtual machine CPU performance</h2></div></div></div><p>
				Much like physical CPUs in host machines, vCPUs are critical to 
virtual machine (VM) performance. As a result, optimizing vCPUs can have
 a significant impact on the resource efficiency of your VMs. To 
optimize your vCPU:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Adjust how many host CPUs are assigned to the VM. You can do this using <a class="link" href="#adding-and-removing-virtual-cpus-using-the-command-line-interface_optimizing-virtual-machine-cpu-performance" title="13.6.1.&nbsp;Adding and removing virtual CPUs using the command-line interface">the CLI</a> or <a class="link" href="#managing-virtual-cpus-using-the-web-console_optimizing-virtual-machine-cpu-performance" title="13.6.2.&nbsp;Managing virtual CPUs using the web console">the web console</a>.
					</li><li class="listitem"><p class="simpara">
						Ensure that the vCPU model is aligned with the CPU model of the host. For example, to set the <span class="emphasis"><em>testguest1</em></span> VM to use the CPU model of the host:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7tunl9o"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virt-xml testguest1 --edit --cpu host-model</strong></span></pre></div></div></li><li class="listitem">
						<a class="link" href="#proc_managing-ksm_optimizing-virtual-machine-cpu-performance" title="13.6.5.&nbsp;Managing kernel same-page merging">Manage kernel same-page merging (KSM)</a>.
					</li><li class="listitem"><p class="simpara">
						If your host machine uses Non-Uniform Memory Access (NUMA), you can also <span class="strong strong"><strong>configure NUMA</strong></span>
 for its VMs. This maps the host’s CPU and memory processes onto the CPU
 and memory processes of the VM as closely as possible. In effect, NUMA 
tuning provides the vCPU with a more streamlined access to the system 
memory allocated to the VM, which can improve the vCPU processing 
effectiveness.
					</p><p class="simpara">
						For details, see <a class="link" href="#configuring-numa-in-a-virtual-machine_optimizing-virtual-machine-cpu-performance" title="13.6.3.&nbsp;Configuring NUMA in a virtual machine">Configuring NUMA in a virtual machine</a> and <a class="link" href="#sample-vcpu-performance-tuning-scenario_optimizing-virtual-machine-cpu-performance" title="13.6.4.&nbsp;Sample vCPU performance tuning scenario">Sample vCPU performance tuning scenario</a>.
					</p></li></ol></div><section class="section" id="adding-and-removing-virtual-cpus-using-the-command-line-interface_optimizing-virtual-machine-cpu-performance"><div class="titlepage"><div><div><h3 class="title">13.6.1. Adding and removing virtual CPUs using the command-line interface</h3></div></div></div><p>
					To increase or optimize the CPU performance of a virtual machine 
(VM), you can add or remove virtual CPUs (vCPUs) assigned to the VM.
				</p><p>
					When performed on a running VM, this is also referred to as vCPU 
hot plugging and hot unplugging. However, note that vCPU hot unplug is 
not supported in RHEL 9, and Red&nbsp;Hat highly discourages its use.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							<span class="strong strong"><strong>Optional:</strong></span> View the current state of the vCPUs in the targeted VM. For example, to display the number of vCPUs on the <span class="emphasis"><em>testguest</em></span> VM:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xfwmfh5"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh vcpucount <span class="emphasis"><em>testguest</em></span></strong></span>
maximum      config         4
maximum      live           2
current      config         2
current      live           1</pre></div></div><p class="simpara">
							This output indicates that <span class="emphasis"><em>testguest</em></span>
 is currently using 1 vCPU, and 1 more vCPu can be hot plugged to it to 
increase the VM’s performance. However, after reboot, the number of 
vCPUs <span class="emphasis"><em>testguest</em></span> uses will change to 2, and it will be possible to hot plug 2 more vCPUs.
						</p></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Adjust the maximum number of vCPUs that can be attached to a VM, which takes effect on the VM’s next boot.
						</p><p class="simpara">
							For example, to increase the maximum vCPU count for the <span class="emphasis"><em>testguest</em></span> VM to 8:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--djhcb6u"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh setvcpus testguest 8 --maximum --config</strong></span></pre></div></div><p class="simpara">
							Note that the maximum may be limited by the CPU topology, host hardware, the hypervisor, and other factors.
						</p></li><li class="listitem"><p class="simpara">
							Adjust the current number of vCPUs attached to a VM, up to the maximum configured in the previous step. For example:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									To increase the number of vCPUs attached to the running <span class="emphasis"><em>testguest</em></span> VM to 4:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7caps9v"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh setvcpus testguest 4 --live</strong></span></pre></div></div><p class="simpara">
									This increases the VM’s performance and host load footprint of <span class="emphasis"><em>testguest</em></span> until the VM’s next boot.
								</p></li><li class="listitem"><p class="simpara">
									To permanently decrease the number of vCPUs attached to the <span class="emphasis"><em>testguest</em></span> VM to 1:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8gau8ng"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh setvcpus testguest 1 --config</strong></span></pre></div></div><p class="simpara">
									This decreases the VM’s performance and host load footprint of <span class="emphasis"><em>testguest</em></span>
 after the VM’s next boot. However, if needed, additional vCPUs can be 
hot plugged to the VM to temporarily increase its performance.
								</p></li></ul></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Confirm that the current state of vCPU for the VM reflects your changes.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--c7n3ut8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh vcpucount <span class="emphasis"><em>testguest</em></span></strong></span>
maximum      config         8
maximum      live           4
current      config         1
current      live           4</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#managing-virtual-cpus-using-the-web-console_optimizing-virtual-machine-cpu-performance">Managing virtual CPUs using the web console</a>
						</li></ul></div></section><section class="section" id="managing-virtual-cpus-using-the-web-console_optimizing-virtual-machine-cpu-performance"><div class="titlepage"><div><div><h3 class="title">13.6.2. Managing virtual CPUs using the web console</h3></div></div></div><p>
					Using the RHEL 9 web console, you can review and configure virtual 
CPUs used by virtual machines (VMs) to which the web console is 
connected.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The web console VM plug-in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/managing-virtual-machines-in-the-web-console_configuring-and-managing-virtualization">is installed on your system</a>.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							In the <span class="guimenu">Virtual Machines</span> interface, click the VM whose information you want to see.
						</p><p class="simpara">
							A new page opens with an Overview section with basic information 
about the selected VM and a Console section to access the VM’s graphical
 interface.
						</p></li><li class="listitem"><p class="simpara">
							Click <span class="guibutton">edit</span> next to the number of vCPUs in the Overview pane.
						</p><p class="simpara">
							The vCPU details dialog appears.
						</p><div class="informalfigure"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/822593b143a5fe3f23f61dc63a892afb/virt-cockpit-configure-vCPUs.png" class="rh_docs--zoom" title="Image displaying the VM CPU details dialog box."><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/virt-cockpit-configure-vCPUs.png" alt="Image displaying the VM CPU details dialog box." width="540"></a></div></div></li></ol></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Configure the virtual CPUs for the selected VM.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>vCPU Count</strong></span> - The number of vCPUs currently in use.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										The vCPU count cannot be greater than the vCPU Maximum.
									</p></div></div></li><li class="listitem">
									<span class="strong strong"><strong>vCPU Maximum</strong></span> - The maximum number of virtual CPUs that can be configured for the VM. If this value is higher than the <span class="strong strong"><strong>vCPU Count</strong></span>, additional vCPUs can be attached to the VM.
								</li><li class="listitem">
									<span class="strong strong"><strong>Sockets</strong></span> - The number of sockets to expose to the VM.
								</li><li class="listitem">
									<span class="strong strong"><strong>Cores per socket</strong></span> - The number of cores for each socket to expose to the VM.
								</li><li class="listitem"><p class="simpara">
									<span class="strong strong"><strong>Threads per core</strong></span> - The number of threads for each core to expose to the VM.
								</p><p class="simpara">
									Note that the <span class="strong strong"><strong>Sockets</strong></span>, <span class="strong strong"><strong>Cores per socket</strong></span>, and <span class="strong strong"><strong>Threads per core</strong></span>
 options adjust the CPU topology of the VM. This may be beneficial for 
vCPU performance and may impact the functionality of certain software in
 the guest OS. If a different setting is not required by your 
deployment, keep the default values.
								</p></li></ul></div></li><li class="listitem"><p class="simpara">
							Click <span class="guibutton">Apply</span>.
						</p><p class="simpara">
							The virtual CPUs for the VM are configured.
						</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
								Changes to virtual CPU settings only take effect after the VM is restarted.
							</p></div></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#adding-and-removing-virtual-cpus-using-the-command-line-interface_optimizing-virtual-machine-cpu-performance">Adding and removing virtual CPUs using the command-line interface</a>
						</li></ul></div></section><section class="section" id="configuring-numa-in-a-virtual-machine_optimizing-virtual-machine-cpu-performance"><div class="titlepage"><div><div><h3 class="title">13.6.3. Configuring NUMA in a virtual machine</h3></div></div></div><p>
					The following methods can be used to configure Non-Uniform Memory 
Access (NUMA) settings of a virtual machine (VM) on a RHEL 9 host.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The host is a NUMA-compatible machine. To detect whether this is the case, use the <code class="literal">virsh nodeinfo</code> command and see the <code class="literal">NUMA cell(s)</code> line:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--8wr9s67"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh nodeinfo</strong></span>
CPU model:           x86_64
CPU(s):              48
CPU frequency:       1200 MHz
CPU socket(s):       1
Core(s) per socket:  12
Thread(s) per core:  2
NUMA cell(s):        <span class="strong strong"><strong>2</strong></span>
Memory size:         67012964 KiB</pre></div></div><p class="simpara">
							If the value of the line is 2 or greater, the host is NUMA-compatible.
						</p></li></ul></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
						For ease of use, you can set up a VM’s NUMA configuration using 
automated utilities and services. However, manual NUMA setup is more 
likely to yield a significant performance improvement.
					</p></div><p>
					<span class="strong strong"><strong>Automatic methods</strong></span>
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Set the VM’s NUMA policy to <code class="literal">Preferred</code>. For example, to do so for the <span class="emphasis"><em>testguest5</em></span> VM:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--hjfjllt"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virt-xml testguest5 --edit --vcpus placement=auto</strong></span>
# <span class="strong strong"><strong>virt-xml testguest5 --edit --numatune mode=preferred</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Enable automatic NUMA balancing on the host:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ik64laf"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>echo 1 &gt; /proc/sys/kernel/numa_balancing</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Use the <code class="literal">numad</code> command to automatically align the VM CPU with memory resources.
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2tzdmik"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>numad</strong></span></pre></div></div></li></ul></div><p>
					<span class="strong strong"><strong>Manual methods</strong></span>
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Pin specific vCPU threads to a specific host CPU or range of 
CPUs. This is also possible on non-NUMA hosts and VMs, and is 
recommended as a safe method of vCPU performance improvement.
						</p><p class="simpara">
							For example, the following commands pin vCPU threads 0 to 5 of the <span class="emphasis"><em>testguest6</em></span> VM to host CPUs 1, 3, 5, 7, 9, and 11, respectively:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3cltrre"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh vcpupin testguest6 0 1</strong></span>
# <span class="strong strong"><strong>virsh vcpupin testguest6 1 3</strong></span>
# <span class="strong strong"><strong>virsh vcpupin testguest6 2 5</strong></span>
# <span class="strong strong"><strong>virsh vcpupin testguest6 3 7</strong></span>
# <span class="strong strong"><strong>virsh vcpupin testguest6 4 9</strong></span>
# <span class="strong strong"><strong>virsh vcpupin testguest6 5 11</strong></span></pre></div></div><p class="simpara">
							Afterwards, you can verify whether this was successful:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--070c1l6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh vcpupin testguest6</strong></span>
VCPU   CPU Affinity
----------------------
0      1
1      3
2      5
3      7
4      9
5      11</pre></div></div></li><li class="listitem"><p class="simpara">
							After pinning vCPU threads, you can also pin QEMU process threads
 associated with a specified VM to a specific host CPU or range of CPUs.
 For example, the following commands pin the QEMU process thread of <span class="emphasis"><em>testguest6</em></span> to CPUs 13 and 15, and verify this was successful:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--kixd0ow"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh emulatorpin testguest6 13,15</strong></span>
# <span class="strong strong"><strong>virsh emulatorpin testguest6</strong></span>
emulator: CPU Affinity
----------------------------------
       *: 13,15</pre></div></div></li><li class="listitem"><p class="simpara">
							Finally, you can also specify which host NUMA nodes will be 
assigned specifically to a certain VM. This can improve the host memory 
usage by the VM’s vCPU. For example, the following commands set <span class="emphasis"><em>testguest6</em></span> to use host NUMA nodes 3 to 5, and verify this was successful:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ek092sy"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh numatune testguest6 --nodeset 3-5</strong></span>
# <span class="strong strong"><strong>virsh numatune testguest6</strong></span></pre></div></div></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						For best performance results, it is recommended to use all of the manual tuning methods listed above
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Known issues</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/assembly_feature-support-and-limitations-in-rhel-9-virtualization_configuring-and-managing-virtualization#how-virtualization-on-ibm-z-differs-from-amd64-and-intel64_feature-support-and-limitations-in-rhel-9-virtualization">NUMA tuning currently cannot be performed on IBM Z hosts</a>.
						</li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#sample-vcpu-performance-tuning-scenario_optimizing-virtual-machine-cpu-performance">Sample vCPU performance tuning scenario</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/optimizing-virtual-machine-performance-in-rhel_configuring-and-managing-virtualization#virtual-machine-performance-monitoring-tools_optimizing-virtual-machine-performance-in-rhel">View the current NUMA configuration of your system</a> using the <code class="literal">numastat</code> utility
						</li></ul></div></section><section class="section" id="sample-vcpu-performance-tuning-scenario_optimizing-virtual-machine-cpu-performance"><div class="titlepage"><div><div><h3 class="title">13.6.4. Sample vCPU performance tuning scenario</h3></div></div></div><p>
					To obtain the best vCPU performance possible, Red&nbsp;Hat recommends using manual <code class="literal">vcpupin</code>, <code class="literal">emulatorpin</code>, and <code class="literal">numatune</code> settings together, for example like in the following scenario.
				</p><div class="itemizedlist"><p class="title"><strong>Starting scenario</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Your host has the following hardware specifics:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
									2 NUMA nodes
								</li><li class="listitem">
									3 CPU cores on each node
								</li><li class="listitem">
									2 threads on each core
								</li></ul></div><p class="simpara">
							The output of <code class="literal">virsh nodeinfo</code> of such a machine would look similar to:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6bjbx1d"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh nodeinfo</strong></span>
CPU model:           x86_64
CPU(s):              12
CPU frequency:       3661 MHz
CPU socket(s):       2
Core(s) per socket:  3
Thread(s) per core:  2
NUMA cell(s):        2
Memory size:         31248692 KiB</pre></div></div></li><li class="listitem"><p class="simpara">
							You intend to modify an existing VM to have 8 vCPUs, which means that it will not fit in a single NUMA node.
						</p><p class="simpara">
							Therefore, you should distribute 4 vCPUs on each NUMA node and 
make the vCPU topology resemble the host topology as closely as 
possible. This means that vCPUs that run as sibling threads of a given 
physical CPU should be pinned to host threads on the same core. For 
details, see the <span class="emphasis"><em>Solution</em></span> below:
						</p></li></ul></div><div class="orderedlist"><p class="title"><strong>Solution</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Obtain the information about the host topology:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--83rlrra"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh capabilities</strong></span></pre></div></div><p class="simpara">
							The output should include a section that looks similar to the following:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fgk7kzz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><button title="Expand" class="codeblock__expand">Expand</button><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>topology</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cells</span> <span class="token attr-name">num</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cell</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memory</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>15624346<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>memory</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pages</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>3906086<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pages</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2048<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pages</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1048576<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>distances</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>distances</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpus</span> <span class="token attr-name">num</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,3<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1,4<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2,5<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,3<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1,4<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2,5<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpus</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cell</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cell</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memory</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>15624346<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>memory</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pages</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>3906086<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pages</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2048<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pages</span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>KiB<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1048576<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>distances</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>distances</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpus</span> <span class="token attr-name">num</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6,9<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7,10<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8,11<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>9<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>6,9<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>7,10<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>11<span class="token punctuation">"</span></span> <span class="token attr-name">socket_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">core_id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>5<span class="token punctuation">"</span></span> <span class="token attr-name">siblings</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8,11<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpus</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cell</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cells</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>topology</span><span class="token punctuation">&gt;</span></span></pre></div></div></li><li class="listitem">
							<span class="strong strong"><strong>Optional:</strong></span> Test the performance of the VM using <a class="link" href="#virtual-machine-performance-monitoring-tools_optimizing-virtual-machine-performance-in-rhel" title="13.8.&nbsp;Virtual machine performance monitoring tools">the applicable tools and utilities</a>.
						</li><li class="listitem"><p class="simpara">
							Set up and mount 1 GiB huge pages on the host:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Add the following line to the host’s kernel command line:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--75g5kiw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed">default_hugepagesz=1G hugepagesz=1G</pre></div></div></li><li class="listitem"><p class="simpara">
									Create the <code class="literal">/etc/systemd/system/hugetlb-gigantic-pages.service</code> file with the following content:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--yfnu3qk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed">[Unit]
Description=HugeTLB Gigantic Pages Reservation
DefaultDependencies=no
Before=dev-hugepages.mount
ConditionPathExists=/sys/devices/system/node
ConditionKernelCommandLine=hugepagesz=1G

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/etc/systemd/hugetlb-reserve-pages.sh

[Install]
WantedBy=sysinit.target</pre></div></div></li><li class="listitem"><p class="simpara">
									Create the <code class="literal">/etc/systemd/hugetlb-reserve-pages.sh</code> file with the following content:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--yplapqk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed">#!/bin/sh

nodes_path=/sys/devices/system/node/
if [ ! -d $nodes_path ]; then
	echo "ERROR: $nodes_path does not exist"
	exit 1
fi

reserve_pages()
{
	echo $1 &gt; $nodes_path/$2/hugepages/hugepages-1048576kB/nr_hugepages
}

reserve_pages 4 node1
reserve_pages 4 node2</pre></div></div><p class="simpara">
									This reserves four 1GiB huge pages from <span class="emphasis"><em>node1</em></span> and four 1GiB huge pages from <span class="emphasis"><em>node2</em></span>.
								</p></li><li class="listitem"><p class="simpara">
									Make the script created in the previous step executable:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--u2oxabo"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>chmod +x /etc/systemd/hugetlb-reserve-pages.sh</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
									Enable huge page reservation on boot:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--za3kwg0"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>systemctl enable hugetlb-gigantic-pages</strong></span></pre></div></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Use the <code class="literal">virsh edit</code> command to edit the XML configuration of the VM you wish to optimize, in this example <span class="emphasis"><em>super-VM</em></span>:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5836964"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>virsh edit super-vm</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
							Adjust the XML configuration of the VM in the following way:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Set the VM to use 8 static vCPUs. Use the <code class="literal">&lt;vcpu/&gt;</code> element to do this.
								</li><li class="listitem"><p class="simpara">
									Pin each of the vCPU threads to the corresponding host CPU threads that it mirrors in the topology. To do so, use the <code class="literal">&lt;vcpupin/&gt;</code> elements in the <code class="literal">&lt;cputune&gt;</code> section.
								</p><p class="simpara">
									Note that, as shown by the <code class="literal">virsh capabilities</code>
 utility above, host CPU threads are not ordered sequentially in their 
respective cores. In addition, the vCPU threads should be pinned to the 
highest available set of host cores on the same NUMA node. For a table 
illustration, see the <span class="strong strong"><strong>Sample topology</strong></span> section below.
								</p><p class="simpara">
									The XML configuration for steps a. and b. can look similar to:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--gasthrr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cputune</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>4<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>2<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>2<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>3<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>5<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>4<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>7<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>5<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>10<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>6<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>8<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>7<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>11<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>emulatorpin</span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>6,9<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cputune</span><span class="token punctuation">&gt;</span></span></pre></div></div></li><li class="listitem"><p class="simpara">
									Set the VM to use 1 GiB huge pages:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--6dd9oux"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memoryBacking</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hugepages</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>page</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>GiB<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hugepages</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>memoryBacking</span><span class="token punctuation">&gt;</span></span></pre></div></div></li><li class="listitem"><p class="simpara">
									Configure the VM’s NUMA nodes to use memory from the corresponding NUMA nodes on the host. To do so, use the <code class="literal">&lt;memnode/&gt;</code> elements in the <code class="literal">&lt;numatune/&gt;</code> section:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--nh7zkdl"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>numatune</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memory</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preferred<span class="token punctuation">"</span></span> <span class="token attr-name">nodeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memnode</span> <span class="token attr-name">cellid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>strict<span class="token punctuation">"</span></span> <span class="token attr-name">nodeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memnode</span> <span class="token attr-name">cellid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>strict<span class="token punctuation">"</span></span> <span class="token attr-name">nodeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>numatune</span><span class="token punctuation">&gt;</span></span></pre></div></div></li><li class="listitem"><p class="simpara">
									Ensure the CPU mode is set to <code class="literal">host-passthrough</code>, and that the CPU uses cache in <code class="literal">passthrough</code> mode:
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2m6wvzr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>host-passthrough<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>topology</span> <span class="token attr-name">sockets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">cores</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">threads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>passthrough<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span></pre></div></div></li></ol></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Confirm that the resulting XML configuration of the VM includes a section similar to the following:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--31qz8d9"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><button title="Expand" class="codeblock__expand">Expand</button><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed">[...]
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memoryBacking</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hugepages</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>page</span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>GiB<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hugepages</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>memoryBacking</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpu</span> <span class="token attr-name">placement</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>static<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>vcpu</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cputune</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>4<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>2<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>2<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>3<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>5<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>4<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>7<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>5<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>10<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>6<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>8<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>7<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>11<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>emulatorpin</span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>6,9<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cputune</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>numatune</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memory</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>preferred<span class="token punctuation">"</span></span> <span class="token attr-name">nodeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memnode</span> <span class="token attr-name">cellid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>strict<span class="token punctuation">"</span></span> <span class="token attr-name">nodeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>memnode</span> <span class="token attr-name">cellid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>strict<span class="token punctuation">"</span></span> <span class="token attr-name">nodeset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>numatune</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cpu</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>host-passthrough<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>topology</span> <span class="token attr-name">sockets</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">cores</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">threads</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cache</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>passthrough<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>numa</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cell</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">cpus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0-3<span class="token punctuation">"</span></span> <span class="token attr-name">memory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GiB<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>distances</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>distances</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cell</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cell</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">cpus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4-7<span class="token punctuation">"</span></span> <span class="token attr-name">memory</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">unit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GiB<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>distances</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>21<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sibling</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>distances</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cell</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>numa</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cpu</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>domain</span><span class="token punctuation">&gt;</span></span></pre></div></div></li><li class="listitem">
							<span class="strong strong"><strong>Optional:</strong></span> Test the performance of the VM using <a class="link" href="#virtual-machine-performance-monitoring-tools_optimizing-virtual-machine-performance-in-rhel" title="13.8.&nbsp;Virtual machine performance monitoring tools">the applicable tools and utilities</a> to evaluate the impact of the VM’s optimization.
						</li></ol></div><div class="itemizedlist"><p class="title"><strong>Sample topology</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The following tables illustrate the connections between the vCPUs and the host CPUs they should be pinned to:
						</p><div class="table" id="idm140611467103792"><p class="title">Table 13.1. Host topology</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="7qnizhg" id="rh-table--7qnizhg" style="--rh-table--scrollbar--width: 0px;"><table class="gt-8-cols lt-7-rows"><colgroup><col style="width: 7%; " class="col_1"><!--Empty--><col style="width: 7%; " class="col_2"><!--Empty--><col style="width: 7%; " class="col_3"><!--Empty--><col style="width: 7%; " class="col_4"><!--Empty--><col style="width: 7%; " class="col_5"><!--Empty--><col style="width: 7%; " class="col_6"><!--Empty--><col style="width: 7%; " class="col_7"><!--Empty--><col style="width: 7%; " class="col_8"><!--Empty--><col style="width: 7%; " class="col_9"><!--Empty--><col style="width: 7%; " class="col_10"><!--Empty--><col style="width: 7%; " class="col_11"><!--Empty--><col style="width: 7%; " class="col_12"><!--Empty--><col style="width: 7%; " class="col_13"><!--Empty--><col style="width: 7%; " class="col_14"><!--Empty--><col style="width: 7%; " class="col_15"><!--Empty--></colgroup><tbody><tr><td colspan="3" data-row="1" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>CPU threads</strong></span>
										</p>
										 </td><td data-row="1" data-col="2" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="1" data-col="3" class="content--md" valign="top" align="left"> <p>
											3
										</p>
										 </td><td data-row="1" data-col="4" class="content--md" valign="top" align="left"> <p>
											1
										</p>
										 </td><td data-row="1" data-col="5" class="content--md" valign="top" align="left"> <p>
											4
										</p>
										 </td><td data-row="1" data-col="6" class="content--md" valign="top" align="left"> <p>
											2
										</p>
										 </td><td data-row="1" data-col="7" class="content--md" valign="top" align="left"> <p>
											5
										</p>
										 </td><td data-row="1" data-col="8" class="content--md" valign="top" align="left"> <p>
											6
										</p>
										 </td><td data-row="1" data-col="9" class="content--md" valign="top" align="left"> <p>
											9
										</p>
										 </td><td data-row="1" data-col="10" class="content--md" valign="top" align="left"> <p>
											7
										</p>
										 </td><td data-row="1" data-col="11" class="content--md" valign="top" align="left"> <p>
											10
										</p>
										 </td><td data-row="1" data-col="12" class="content--md" valign="top" align="left"> <p>
											8
										</p>
										 </td><td data-row="1" data-col="13" class="content--md" valign="top" align="left"> <p>
											11
										</p>
										 </td></tr><tr><td colspan="3" data-row="2" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>Cores</strong></span>
										</p>
										 </td><td colspan="2" data-row="2" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="2" data-row="2" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td><td colspan="2" data-row="2" data-col="4" class="content--md" valign="top" align="center"> <p>
											2
										</p>
										 </td><td colspan="2" data-row="2" data-col="5" class="content--md" valign="top" align="center"> <p>
											3
										</p>
										 </td><td colspan="2" data-row="2" data-col="6" class="content--md" valign="top" align="center"> <p>
											4
										</p>
										 </td><td colspan="2" data-row="2" data-col="7" class="content--md" valign="top" align="center"> <p>
											5
										</p>
										 </td></tr><tr><td colspan="3" data-row="3" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>Sockets</strong></span>
										</p>
										 </td><td colspan="6" data-row="3" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="6" data-row="3" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td></tr><tr><td colspan="3" data-row="4" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>NUMA nodes</strong></span>
										</p>
										 </td><td colspan="6" data-row="4" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="6" data-row="4" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td></tr></tbody></table></rh-table></div><div class="table" id="idm140611474325232"><p class="title">Table 13.2. VM topology</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="ipfa60b" id="rh-table--ipfa60b" style="--rh-table--scrollbar--width: 0px;"><table class="gt-8-cols lt-7-rows"><colgroup><col style="width: 9%; " class="col_1"><!--Empty--><col style="width: 9%; " class="col_2"><!--Empty--><col style="width: 9%; " class="col_3"><!--Empty--><col style="width: 9%; " class="col_4"><!--Empty--><col style="width: 9%; " class="col_5"><!--Empty--><col style="width: 9%; " class="col_6"><!--Empty--><col style="width: 9%; " class="col_7"><!--Empty--><col style="width: 9%; " class="col_8"><!--Empty--><col style="width: 9%; " class="col_9"><!--Empty--><col style="width: 9%; " class="col_10"><!--Empty--><col style="width: 9%; " class="col_11"><!--Empty--></colgroup><tbody><tr><td colspan="3" data-row="1" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>vCPU threads</strong></span>
										</p>
										 </td><td data-row="1" data-col="2" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="1" data-col="3" class="content--md" valign="top" align="left"> <p>
											1
										</p>
										 </td><td data-row="1" data-col="4" class="content--md" valign="top" align="left"> <p>
											2
										</p>
										 </td><td data-row="1" data-col="5" class="content--md" valign="top" align="left"> <p>
											3
										</p>
										 </td><td data-row="1" data-col="6" class="content--md" valign="top" align="left"> <p>
											4
										</p>
										 </td><td data-row="1" data-col="7" class="content--md" valign="top" align="left"> <p>
											5
										</p>
										 </td><td data-row="1" data-col="8" class="content--md" valign="top" align="left"> <p>
											6
										</p>
										 </td><td data-row="1" data-col="9" class="content--md" valign="top" align="left"> <p>
											7
										</p>
										 </td></tr><tr><td colspan="3" data-row="2" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>Cores</strong></span>
										</p>
										 </td><td colspan="2" data-row="2" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="2" data-row="2" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td><td colspan="2" data-row="2" data-col="4" class="content--md" valign="top" align="center"> <p>
											2
										</p>
										 </td><td colspan="2" data-row="2" data-col="5" class="content--md" valign="top" align="center"> <p>
											3
										</p>
										 </td></tr><tr><td colspan="3" data-row="3" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>Sockets</strong></span>
										</p>
										 </td><td colspan="4" data-row="3" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="4" data-row="3" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td></tr><tr><td colspan="3" data-row="4" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>NUMA nodes</strong></span>
										</p>
										 </td><td colspan="4" data-row="4" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="4" data-row="4" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td></tr></tbody></table></rh-table></div><div class="table" id="idm140611467954592"><p class="title">Table 13.3. Combined host and VM topology</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="me6nq84" id="rh-table--me6nq84" style="--rh-table--scrollbar--width: 0px;"><table class="gt-8-cols lt-7-rows"><colgroup><col style="width: 7%; " class="col_1"><!--Empty--><col style="width: 7%; " class="col_2"><!--Empty--><col style="width: 7%; " class="col_3"><!--Empty--><col style="width: 7%; " class="col_4"><!--Empty--><col style="width: 7%; " class="col_5"><!--Empty--><col style="width: 7%; " class="col_6"><!--Empty--><col style="width: 7%; " class="col_7"><!--Empty--><col style="width: 7%; " class="col_8"><!--Empty--><col style="width: 7%; " class="col_9"><!--Empty--><col style="width: 7%; " class="col_10"><!--Empty--><col style="width: 7%; " class="col_11"><!--Empty--><col style="width: 7%; " class="col_12"><!--Empty--><col style="width: 7%; " class="col_13"><!--Empty--><col style="width: 7%; " class="col_14"><!--Empty--><col style="width: 7%; " class="col_15"><!--Empty--></colgroup><tbody><tr><td colspan="3" data-row="1" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>vCPU threads</strong></span>
										</p>
										 </td><td colspan="2" data-row="1" data-col="2" class="content--sm" valign="top" align="center">&nbsp;</td><td data-row="1" data-col="3" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="1" data-col="4" class="content--md" valign="top" align="left"> <p>
											1
										</p>
										 </td><td data-row="1" data-col="5" class="content--md" valign="top" align="left"> <p>
											2
										</p>
										 </td><td data-row="1" data-col="6" class="content--md" valign="top" align="left"> <p>
											3
										</p>
										 </td><td colspan="2" data-row="1" data-col="7" class="content--sm" valign="top" align="center">&nbsp;</td><td data-row="1" data-col="8" class="content--md" valign="top" align="left"> <p>
											4
										</p>
										 </td><td data-row="1" data-col="9" class="content--md" valign="top" align="left"> <p>
											5
										</p>
										 </td><td data-row="1" data-col="10" class="content--md" valign="top" align="left"> <p>
											6
										</p>
										 </td><td data-row="1" data-col="11" class="content--md" valign="top" align="left"> <p>
											7
										</p>
										 </td></tr><tr><td colspan="3" data-row="2" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>Host CPU threads</strong></span>
										</p>
										 </td><td data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
											3
										</p>
										 </td><td data-row="2" data-col="4" class="content--md" valign="top" align="left"> <p>
											1
										</p>
										 </td><td data-row="2" data-col="5" class="content--md" valign="top" align="left"> <p>
											4
										</p>
										 </td><td data-row="2" data-col="6" class="content--md" valign="top" align="left"> <p>
											2
										</p>
										 </td><td data-row="2" data-col="7" class="content--md" valign="top" align="left"> <p>
											5
										</p>
										 </td><td data-row="2" data-col="8" class="content--md" valign="top" align="left"> <p>
											6
										</p>
										 </td><td data-row="2" data-col="9" class="content--md" valign="top" align="left"> <p>
											9
										</p>
										 </td><td data-row="2" data-col="10" class="content--md" valign="top" align="left"> <p>
											7
										</p>
										 </td><td data-row="2" data-col="11" class="content--md" valign="top" align="left"> <p>
											10
										</p>
										 </td><td data-row="2" data-col="12" class="content--md" valign="top" align="left"> <p>
											8
										</p>
										 </td><td data-row="2" data-col="13" class="content--md" valign="top" align="left"> <p>
											11
										</p>
										 </td></tr><tr><td colspan="3" data-row="3" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>Cores</strong></span>
										</p>
										 </td><td colspan="2" data-row="3" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="2" data-row="3" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td><td colspan="2" data-row="3" data-col="4" class="content--md" valign="top" align="center"> <p>
											2
										</p>
										 </td><td colspan="2" data-row="3" data-col="5" class="content--md" valign="top" align="center"> <p>
											3
										</p>
										 </td><td colspan="2" data-row="3" data-col="6" class="content--md" valign="top" align="center"> <p>
											4
										</p>
										 </td><td colspan="2" data-row="3" data-col="7" class="content--md" valign="top" align="center"> <p>
											5
										</p>
										 </td></tr><tr><td colspan="3" data-row="4" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>Sockets</strong></span>
										</p>
										 </td><td colspan="6" data-row="4" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="6" data-row="4" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td></tr><tr><td colspan="3" data-row="5" data-col="1" class="content--md" valign="top" align="center"> <p>
											<span class="strong strong"><strong>NUMA nodes</strong></span>
										</p>
										 </td><td colspan="6" data-row="5" data-col="2" class="content--md" valign="top" align="center"> <p>
											0
										</p>
										 </td><td colspan="6" data-row="5" data-col="3" class="content--md" valign="top" align="center"> <p>
											1
										</p>
										 </td></tr></tbody></table></rh-table></div><p class="simpara">
							In this scenario, there are 2 NUMA nodes and 8 vCPUs. Therefore, 4 vCPU threads should be pinned to each node.
						</p><p class="simpara">
							In addition, Red&nbsp;Hat recommends leaving at least a single 
CPU thread available on each node for host system operations.
						</p><p class="simpara">
							Because in this example, each NUMA node houses 3 cores, each with
 2 host CPU threads, the set for node 0 translates as follows:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--4yyvlsw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="programlisting language-xml codeblock codeblock--processed"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>0<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>1<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>4<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>2<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>2<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>vcpupin</span> <span class="token attr-name">vcpu</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>3<span class="token punctuation">'</span></span> <span class="token attr-name">cpuset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>5<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span></pre></div></div></li></ul></div></section><section class="section" id="proc_managing-ksm_optimizing-virtual-machine-cpu-performance"><div class="titlepage"><div><div><h3 class="title">13.6.5. Managing kernel same-page merging</h3></div></div></div><p>
					Kernel Same-Page Merging (KSM) improves memory density by sharing 
identical memory pages between virtual machines (VMs). However, enabling
 KSM increases CPU utilization, and might adversely affect overall 
performance depending on the workload.
				</p><p>
					Depending on your requirements, you can either enable or disable KSM for a single session or persistently.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						In RHEL&nbsp;9 and later, KSM is disabled by default.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							Root access to your host system.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Disable KSM:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
									To deactivate KSM for a single session, use the <code class="literal">systemctl</code> utility to stop <code class="literal">ksm</code> and <code class="literal">ksmtuned</code> services.
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--r0ethbl"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"><span class="strong strong"><strong># systemctl stop ksm</strong></span>

<span class="strong strong"><strong># systemctl stop ksmtuned</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
									To deactivate KSM persistently, use the <code class="literal">systemctl</code> utility to disable <code class="literal">ksm</code> and <code class="literal">ksmtuned</code> services.
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l9ytob8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"><span class="strong strong"><strong># systemctl disable ksm</strong></span>
Removed /etc/systemd/system/multi-user.target.wants/ksm.service.
<span class="strong strong"><strong># systemctl disable ksmtuned</strong></span>
Removed /etc/systemd/system/multi-user.target.wants/ksmtuned.service.</pre></div></div></li></ul></div></li></ul></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Memory pages shared between VMs before deactivating KSM will remain shared. To stop sharing, delete all the <code class="literal">PageKSM</code> pages in the system using the following command:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--er44txr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"><span class="strong strong"><strong># echo 2 &gt; /sys/kernel/mm/ksm/run</strong></span></pre></div></div><p>
						After anonymous pages replace the KSM pages, the <code class="literal">khugepaged</code> kernel service will rebuild transparent hugepages on the VM’s physical memory.
					</p></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Enable KSM:
						</li></ul></div><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
						Enabling KSM increases CPU utilization and affects overall CPU performance.
					</p></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Install the <code class="literal">ksmtuned</code> service:
						</p><p class="simpara">
							<span class="strong strong"><strong># dnf install ksmtuned</strong></span>
						</p></li><li class="listitem"><p class="simpara">
							Start the service:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									To enable KSM for a single session, use the <code class="literal">systemctl</code> utility to start the <code class="literal">ksm</code> and <code class="literal">ksmtuned</code> services.
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--uywlkad"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"><span class="strong strong"><strong># systemctl start ksm</strong></span>
<span class="strong strong"><strong># systemctl start ksmtuned</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
									To enable KSM persistently, use the <code class="literal">systemctl</code> utility to enable the <code class="literal">ksm</code> and <code class="literal">ksmtuned</code> services.
								</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--4fpqlep"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"><span class="strong strong"><strong># systemctl enable ksm</strong></span>
Created symlink /etc/systemd/system/multi-user.target.wants/ksm.service → /usr/lib/systemd/system/ksm.service

<span class="strong strong"><strong># systemctl enable ksmtuned</strong></span>
Created symlink /etc/systemd/system/multi-user.target.wants/ksmtuned.service → /usr/lib/systemd/system/ksmtuned.service</pre></div></div></li></ul></div></li></ol></div></section></section><section class="section" id="optimizing-virtual-machine-network-performance_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.7. Optimizing virtual machine network performance</h2></div></div></div><p>
				Due to the virtual nature of a VM’s network interface card (NIC), 
the VM loses a portion of its allocated host network bandwidth, which 
can reduce the overall workload efficiency of the VM. The following tips
 can minimize the negative impact of virtualization on the virtual NIC 
(vNIC) throughput.
			</p><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					Use any of the following methods and observe if it has a beneficial effect on your VM network performance:
				</p></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Enable the vhost_net module</span></dt><dd><p class="simpara">
							On the host, ensure the <code class="literal">vhost_net</code> kernel feature is enabled:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mlhi1s8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>lsmod | grep vhost</strong></span>
vhost_net              32768  1
vhost                  53248  1 vhost_net
tap                    24576  1 vhost_net
tun                    57344  6 vhost_net</pre></div></div><p class="simpara">
							If the output of this command is blank, enable the <code class="literal">vhost_net</code> kernel module:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--g28hxgn"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>modprobe vhost_net</strong></span></pre></div></div></dd><dt><span class="term">Set up multi-queue virtio-net</span></dt><dd><p class="simpara">
							To set up the <span class="emphasis"><em>multi-queue virtio-net</em></span> feature for a VM, use the <code class="literal">virsh edit</code> command to edit to the XML configuration of the VM. In the XML, add the following to the <code class="literal">&lt;devices&gt;</code> section, and replace <code class="literal">N</code> with the number of vCPUs in the VM, up to 16:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--qn8glje"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">&lt;interface type='network'&gt;
      &lt;source network='default'/&gt;
      &lt;model type='virtio'/&gt;
      &lt;driver name='vhost' queues='N'/&gt;
&lt;/interface&gt;</pre></div></div><p class="simpara">
							If the VM is running, restart it for the changes to take effect.
						</p></dd><dt><span class="term">Batching network packets</span></dt><dd><p class="simpara">
							In Linux VM configurations with a long transmission path, 
batching packets before submitting them to the kernel may improve cache 
utilization. To set up packet batching, use the following command on the
 host, and replace <span class="emphasis"><em>tap0</em></span> with the name of the network interface that the VMs use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ri0di0r"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># <span class="strong strong"><strong>ethtool -C <span class="emphasis"><em>tap0</em></span> rx-frames 64</strong></span></pre></div></div></dd><dt><span class="term">SR-IOV</span></dt><dd>
							If your host NIC supports SR-IOV, use SR-IOV device assignment for your vNICs. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/managing-virtual-devices_configuring-and-managing-virtualization#managing-sr-iov-devices_managing-virtual-devices">Managing SR-IOV devices</a>.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_virtualization/configuring-virtual-machine-network-connections_configuring-and-managing-virtualization#understanding-virtual-networking-overview_configuring-virtual-machine-network-connections">Understanding virtual networking</a>
					</li></ul></div></section><section class="section" id="virtual-machine-performance-monitoring-tools_optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.8. Virtual machine performance monitoring tools</h2></div></div></div><p>
				To identify what consumes the most VM resources and which aspect of 
VM performance needs optimization, performance diagnostic tools, both 
general and VM-specific, can be used.
			</p><div class="formalpara"><p class="title"><strong>Default OS performance monitoring tools</strong></p><p>
					For standard performance evaluation, you can use the utilities 
provided by default by your host and guest operating systems:
				</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						On your RHEL&nbsp;9 host, as root, use the <code class="literal">top</code> utility or the <span class="strong strong"><strong>system monitor</strong></span> application, and look for <code class="literal">qemu</code> and <code class="literal">virt</code> in the output. This shows how much host system resources your VMs are consuming.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								If the monitoring tool displays that any of the <code class="literal">qemu</code> or <code class="literal">virt</code> processes consume a large portion of the host CPU or memory capacity, use the <code class="literal">perf</code> utility to investigate. For details, see below.
							</li><li class="listitem">
								In addition, if a <code class="literal">vhost_net</code> thread process, named for example <span class="emphasis"><em>vhost_net-1234</em></span>, is displayed as consuming an excessive amount of host CPU capacity, consider using <a class="link" href="#optimizing-virtual-machine-network-performance_optimizing-virtual-machine-performance-in-rhel" title="13.7.&nbsp;Optimizing virtual machine network performance">virtual network optimization features</a>, such as <code class="literal">multi-queue virtio-net</code>.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						On the guest operating system, use performance utilities and 
applications available on the system to evaluate which processes consume
 the most system resources.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								On Linux systems, you can use the <code class="literal">top</code> utility.
							</li><li class="listitem">
								On Windows systems, you can use the <span class="strong strong"><strong>Task Manager</strong></span> application.
							</li></ul></div></li></ul></div><div class="formalpara"><p class="title"><strong>perf kvm</strong></p><p>
					You can use the <code class="literal">perf</code> utility to collect and analyze virtualization-specific statistics about the performance of your RHEL&nbsp;9 host. To do so:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						On the host, install the <span class="emphasis"><em>perf</em></span> package:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--at1fapz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># <span class="strong strong"><strong>dnf install perf</strong></span></pre></div></div></li><li class="listitem"><p class="simpara">
						Use one of the <code class="literal">perf kvm stat</code> commands to display perf statistics for your virtualization host:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								For real-time monitoring of your hypervisor, use the <code class="literal">perf kvm stat live</code> command.
							</li><li class="listitem">
								To log the perf data of your hypervisor over a period of time, activate the logging using the <code class="literal">perf kvm stat record</code> command. After the command is canceled or interrupted, the data is saved in the <code class="literal">perf.data.guest</code> file, which can be analyzed using the <code class="literal">perf kvm stat report</code> command.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						Analyze the <code class="literal">perf</code> output for types of <code class="literal">VM-EXIT</code> events and their distribution. For example, the <code class="literal">PAUSE_INSTRUCTION</code>
 events should be infrequent, but in the following output, the high 
occurrence of this event suggests that the host CPUs are not handling 
the running vCPUs well. In such a scenario, consider shutting down some 
of your active VMs, removing vCPUs from these VMs, or <a class="link" href="#optimizing-virtual-machine-cpu-performance_optimizing-virtual-machine-performance-in-rhel" title="13.6.&nbsp;Optimizing virtual machine CPU performance">tuning the performance of the vCPUs</a>.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--us5rv0i"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># <span class="strong strong"><strong>perf kvm stat report</strong></span>

Analyze events for all VMs, all VCPUs:


             VM-EXIT    Samples  Samples%     Time%    Min Time    Max Time         Avg time

  EXTERNAL_INTERRUPT     365634    31.59%    18.04%      0.42us  58780.59us    204.08us ( +-   0.99% )
           MSR_WRITE     293428    25.35%     0.13%      0.59us  17873.02us      1.80us ( +-   4.63% )
    PREEMPTION_TIMER     276162    23.86%     0.23%      0.51us  21396.03us      3.38us ( +-   5.19% )
   PAUSE_INSTRUCTION     189375    16.36%    11.75%      0.72us  29655.25us    256.77us ( +-   0.70% )
                 HLT      20440     1.77%    69.83%      0.62us  79319.41us  14134.56us ( +-   0.79% )
              VMCALL      12426     1.07%     0.03%      1.02us   5416.25us      8.77us ( +-   7.36% )
       EXCEPTION_NMI         27     0.00%     0.00%      0.69us      1.34us      0.98us ( +-   3.50% )
       EPT_MISCONFIG          5     0.00%     0.00%      5.15us     10.85us      7.88us ( +-  11.67% )

Total Samples:1157497, Total events handled time:413728274.66us.</pre></div></div><p class="simpara">
						Other event types that can signal problems in the output of <code class="literal">perf kvm stat</code> include:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<code class="literal">INSN_EMULATION</code> - suggests suboptimal <a class="link" href="#optimizing-virtual-machine-i-o-performance_optimizing-virtual-machine-performance-in-rhel" title="13.5.&nbsp;Optimizing virtual machine I/O performance">VM I/O configuration</a>.
							</li></ul></div></li></ol></div><p>
				For more information about using <code class="literal">perf</code> to monitor virtualization performance, see the <code class="literal">perf-kvm</code> man page.
			</p><div class="formalpara"><p class="title"><strong>numastat</strong></p><p>
					To see the current NUMA configuration of your system, you can use the <code class="literal">numastat</code> utility, which is provided by installing the <span class="strong strong"><strong>numactl</strong></span> package.
				</p></div><p>
				The following shows a host with 4 running VMs, each obtaining memory
 from multiple NUMA nodes. This is not optimal for vCPU performance, and
 <a class="link" href="#configuring-numa-in-a-virtual-machine_optimizing-virtual-machine-cpu-performance" title="13.6.3.&nbsp;Configuring NUMA in a virtual machine">warrants adjusting</a>:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--mm54rbp"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># <span class="strong strong"><strong>numastat -c qemu-kvm</strong></span>

Per-node process memory usage (in MBs)
PID              Node 0 Node 1 Node 2 Node 3 Node 4 Node 5 Node 6 Node 7 Total
---------------  ------ ------ ------ ------ ------ ------ ------ ------ -----
51722 (qemu-kvm)     68     16    357   6936      2      3    147    598  8128
51747 (qemu-kvm)    245     11      5     18   5172   2532      1     92  8076
53736 (qemu-kvm)     62    432   1661    506   4851    136     22    445  8116
53773 (qemu-kvm)   1393      3      1      2     12      0      0   6702  8114
---------------  ------ ------ ------ ------ ------ ------ ------ ------ -----
Total              1769    463   2024   7462  10037   2672    169   7837 32434</pre></div></div><p>
				In contrast, the following shows memory being provided to each VM by a single node, which is significantly more efficient.
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--1bfh6av"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># <span class="strong strong"><strong>numastat -c qemu-kvm</strong></span>

Per-node process memory usage (in MBs)
PID              Node 0 Node 1 Node 2 Node 3 Node 4 Node 5 Node 6 Node 7 Total
---------------  ------ ------ ------ ------ ------ ------ ------ ------ -----
51747 (qemu-kvm)      0      0      7      0   8072      0      1      0  8080
53736 (qemu-kvm)      0      0      7      0      0      0   8113      0  8120
53773 (qemu-kvm)      0      0      7      0      0      0      1   8110  8118
59065 (qemu-kvm)      0      0   8050      0      0      0      0      0  8051
---------------  ------ ------ ------ ------ ------ ------ ------ ------ -----
Total                 0      0   8072      0   8072      0   8114   8110 32368</pre></div></div></section><section class="section _additional-resources" id="related-information-optimizing-virtual-machine-performance-in-rhel"><div class="titlepage"><div><div><h2 class="title">13.9. ADDITIONAL RESOURCES</h2></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/configuring_and_managing_virtualization/index#optimizing-windows-virtual-machines-on-rhel_installing-and-managing-windows-virtual-machines-on-rhel">Optimizing Windows virtual machines</a>
					</li></ul></div></section></section><section class="chapter" id="importance-of-power-management_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 14. Importance of power management</h1></div></div></div><p class="_abstract _abstract">
			Reducing the overall power consumption of computer systems helps to 
save cost. Effectively optimizing energy consumption of each system 
component includes studying different tasks that your system performs, 
and configuring each component to ensure that its performance is correct
 for that job. Lowering the power consumption of a specific component or
 of the system as a whole leads to lower heat and performance.
		</p><p>
			Proper power management results in:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					heat reduction for servers and computing centers
				</li><li class="listitem">
					reduced secondary costs, including cooling, space, cables, generators, and uninterruptible power supplies (UPS)
				</li><li class="listitem">
					extended battery life for laptops
				</li><li class="listitem">
					lower carbon dioxide output
				</li><li class="listitem">
					meeting government regulations or legal requirements regarding Green IT, for example, Energy Star
				</li><li class="listitem">
					meeting company guidelines for new systems
				</li></ul></div><p>
			This section describes the information regarding power management of your Red&nbsp;Hat Enterprise&nbsp;Linux systems.
		</p><section class="section" id="power-management-basics_importance-of-power-management"><div class="titlepage"><div><div><h2 class="title">14.1. Power management basics</h2></div></div></div><p class="_abstract _abstract">
				Effective power management is built on the following principles:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">An idle CPU should only wake up when needed</code></span></dt><dd><p class="simpara">
							Since Red&nbsp;Hat Enterprise&nbsp;Linux 6, the kernel runs <code class="literal">tickless</code>,
 which means the previous periodic timer interrupts have been replaced 
with on-demand interrupts. Therefore, idle CPUs are allowed to remain 
idle until a new task is queued for processing, and CPUs that have 
entered lower power states can remain in these states longer. However, 
benefits from this feature can be offset if your system has applications
 that create unnecessary timer events. Polling events, such as checks 
for volume changes or mouse movement, are examples of such events.
						</p><p class="simpara">
							Red&nbsp;Hat Enterprise&nbsp;Linux includes tools using which you
 can identify and audit applications on the basis of their CPU usage. 
For more information see, <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#audit-and-analysis-overview_importance-of-power-management">Audit and analysis overview</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#tools-for-auditing_importance-of-power-management">Tools for auditing</a>.
						</p></dd><dt><span class="term"><code class="literal">Unused hardware and devices should be disabled completely</code></span></dt><dd>
							This is true for devices that have moving parts, for example, 
hard disks. In addition to this, some applications may leave an unused 
but enabled device "open"; when this occurs, the kernel assumes that the
 device is in use, which can prevent the device from going into a power 
saving state.
						</dd><dt><span class="term"><code class="literal">Low activity should translate to low wattage</code></span></dt><dd><p class="simpara">
							In many cases, however, this depends on modern hardware and 
correct BIOS configuration or UEFI on modern systems, including non-x86 
architectures. Make sure that you are using the latest official firmware
 for your systems and that in the power management or device 
configuration sections of the BIOS the power management features are 
enabled. Some features to look for include:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Collaborative Processor Performance Controls (CPPC) support for ARM64
								</li><li class="listitem">
									PowerNV support for IBM Power Systems
								</li><li class="listitem">
									SpeedStep
								</li><li class="listitem">
									PowerNow!
								</li><li class="listitem">
									Cool’n’Quiet
								</li><li class="listitem">
									ACPI (C-state)
								</li><li class="listitem"><p class="simpara">
									Smart
								</p><p class="simpara">
									If your hardware has support for these features and they are 
enabled in the BIOS, Red&nbsp;Hat Enterprise&nbsp;Linux uses them by 
default.
								</p></li></ul></div></dd><dt><span class="term"><code class="literal">Different forms of CPU states and their effects</code></span></dt><dd><p class="simpara">
							Modern CPUs together with Advanced Configuration and Power 
Interface (ACPI) provide different power states. The three different 
states are:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Sleep (C-states)
								</li><li class="listitem">
									Frequency and voltage (P-states)
								</li><li class="listitem"><p class="simpara">
									Heat output (T-states or thermal states)
								</p><p class="simpara">
									A CPU running on the lowest sleep state, consumes the least 
amount of watts, but it also takes considerably more time to wake it up 
from that state when needed. In very rare cases this can lead to the CPU
 having to wake up immediately every time it just went to sleep. This 
situation results in an effectively permanently busy CPU and loses some 
of the potential power saving if another state had been used.
								</p></li></ul></div></dd><dt><span class="term"><code class="literal">A turned off machine uses the least amount of power</code></span></dt><dd>
							One of the best ways to save power is to turn off systems. For 
example, your company can develop a corporate culture focused on "green 
IT" awareness with a guideline to turn off machines during lunch break 
or when going home. You also might consolidate several physical servers 
into one bigger server and virtualize them using the virtualization 
technology, which is shipped with Red&nbsp;Hat Enterprise&nbsp;Linux.
						</dd></dl></div></section><section class="section" id="audit-and-analysis-overview_importance-of-power-management"><div class="titlepage"><div><div><h2 class="title">14.2. Audit and analysis overview</h2></div></div></div><p class="_abstract _abstract">
				The detailed manual audit, analysis, and tuning of a single system 
is usually the exception because the time and cost spent to do so 
typically outweighs the benefits gained from these last pieces of system
 tuning.
			</p><p>
				However, performing these tasks once for a large number of nearly 
identical systems where you can reuse the same settings for all systems 
can be very useful. For example, consider the deployment of thousands of
 desktop systems, or an HPC cluster where the machines are nearly 
identical. Another reason to do auditing and analysis is to provide a 
basis for comparison against which you can identify regressions or 
changes in system behavior in the future. The results of this analysis 
can be very helpful in cases where hardware, BIOS, or software updates 
happen regularly and you want to avoid any surprises with regard to 
power consumption. Generally, a thorough audit and analysis gives you a 
much better idea of what is really happening on a particular system.
			</p><p>
				Auditing and analyzing a system with regard to power consumption is 
relatively hard, even with the most modern systems available. Most 
systems do not provide the necessary means to measure power use via 
software. Exceptions exist though:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						iLO management console of Hewlett Packard server systems has a 
power management module that you can access through the web.
					</li><li class="listitem">
						IBM provides a similar solution in their BladeCenter power management module.
					</li><li class="listitem">
						On some Dell systems, the IT Assistant offers power monitoring capabilities as well.
					</li></ul></div><p>
				Other vendors are likely to offer similar capabilities for their 
server platforms, but as can be seen there is no single solution 
available that is supported by all vendors. Direct measurements of power
 consumption are often only necessary to maximize savings as far as 
possible.
			</p></section><section class="section" id="tools-for-auditing_importance-of-power-management"><div class="titlepage"><div><div><h2 class="title">14.3. Tools for auditing</h2></div></div></div><p class="_abstract _abstract">
				Red&nbsp;Hat Enterprise&nbsp;Linux 8 offers tools using which you 
can perform system auditing and analysis. Most of them can be used as 
supplementary sources of information in case you want to verify what you
 have discovered already or in case you need more in-depth information 
about certain parts.
			</p><p>
				Many of these tools are used for performance tuning as well, which include:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">PowerTOP</code></span></dt><dd>
							It identifies specific components of kernel and user-space applications that frequently wake up the CPU. Use the <code class="literal">powertop</code> command as root to start the <span class="strong strong"><strong>PowerTop</strong></span> tool and <code class="literal">powertop --calibrate</code> to calibrate the power estimation engine. For more information about PowerTop, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#managing-power-consumption-with-powertop_monitoring-and-managing-system-status-and-performance">Managing power consumption with PowerTOP</a>.
						</dd><dt><span class="term"><code class="literal">Diskdevstat and netdevstat</code></span></dt><dd><p class="simpara">
							They are SystemTap tools that collect detailed information about 
the disk activity and network activity of all applications running on a 
system. Using the collected statistics by these tools, you can identify 
applications that waste power with many small I/O operations rather than
 fewer, larger operations. Using the <code class="literal">dnf install tuned-utils-systemtap kernel-debuginfo</code> command as root, install the <code class="literal">diskdevstat</code> and <code class="literal">netdevstat</code> tool.
						</p><p class="simpara">
							To view the detailed information about the disk and network activity, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2fyt6bt"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># diskdevstat

PID   UID   DEV   WRITE_CNT   WRITE_MIN   WRITE_MAX   WRITE_AVG   READ_CNT   READ_MIN   READ_MAX   READ_AVG   COMMAND

3575  1000  dm-2   59          0.000      0.365        0.006        5         0.000        0.000      0.000      mozStorage #5
3575  1000  dm-2    7          0.000      0.000        0.000        0         0.000        0.000      0.000      localStorage DB
[...]


# netdevstat

PID   UID   DEV       XMIT_CNT   XMIT_MIN   XMIT_MAX   XMIT_AVG   RECV_CNT   RECV_MIN   RECV_MAX   RECV_AVG   COMMAND
3572  991  enp0s31f6    40       0.000      0.882       0.108        0         0.000       0.000       0.000     openvpn
3575  1000 enp0s31f6    27       0.000      1.363       0.160        0         0.000       0.000       0.000     Socket Thread
[...]</pre></div></div><p class="simpara">
							With these commands, you can specify three parameters: <code class="literal">update_interval</code>, <code class="literal">total_duration</code>, and <code class="literal">display_histogram</code>.
						</p></dd><dt><span class="term"><code class="literal">TuneD</code></span></dt><dd>
							It is a profile-based system tuning tool that uses the <code class="literal">udev</code> device manager to monitor connected devices, and enables both static and dynamic tuning of system settings. You can use the <code class="literal">tuned-adm recommend</code>
 command to determine which profile Red&nbsp;Hat recommends as the most 
suitable for a particular product. For more information about TuneD, see
 <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#getting-started-with-tuned_monitoring-and-managing-system-status-and-performance">Getting started with TuneD</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance">Customizing TuneD profiles</a>. Using the <code class="literal">powertop2tuned utility</code>, you can create custom TuneD profiles from <code class="literal">PowerTOP</code> suggestions. For information about the <code class="literal">powertop2tuned</code> utility, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#optimizing-power-consumption_managing-power-consumption-with-powertop">Optimizing power consumption</a>.
						</dd><dt><span class="term"><code class="literal">Virtual memory statistics (vmstat)</code></span></dt><dd><p class="simpara">
							It is provided by the <code class="literal">procps-ng</code> 
package. Using this tool, you can view the detailed information about 
processes, memory, paging, block I/O, traps, and CPU activity.
						</p><p class="simpara">
							To view this information, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--v1or1ig"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ vmstat
procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----
r  b  swpd  free    buff   cache   si   so  bi   bo   in  cs  us  sy id  wa  st
1  0   0   5805576 380856 4852848   0    0  119  73  814  640  2   2 96   0   0</pre></div></div><p class="simpara">
							Using the <code class="literal">vmstat -a</code> command, you can display active and inactive memory. For more information about other <code class="literal">vmstat</code> options, see the <code class="literal">vmstat</code> man page.
						</p></dd><dt><span class="term"><code class="literal">iostat</code></span></dt><dd><p class="simpara">
							It is provided by the <code class="literal">sysstat</code> package. This tool is similar to <code class="literal">vmstat</code>, but only for monitoring I/O on block devices. It also provides more verbose output and statistics.
						</p><p class="simpara">
							To monitor the system I/O, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--9tjd1u3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ iostat
avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           2.05    0.46    1.55    0.26    0.00   95.67

Device     tps     kB_read/s    kB_wrtn/s    kB_read    kB_wrtn
nvme0n1    53.54     899.48     616.99      3445229     2363196
dm-0       42.84     753.72     238.71      2886921      914296
dm-1        0.03       0.60       0.00         2292           0
dm-2       24.15     143.12     379.80       548193     1454712</pre></div></div></dd><dt><span class="term"><code class="literal">blktrace</code></span></dt><dd><p class="simpara">
							It provides detailed information about how time is spent in the I/O subsystem.
						</p><p class="simpara">
							To view this information in human readable format, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--osry1lj"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># blktrace -d /dev/dm-0 -o - | blkparse -i -

253,0   1    1   0.000000000  17694  Q   W 76423384 + 8 [kworker/u16:1]
253,0   2    1   0.001926913     0   C   W 76423384 + 8 [0]
[...]</pre></div></div><p class="simpara">
							Here, The first column, <span class="strong strong"><strong>253,0</strong></span> is the device major and minor tuple. The second column, <span class="strong strong"><strong>1</strong></span>, gives information about the CPU, followed by columns for timestamps and PID of the process issuing the IO process.
						</p><p class="simpara">
							The sixth column, <span class="strong strong"><strong>Q</strong></span>, shows the event type, the 7th column, <span class="strong strong"><strong>W</strong></span> for write operation, the 8th column, <span class="strong strong"><strong>76423384</strong></span>, is the block number, and the <span class="strong strong"><strong>+ 8</strong></span> is the number of requested blocks.
						</p><p class="simpara">
							The last field, <span class="strong strong"><strong>[kworker/u16:1]</strong></span>, is the process name.
						</p><p class="simpara">
							By default, the <code class="literal">blktrace</code> command runs forever until the process is explicitly killed. Use the <code class="literal">-w</code> option to specify the run-time duration.
						</p></dd><dt><span class="term"><code class="literal">turbostat</code></span></dt><dd><p class="simpara">
							It is provided by the <code class="literal">kernel-tools</code> 
package. It reports on processor topology, frequency, idle power-state 
statistics, temperature, and power usage on x86-64 processors.
						</p><p class="simpara">
							To view this summary, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--o5po96y"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed"># turbostat

CPUID(0): GenuineIntel 0x16 CPUID levels; 0x80000008 xlevels; family:model:stepping 0x6:8e:a (6:142:10)
CPUID(1): SSE3 MONITOR SMX EIST TM2 TSC MSR ACPI-TM HT TM
CPUID(6): APERF, TURBO, DTS, PTM, HWP, HWPnotify, HWPwindow, HWPepp, No-HWPpkg, EPB
[...]</pre></div></div><p class="simpara">
							By default, <code class="literal">turbostat</code> prints a 
summary of counter results for the entire screen, followed by counter 
results every 5 seconds. Specify a different period between counter 
results with the <code class="literal">-i</code> option, for example, execute <code class="literal">turbostat -i 10</code> to print results every 10 seconds instead.
						</p><p class="simpara">
							<span class="strong strong"><strong>Turbostat</strong></span> is 
also useful for identifying servers that are inefficient in terms of 
power usage or idle time. It also helps to identify the rate of system 
management interrupts (SMIs) occurring on the system. It can also be 
used to verify the effects of power management tuning.
						</p></dd><dt><span class="term"><code class="literal">cpupower</code></span></dt><dd><p class="simpara">
							IT is a collection of tools to examine and tune power saving related features of processors. Use the <code class="literal">cpupower</code> command with the <code class="literal">frequency-info</code>, <code class="literal">frequency-set</code>, <code class="literal">idle-info</code>, <code class="literal">idle-set</code>, <code class="literal">set</code>, <code class="literal">info</code>, and <code class="literal">monitor</code> options to display and set processor related values.
						</p><p class="simpara">
							For example, to view available cpufreq governors, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--sunbx04"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout white-space-pre language-none codeblock codeblock--processed">$ cpupower frequency-info --governors
analyzing CPU 0:
  available cpufreq governors: performance powersave</pre></div></div><p class="simpara">
							For more information about <code class="literal">cpupower</code>, see Viewing CPU related information.
						</p></dd><dt><span class="term"><code class="literal">GNOME Power Manager</code></span></dt><dd>
							It is a daemon that is installed as part of the GNOME desktop 
environment. GNOME Power Manager notifies you of changes in your 
system’s power status; for example, a change from battery to AC power. 
It also reports battery status, and warns you when battery power is low.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">powertop(1)</code>, <code class="literal">diskdevstat(8)</code>, <code class="literal">netdevstat(8)</code>, <code class="literal">tuned(8)</code>, <code class="literal">vmstat(8)</code>, <code class="literal">iostat(1)</code>, <code class="literal">blktrace(8)</code>, <code class="literal">blkparse(8)</code>, and <code class="literal">turbostat(8)</code> man pages
					</li><li class="listitem">
						<code class="literal">cpupower(1)</code>, <code class="literal">cpupower-set(1)</code>, <code class="literal">cpupower-info(1)</code>, <code class="literal">cpupower-idle(1)</code>, <code class="literal">cpupower-frequency-set(1)</code>, <code class="literal">cpupower-frequency-info(1)</code>, and <code class="literal">cpupower-monitor(1)</code> man pages
					</li></ul></div></section></section><section class="chapter" id="managing-power-consumption-with-powertop_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 15. Managing power consumption with PowerTOP</h1></div></div></div><p>
			As a system administrator, you can use the <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> tool to analyze and manage power consumption.
		</p><section class="section" id="the-purpose-of-powertop_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h2 class="title">15.1. The purpose of PowerTOP</h2></div></div></div><p>
				<span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> is a program that diagnoses issues related to power consumption and provides suggestions on how to extend battery lifetime.
			</p><p>
				The <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>
 tool can provide an estimate of the total power usage of the system and
 also individual power usage for each process, device, kernel worker, 
timer, and interrupt handler. The tool can also identify specific 
components of kernel and user-space applications that frequently wake up
 the CPU.
			</p><p>
				Red&nbsp;Hat Enterprise&nbsp;Linux 9 uses version 2.x of <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>.
			</p></section><section class="section" id="using-powertop_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h2 class="title">15.2. Using PowerTOP</h2></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To be able to use <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>, make sure that the <code class="literal package">powertop</code> package has been installed on your system:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--bvj78v7"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install powertop</pre></div></div></li></ul></div><section class="section" id="starting-powertop_using-powertop"><div class="titlepage"><div><div><h3 class="title">15.2.1. Starting PowerTOP</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							To run <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>, use the following command:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--e21aug1"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># powertop</pre></div></div></li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Laptops should run on battery power when running the <code class="literal package">powertop</code> command.
					</p></div></div></section><section class="section" id="calibrating-powertop_using-powertop"><div class="titlepage"><div><div><h3 class="title">15.2.2. Calibrating PowerTOP</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							On a laptop, you can calibrate the power estimation engine by running the following command:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--h92bod3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># powertop --calibrate</pre></div></div></li><li class="listitem"><p class="simpara">
							Let the calibration finish without interacting with the machine during the process.
						</p><p class="simpara">
							Calibration takes time because the process performs various 
tests, cycles through brightness levels and switches devices on and off.
						</p></li><li class="listitem"><p class="simpara">
							When the calibration process is completed, <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> starts as normal. Let it run for approximately an hour to collect data.
						</p><p class="simpara">
							When enough data is collected, power estimation figures will be displayed in the first column of the output table.
						</p></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Note that <code class="literal command">powertop --calibrate</code> can only be used on laptops.
					</p></div></div></section><section class="section" id="setting-the-measuring-interval_using-powertop"><div class="titlepage"><div><div><h3 class="title">15.2.3. Setting the measuring interval</h3></div></div></div><p>
					By default, <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> takes measurements in 20 seconds intervals.
				</p><p>
					If you want to change this measuring frequency, use the following procedure:
				</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Run the <code class="literal command">powertop</code> command with the <code class="literal option">--time</code> option:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--l1zbqb5"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># powertop --time=<span class="emphasis"><em><span class="replaceable replaceable">time in seconds</span></em></span></pre></div></div></li></ul></div></section><section class="section _additional-resources" id="related-information-using-powertop"><div class="titlepage"><div><div><h3 class="title">15.2.4. ADDITIONAL RESOURCES</h3></div></div></div><p>
					For more details on how to use <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>, see the <code class="literal">powertop</code> man page.
				</p></section></section><section class="section" id="powertop-statistics_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h2 class="title">15.3. PowerTOP statistics</h2></div></div></div><p>
				While it runs, <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> gathers statistics from the system.
			</p><p>
				<span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>'s output provides multiple tabs:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">Overview</code>
					</li><li class="listitem">
						<code class="literal">Idle stats</code>
					</li><li class="listitem">
						<code class="literal">Frequency stats</code>
					</li><li class="listitem">
						<code class="literal">Device stats</code>
					</li><li class="listitem">
						<code class="literal">Tunables</code>
					</li><li class="listitem">
						<code class="literal">WakeUp</code>
					</li></ul></div><p>
				You can use the <code class="literal">Tab</code> and <code class="literal">Shift+Tab</code> keys to cycle through these tabs.
			</p><section class="section" id="overview-tab_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h3 class="title">15.3.1. The Overview tab</h3></div></div></div><p>
					In the <code class="literal">Overview</code> tab, you can view a 
list of the components that either send wakeups to the CPU most 
frequently or consume the most power. The items within the <code class="literal">Overview</code> tab, including processes, interrupts, devices, and other resources, are sorted according to their utilization.
				</p><p>
					The adjacent columns within the <code class="literal">Overview</code> tab provide the following pieces of information:
				</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Usage</span></dt><dd>
								Power estimation of how the resource is being used.
							</dd><dt><span class="term">Events/s</span></dt><dd>
								Wakeups per second. The number of wakeups per second indicates 
how efficiently the services or the devices and drivers of the kernel 
are performing. Less wakeups means that less power is consumed. 
Components are ordered by how much further their power usage can be 
optimized.
							</dd><dt><span class="term">Category</span></dt><dd>
								Classification of the component; such as process, device, or timer.
							</dd><dt><span class="term">Description</span></dt><dd>
								Description of the component.
							</dd></dl></div><p>
					If properly calibrated, a power consumption estimation for every listed item in the first column is shown as well.
				</p><p>
					Apart from this, the <code class="literal">Overview</code> tab includes the line with summary statistics such as:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Total power consumption
						</li><li class="listitem">
							Remaining battery life (only if applicable)
						</li><li class="listitem">
							Summary of total wakeups per second, GPU operations per second, and virtual file system operations per second
						</li></ul></div></section><section class="section" id="idle-stats-tab_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h3 class="title">15.3.2. The Idle stats tab</h3></div></div></div><p>
					The <code class="literal">Idle stats</code> tab shows usage of C-states for all processors and cores, while the <code class="literal">Frequency stats</code>
 tab shows usage of P-states including the Turbo mode, if applicable, 
for all processors and cores. The duration of C- or P-states is an 
indication of how well the CPU usage has been optimized. The longer the 
CPU stays in the higher C- or P-states (for example C4 is higher than 
C3), the better the CPU usage optimization is. Ideally, residency is 90%
 or more in the highest C- or P-state when the system is idle.
				</p></section><section class="section" id="device-stats-tab_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h3 class="title">15.3.3. The Device stats tab</h3></div></div></div><p>
					The <code class="literal">Device stats</code> tab provides similar information to the <code class="literal">Overview</code> tab but only for devices.
				</p></section><section class="section" id="tunables-tab_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h3 class="title">15.3.4. The Tunables tab</h3></div></div></div><p>
					The <code class="literal">Tunables</code> tab contains <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>'s suggestions for optimizing the system for lower power consumption.
				</p><p>
					Use the <code class="literal">up</code> and <code class="literal">down</code> keys to move through suggestions, and the <code class="literal">enter</code> key to toggle the suggestion on or off.
				</p></section><section class="section" id="wakeup-tab_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h3 class="title">15.3.5. The WakeUp tab</h3></div></div></div><p>
					The <code class="literal">WakeUp</code> tab displays the device wakeup settings available for users to change as and when required.
				</p><p>
					Use the <code class="literal">up</code> and <code class="literal">down</code> keys to move through the available settings, and the <code class="literal">enter</code> key to enable or disable a setting.
				</p><div class="figure" id="idm140611495970352"><p class="title">Figure 15.1. PowerTOP output</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/99b231a090ded326ccc3823ca0f7f134/powertop2-14.png" class="rh_docs--zoom" title="powertop2 14"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/powertop2-14.png" alt="powertop2 14"></a></div></div></div><div class="_additional-resources _additional-resources"><p class="title"><strong>Additional resources</strong></p><p>
						For more details on <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>, see <a class="link" href="https://01.org/powertop/">PowerTOP’s home page</a>.
					</p></div></section></section><section class="section" id="con_why-powertop-does-not-display-frequency-stats-values-in-some-instances_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h2 class="title">15.4. Why Powertop does not display Frequency stats values in some instances</h2></div></div></div><p class="_abstract _abstract">
				While using the Intel P-State driver, PowerTOP only displays values in the <code class="literal">Frequency Stats</code> tab if the driver is in passive mode. But, even in this case, the values may be incomplete.
			</p><p>
				In total, there are three possible modes of the Intel P-State driver:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Active mode with Hardware P-States (HWP)
					</li><li class="listitem">
						Active mode without HWP
					</li><li class="listitem">
						Passive mode
					</li></ul></div><p>
				Switching to the ACPI CPUfreq driver results in complete information
 being displayed by PowerTOP. However, it is recommended to keep your 
system on the default settings.
			</p><p>
				To see what driver is loaded and in what mode, run:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--zl9zq9g"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_driver</pre></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">intel_pstate</code> is returned if the Intel P-State driver is loaded and in active mode.
					</li><li class="listitem">
						<code class="literal">intel_cpufreq</code> is returned if the Intel P-State driver is loaded and in passive mode.
					</li><li class="listitem">
						<code class="literal">acpi-cpufreq</code> is returned if the ACPI CPUfreq driver is loaded.
					</li></ul></div><p>
				While using the Intel P-State driver, add the following argument to 
the kernel boot command line to force the driver to run in passive mode:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--0wh8p10"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">intel_pstate=passive</pre></div></div><p>
				To disable the Intel P-State driver and use, instead, the ACPI 
CPUfreq driver, add the following argument to the kernel boot command 
line:
			</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--93jk5ug"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">intel_pstate=disable</pre></div></div></section><section class="section" id="generating-an-html-output_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h2 class="title">15.5. Generating an HTML output</h2></div></div></div><p>
				Apart from the <code class="literal command">powertop’s</code> output in terminal, you can also generate an HTML report.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <code class="literal command">powertop</code> command with the <code class="literal option">--html</code> option:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--892ytx3"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># powertop --html=htmlfile.html</pre></div></div><p class="simpara">
						Replace the <code class="literal">htmlfile.html</code> parameter with the required name for the output file.
					</p></li></ul></div></section><section class="section" id="optimizing-power-consumption_managing-power-consumption-with-powertop"><div class="titlepage"><div><div><h2 class="title">15.6. Optimizing power consumption</h2></div></div></div><p>
				To optimize power consumption, you can use either the <code class="literal">powertop</code> service or the <code class="literal">powertop2tuned</code> utility.
			</p><section class="section" id="optimizing-power-consumption-using-the-powertop-service_optimizing-power-consumption"><div class="titlepage"><div><div><h3 class="title">15.6.1. Optimizing power consumption using the powertop service</h3></div></div></div><p>
					You can use the <code class="literal">powertop</code> service to automatically enable all <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>'s suggestions from the <code class="literal">Tunables</code> tab on the boot:
				</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Enable the <code class="literal">powertop</code> service:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--nibrdij"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># systemctl enable powertop</pre></div></div></li></ul></div></section><section class="section" id="powertop2tuned-utility_optimizing-power-consumption"><div class="titlepage"><div><div><h3 class="title">15.6.2. The powertop2tuned utility</h3></div></div></div><p>
					The <code class="literal">powertop2tuned</code> utility allows you to create custom <span class="strong strong"><strong><span class="application application">TuneD</span></strong></span> profiles from <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> suggestions.
				</p><p>
					By default, <code class="literal">powertop2tuned</code> creates profiles in the <code class="literal filename">/etc/tuned/</code> directory, and bases the custom profile on the currently selected <span class="strong strong"><strong><span class="application application">TuneD</span></strong></span> profile. For safety reasons, all <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> tunings are initially disabled in the new profile.
				</p><p>
					To enable the tunings, you can:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Uncomment them in the <code class="literal filename">/etc/tuned/profile_name/tuned.conf file</code>.
						</li><li class="listitem"><p class="simpara">
							Use the <code class="literal option">--enable</code> or <code class="literal option">-e</code> option to generate a new profile that enables most of the tunings suggested by <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span>.
						</p><p class="simpara">
							Certain potentially problematic tunings, such as the USB 
autosuspend, are disabled by default and need to be uncommented 
manually.
						</p></li></ul></div></section><section class="section" id="optimizing-power-consumption-with-powertop2tuned_optimizing-power-consumption"><div class="titlepage"><div><div><h3 class="title">15.6.3. Optimizing power consumption using the powertop2tuned utility</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							The <code class="literal">powertop2tuned</code> utility is installed on the system:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--1m6ovii"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># dnf install tuned-utils</pre></div></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create a custom profile:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3q7k9wa"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># powertop2tuned new_profile_name</pre></div></div></li><li class="listitem"><p class="simpara">
							Activate the new profile:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--yfyrbpr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed"># tuned-adm profile new_profile_name</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Additional information</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							For a complete list of options that <code class="literal">powertop2tuned</code> supports, use:
						</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--4mrn1rw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="literallayout language-none codeblock codeblock--processed">$ powertop2tuned --help</pre></div></div></li></ul></div></section><section class="section" id="con_comparison-of-powertop-service-and-powertop2tuned_optimizing-power-consumption"><div class="titlepage"><div><div><h3 class="title">15.6.4. Comparison of powertop.service and powertop2tuned</h3></div></div></div><p>
					Optimizing power consumption with <code class="literal">powertop2tuned</code> is preferred over <code class="literal">powertop.service</code> for the following reasons:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">powertop2tuned</code> utility represents integration of <span class="strong strong"><strong><span class="application application">PowerTOP</span></strong></span> into <span class="strong strong"><strong><span class="application application">TuneD</span></strong></span>, which enables to benefit of advantages of both tools.
						</li><li class="listitem">
							The <code class="literal">powertop2tuned</code> utility allows for fine-grained control of enabled tuning.
						</li><li class="listitem">
							With <code class="literal">powertop2tuned</code>, potentially dangerous tuning are not automatically enabled.
						</li><li class="listitem">
							With <code class="literal">powertop2tuned</code>, rollback is possible without reboot.
						</li></ul></div></section></section></section><section class="chapter" id="getting-started-with-perf_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 16. Getting started with perf</h1></div></div></div><p class="_abstract _abstract">
			As a system administrator, you can use the <code class="literal">perf</code> tool to collect and analyze performance data of your system.
		</p><section class="section" id="introduction-to-perf_getting-started-with-perf"><div class="titlepage"><div><div><h2 class="title">16.1. Introduction to perf</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">perf</code> user-space tool interfaces with the kernel-based subsystem <span class="emphasis"><em>Performance Counters for Linux</em></span> (PCL). <code class="literal">perf</code>
 is a powerful tool that uses the Performance Monitoring Unit (PMU) to 
measure, record, and monitor a variety of hardware and software events. <code class="literal">perf</code> also supports tracepoints, kprobes, and uprobes.
			</p></section><section class="section" id="installing-perf_getting-started-with-perf"><div class="titlepage"><div><div><h2 class="title">16.2. Installing perf</h2></div></div></div><p class="_abstract _abstract">
				This procedure installs the <code class="literal">perf</code> user-space tool.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Install the <code class="literal">perf</code> tool:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--r4z33h7"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf install perf</pre></div></div></li></ul></div></section><section class="section" id="common-perf-commands_getting-started-with-perf"><div class="titlepage"><div><div><h2 class="title">16.3. Common perf commands</h2></div></div></div><div class="variablelist _abstract"><dl class="variablelist _abstract"><dt><span class="term"><code class="literal command">perf stat</code> </span></dt><dd>
							This command provides overall statistics for common performance 
events, including instructions executed and clock cycles consumed. 
Options allow for selection of events other than the default measurement
 events.
						</dd><dt><span class="term"><code class="literal command">perf record</code> </span></dt><dd>
							This command records performance data into a file, <code class="literal">perf.data</code>, which can be later analyzed using the <code class="literal">perf report</code> command.
						</dd><dt><span class="term"><code class="literal command">perf report</code> </span></dt><dd>
							This command reads and displays the performance data from the <code class="literal">perf.data</code> file created by <code class="literal">perf record</code>.
						</dd><dt><span class="term"><code class="literal command">perf list</code> </span></dt><dd>
							This command lists the events available on a particular machine. 
These events will vary based on performance monitoring hardware and 
software configuration of the system.
						</dd><dt><span class="term"><code class="literal command">perf top</code> </span></dt><dd>
							This command performs a similar function to the <code class="literal">top</code> utility. It generates and displays a performance counter profile in realtime.
						</dd><dt><span class="term"><code class="literal command">perf trace</code> </span></dt><dd>
							This command performs a similar function to the <code class="literal">strace</code> tool. It monitors the system calls used by a specified thread or process and all signals received by that application.
						</dd><dt><span class="term"><code class="literal command">perf help</code> </span></dt><dd>
							This command displays a complete list of <code class="literal">perf</code> commands.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						Add the <code class="literal">--help</code> option to a subcommand to open the man page.
					</li></ul></div></section></section><section class="chapter" id="profiling-cpu-usage-in-real-time-with-top_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 17. Profiling CPU usage in real time with perf top</h1></div></div></div><p class="_abstract _abstract">
			You can use the <code class="literal command">perf top</code> command to measure CPU usage of different functions in real time.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
				</li></ul></div><section class="section" id="the-purpose-of-perf-top_profiling-cpu-usage-in-real-time-with-top"><div class="titlepage"><div><div><h2 class="title">17.1. The purpose of perf top</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal command">perf top</code> command is used for real time system profiling and functions similarly to the <code class="literal">top</code> utility. However, where the <code class="literal">top</code> utility generally shows you how much CPU time a given process or thread is using, <code class="literal command">perf top</code> shows you how much CPU time each specific function uses. In its default state, <code class="literal command">perf top</code> tells you about functions being used across all CPUs in both the user-space and the kernel-space. To use <code class="literal command">perf top</code> you need root access.
			</p></section><section class="section" id="profiling-cpu-usage-with-perf-top_profiling-cpu-usage-in-real-time-with-top"><div class="titlepage"><div><div><h2 class="title">17.2. Profiling CPU usage with perf top</h2></div></div></div><p class="_abstract _abstract">
				This procedure activates <code class="literal">perf top</code> and profiles CPU usage in real time.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem">
						You have root access
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Start the <code class="literal">perf top</code> monitoring interface:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7y9251c"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf top</pre></div></div><p class="simpara">
						The monitoring interface looks similar to the following:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--151d6iw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">Samples: 8K of event 'cycles', 2000 Hz, Event count (approx.): 4579432780 lost: 0/0 drop: 0/0
Overhead  Shared Object       Symbol
   2.20%  [kernel]            [k] do_syscall_64
   2.17%  [kernel]            [k] module_get_kallsym
   1.49%  [kernel]            [k] copy_user_enhanced_fast_string
   1.37%  libpthread-2.29.so  [.] <span class="emphasis"><em>pthread_mutex_lock 1.31% [unknown] [.] 0000000000000000 1.07% [kernel] [k] psi_task_change 1.04% [kernel] [k] switch_mm_irqs_off 0.94% [kernel] [k] </em></span>fget
   0.74%  [kernel]            [k] entry_SYSCALL_64
   0.69%  [kernel]            [k] syscall_return_via_sysret
   0.69%  libxul.so           [.] 0x000000000113f9b0
   0.67%  [kernel]            [k] kallsyms_expand_symbol.constprop.0
   0.65%  firefox             [.] moz_xmalloc
   0.65%  libpthread-2.29.so  [.] __pthread_mutex_unlock_usercnt
   0.60%  firefox             [.] free
   0.60%  libxul.so           [.] 0x000000000241d1cd
   0.60%  [kernel]            [k] do_sys_poll
   0.58%  [kernel]            [k] menu_select
   0.56%  [kernel]            [k] _raw_spin_lock_irqsave
   0.55%  perf                [.] 0x00000000002ae0f3</pre></div></div><p class="simpara">
						In this example, the kernel function <code class="literal">do_syscall_64</code> is using the most CPU time.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-top(1)</code> man page
					</li></ul></div></section><section class="section" id="interpretation-of-perf-top-output_profiling-cpu-usage-in-real-time-with-top"><div class="titlepage"><div><div><h2 class="title">17.3. Interpretation of perf top output</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">perf top</code> monitoring interface displays the data in several columns:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The "Overhead" column </span></dt><dd>
							Displays the percent of CPU a given function is using.
						</dd><dt><span class="term">The "Shared Object" column </span></dt><dd>
							Displays name of the program or library which is using the function.
						</dd><dt><span class="term">The "Symbol" column </span></dt><dd>
							Displays the function name or symbol. Functions executed in the kernel-space are identified by <code class="literal">[k]</code> and functions executed in the user-space are identified by <code class="literal">[.]</code>.
						</dd></dl></div></section><section class="section" id="why-perf-displays-some-function-names-as-raw-function-addresses_profiling-cpu-usage-in-real-time-with-top"><div class="titlepage"><div><div><h2 class="title">17.4. Why perf displays some function names as raw function addresses</h2></div></div></div><p class="_abstract _abstract">
				For kernel functions, <code class="literal">perf</code> uses the information from the <code class="literal">/proc/kallsyms</code>
 file to map the samples to their respective function names or symbols. 
For functions executed in the user space, however, you might see raw 
function addresses because the binary is stripped.
			</p><p>
				The <code class="literal literal">debuginfo</code> package of the 
executable must be installed or, if the executable is a locally 
developed application, the application must be compiled with debugging 
information turned on (the <code class="literal option">-g</code> option in GCC) to display the function names or symbols in such a situation.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					It is not necessary to re-run the <code class="literal command">perf record</code> command after installing the <code class="literal literal">debuginfo</code> associated with an executable. Simply re-run the <code class="literal command">perf report</code> command.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional Resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/debugging-applications_developing-applications#enabling-debugging-with-debugging-information_debugging-applications">Enabling debugging with debugging information</a>
					</li></ul></div></section><section class="section" id="enabling-debug-and-source-repositories_profiling-cpu-usage-in-real-time-with-top"><div class="titlepage"><div><div><h2 class="title">17.5. Enabling debug and source repositories</h2></div></div></div><p class="_abstract _abstract">
				A standard installation of Red&nbsp;Hat Enterprise&nbsp;Linux does 
not enable the debug and source repositories. These repositories contain
 information needed to debug the system components and measure their 
performance.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Enable the source and debug information package channels: The <code class="literal">$(uname -i)</code> part is automatically replaced with a matching value for architecture of your system:
					</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="iopxych" id="rh-table--iopxych"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><thead><tr><th id="idm140611466374240" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Architecture name</th><th id="idm140611466373152" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Value</th></tr></thead><tbody><tr><td headers="idm140611466374240" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
										64-bit Intel and AMD
									</p>
									 </td><td headers="idm140611466373152" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
										x86_64
									</p>
									 </td></tr><tr><td headers="idm140611466374240" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
										64-bit ARM
									</p>
									 </td><td headers="idm140611466373152" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
										aarch64
									</p>
									 </td></tr><tr><td headers="idm140611466374240" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
										IBM POWER
									</p>
									 </td><td headers="idm140611466373152" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
										ppc64le
									</p>
									 </td></tr><tr><td headers="idm140611466374240" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
										64-bit IBM Z
									</p>
									 </td><td headers="idm140611466373152" data-row="5" data-col="2" class="content--md" valign="top" align="left"> <p>
										s390x
									</p>
									 </td></tr></tbody></table></rh-table></li></ul></div></section><section class="section" id="getting-debuginfo-packages-for-an-application-or-library-using-gdb_profiling-cpu-usage-in-real-time-with-top"><div class="titlepage"><div><div><h2 class="title">17.6. Getting debuginfo packages for an application or library using GDB</h2></div></div></div><p class="_abstract _abstract">
				Debugging information is required to debug code. For code that is 
installed from a package, the GNU Debugger (GDB) automatically 
recognizes missing debug information, resolves the package name and 
provides concrete advice on how to get the package.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The application or library you want to debug must be installed on the system.
					</li><li class="listitem">
						GDB and the <code class="literal command">debuginfo-install</code> tool must be installed on the system. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/setting-up-a-development-workstation_developing-applications#setting-up-to-debug-applications_setting-up-a-development-workstation">Setting up to debug applications</a>.
					</li><li class="listitem">
						Repositories providing <code class="literal">debuginfo</code> and <code class="literal">debugsource</code> packages must be configured and enabled on the system. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/developing_c_and_cpp_applications_in_rhel_9/index#enabling-debug-and-source-repositories_setting-up-a-development-workstation">Enabling debug and source repositories</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Start GDB attached to the application or library you want to 
debug. GDB automatically recognizes missing debugging information and 
suggests a command to run.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ko4ep1r"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ gdb -q /bin/ls
Reading symbols from /bin/ls...Reading symbols from .gnu_debugdata for /usr/bin/ls...(no debugging symbols found)...done.
(no debugging symbols found)...done.
Missing separate debuginfos, use: dnf <span class="emphasis"><em>debuginfo-install coreutils-8.30-6.el8.x86_64</em></span>
(gdb)</pre></div></div></li><li class="listitem"><p class="simpara">
						Exit GDB: type <span class="keycap"><strong>q</strong></span> and confirm with <span class="keycap"><strong>Enter</strong></span>.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--p6egxdr"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">(gdb) q</pre></div></div></li><li class="listitem"><p class="simpara">
						Run the command suggested by GDB to install the required <code class="literal">debuginfo</code> packages:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--dn6lyvq"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf debuginfo-install coreutils-8.30-6.el8.x86_64</pre></div></div><p class="simpara">
						The <code class="literal">dnf</code> package management tool 
provides a summary of the changes, asks for confirmation and once you 
confirm, downloads and installs all the necessary files.
					</p></li><li class="listitem">
						In case GDB is not able to suggest the <code class="literal">debuginfo</code> package, follow the procedure described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/debugging-applications_developing-applications#getting-debuginfo-packages-for-an-application-or-library-manually_enabling-debugging-with-debugging-information">Getting debuginfo packages for an application or library manually</a>.
					</li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_developer_toolset/10/html-single/user_guide/index#sect-Red_Hat_Developer_Toolset-Install-Debugging">Red Hat Developer Toolset User Guide, section Installing Debugging Information</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/9907">How can I download or install debuginfo packages for RHEL systems?</a> — Red&nbsp;Hat Knowledgebase solution
					</li></ul></div></section></section><section class="chapter" id="counting-events-during-process-execution-with-perf-stat_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 18. Counting events during process execution with perf stat</h1></div></div></div><p class="_abstract _abstract">
			You can use the <code class="literal command">perf stat</code> command to count hardware and software events during process execution.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
				</li></ul></div><section class="section" id="the-purpose-of-perf-stat_counting-events-during-process-execution-with-perf-stat"><div class="titlepage"><div><div><h2 class="title">18.1. The purpose of perf stat</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal command">perf stat</code> command executes a
 specified command, keeps a running count of hardware and software event
 occurrences during the commands execution, and generates statistics of 
these counts. If you do not specify any events, then <code class="literal command">perf stat</code> counts a set of common hardware and software events.
			</p></section><section class="section" id="counting-events-with-perf-stat_counting-events-during-process-execution-with-perf-stat"><div class="titlepage"><div><div><h2 class="title">18.2. Counting events with perf stat</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">perf stat</code> to count hardware and software event occurrences during command execution and generate statistics of these counts. By default, <code class="literal">perf stat</code> operates in per-thread mode.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Count the events.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								Running the <code class="literal command">perf stat</code> command without root access will only count events occurring in the user space:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--za69lk6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ perf stat ls</pre></div></div><div class="example" id="idm140611465190560"><p class="title">Example 18.1. Output of perf stat ran without root access</p><div class="example-contents"><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jgzzh1i"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">Desktop  Documents  Downloads  Music  Pictures  Public  Templates  Videos

 Performance counter stats for 'ls':

              1.28 msec task-clock:u               #    0.165 CPUs utilized
                 0      context-switches:u         #    0.000 M/sec
                 0      cpu-migrations:u           #    0.000 K/sec
               104      page-faults:u              #    0.081 M/sec
         1,054,302      cycles:u                   #    0.823 GHz
         1,136,989      instructions:u             #    1.08  insn per cycle
           228,531      branches:u                 #  178.447 M/sec
            11,331      branch-misses:u            #    4.96% of all branches

       0.007754312 seconds time elapsed

       0.000000000 seconds user
       0.007717000 seconds sys</pre></div></div></div></div><p class="simpara">
								As you can see in the previous example, when <code class="literal">perf stat</code> runs without root access the event names are followed by <code class="literal">:u</code>, indicating that these events were counted only in the user-space.
							</p></li><li class="listitem"><p class="simpara">
								To count both user-space and kernel-space events, you must have root access when running <code class="literal command">perf stat</code>:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--r1bapny"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf stat ls</pre></div></div><div class="example" id="idm140611467462176"><p class="title">Example 18.2. Output of perf stat ran with root access</p><div class="example-contents"><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ynsoeht"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">Desktop  Documents  Downloads  Music  Pictures  Public  Templates  Videos

 Performance counter stats for 'ls':

              3.09 msec task-clock                #    0.119 CPUs utilized
                18      context-switches          #    0.006 M/sec
                 3      cpu-migrations            #    0.969 K/sec
               108      page-faults               #    0.035 M/sec
         6,576,004      cycles                    #    2.125 GHz
         5,694,223      instructions              #    0.87  insn per cycle
         1,092,372      branches                  #  352.960 M/sec
            31,515      branch-misses             #    2.89% of all branches

       0.026020043 seconds time elapsed

       0.000000000 seconds user
       0.014061000 seconds sys</pre></div></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem"><p class="simpara">
										By default, <code class="literal">perf stat</code> operates in per-thread mode. To change to CPU-wide event counting, pass the <code class="literal">-a</code> option to <code class="literal">perf stat</code>. To count CPU-wide events, you need root access:
									</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--do2v59t"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf stat -a ls</pre></div></div></li></ul></div></li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-stat(1)</code> man page
					</li></ul></div></section><section class="section" id="interpretation-of-perf-stat-output_counting-events-during-process-execution-with-perf-stat"><div class="titlepage"><div><div><h2 class="title">18.3. Interpretation of perf stat output</h2></div></div></div><p class="_abstract _abstract">
				<code class="literal">perf stat</code> executes a specified command 
and counts event occurrences during the commands execution and displays 
statistics of these counts in three columns:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						The number of occurrences counted for a given event
					</li><li class="listitem">
						The name of the event that was counted
					</li><li class="listitem"><p class="simpara">
						When related metrics are available, a ratio or percentage is displayed after the hash sign (<code class="literal">#</code>) in the right-most column.
					</p><p class="simpara">
						For example, when running in default mode, <code class="literal">perf stat</code>
 counts both cycles and instructions and, therefore, calculates and 
displays instructions per cycle in the right-most column. You can see 
similar behavior with regard to branch-misses as a percent of all 
branches since both events are counted by default.
					</p></li></ol></div></section><section class="section" id="attaching-perf-stat-to-a-running-process_counting-events-during-process-execution-with-perf-stat"><div class="titlepage"><div><div><h2 class="title">18.4. Attaching perf stat to a running process</h2></div></div></div><p class="_abstract _abstract">
				You can attach <code class="literal">perf stat</code> to a running process. This will instruct <code class="literal">perf stat</code> to count event occurrences only in the specified processes during the execution of a command.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Attach <code class="literal">perf stat</code> to a running process:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--7z4e13v"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ perf stat -p <span class="emphasis"><em>ID1,ID2</em></span> sleep <span class="emphasis"><em>seconds</em></span></pre></div></div><p class="simpara">
						The previous example counts events in the processes with the IDs of <code class="literal"><span class="emphasis"><em>ID1</em></span></code> and <code class="literal"><span class="emphasis"><em>ID2</em></span></code> for a time period of <code class="literal"><span class="emphasis"><em>seconds</em></span></code> seconds as dictated by using the <code class="literal">sleep</code> command.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-stat(1)</code> man page
					</li></ul></div></section></section><section class="chapter" id="recording-and-analyzing-performance-profiles-with-perf_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 19. Recording and analyzing performance profiles with perf</h1></div></div></div><p class="_abstract _abstract">
			The <code class="literal">perf</code> tool allows you to record performance data and analyze it at a later time.
		</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
					You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
				</li></ul></div><section class="section" id="the-purpose-of-perf-record_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.1. The purpose of perf record</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal command">perf record</code> command samples performance data and stores it in a file, <code class="literal file">perf.data</code>, which can be read and visualized with other <code class="literal">perf</code> commands. <code class="literal file">perf.data</code> is generated in the current directory and can be accessed at a later time, possibly on a different machine.
			</p><p>
				If you do not specify a command for <code class="literal command">perf record</code> to record during, it will record until you manually stop the process by pressing <code class="literal">Ctrl+C</code>. You can attach <code class="literal command">perf record</code> to specific processes by passing the <code class="literal option">-p</code> option followed by one or more process IDs. You can run <code class="literal command">perf record</code> without root access, however, doing so will only sample performance data in the user space. In the default mode, <code class="literal command">perf record</code> uses CPU cycles as the sampling event and operates in per-thread mode with inherit mode enabled.
			</p></section><section class="section" id="recording-a-performance-profile-without-root-access_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.2. Recording a performance profile without root access</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">perf record</code> without root access to sample and record performance data in the user-space only.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Sample and record the performance data:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xvki38e"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ perf record <span class="emphasis"><em>command</em></span></pre></div></div><p class="simpara">
						Replace <code class="literal"><span class="emphasis"><em>command</em></span></code> with the command you want to sample data during. If you do not specify a command, then <code class="literal">perf record</code> will sample data until you manually stop it by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-record(1)</code> man page
					</li></ul></div></section><section class="section" id="recording-a-performance-profile-with-root-access_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.3. Recording a performance profile with root access</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">perf record</code> with root access to sample and record performance data in both the user-space and the kernel-space simultaneously.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
					</li><li class="listitem">
						You have root access.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Sample and record the performance data:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--fzwx1a4"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf record <span class="emphasis"><em>command</em></span></pre></div></div><p class="simpara">
						Replace <code class="literal"><span class="emphasis"><em>command</em></span></code> with the command you want to sample data during. If you do not specify a command, then <code class="literal">perf record</code> will sample data until you manually stop it by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-record(1)</code> man page
					</li></ul></div></section><section class="section" id="recording-a-performance-profile-in-per-cpu-mode_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.4. Recording a performance profile in per-CPU mode</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">perf record</code> in per-CPU mode
 to sample and record performance data in both and user-space and the 
kernel-space simultaneously across all threads on a monitored CPU. By 
default, per-CPU mode monitors all online CPUs.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Sample and record the performance data:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--9bg4tto"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf record -a <span class="emphasis"><em>command</em></span></pre></div></div><p class="simpara">
						Replace <code class="literal"><span class="emphasis"><em>command</em></span></code> with the command you want to sample data during. If you do not specify a command, then <code class="literal">perf record</code> will sample data until you manually stop it by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-record(1)</code> man page
					</li></ul></div></section><section class="section" id="capturing-call-graph-data-with-perf-record_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.5. Capturing call graph data with perf record</h2></div></div></div><p class="_abstract _abstract">
				You can configure the <code class="literal">perf record</code> tool 
so that it records which function is calling other functions in the 
performance profile. This helps to identify a bottleneck if several 
processes are calling the same function.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Sample and record performance data with the <code class="literal">--call-graph</code> option:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--xfu8a0u"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ perf record --call-graph <span class="emphasis"><em>method</em></span> <span class="emphasis"><em>command</em></span></pre></div></div><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Replace <code class="literal"><span class="emphasis"><em>command</em></span></code> with the command you want to sample data during. If you do not specify a command, then <code class="literal">perf record</code> will sample data until you manually stop it by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Replace <span class="emphasis"><em>method</em></span> with one of the following unwinding methods:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">fp</code></span></dt><dd>
											Uses the frame pointer method. Depending on compiler optimization, such as with binaries built with the GCC option <code class="literal option">--fomit-frame-pointer</code>, this may not be able to unwind the stack.
										</dd><dt><span class="term"><code class="literal">dwarf</code></span></dt><dd>
											Uses DWARF Call Frame Information to unwind the stack.
										</dd><dt><span class="term"><code class="literal">lbr</code></span></dt><dd>
											Uses the last branch record hardware on Intel processors.
										</dd></dl></div></li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-record(1)</code> man page
					</li></ul></div></section><section class="section" id="analyzing-perf-data-with-perf-report_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.6. Analyzing perf.data with perf report</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">perf report</code> to display and analyze a <code class="literal file">perf.data</code> file.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem">
						There is a <code class="literal file">perf.data</code> file in the current directory.
					</li><li class="listitem">
						If the <code class="literal file">perf.data</code> file was created with root access, you need to run <code class="literal">perf report</code> with root access too.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the contents of the <code class="literal file">perf.data</code> file for further analysis:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--dddcebz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf report</pre></div></div><p class="simpara">
						This command displays output similar to the following:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--sswprbk"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">Samples: 2K of event 'cycles', Event count (approx.): 235462960
Overhead  Command          Shared Object                     Symbol
   2.36%  kswapd0          [kernel.kallsyms]                 [k] page_vma_mapped_walk
   2.13%  sssd_kcm         libc-2.28.so                      [.] <span class="emphasis"><em>memset_avx2_erms 2.13% perf [kernel.kallsyms] [k] smp_call_function_single 1.53% gnome-shell libc-2.28.so [.] </em></span>strcmp_avx2
   1.17%  gnome-shell      libglib-2.0.so.0.5600.4           [.] g_hash_table_lookup
   0.93%  Xorg             libc-2.28.so                      [.] <span class="emphasis"><em>memmove_avx_unaligned_erms 0.89% gnome-shell libgobject-2.0.so.0.5600.4 [.] g_object_unref 0.87% kswapd0 [kernel.kallsyms] [k] page_referenced_one 0.86% gnome-shell libc-2.28.so [.] </em></span>memmove_avx_unaligned_erms
   0.83%  Xorg             [kernel.kallsyms]                 [k] alloc_vmap_area
   0.63%  gnome-shell      libglib-2.0.so.0.5600.4           [.] g_slice_alloc
   0.53%  gnome-shell      libgirepository-1.0.so.1.0.0      [.] g_base_info_unref
   0.53%  gnome-shell      ld-2.28.so                        [.] _dl_find_dso_for_object
   0.49%  kswapd0          [kernel.kallsyms]                 [k] vma_interval_tree_iter_next
   0.48%  gnome-shell      libpthread-2.28.so                [.] <span class="emphasis"><em>pthread_getspecific 0.47% gnome-shell libgirepository-1.0.so.1.0.0 [.] 0x0000000000013b1d 0.45% gnome-shell libglib-2.0.so.0.5600.4 [.] g_slice_free1 0.45% gnome-shell libgobject-2.0.so.0.5600.4 [.] g_type_check_instance_is_fundamentally_a 0.44% gnome-shell libc-2.28.so [.] malloc 0.41% swapper [kernel.kallsyms] [k] apic_timer_interrupt 0.40% gnome-shell ld-2.28.so [.] _dl_lookup_symbol_x 0.39% kswapd0 [kernel.kallsyms] [k] </em></span>raw_callee_save___pv_queued_spin_unlock</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-report(1)</code> man page
					</li></ul></div></section><section class="section" id="interpretation-of-perf-report-output_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.7. Interpretation of perf report output</h2></div></div></div><p class="_abstract _abstract">
				The table displayed by running the <code class="literal command">perf report</code> command sorts the data into several columns:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The 'Overhead' column</span></dt><dd>
							Indicates what percentage of overall samples were collected in that particular function.
						</dd><dt><span class="term">The 'Command' column</span></dt><dd>
							Tells you which process the samples were collected from.
						</dd><dt><span class="term">The 'Shared Object' column</span></dt><dd>
							Displays the name of the ELF image where the samples come from 
(the name [kernel.kallsyms] is used when the samples come from the 
kernel).
						</dd><dt><span class="term">The 'Symbol' column</span></dt><dd>
							Displays the function name or symbol.
						</dd></dl></div><p>
				In default mode, the functions are sorted in descending order with those with the highest overhead displayed first.
			</p></section><section class="section" id="generating-a-perf-data-file-that-is-readable-on-a-different-device_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.8. Generating a perf.data file that is readable on a different device</h2></div></div></div><p class="_abstract _abstract">
				You can use the <code class="literal">perf</code> tool to record performance data into a <code class="literal">perf.data</code> file to be analyzed on a different device.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="#installing-perf_getting-started-with-perf" title="16.2.&nbsp;Installing perf">Installing perf</a>.
					</li><li class="listitem">
						The kernel <code class="literal">debuginfo</code> package is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/developing_c_and_cpp_applications_in_rhel_8/index#getting-debuginfo-packages-for-an-application-or-library-using-gdb_enabling-debugging-with-debugging-information">Getting debuginfo packages for an application or library using GDB.</a>
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Capture performance data you are interested in investigating further:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--s8b4qkx"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf record -a --call-graph fp sleep <span class="emphasis"><em>seconds</em></span></pre></div></div><p class="simpara">
						This example would generate a <code class="literal">perf.data</code> over the entire system for a period of <code class="literal"><span class="emphasis"><em>seconds</em></span></code> seconds as dictated by the use of the <code class="literal">sleep</code> command. It would also capture call graph data using the frame pointer method.
					</p></li><li class="listitem"><p class="simpara">
						Generate an archive file containing debug symbols of the recorded data:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--g8ox7rc"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf archive</pre></div></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify that the archive file has been generated in your current active directory:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--lb2y1f1"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># ls perf.data*</pre></div></div><p class="simpara">
						The output will display every file in your current directory that begins with <code class="literal">perf.data</code>. The archive file will be named either:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--twdtosi"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">perf.data.tar.gz</pre></div></div><p class="simpara">
						or
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jzdphsd"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">perf.data.tar.bz2</pre></div></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#recording-and-analyzing-performance-profiles-with-perf_monitoring-and-managing-system-status-and-performance" title="Chapter&nbsp;19.&nbsp;Recording and analyzing performance profiles with perf">Recording and analyzing performance profiles with perf</a>
					</li><li class="listitem">
						<a class="link" href="#capturing-call-graph-data-with-perf-record_recording-and-analyzing-performance-profiles-with-perf" title="19.5.&nbsp;Capturing call graph data with perf record">Capturing call graph data with perf record</a>
					</li></ul></div></section><section class="section" id="analyzing-a-perf-data-file-that-was-created-on-a-different-device_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.9. Analyzing a perf.data file that was created on a different device</h2></div></div></div><p class="_abstract _abstract">
				You can use the <code class="literal">perf</code> tool to analyze a <code class="literal">perf.data</code> file that was generated on a different device.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem">
						A <code class="literal">perf.data</code> file and associated archive file generated on a different device are present on the current device being used.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						Copy both the <code class="literal">perf.data</code> file and the archive file into your current active directory.
					</li><li class="listitem"><p class="simpara">
						Extract the archive file into <code class="literal">~/.debug</code>:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--z95pnux"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># mkdir -p ~/.debug
# tar xf <span class="emphasis"><em>perf.data.tar.bz2</em></span> -C ~/.debug</pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							The archive file might also be named <code class="literal"><span class="emphasis"><em>perf.data.tar.gz</em></span></code>.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Open the <code class="literal">perf.data</code> file for further analysis:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--q1vqp3e"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf report</pre></div></div></li></ol></div></section><section class="section" id="why-perf-displays-some-function-names-as-raw-function-addresses_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.10. Why perf displays some function names as raw function addresses</h2></div></div></div><p class="_abstract _abstract">
				For kernel functions, <code class="literal">perf</code> uses the information from the <code class="literal">/proc/kallsyms</code>
 file to map the samples to their respective function names or symbols. 
For functions executed in the user space, however, you might see raw 
function addresses because the binary is stripped.
			</p><p>
				The <code class="literal literal">debuginfo</code> package of the 
executable must be installed or, if the executable is a locally 
developed application, the application must be compiled with debugging 
information turned on (the <code class="literal option">-g</code> option in GCC) to display the function names or symbols in such a situation.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					It is not necessary to re-run the <code class="literal command">perf record</code> command after installing the <code class="literal literal">debuginfo</code> associated with an executable. Simply re-run the <code class="literal command">perf report</code> command.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional Resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/debugging-applications_developing-applications#enabling-debugging-with-debugging-information_debugging-applications">Enabling debugging with debugging information</a>
					</li></ul></div></section><section class="section" id="enabling-debug-and-source-repositories_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.11. Enabling debug and source repositories</h2></div></div></div><p class="_abstract _abstract">
				A standard installation of Red&nbsp;Hat Enterprise&nbsp;Linux does 
not enable the debug and source repositories. These repositories contain
 information needed to debug the system components and measure their 
performance.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Enable the source and debug information package channels: The <code class="literal">$(uname -i)</code> part is automatically replaced with a matching value for architecture of your system:
					</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="n064348" id="rh-table--n064348"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><thead><tr><th id="idm140611467875200" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Architecture name</th><th id="idm140611467874112" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Value</th></tr></thead><tbody><tr><td headers="idm140611467875200" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
										64-bit Intel and AMD
									</p>
									 </td><td headers="idm140611467874112" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
										x86_64
									</p>
									 </td></tr><tr><td headers="idm140611467875200" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
										64-bit ARM
									</p>
									 </td><td headers="idm140611467874112" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
										aarch64
									</p>
									 </td></tr><tr><td headers="idm140611467875200" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
										IBM POWER
									</p>
									 </td><td headers="idm140611467874112" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
										ppc64le
									</p>
									 </td></tr><tr><td headers="idm140611467875200" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
										64-bit IBM Z
									</p>
									 </td><td headers="idm140611467874112" data-row="5" data-col="2" class="content--md" valign="top" align="left"> <p>
										s390x
									</p>
									 </td></tr></tbody></table></rh-table></li></ul></div></section><section class="section" id="getting-debuginfo-packages-for-an-application-or-library-using-gdb_recording-and-analyzing-performance-profiles-with-perf"><div class="titlepage"><div><div><h2 class="title">19.12. Getting debuginfo packages for an application or library using GDB</h2></div></div></div><p class="_abstract _abstract">
				Debugging information is required to debug code. For code that is 
installed from a package, the GNU Debugger (GDB) automatically 
recognizes missing debug information, resolves the package name and 
provides concrete advice on how to get the package.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The application or library you want to debug must be installed on the system.
					</li><li class="listitem">
						GDB and the <code class="literal command">debuginfo-install</code> tool must be installed on the system. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/setting-up-a-development-workstation_developing-applications#setting-up-to-debug-applications_setting-up-a-development-workstation">Setting up to debug applications</a>.
					</li><li class="listitem">
						Repositories providing <code class="literal">debuginfo</code> and <code class="literal">debugsource</code> packages must be configured and enabled on the system. For details, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/developing_c_and_cpp_applications_in_rhel_9/index#enabling-debug-and-source-repositories_setting-up-a-development-workstation">Enabling debug and source repositories</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Start GDB attached to the application or library you want to 
debug. GDB automatically recognizes missing debugging information and 
suggests a command to run.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--e9sxpsd"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ gdb -q /bin/ls
Reading symbols from /bin/ls...Reading symbols from .gnu_debugdata for /usr/bin/ls...(no debugging symbols found)...done.
(no debugging symbols found)...done.
Missing separate debuginfos, use: dnf <span class="emphasis"><em>debuginfo-install coreutils-8.30-6.el8.x86_64</em></span>
(gdb)</pre></div></div></li><li class="listitem"><p class="simpara">
						Exit GDB: type <span class="keycap"><strong>q</strong></span> and confirm with <span class="keycap"><strong>Enter</strong></span>.
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--pul8cqd"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">(gdb) q</pre></div></div></li><li class="listitem"><p class="simpara">
						Run the command suggested by GDB to install the required <code class="literal">debuginfo</code> packages:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--cnfkbi0"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># dnf debuginfo-install coreutils-8.30-6.el8.x86_64</pre></div></div><p class="simpara">
						The <code class="literal">dnf</code> package management tool 
provides a summary of the changes, asks for confirmation and once you 
confirm, downloads and installs all the necessary files.
					</p></li><li class="listitem">
						In case GDB is not able to suggest the <code class="literal">debuginfo</code> package, follow the procedure described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/debugging-applications_developing-applications#getting-debuginfo-packages-for-an-application-or-library-manually_enabling-debugging-with-debugging-information">Getting debuginfo packages for an application or library manually</a>.
					</li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_developer_toolset/10/html-single/user_guide/index#sect-Red_Hat_Developer_Toolset-Install-Debugging">Red Hat Developer Toolset User Guide, section Installing Debugging Information</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/9907">How can I download or install debuginfo packages for RHEL systems?</a> — Red&nbsp;Hat Knowledgebase solution
					</li></ul></div></section></section><section class="chapter" id="investigating-busy-cpus-with-perf_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 20. Investigating busy CPUs with perf</h1></div></div></div><p class="_abstract _abstract">
			When investigating performance issues on a system, you can use the <code class="literal">perf</code> tool to identify and monitor the busiest CPUs in order to focus your efforts.
		</p><section class="section" id="displaying-which-cpu-events-were-counted-on-with-perf-stat_investigating-busy-cpus-with-perf"><div class="titlepage"><div><div><h2 class="title">20.1. Displaying which CPU events were counted on with perf stat</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">perf stat</code> to display which 
CPU events were counted on by disabling CPU count aggregation. You must 
count events in system-wide mode by using the <code class="literal">-a</code> flag in order to use this functionality.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Count the events with CPU count aggregation disabled:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--trah9iw"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf stat -a -A sleep <span class="emphasis"><em>seconds</em></span></pre></div></div><p class="simpara">
						The previous example displays counts of a default set of common 
hardware and software events recorded over a time period of <code class="literal"><span class="emphasis"><em>seconds</em></span></code> seconds, as dictated by using the <code class="literal">sleep</code> command, over each individual CPU in ascending order, starting with <code class="literal">CPU0</code>. As such, it may be useful to specify an event such as cycles:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jldbnb6"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf stat -a -A -e cycles sleep <span class="emphasis"><em>seconds</em></span></pre></div></div></li></ul></div></section><section class="section" id="displaying-which-cpu-samples-were-taken-on-with-perf-report_investigating-busy-cpus-with-perf"><div class="titlepage"><div><div><h2 class="title">20.2. Displaying which CPU samples were taken on with perf report</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">perf record</code> command samples performance data and stores this data in a <code class="literal">perf.data</code> file which can be read with the <code class="literal">perf report</code> command. The <code class="literal">perf record</code> command always records which CPU samples were taken on. You can configure <code class="literal">perf report</code> to display this information.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem">
						There is a <code class="literal">perf.data</code> file created with <code class="literal">perf record</code> in the current directory. If the <code class="literal">perf.data</code> file was created with root access, you need to run <code class="literal">perf report</code> with root access too.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the contents of the <code class="literal">perf.data</code> file for further analysis while sorting by CPU:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--2h2y7sz"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf report --sort cpu</pre></div></div><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								You can sort by CPU and command to display more detailed information about where CPU time is being spent:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--jshzdl7"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf report --sort cpu,comm</pre></div></div><p class="simpara">
								This example will list commands from all monitored CPUs by total
 overhead in descending order of overhead usage and identify the CPU the
 command was executed on.
							</p></li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/recording-and-analyzing-performance-profiles-with-perf_monitoring-and-managing-system-status-and-performance">Recording and analyzing performance profiles with perf</a>
					</li></ul></div></section><section class="section" id="displaying-specific-cpus-during-profiling-with-perf-top_investigating-busy-cpus-with-perf"><div class="titlepage"><div><div><h2 class="title">20.3. Displaying specific CPUs during profiling with perf top</h2></div></div></div><p class="_abstract _abstract">
				You can configure <code class="literal">perf top</code> to display specific CPUs and their relative usage while profiling your system in real time.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Start the <code class="literal">perf top</code> interface while sorting by CPU:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--3gyn6hf"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf top --sort cpu</pre></div></div><p class="simpara">
						This example will list CPUs and their respective overhead in descending order of overhead usage in real time.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								You can sort by CPU and command for more detailed information of where CPU time is being spent:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--5vhtamt"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf top --sort cpu,comm</pre></div></div><p class="simpara">
								This example will list commands by total overhead in descending 
order of overhead usage and identify the CPU the command was executed on
 in real time.
							</p></li></ul></div></li></ul></div></section><section class="section" id="monitoring-specific-cpus-with-perf-record-and-perf-report_investigating-busy-cpus-with-perf"><div class="titlepage"><div><div><h2 class="title">20.4. Monitoring specific CPUs with perf record and perf report</h2></div></div></div><p class="_abstract _abstract">
				You can configure <code class="literal">perf record</code> to only sample specific CPUs of interest and analyze the generated <code class="literal">perf.data</code> file with <code class="literal">perf report</code> for further analysis.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Sample and record the performance data in the specific CPU’s, generating a <code class="literal">perf.data</code> file:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
								Using a comma separated list of CPUs:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--v6bqg82"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf record -C <span class="emphasis"><em>0,1</em></span> sleep <span class="emphasis"><em>seconds</em></span></pre></div></div><p class="simpara">
								The previous example samples and records data in CPUs 0 and 1 for a period of <code class="literal"><span class="emphasis"><em>seconds</em></span></code> seconds as dictated by the use of the <code class="literal">sleep</code> command.
							</p></li><li class="listitem"><p class="simpara">
								Using a range of CPUs:
							</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--va0yg1k"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf record -C <span class="emphasis"><em>0-2</em></span> sleep <span class="emphasis"><em>seconds</em></span></pre></div></div><p class="simpara">
								The previous example samples and records data in all CPUs from CPU 0 to 2 for a period of <code class="literal"><span class="emphasis"><em>seconds</em></span></code> seconds as dictated by the use of the <code class="literal">sleep</code> command.
							</p></li></ul></div></li><li class="listitem"><p class="simpara">
						Display the contents of the <code class="literal">perf.data</code> file for further analysis:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--ojsl32i"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf report</pre></div></div><p class="simpara">
						This example will display the contents of <code class="literal">perf.data</code>. If you are monitoring several CPUs and want to know which CPU data was sampled on, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/investigating-busy-cpus-with-perf_monitoring-and-managing-system-status-and-performance#displaying-which-cpu-samples-were-taken-on-with-perf-report_investigating-busy-cpus-with-perf">Displaying which CPU samples were taken on with perf report</a>.
					</p></li></ol></div></section></section><section class="chapter" id="monitoring-application-performance-with-perf_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 21. Monitoring application performance with perf</h1></div></div></div><p class="_abstract _abstract">
			You can use the <code class="literal">perf</code> tool to monitor and analyze application performance.
		</p><section class="section" id="attaching-perf-record-to-a-running-process_monitoring-application-performance-with-perf"><div class="titlepage"><div><div><h2 class="title">21.1. Attaching perf record to a running process</h2></div></div></div><p class="_abstract _abstract">
				You can attach <code class="literal">perf record</code> to a running process. This will instruct <code class="literal">perf record</code> to only sample and record performance data in the specified processes.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Attach <code class="literal">perf record</code> to a running process:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--0pets93"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ perf record -p <span class="emphasis"><em>ID1,ID2</em></span> sleep <span class="emphasis"><em>seconds</em></span></pre></div></div><p class="simpara">
						The previous example samples and records performance data of the processes with the process ID’s <code class="literal"><span class="emphasis"><em>ID1</em></span></code> and <code class="literal"><span class="emphasis"><em>ID2</em></span></code> for a time period of <code class="literal"><span class="emphasis"><em>seconds</em></span></code> seconds as dictated by using the <code class="literal">sleep</code> command. You can also configure <code class="literal">perf</code> to record events in specific threads:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--aajc0il"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ perf record -t <span class="emphasis"><em>ID1,ID2</em></span> sleep <span class="emphasis"><em>seconds</em></span></pre></div></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							When using the <code class="literal">-t</code> flag and stipulating thread ID’s, <code class="literal">perf</code> disables inheritance by default. You can enable inheritance by adding the <code class="literal">--inherit</code> option.
						</p></div></div></li></ul></div></section><section class="section" id="capturing-call-graph-data-with-perf-record_monitoring-application-performance-with-perf"><div class="titlepage"><div><div><h2 class="title">21.2. Capturing call graph data with perf record</h2></div></div></div><p class="_abstract _abstract">
				You can configure the <code class="literal">perf record</code> tool 
so that it records which function is calling other functions in the 
performance profile. This helps to identify a bottleneck if several 
processes are calling the same function.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Sample and record performance data with the <code class="literal">--call-graph</code> option:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--4xdgjv8"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed">$ perf record --call-graph <span class="emphasis"><em>method</em></span> <span class="emphasis"><em>command</em></span></pre></div></div><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Replace <code class="literal"><span class="emphasis"><em>command</em></span></code> with the command you want to sample data during. If you do not specify a command, then <code class="literal">perf record</code> will sample data until you manually stop it by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span>.
							</li><li class="listitem"><p class="simpara">
								Replace <span class="emphasis"><em>method</em></span> with one of the following unwinding methods:
							</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">fp</code></span></dt><dd>
											Uses the frame pointer method. Depending on compiler optimization, such as with binaries built with the GCC option <code class="literal option">--fomit-frame-pointer</code>, this may not be able to unwind the stack.
										</dd><dt><span class="term"><code class="literal">dwarf</code></span></dt><dd>
											Uses DWARF Call Frame Information to unwind the stack.
										</dd><dt><span class="term"><code class="literal">lbr</code></span></dt><dd>
											Uses the last branch record hardware on Intel processors.
										</dd></dl></div></li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-record(1)</code> man page
					</li></ul></div></section><section class="section" id="analyzing-perf-data-with-perf-report_monitoring-application-performance-with-perf"><div class="titlepage"><div><div><h2 class="title">21.3. Analyzing perf.data with perf report</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">perf report</code> to display and analyze a <code class="literal file">perf.data</code> file.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem">
						There is a <code class="literal file">perf.data</code> file in the current directory.
					</li><li class="listitem">
						If the <code class="literal file">perf.data</code> file was created with root access, you need to run <code class="literal">perf report</code> with root access too.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the contents of the <code class="literal file">perf.data</code> file for further analysis:
					</p><div class="codeblock__wrapper" data-plain-code-block-id="codeblock--plain--d96b6na"><pfe-clipboard title="Copy" copy-from="property" class="codeblock__copy PFElement" copied-duration="3" role="button" tabindex="0" pfelement="" type="content"><span slot="text">Copy</span><span slot="text--success">Copied!</span></pfe-clipboard><div class="codeblock__inner-wrapper" tabindex="0"><pre class="screen language-none codeblock codeblock--processed"># perf report</pre></div></div><p class="simpara">
						This command displays output similar to the following:
					</p><pre class="screen">Samples: 2K of event 'cycles', Event count (approx.): 235462960
Overhead  Command          Shared Object                     Symbol
   2.36%  kswapd0          [kernel.kallsyms]                 [k] page_vma_mapped_walk
   2.13%  sssd_kcm         libc-2.28.so                      [.] <span class="emphasis"><em>memset_avx2_erms 2.13% perf [kernel.kallsyms] [k] smp_call_function_single 1.53% gnome-shell libc-2.28.so [.] </em></span>strcmp_avx2
   1.17%  gnome-shell      libglib-2.0.so.0.5600.4           [.] g_hash_table_lookup
   0.93%  Xorg             libc-2.28.so                      [.] <span class="emphasis"><em>memmove_avx_unaligned_erms 0.89% gnome-shell libgobject-2.0.so.0.5600.4 [.] g_object_unref 0.87% kswapd0 [kernel.kallsyms] [k] page_referenced_one 0.86% gnome-shell libc-2.28.so [.] </em></span>memmove_avx_unaligned_erms
   0.83%  Xorg             [kernel.kallsyms]                 [k] alloc_vmap_area
   0.63%  gnome-shell      libglib-2.0.so.0.5600.4           [.] g_slice_alloc
   0.53%  gnome-shell      libgirepository-1.0.so.1.0.0      [.] g_base_info_unref
   0.53%  gnome-shell      ld-2.28.so                        [.] _dl_find_dso_for_object
   0.49%  kswapd0          [kernel.kallsyms]                 [k] vma_interval_tree_iter_next
   0.48%  gnome-shell      libpthread-2.28.so                [.] <span class="emphasis"><em>pthread_getspecific 0.47% gnome-shell libgirepository-1.0.so.1.0.0 [.] 0x0000000000013b1d 0.45% gnome-shell libglib-2.0.so.0.5600.4 [.] g_slice_free1 0.45% gnome-shell libgobject-2.0.so.0.5600.4 [.] g_type_check_instance_is_fundamentally_a 0.44% gnome-shell libc-2.28.so [.] malloc 0.41% swapper [kernel.kallsyms] [k] apic_timer_interrupt 0.40% gnome-shell ld-2.28.so [.] _dl_lookup_symbol_x 0.39% kswapd0 [kernel.kallsyms] [k] </em></span>raw_callee_save___pv_queued_spin_unlock</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-report(1)</code> man page
					</li></ul></div></section></section><section class="chapter" id="creating-uprobes-with-perf_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 22. Creating uprobes with perf</h1></div></div></div><section class="section" id="proc_creating-uprobes-at-the-fucntion-level-with-perf_assembly_creating-uprobes-with-perf"><div class="titlepage"><div><div><h2 class="title">22.1. Creating uprobes at the function level with perf</h2></div></div></div><p class="_abstract _abstract">
				You can use the <code class="literal">perf</code> tool to create 
dynamic tracepoints at arbitrary points in a process or application. 
These tracepoints can then be used in conjunction with other <code class="literal">perf</code> tools such as <code class="literal">perf stat</code> and <code class="literal">perf record</code> to better understand the process or applications behavior.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the uprobe in the process or application you are interested
 in monitoring at a location of interest within the process or 
application:
					</p><pre class="literallayout white-space-pre"># perf probe -x <span class="emphasis"><em>/path/to/executable</em></span> -a <span class="emphasis"><em>function</em></span>
Added new event:
  <span class="emphasis"><em>probe_executable:function</em></span>   (on <span class="emphasis"><em>function</em></span> in <span class="emphasis"><em>/path/to/executable</em></span>)

You can now use it in all perf tools, such as:

        perf record -e <span class="emphasis"><em>probe_executable:function</em></span> -aR sleep 1</pre></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-probe</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/recording-and-analyzing-performance-profiles-with-perf_monitoring-and-managing-system-status-and-performance">Recording and analyzing performance profiles with perf</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/counting-events-during-process-execution-with-perf-stat_monitoring-and-managing-system-status-and-performance">Counting events during process execution with perf stat</a>
					</li></ul></div></section><section class="section" id="proc_creating-uprobes-on-lines-within-a-function-with-perf_assembly_creating-uprobes-with-perf"><div class="titlepage"><div><div><h2 class="title">22.2. Creating uprobes on lines within a function with perf</h2></div></div></div><p class="_abstract _abstract">
				These tracepoints can then be used in conjunction with other <code class="literal">perf</code> tools such as <code class="literal">perf stat</code> and <code class="literal">perf record</code> to better understand the process or applications behavior.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem"><p class="simpara">
						You have gotten the debugging symbols for your executable:
					</p><pre class="literallayout"># objdump -t <span class="emphasis"><em>./your_executable</em></span> | head</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							To do this, the <code class="literal">debuginfo</code> package of
 the executable must be installed or, if the executable is a locally 
developed application, the application must be compiled with debugging 
information, the <code class="literal">-g</code> option in GCC.
						</p></div></div></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						View the function lines where you can place a uprobe:
					</p><pre class="literallayout">$ perf probe -x <span class="emphasis"><em>./your_executable</em></span> -L main</pre><p class="simpara">
						Output of this command looks similar to:
					</p><pre class="literallayout white-space-pre">&lt;main@/home/<span class="emphasis"><em>user</em></span>/<span class="emphasis"><em>my_executable</em></span>:0&gt;
              0  int main(int argc, const char **argv)
              1  {
                        int err;
                        const char *cmd;
                        char sbuf[STRERR_BUFSIZE];

                        /* libsubcmd init */
              7         exec_cmd_init("perf", PREFIX, PERF_EXEC_PATH, EXEC_PATH_ENVIRONMENT);
              8         pager_init(PERF_PAGER_ENVIRONMENT);</pre></li><li class="listitem"><p class="simpara">
						Create the uprobe for the desired function line:
					</p><pre class="literallayout white-space-pre"># perf probe -x ./<span class="emphasis"><em>my_executable</em></span> main:8
Added new event:
          probe_my_executable:main_L8   (on main:8 in /home/user/my_executable)

        You can now use it in all perf tools, such as:

                perf record -e probe_my_executable:main_L8 -aR sleep 1</pre></li></ol></div></section><section class="section" id="ref_perf-script-output-of-a-perf-data-file-generated-over-uprobes_assembly_creating-uprobes-with-perf"><div class="titlepage"><div><div><h2 class="title">22.3. Perf script output of data recorded over uprobes</h2></div></div></div><p class="_abstract _abstract">
				A common method to analyze data collected using uprobes is using the <code class="literal">perf script</code> command to read a <code class="literal">perf.data</code> file and display a detailed trace of the recorded workload.
			</p><p>
				In the perf script example output:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						A uprobe is added to the function <span class="strong strong"><strong>isprime()</strong></span> in a program called <span class="strong strong"><strong>my_prog</strong></span>
					</li><li class="listitem">
						<span class="strong strong"><strong>a</strong></span> is a function argument added to the uprobe. Alternatively, <span class="strong strong"><strong>a</strong></span> could be an arbitrary variable visible in the code scope of where you add your uprobe:
					</li></ul></div><pre class="screen"># perf script
    my_prog  1367 [007] 10802159.906593: probe_my_prog:isprime: (400551) a=2
    my_prog  1367 [007] 10802159.906623: probe_my_prog:isprime: (400551) a=3
    my_prog  1367 [007] 10802159.906625: probe_my_prog:isprime: (400551) a=4
    my_prog  1367 [007] 10802159.906627: probe_my_prog:isprime: (400551) a=5
    my_prog  1367 [007] 10802159.906629: probe_my_prog:isprime: (400551) a=6
    my_prog  1367 [007] 10802159.906631: probe_my_prog:isprime: (400551) a=7
    my_prog  1367 [007] 10802159.906633: probe_my_prog:isprime: (400551) a=13
    my_prog  1367 [007] 10802159.906635: probe_my_prog:isprime: (400551) a=17
    my_prog  1367 [007] 10802159.906637: probe_my_prog:isprime: (400551) a=19</pre></section></section><section class="chapter" id="profiling-memory-accesses-with-perf-mem_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 23. Profiling memory accesses with perf mem</h1></div></div></div><p class="_abstract _abstract">
			You can use the <code class="literal">perf mem</code> command to sample memory accesses on your system.
		</p><section class="section" id="the-purpose-of-perf-mem_profiling-memory-accesses-with-perf-mem"><div class="titlepage"><div><div><h2 class="title">23.1. The purpose of perf mem</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">mem</code> subcommand of the <code class="literal">perf</code> tool enables the sampling of memory accesses (loads and stores). The <code class="literal">perf mem</code>
 command provides information about memory latency, types of memory 
accesses, functions causing cache hits and misses, and, by recording the
 data symbol, the memory locations where these hits and misses occur.
			</p></section><section class="section" id="sampling-memory-access-with-perf-mem_profiling-memory-accesses-with-perf-mem"><div class="titlepage"><div><div><h2 class="title">23.2. Sampling memory access with perf mem</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to use the <code class="literal">perf mem</code> command to sample memory accesses on your system. The command takes the same options as <code class="literal">perf record</code> and <code class="literal">perf report</code> as well as some options exclusive to the <code class="literal">mem</code> subcommand. The recorded data is stored in a <code class="literal">perf.data</code> file in the current directory for later analysis.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Sample the memory accesses:
					</p><pre class="screen"># perf mem record -a sleep <span class="emphasis"><em>seconds</em></span></pre><p class="simpara">
						This example samples memory accesses across all CPUs for a period of <span class="emphasis"><em>seconds</em></span> seconds as dictated by the <code class="literal">sleep</code> command. You can replace the <code class="literal">sleep</code> command for any command during which you want to sample memory access data. By default, <code class="literal">perf mem</code> samples both memory loads and stores. You can select only one memory operation by using the <code class="literal">-t</code> option and specifying either "load" or "store" between <code class="literal">perf mem</code> and <code class="literal">record</code>. For loads, information over the memory hierarchy level, TLB memory accesses, bus snoops, and memory locks is captured.
					</p></li><li class="listitem"><p class="simpara">
						Open the <code class="literal">perf.data</code> file for analysis:
					</p><pre class="screen"># perf mem report</pre><p class="simpara">
						If you have used the example commands, the output is:
					</p><pre class="screen">Available samples
35k cpu/mem-loads,ldlat=30/P
54k cpu/mem-stores/P</pre><p class="simpara">
						The <code class="literal">cpu/mem-loads,ldlat=30/P</code> line denotes data collected over memory loads and the <code class="literal">cpu/mem-stores/P</code> line denotes data collected over memory stores. Highlight the category of interest and press <span class="keycap"><strong>Enter</strong></span> to view the data:
					</p><pre class="literallayout white-space-pre">Samples: 35K of event 'cpu/mem-loads,ldlat=30/P', Event count (approx.): 4067062
Overhead       Samples  Local Weight  Memory access             Symbol                                                                 Shared Object                 Data Symbol                                                     Data Object                            Snoop         TLB access              Locked
   0.07%            29  98            L1 or L1 hit              [.] 0x000000000000a255                                                 libspeexdsp.so.1.5.0          [.] 0x00007f697a3cd0f0                                          anon                                   None          L1 or L2 hit            No
   0.06%            26  97            L1 or L1 hit              [.] 0x000000000000a255                                                 libspeexdsp.so.1.5.0          [.] 0x00007f697a3cd0f0                                          anon                                   None          L1 or L2 hit            No
   0.06%            25  96            L1 or L1 hit              [.] 0x000000000000a255                                                 libspeexdsp.so.1.5.0          [.] 0x00007f697a3cd0f0                                          anon                                   None          L1 or L2 hit            No
   0.06%             1  2325          Uncached or N/A hit       [k] pci_azx_readl                                                      [kernel.kallsyms]             [k] 0xffffb092c06e9084                                          [kernel.kallsyms]                      None          L1 or L2 hit            No
   0.06%             1  2247          Uncached or N/A hit       [k] pci_azx_readl                                                      [kernel.kallsyms]             [k] 0xffffb092c06e8164                                          [kernel.kallsyms]                      None          L1 or L2 hit            No
   0.05%             1  2166          L1 or L1 hit              [.] 0x00000000038140d6                                                 libxul.so                     [.] 0x00007ffd7b84b4a8                                          [stack]                                None          L1 or L2 hit            No
   0.05%             1  2117          Uncached or N/A hit       [k] check_for_unclaimed_mmio                                           [kernel.kallsyms]             [k] 0xffffb092c1842300                                          [kernel.kallsyms]                      None          L1 or L2 hit            No
   0.05%            22  95            L1 or L1 hit              [.] 0x000000000000a255                                                 libspeexdsp.so.1.5.0          [.] 0x00007f697a3cd0f0                                          anon                                   None          L1 or L2 hit            No
   0.05%             1  1898          L1 or L1 hit              [.] 0x0000000002a30e07                                                 libxul.so                     [.] 0x00007f610422e0e0                                          anon                                   None          L1 or L2 hit            No
   0.05%             1  1878          Uncached or N/A hit       [k] pci_azx_readl                                                      [kernel.kallsyms]             [k] 0xffffb092c06e8164                                          [kernel.kallsyms]                      None          L2 miss                 No
   0.04%            18  94            L1 or L1 hit              [.] 0x000000000000a255                                                 libspeexdsp.so.1.5.0          [.] 0x00007f697a3cd0f0                                          anon                                   None          L1 or L2 hit            No
   0.04%             1  1593          Local RAM or RAM hit      [.] 0x00000000026f907d                                                 libxul.so                     [.] 0x00007f3336d50a80                                          anon                                   Hit           L2 miss                 No
   0.03%             1  1399          L1 or L1 hit              [.] 0x00000000037cb5f1                                                 libxul.so                     [.] 0x00007fbe81ef5d78                                          libxul.so                              None          L1 or L2 hit            No
   0.03%             1  1229          LFB or LFB hit            [.] 0x0000000002962aad                                                 libxul.so                     [.] 0x00007fb6f1be2b28                                          anon                                   None          L2 miss                 No
   0.03%             1  1202          LFB or LFB hit            [.] __pthread_mutex_lock                                               libpthread-2.29.so            [.] 0x00007fb75583ef20                                          anon                                   None          L1 or L2 hit            No
   0.03%             1  1193          Uncached or N/A hit       [k] pci_azx_readl                                                      [kernel.kallsyms]             [k] 0xffffb092c06e9164                                          [kernel.kallsyms]                      None          L2 miss                 No
   0.03%             1  1191          L1 or L1 hit              [k] azx_get_delay_from_lpib                                            [kernel.kallsyms]             [k] 0xffffb092ca7efcf0                                          [kernel.kallsyms]                      None          L1 or L2 hit            No</pre><p class="simpara">
						Alternatively, you can sort your results to investigate different 
aspects of interest when displaying the data. For example, to sort data 
over memory loads by type of memory accesses occurring during the 
sampling period in descending order of overhead they account for:
					</p><pre class="screen"># perf mem -t load report --sort=mem</pre><p class="simpara">
						For example, the output can be:
					</p><pre class="screen">Samples: 35K of event 'cpu/mem-loads,ldlat=30/P', Event count (approx.): 40670
Overhead       Samples  Memory access
  31.53%          9725  LFB or LFB hit
  29.70%         12201  L1 or L1 hit
  23.03%          9725  L3 or L3 hit
  12.91%          2316  Local RAM or RAM hit
   2.37%           743  L2 or L2 hit
   0.34%             9  Uncached or N/A hit
   0.10%            69  I/O or N/A hit
   0.02%           825  L3 miss</pre></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-mem(1)</code> man page.
					</li></ul></div></section><section class="section" id="interpretation-of-perf-mem-report-output_profiling-memory-accesses-with-perf-mem"><div class="titlepage"><div><div><h2 class="title">23.3. Interpretation of perf mem report output</h2></div></div></div><p class="_abstract _abstract">
				The table displayed by running the <code class="literal command">perf mem report</code> command without any modifiers sorts the data into several columns:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The 'Overhead' column</span></dt><dd>
							Indicates percentage of overall samples collected in that particular function.
						</dd><dt><span class="term">The 'Samples' column</span></dt><dd>
							Displays the number of samples accounted for by that row.
						</dd><dt><span class="term">The 'Local Weight' column</span></dt><dd>
							Displays the access latency in processor core cycles.
						</dd><dt><span class="term">The 'Memory Access' column</span></dt><dd>
							Displays the type of memory access that occurred.
						</dd><dt><span class="term">The 'Symbol' column</span></dt><dd>
							Displays the function name or symbol.
						</dd><dt><span class="term">The 'Shared Object' column</span></dt><dd>
							Displays the name of the ELF image where the samples come from 
(the name [kernel.kallsyms] is used when the samples come from the 
kernel).
						</dd><dt><span class="term">The 'Data Symbol' column</span></dt><dd>
							Displays the address of the memory location that row was targeting.
						</dd></dl></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Oftentimes, due to dynamic allocation of memory or stack memory 
being accessed, the 'Data Symbol' column will display a raw address.
				</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">The "Snoop" column</span></dt><dd>
							Displays bus transactions.
						</dd><dt><span class="term">The 'TLB Access' column</span></dt><dd>
							Displays TLB memory accesses.
						</dd><dt><span class="term">The 'Locked' column</span></dt><dd>
							Indicates if a function was or was not memory locked.
						</dd></dl></div><p>
				In default mode, the functions are sorted in descending order with those with the highest overhead displayed first.
			</p></section></section><section class="chapter" id="detecting-false-sharing_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 24. Detecting false sharing</h1></div></div></div><p class="_abstract _abstract">
			False sharing occurs when a processor core on a Symmetric Multi 
Processing (SMP) system modifies data items on the same cache line that 
is in use by other processors to access other data items that are not 
being shared between the processors.
		</p><p>
			This initial modification requires that the other processors using 
the cache line invalidate their copy and request an updated one despite 
the processors not needing, or even necessarily having access to, an 
updated version of the modified data item.
		</p><p>
			You can use the <code class="literal">perf c2c</code> command to detect false sharing.
		</p><section class="section" id="the-purpose-of-perf-c2c_detecting-false-sharing"><div class="titlepage"><div><div><h2 class="title">24.1. The purpose of perf c2c</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">c2c</code> subcommand of the <code class="literal">perf</code> tool enables Shared Data Cache-to-Cache (C2C) analysis. You can use the <code class="literal">perf c2c</code> command to inspect cache-line contention to detect both true and false sharing.
			</p><p>
				Cache-line contention occurs when a processor core on a Symmetric 
Multi Processing (SMP) system modifies data items on the same cache line
 that is in use by other processors. All other processors using this 
cache-line must then invalidate their copy and request an updated one. 
This can lead to degraded performance.
			</p><p>
				The <code class="literal">perf c2c</code> command provides the following information:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Cache lines where contention has been detected
					</li><li class="listitem">
						Processes reading and writing the data
					</li><li class="listitem">
						Instructions causing the contention
					</li><li class="listitem">
						The Non-Uniform Memory Access (NUMA) nodes involved in the contention
					</li></ul></div></section><section class="section" id="detecting-cache-line-contention-with-perf-c2c_detecting-false-sharing"><div class="titlepage"><div><div><h2 class="title">24.2. Detecting cache-line contention with perf c2c</h2></div></div></div><p class="_abstract _abstract">
				Use the <code class="literal">perf c2c</code> command to detect cache-line contention in a system.
			</p><p>
				The <code class="literal">perf c2c</code> command supports the same options as <code class="literal">perf record</code> as well as some options exclusive to the <code class="literal">c2c</code> subcommand. The recorded data is stored in a <code class="literal">perf.data</code> file in the current directory for later analysis.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">perf</code> user space tool is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Use <code class="literal">perf c2c</code> to detect cache-line contention:
					</p><pre class="screen"># perf c2c record -a <span class="emphasis"><em>sleep</em></span> <span class="emphasis"><em>seconds</em></span></pre><p class="simpara">
						This example samples and records cache-line contention data across all CPU’s for a period of <code class="literal"><span class="emphasis"><em>seconds</em></span></code> as dictated by the <code class="literal">sleep</code> command. You can replace the <code class="literal">sleep</code> command with any command you want to collect cache-line contention data over.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf-c2c(1)</code> man page
					</li></ul></div></section><section class="section" id="visualizing-a-perf-data-file-recorded-with-perf-c2c-record_detecting-false-sharing"><div class="titlepage"><div><div><h2 class="title">24.3. Visualizing a perf.data file recorded with perf c2c record</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to visualize the <code class="literal">perf.data</code> file, which is recorded using the <code class="literal">perf c2c</code> command.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">perf</code> user space tool is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem">
						A <code class="literal">perf.data</code> file recorded using the <code class="literal">perf c2c</code> command is available in the current directory. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/detecting-false-sharing_monitoring-and-managing-system-status-and-performance#detecting-cache-line-contention-with-perf-c2c_detecting-false-sharing">Detecting cache-line contention with perf c2c</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Open the <code class="literal">perf.data</code> file for further analysis:
					</p><pre class="screen"># perf c2c report --stdio</pre><p class="simpara">
						This command visualizes the <code class="literal">perf.data</code> file into several graphs within the terminal:
					</p><pre class="literallayout white-space-pre">=================================================
           Trace Event Information
=================================================
 Total records                     :     329219
 Locked Load/Store Operations      :      14654
 Load Operations                   :      69679
 Loads - uncacheable               :          0
 Loads - IO                        :          0
 Loads - Miss                      :       3972
 Loads - no mapping                :          0
 Load Fill Buffer Hit              :      11958
 Load L1D hit                      :      17235
 Load L2D hit                      :         21
 Load LLC hit                      :      14219
 Load Local HITM                   :       3402
 Load Remote HITM                  :      12757
 Load Remote HIT                   :       5295
 Load Local DRAM                   :        976
 Load Remote DRAM                  :       3246
 Load MESI State Exclusive         :       4222
 Load MESI State Shared            :          0
 Load LLC Misses                   :      22274
 LLC Misses to Local DRAM          :        4.4%
 LLC Misses to Remote DRAM         :       14.6%
 LLC Misses to Remote cache (HIT)  :       23.8%
 LLC Misses to Remote cache (HITM) :       57.3%
 Store Operations                  :     259539
 Store - uncacheable               :          0
 Store - no mapping                :         11
 Store L1D Hit                     :     256696
 Store L1D Miss                    :       2832
 No Page Map Rejects               :       2376
 Unable to parse data source       :          1

=================================================
   Global Shared Cache Line Event Information
=================================================
 Total Shared Cache Lines          :         55
 Load HITs on shared lines         :      55454
 Fill Buffer Hits on shared lines  :      10635
 L1D hits on shared lines          :      16415
 L2D hits on shared lines          :          0
 LLC hits on shared lines          :       8501
 Locked Access on shared lines     :      14351
 Store HITs on shared lines        :     109953
 Store L1D hits on shared lines    :     109449
 Total Merged records              :     126112

=================================================
                 c2c details
=================================================
 Events                            : cpu/mem-loads,ldlat=30/P
	                                    : cpu/mem-stores/P
 Cachelines sort on                : Remote HITMs
 Cacheline data groupping          : offset,pid,iaddr

=================================================
	   Shared Data Cache Line Table
=================================================
#
#                              Total      Rmt  ----- LLC Load Hitm -----  ---- Store Reference ----  --- Load Dram ----      LLC    Total  ----- Core Load Hit -----  -- LLC Load Hit --
# Index           Cacheline  records     Hitm    Total      Lcl      Rmt    Total    L1Hit   L1Miss       Lcl       Rmt  Ld Miss    Loads       FB       L1       L2       Llc       Rmt
# .....  ..................  .......  .......  .......  .......  .......  .......  .......  .......  ........  ........  .......  .......  .......  .......  .......  ........  ........
#
      0            0x602180   149904   77.09%    12103     2269     9834   109504   109036      468       727      2657    13747    40400     5355    16154        0      2875       529
      1            0x602100    12128   22.20%     3951     1119     2832        0        0        0        65       200     3749    12128     5096      108        0      2056       652
      2  0xffff883ffb6a7e80      260    0.09%       15        3       12      161      161        0         1         1       15       99       25       50        0         6         1
      3  0xffffffff81aec000      157    0.07%        9        0        9        1        0        1         0         7       20      156       50       59        0        27         4
      4  0xffffffff81e3f540      179    0.06%        9        1        8      117       97       20         0        10       25       62       11        1        0        24         7

=================================================
      Shared Cache Line Distribution Pareto
=================================================
#
#        ----- HITM -----  -- Store Refs --        Data address                               ---------- cycles ----------       cpu                                     Shared
#   Num      Rmt      Lcl   L1 Hit  L1 Miss              Offset      Pid        Code address  rmt hitm  lcl hitm      load       cnt               Symbol                Object                  Source:Line  Node{cpu list}
# .....  .......  .......  .......  .......  ..................  .......  ..................  ........  ........  ........  ........  ...................  ....................  ...........................  ....
#
  -------------------------------------------------------------
      0     9834     2269   109036      468            0x602180
  -------------------------------------------------------------
          65.51%   55.88%   75.20%    0.00%                 0x0    14604            0x400b4f     27161     26039     26017         9  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:144   0{0-1,4}  1{24-25,120}  2{48,54}  3{169}
	   0.41%    0.35%    0.00%    0.00%                 0x0    14604            0x400b56     18088     12601     26671         9  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:145   0{0-1,4}  1{24-25,120}  2{48,54}  3{169}
	   0.00%    0.00%   24.80%  100.00%                 0x0    14604            0x400b61         0         0         0         9  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:145   0{0-1,4}  1{24-25,120}  2{48,54}  3{169}
	   7.50%    9.92%    0.00%    0.00%                0x20    14604            0x400ba7      2470      1729      1897         2  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:154   1{122}  2{144}
	  17.61%   20.89%    0.00%    0.00%                0x28    14604            0x400bc1      2294      1575      1649         2  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:158   2{53}  3{170}
	   8.97%   12.96%    0.00%    0.00%                0x30    14604            0x400bdb      2325      1897      1828         2  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:162   0{96}  3{171}

  -------------------------------------------------------------
      1     2832     1119        0        0            0x602100
  -------------------------------------------------------------
	  29.13%   36.19%    0.00%    0.00%                0x20    14604            0x400bb3      1964      1230      1788         2  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:155   1{122}  2{144}
	  43.68%   34.41%    0.00%    0.00%                0x28    14604            0x400bcd      2274      1566      1793         2  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:159   2{53}  3{170}
	  27.19%   29.40%    0.00%    0.00%                0x30    14604            0x400be7      2045      1247      2011         2  [.] read_write_func  no_false_sharing.exe  false_sharing_example.c:163   0{96}  3{171}</pre></li></ol></div></section><section class="section" id="interpretation-of-perf-c2c-report-output_detecting-false-sharing"><div class="titlepage"><div><div><h2 class="title">24.4. Interpretation of perf c2c report output</h2></div></div></div><p class="_abstract _abstract">
				The visualization displayed by running the <code class="literal">perf c2c report --stdio</code> command sorts the data into several tables:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Trace Events Information</code></span></dt><dd>
							This table provides a high level summary of all the load and store samples, which are collected by the <code class="literal">perf c2c record</code> command.
						</dd><dt><span class="term"><code class="literal">Global Shared Cache Line Event Information</code></span></dt><dd>
							This table provides statistics over the shared cache lines.
						</dd><dt><span class="term"><code class="literal">c2c Details</code></span></dt><dd>
							This table provides information about what events were sampled and how the <code class="literal">perf c2c report</code> data is organized within the visualization.
						</dd><dt><span class="term"><code class="literal">Shared Data Cache Line Table</code></span></dt><dd>
							This table provides a one line summary for the hottest cache 
lines where false sharing is detected and is sorted in descending order 
by the amount of remote <span class="strong strong"><strong>Hitm</strong></span> detected per cache line by default.
						</dd><dt><span class="term"><code class="literal">Shared Cache Line Distribution Pareto</code></span></dt><dd><p class="simpara">
							This tables provides a variety of information about each cache line experiencing contention:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The cache lines are numbered in the <span class="strong strong"><strong>NUM</strong></span> column, starting at <code class="literal">0</code>.
								</li><li class="listitem">
									The virtual address of each cache line is contained in the <span class="strong strong"><strong>Data address Offset</strong></span> column and followed subsequently by the offset into the cache line where different accesses occurred.
								</li><li class="listitem">
									The <span class="strong strong"><strong>Pid</strong></span> column contains the process ID.
								</li><li class="listitem">
									The <span class="strong strong"><strong>Code Address</strong></span> column contains the instruction pointer code address.
								</li><li class="listitem">
									The columns under the <span class="strong strong"><strong>cycles</strong></span> label show average load latencies.
								</li><li class="listitem">
									The <span class="strong strong"><strong>cpu cnt</strong></span>
 column displays how many different CPUs samples came from (essentially,
 how many different CPUs were waiting for the data indexed at that given
 location).
								</li><li class="listitem">
									The <span class="strong strong"><strong>Symbol</strong></span> column displays the function name or symbol.
								</li><li class="listitem">
									The <span class="strong strong"><strong>Shared Object</strong></span> column displays the name of the ELF image where the samples come from (the name [<code class="literal">kernel.kallsyms</code>] is used when the samples come from the kernel).
								</li><li class="listitem">
									The <span class="strong strong"><strong>Source:Line</strong></span> column displays the source file and line number.
								</li><li class="listitem">
									The <span class="strong strong"><strong>Node{cpu list}</strong></span> column displays which specific CPUs samples came from for each node.
								</li></ul></div></dd></dl></div></section><section class="section" id="detecting-false-sharing-with-perf-c2c_detecting-false-sharing"><div class="titlepage"><div><div><h2 class="title">24.5. Detecting false sharing with perf c2c</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to detect false sharing using the <code class="literal">perf c2c</code> command.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						The <code class="literal">perf</code> user space tool is installed. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">installing perf</a>.
					</li><li class="listitem">
						A <code class="literal">perf.data</code> file recorded using the <code class="literal">perf c2c</code> command is available in the current directory. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/detecting-false-sharing_monitoring-and-managing-system-status-and-performance#detecting-cache-line-contention-with-perf-c2c_detecting-false-sharing">Detecting cache-line contention with perf c2c</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Open the <code class="literal">perf.data</code> file for further analysis:
					</p><pre class="screen"># perf c2c report --stdio</pre><p class="simpara">
						This opens the <code class="literal">perf.data</code> file in the terminal.
					</p></li><li class="listitem"><p class="simpara">
						In the "Trace Event Information" table, locate the row containing the values for <span class="strong strong"><strong>LLC Misses to Remote Cache (HITM)</strong></span>:
					</p><p class="simpara">
						The percentage in the value column of the <span class="strong strong"><strong>LLC Misses to Remote Cache (HITM)</strong></span>
 row represents the percentage of LLC misses that were occurring across 
NUMA nodes in modified cache-lines and is a key indicator false sharing 
has occurred.
					</p><pre class="literallayout white-space-pre">=================================================
            Trace Event Information
=================================================
  Total records                     :     329219
  Locked Load/Store Operations      :      14654
  Load Operations                   :      69679
  Loads - uncacheable               :          0
  Loads - IO                        :          0
  Loads - Miss                      :       3972
  Loads - no mapping                :          0
  Load Fill Buffer Hit              :      11958
  Load L1D hit                      :      17235
  Load L2D hit                      :         21
  Load LLC hit                      :      14219
  Load Local HITM                   :       3402
  Load Remote HITM                  :      12757
  Load Remote HIT                   :       5295
  Load Local DRAM                   :        976
  Load Remote DRAM                  :       3246
  Load MESI State Exclusive         :       4222
  Load MESI State Shared            :          0
  Load LLC Misses                   :      22274
  LLC Misses to Local DRAM          :        4.4%
  LLC Misses to Remote DRAM         :       14.6%
  LLC Misses to Remote cache (HIT)  :       23.8%
  <span class="strong strong"><strong>LLC Misses to Remote cache (HITM) : 57.3%</strong></span>
  Store Operations                  :     259539
  Store - uncacheable               :          0
  Store - no mapping                :         11
  Store L1D Hit                     :     256696
  Store L1D Miss                    :       2832
  No Page Map Rejects               :       2376
  Unable to parse data source       :          1</pre></li><li class="listitem"><p class="simpara">
						Inspect the <span class="strong strong"><strong>Rmt</strong></span> column of the <span class="strong strong"><strong>LLC Load Hitm</strong></span> field of the <span class="strong strong"><strong>Shared Data Cache Line Table</strong></span>:
					</p><pre class="literallayout white-space-pre">  =================================================
             Shared Data Cache Line Table
  =================================================
  #
  #                              Total      Rmt  <span class="strong strong"><strong>----- LLC Load Hitm -----</strong></span>  ---- Store Reference ----  --- Load Dram ----      LLC    Total  ----- Core Load Hit -----  -- LLC Load Hit --
  # Index           Cacheline  records     Hitm    Total      Lcl      <span class="strong strong"><strong>Rmt</strong></span>    Total    L1Hit   L1Miss       Lcl       Rmt  Ld Miss    Loads       FB       L1       L2       Llc       Rmt
  # .....  ..................  .......  .......  .......  .......  .......  .......  .......  .......  ........  ........  .......  .......  .......  .......  .......  ........  ........
  #
        0            0x602180   149904   77.09%    12103     2269     9834   109504   109036      468       727      2657    13747    40400     5355    16154        0      2875       529
        1            0x602100    12128   22.20%     3951     1119     2832        0        0        0        65       200     3749    12128     5096      108        0      2056       652
        2  0xffff883ffb6a7e80      260    0.09%       15        3       12      161      161        0         1         1       15       99       25       50        0         6         1
        3  0xffffffff81aec000      157    0.07%        9        0        9        1        0        1         0         7       20      156       50       59        0        27         4
        4  0xffffffff81e3f540      179    0.06%        9        1        8      117       97       20         0        10       25       62       11        1        0        24         7</pre><p class="simpara">
						This table is sorted in descending order by the amount of remote <span class="strong strong"><strong>Hitm</strong></span> detected per cache line. A high number in the <span class="strong strong"><strong>Rmt</strong></span> column of the <span class="strong strong"><strong>LLC Load Hitm</strong></span>
 section indicates false sharing and requires further inspection of the 
cache line on which it occurred to debug the false sharing activity.
					</p></li></ol></div></section></section><section class="chapter" id="getting-started-with-flamegraphs_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 25. Getting started with flamegraphs</h1></div></div></div><p class="_abstract _abstract">
			As a system administrator, you can use <code class="literal">flamegraphs</code> to create visualizations of system performance data recorded with the <code class="literal">perf</code> tool. As a software developer, you can use <code class="literal">flamegraphs</code> to create visualizations of application performance data recorded with the <code class="literal">perf</code> tool.
		</p><p>
			Sampling stack traces is a common technique for profiling CPU performance with the <code class="literal">perf</code> tool. Unfortunately, the results of profiling stack traces with <code class="literal">perf</code> can be extremely verbose and labor-intensive to analyze. <code class="literal">flamegraphs</code> are visualizations created from data recorded with <code class="literal">perf</code> to make identifying hot code-paths faster and easier.
		</p><section class="section" id="installing-flamegraphs_getting-started-with-flamegraphs"><div class="titlepage"><div><div><h2 class="title">25.1. Installing flamegraphs</h2></div></div></div><p class="_abstract _abstract">
				To begin using <code class="literal">flamegraphs</code>, install the required package.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Install the <code class="literal">flamegraphs</code> package:
					</p><pre class="screen"># dnf install js-d3-flame-graph</pre></li></ul></div></section><section class="section" id="creating-flamegraphs-over-the-entire-system_getting-started-with-flamegraphs"><div class="titlepage"><div><div><h2 class="title">25.2. Creating flamegraphs over the entire system</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to visualize performance data recorded over an entire system using <code class="literal">flamegraphs</code>.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">flamegraphs</code> are installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-flamegraphs_monitoring-and-managing-system-status-and-performance#installing-flamegraphs_getting-started-with-flamegraphs">installing flamegraphs</a>.
					</li><li class="listitem">
						The <code class="literal">perf</code> tool is installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Record the data and create the visualization:
					</p><pre class="screen"># perf script flamegraph -a -F 99 sleep 60</pre><p class="simpara">
						This command samples and records performance data over the entire system for 60 seconds, as stipulated by use of the <code class="literal">sleep</code> command, and then constructs the visualization which will be stored in the current active directory as <code class="literal">flamegraph.html</code>. The command samples call-graph data by default and takes the same arguments as the <code class="literal">perf</code> tool, in this particular case:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-a</code></span></dt><dd>
									Stipulates to record data over the entire system.
								</dd><dt><span class="term"><code class="literal">-F</code></span></dt><dd>
									To set the sampling frequency per second.
								</dd></dl></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						For analysis, view the generated visualization:
					</p><pre class="screen"># xdg-open flamegraph.html</pre><p class="simpara">
						This command opens the visualization in the default browser:
					</p><p class="simpara">
						<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/a28282f7a290a148d48eb29b3a17d046/flamegraph_allcpus.png" class="rh_docs--zoom" title="flamegraph allcpus"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/flamegraph_allcpus.png" alt="flamegraph allcpus"></a></span>

					</p></li></ul></div></section><section class="section" id="creating-flamegraphs-over-specific-processes_getting-started-with-flamegraphs"><div class="titlepage"><div><div><h2 class="title">25.3. Creating flamegraphs over specific processes</h2></div></div></div><p class="_abstract _abstract">
				You can use <code class="literal">flamegraphs</code> to visualize performance data recorded over specific running processes.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">flamegraphs</code> are installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-flamegraphs_monitoring-and-managing-system-status-and-performance#installing-flamegraphs_getting-started-with-flamegraphs">installing flamegraphs</a>.
					</li><li class="listitem">
						The <code class="literal">perf</code> tool is installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">installing perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Record the data and create the visualization:
					</p><pre class="screen"># perf script flamegraph -a -F 99 -p <code class="literal"><span class="emphasis"><em>ID1,ID2</em></span></code> sleep 60</pre><p class="simpara">
						This command samples and records performance data of the processes with the process ID’s <code class="literal"><span class="emphasis"><em>ID1</em></span></code> and <code class="literal"><span class="emphasis"><em>ID2</em></span></code> for 60 seconds, as stipulated by use of the <code class="literal">sleep</code> command, and then constructs the visualization which will be stored in the current active directory as <code class="literal">flamegraph.html</code>. The command samples call-graph data by default and takes the same arguments as the <code class="literal">perf</code> tool, in this particular case:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-a</code></span></dt><dd>
									Stipulates to record data over the entire system.
								</dd><dt><span class="term"><code class="literal">-F</code></span></dt><dd>
									To set the sampling frequency per second.
								</dd><dt><span class="term"><code class="literal">-p</code></span></dt><dd>
									To stipulate specific process ID’s to sample and record data over.
								</dd></dl></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						For analysis, view the generated visualization:
					</p><pre class="screen"># xdg-open flamegraph.html</pre><p class="simpara">
						This command opens the visualization in the default browser:
					</p><p class="simpara">
						<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/003d80d4f9d85ea8e33c627a40a2f333/flamegraph.png" class="rh_docs--zoom" title="flamegraph"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/flamegraph.png" alt="flamegraph"></a></span>

					</p></li></ul></div></section><section class="section" id="interpreting-flamegraphs_getting-started-with-flamegraphs"><div class="titlepage"><div><div><h2 class="title">25.4. Interpreting flamegraphs</h2></div></div></div><p class="_abstract _abstract">
				Each box in the flamegraph represents a different function in the 
stack. The y-axis shows the depth of the stack with the topmost box in 
each stack being the function that was actually on-CPU and everything 
below it being ancestry. The x-axis displays the population of the 
sampled call-graph data.
			</p><p>
				The children of a stack in a given row are displayed based on the 
number of samples taken of each respective function in descending order 
along the x-axis; the x-axis does not represent the passing of time. The
 wider an individual box is, the more frequent it was on-CPU or part of 
an on-CPU ancestry at the time the data was being sampled.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To reveal the names of functions which may have not been displayed
 previously and further investigate the data click on a box within the 
flamegraph to zoom into the stack at that given location:
					</p><p class="simpara">
						<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/0ea4b6a35abc82847a9eb7bb25bf1d6e/zoomed-in-flamegraph.png" class="rh_docs--zoom" title="zoomed in flamegraph"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/zoomed-in-flamegraph.png" alt="zoomed in flamegraph"></a></span>

					</p></li><li class="listitem">
						To return to the default view of the flamegraph, click <span class="guibutton">Reset Zoom</span>.
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Boxes representing user-space functions may be labeled as <span class="strong strong"><strong>Unknown</strong></span> in <code class="literal">flamegraphs</code> because the binary of the function is stripped. The <code class="literal">debuginfo</code>
 package of the executable must be installed or, if the executable is a 
locally developed application, the application must be compiled with 
debugging information. Use the <code class="literal">-g</code> option in GCC, to display the function names or symbols in such a situation.
				</p><p>
					<span class="inlinemediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/003d80d4f9d85ea8e33c627a40a2f333/flamegraph.png" class="rh_docs--zoom" title="flamegraph"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/flamegraph.png" alt="flamegraph"></a></span>

				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#why-perf-displays-some-function-names-as-raw-function-addresses_real-time-system-profiling-using-perf-top">Why perf displays some function names as raw functions addresses</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/debugging-applications_developing-applications#enabling-debugging-with-debugging-information_debugging-applications">Enabling debugging with debugging information</a>
					</li></ul></div></section></section><section class="chapter" id="creating-custom-circular-buffers-to-collect-specific-data-with-perf_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 26. Monitoring processes for performance bottlenecks using perf circular buffers</h1></div></div></div><p class="_abstract _abstract">
			You can create circular buffers that take event-specific snapshots of data with the <code class="literal">perf</code>
 tool in order to monitor performance bottlenecks in specific processes 
or parts of applications running on your system. In such cases, <code class="literal">perf</code> only writes data to a <code class="literal">perf.data</code> file for later analysis if a specified event is detected.
		</p><section class="section" id="circular-buffers-and-event-specific-snapshots_assembly_creating-custom-circular-buffers-to-collect-specific-data-with-perf"><div class="titlepage"><div><div><h2 class="title">26.1. Circular buffers and event-specific snapshots with perf</h2></div></div></div><p class="_abstract _abstract">
				When investigating performance issues in a process or application with <code class="literal">perf</code>,
 it may not be affordable or appropriate to record data for hours 
preceding a specific event of interest occurring. In such cases, you can
 use <code class="literal">perf record</code> to create custom circular buffers that take snapshots after specific events.
			</p><p>
				The <code class="literal option">--overwrite</code> option makes <code class="literal">perf record</code> store all data in an overwritable circular buffer. When the buffer gets full, <code class="literal">perf record</code> automatically overwrites the oldest records which, therefore, never get written to a <code class="literal file">perf.data</code> file.
			</p><p>
				Using the <code class="literal option">--overwrite</code> and <code class="literal option">--switch-output-event</code> options together configures a circular buffer that records and dumps data continuously until it detects the <code class="literal option">--switch-output-event</code> trigger event. The trigger event signals to <code class="literal">perf record</code> that something of interest to the user has occurred and to write the data in the circular buffer to a <code class="literal file">perf.data</code> file. This collects specific data you are interested in while simultaneously reducing the overhead of the running <code class="literal">perf</code> process by not writing data you do not want to a <code class="literal">perf.data</code> file.
			</p></section><section class="section" id="using-perf-to-create-custom-circular-buffers-that-perform-event-specific-snapshots_assembly_creating-custom-circular-buffers-to-collect-specific-data-with-perf"><div class="titlepage"><div><div><h2 class="title">26.2. Collecting specific data to monitor for performance bottlenecks using perf circular buffers</h2></div></div></div><p class="_abstract _abstract">
				With the <code class="literal">perf</code> tool, you can create 
circular buffers that are triggered by events you specify in order to 
only collect data you are interested in. To create circular buffers that
 collect event-specific data, use the <code class="literal">--overwrite</code> and <code class="literal">--switch-output-event</code> options for <code class="literal">perf</code>.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem"><p class="simpara">
						You have placed a uprobe in the process or application you are 
interested in monitoring at a location of interest within the process or
 application:
					</p><pre class="screen"># perf probe -x <span class="emphasis"><em>/path/to/executable</em></span> -a <span class="emphasis"><em>function</em></span>
Added new event:
  <span class="emphasis"><em>probe_executable:function</em></span>   (on <span class="emphasis"><em>function</em></span> in <span class="emphasis"><em>/path/to/executable</em></span>)

You can now use it in all perf tools, such as:

        perf record -e <span class="emphasis"><em>probe_executable:function</em></span> -aR sleep 1</pre></li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Create the circular buffer with the uprobe as the trigger event:
					</p><pre class="screen"># perf record --overwrite -e cycles --switch-output-event <span class="emphasis"><em>probe_executable:function</em></span> ./executable
[ perf record: dump data: Woken up 1 times ]
[ perf record: Dump perf.data.2021021012231959 ]
[ perf record: dump data: Woken up 1 times ]
[ perf record: Dump perf.data.2021021012232008 ]
^C[ perf record: dump data: Woken up 1 times ]
[ perf record: Dump perf.data.2021021012232082 ]
[ perf record: Captured and wrote 5.621 MB perf.data.&lt;timestamp&gt; ]</pre><p class="simpara">
						This example initiates the executable and collects cpu cycles, specified after the <code class="literal">-e</code> option, until <code class="literal">perf</code> detects the uprobe, the trigger event specified after the <code class="literal">--switch-output-event</code> option. At that point, <code class="literal">perf</code> takes a snapshot of all the data in the circular buffer and stores it in a unique <code class="literal">perf.data</code> file identified by timestamp. This example produced a total of 2 snapshots, the last <code class="literal">perf.data</code> file was forced by pressing <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>c</strong></span>.
					</p></li></ul></div></section></section><section class="chapter" id="turning-tracepoints-on-and-off-without-stopping-or-restarting-perf_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 27. Adding and removing tracepoints from a running perf collector without stopping or restarting perf</h1></div></div></div><p class="_abstract _abstract">
			By using the control pipe interface to enable and disable different tracepoints in a running <code class="literal">perf</code> collector, you can dynamically adjust what data you are collecting without having to stop or restart <code class="literal">perf</code>.
 This ensures you do not lose performance data that would have otherwise
 been recorded during the stopping or restarting process.
		</p><section class="section" id="adding-tracepoints-to-a-running-perf-collector-without-stopping-or-restarting-perf_turning-tracepoints-on-and-off-without-stopping-or-restarting-perf"><div class="titlepage"><div><div><h2 class="title">27.1. Adding tracepoints to a running perf collector without stopping or restarting perf</h2></div></div></div><p class="_abstract _abstract">
				Add tracepoints to a running <code class="literal">perf</code> collector using the control pipe interface to adjust the data you are recording without having to stop <code class="literal">perf</code> and losing performance data.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure the control pipe interface:
					</p><pre class="screen"># mkfifo control ack perf.pipe</pre></li><li class="listitem"><p class="simpara">
						Run <code class="literal">perf record</code> with the control file setup and events you are interested in enabling:
					</p><pre class="screen"># perf record --control=fifo:control,ack -D -1 --no-buffering -e '<span class="emphasis"><em>sched:*</em></span>' -o - &gt; perf.pipe</pre><p class="simpara">
						In this example, declaring <code class="literal">'sched:*'</code> after the <code class="literal">-e</code> option starts <code class="literal">perf record</code> with scheduler events.
					</p></li><li class="listitem"><p class="simpara">
						In a second terminal, start the read side of the control pipe:
					</p><pre class="screen"># cat perf.pipe | perf --no-pager script -i -</pre><p class="simpara">
						Starting the read side of the control pipe triggers the following message in the first terminal:
					</p><pre class="screen">Events disabled</pre></li><li class="listitem"><p class="simpara">
						In a third terminal, enable a tracepoint using the control file:
					</p><pre class="screen"># echo 'enable <span class="emphasis"><em>sched:sched_process_fork</em></span>' &gt; control</pre><p class="simpara">
						This command triggers <code class="literal">perf</code> to scan 
the current event list in the control file for the declared event. If 
the event is present, the tracepoint is enabled and the following 
message appears in the first terminal:
					</p><pre class="screen">event sched:sched_process_fork enabled</pre><p class="simpara">
						Once the tracepoint is enabled, the second terminal displays the output from <code class="literal">perf</code> detecting the tracepoint:
					</p><pre class="screen">bash 33349 [034] 149587.674295: sched:sched_process_fork: comm=bash pid=33349 child_comm=bash child_pid=34056</pre></li></ol></div></section><section class="section" id="removing-tracepoints-from-a-running-perf-collector-without-stopping-or-restarting-perf_turning-tracepoints-on-and-off-without-stopping-or-restarting-perf"><div class="titlepage"><div><div><h2 class="title">27.2. Removing tracepoints from a running perf collector without stopping or restarting perf</h2></div></div></div><p class="_abstract _abstract">
				Remove tracepoints from a running <code class="literal">perf</code> collector using the control pipe interface to reduce the scope of data you are collecting without having to stop <code class="literal">perf</code> and losing performance data.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">perf</code> user space tool installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-perf_monitoring-and-managing-system-status-and-performance#installing-perf_getting-started-with-perf">Installing perf</a>.
					</li><li class="listitem">
						You have added tracepoints to a running <code class="literal">perf</code> collector via the control pipe interface. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/turning-tracepoints-on-and-off-without-stopping-or-restarting-perf_monitoring-and-managing-system-status-and-performance#adding-tracepoints-to-a-running-perf-collector-without-stopping-or-restarting-perf_turning-tracepoints-on-and-off-without-stopping-or-restarting-perf">Adding tracepoints to a running perf collector without stopping or restarting perf</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Remove the tracepoint:
					</p><pre class="screen"># echo 'disable <span class="emphasis"><em>sched:sched_process_fork</em></span>' &gt; control</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							This example assumes you have previously loaded scheduler events into the control file and enabled the tracepoint <code class="literal">sched:sched_process_fork</code>.
						</p></div></div><p class="simpara">
						This command triggers <code class="literal">perf</code> to scan 
the current event list in the control file for the declared event. If 
the event is present, the tracepoint is disabled and the following 
message appears in the terminal used to configure the control pipe:
					</p><pre class="screen">event sched:sched_process_fork disabled</pre></li></ul></div></section></section><section class="chapter" id="profiling-memory-allocation-with-numastat_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 28. Profiling memory allocation with numastat</h1></div></div></div><p class="_abstract _abstract">
			With the <code class="literal">numastat</code> tool, you can display statistics over memory allocations in a system.
		</p><p>
			The <code class="literal">numastat</code> tool displays data for each
 NUMA node separately. You can use this information to investigate 
memory performance of your system or the effectiveness of different 
memory policies on your system.
		</p><section class="section" id="default-numastat-statistics_profiling-memory-allocation-with-numastat"><div class="titlepage"><div><div><h2 class="title">28.1. Default numastat statistics</h2></div></div></div><p class="_abstract _abstract">
				By default, the <code class="literal">numastat</code> tool displays statistics over these categories of data for each NUMA node:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">numa_hit</code></span></dt><dd>
							The number of pages that were successfully allocated to this node.
						</dd><dt><span class="term"><code class="literal">numa_miss</code></span></dt><dd>
							The number of pages that were allocated on this node because of low memory on the intended node. Each <code class="literal">numa_miss</code> event has a corresponding <code class="literal">numa_foreign</code> event on another node.
						</dd><dt><span class="term"><code class="literal">numa_foreign</code></span></dt><dd>
							The number of pages initially intended for this node that were allocated to another node instead. Each <code class="literal">numa_foreign</code> event has a corresponding <code class="literal">numa_miss</code> event on another node.
						</dd><dt><span class="term"><code class="literal">interleave_hit</code></span></dt><dd>
							The number of interleave policy pages successfully allocated to this node.
						</dd><dt><span class="term"><code class="literal">local_node</code></span></dt><dd>
							The number of pages successfully allocated on this node by a process on this node.
						</dd><dt><span class="term"><code class="literal">other_node</code></span></dt><dd>
							The number of pages allocated on this node by a process on another node.
						</dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					High <code class="literal">numa_hit</code> values and low <code class="literal">numa_miss</code> values (relative to each other) indicate optimal performance.
				</p></div></div></section><section class="section" id="viewing-memory-allocation-with-numastat_profiling-memory-allocation-with-numastat"><div class="titlepage"><div><div><h2 class="title">28.2. Viewing memory allocation with numastat</h2></div></div></div><p class="_abstract _abstract">
				You can view the memory allocation of the system by using the <code class="literal">numastat</code> tool.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Install the <code class="literal">numactl</code> package:
					</p><pre class="screen"># dnf install numactl</pre></li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						View the memory allocation of your system:
					</p><pre class="screen white-space-pre white-space-pre">$ numastat
                             node0         node1
numa_hit                  76557759      92126519
numa_miss                 30772308      30827638
numa_foreign              30827638      30772308
interleave_hit              106507        103832
local_node                76502227      92086995
other_node                30827840      30867162</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">numastat(8)</code> man page
					</li></ul></div></section></section><section class="chapter" id="configuring-an-operating-system-to-optimize-cpu-utilization_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 29. Configuring an operating system to optimize CPU utilization</h1></div></div></div><p class="_abstract _abstract">
			You can configure the operating system to optimize CPU utilization across their workloads.
		</p><section class="section" id="tools-for-monitoring-and-diagnosing-processor-issues_configuring-an-operating-system-to-optimize-cpu-utilization"><div class="titlepage"><div><div><h2 class="title">29.1. Tools for monitoring and diagnosing processor issues</h2></div></div></div><p class="_abstract _abstract">
				The following are the tools available in Red&nbsp;Hat 
Enterprise&nbsp;Linux&nbsp;9 to monitor and diagnose processor-related 
performance issues:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">turbostat</code> tool prints counter results
 at specified intervals to help administrators identify unexpected 
behavior in servers, such as excessive power usage, failure to enter 
deep sleep states, or system management interrupts (SMIs) being created 
unnecessarily.
					</li><li class="listitem">
						<code class="literal">numactl</code> utility provides a number of options to manage processor and memory affinity. The <code class="literal">numactl</code> package includes the <code class="literal">libnuma</code>
 library which offers a simple programming interface to the NUMA policy 
supported by the kernel, and can be used for more fine-grained tuning 
than the <code class="literal">numactl</code> application.
					</li><li class="listitem">
						<code class="literal">numastat</code> tool displays per-NUMA node 
memory statistics for the operating system and its processes, and shows 
administrators whether the process memory is spread throughout a system 
or is centralized on specific nodes. This tool is provided by the <code class="literal">numactl</code> package.
					</li><li class="listitem">
						<code class="literal">numad</code> is an automatic NUMA affinity 
management daemon. It monitors NUMA topology and resource usage within a
 system in order to dynamically improve NUMA resource allocation and 
management.
					</li><li class="listitem">
						<code class="literal">/proc/interrupts</code> file displays the 
interrupt request (IRQ) number, the number of similar interrupt requests
 handled by each processor in the system, the type of interrupt sent, 
and a comma-separated list of devices that respond to the listed 
interrupt request.
					</li><li class="listitem"><p class="simpara">
						<code class="literal">pqos</code> utility is available in the <code class="literal">intel-cmt-cat</code> package. It monitors CPU cache and memory bandwidth on recent Intel processors. It monitors:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								The instructions per cycle (IPC).
							</li><li class="listitem">
								The count of last level cache MISSES.
							</li><li class="listitem">
								The size in kilobytes that the program executing in a given CPU occupies in the LLC.
							</li><li class="listitem">
								The bandwidth to local memory (MBL).
							</li><li class="listitem">
								The bandwidth to remote memory (MBR).
							</li></ul></div></li><li class="listitem">
						<code class="literal">x86_energy_perf_policy</code> tool allows 
administrators to define the relative importance of performance and 
energy efficiency. This information can then be used to influence 
processors that support this feature when they select options that trade
 off between performance and energy efficiency.
					</li><li class="listitem">
						<code class="literal">taskset</code> tool is provided by the <code class="literal">util-linux</code>
 package. It allows administrators to retrieve and set the processor 
affinity of a running process, or launch a process with a specified 
processor affinity.
					</li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">turbostat(8)</code>, <code class="literal">numactl(8)</code>, <code class="literal">numastat(8)</code>, <code class="literal">numa(7)</code>, <code class="literal">numad(8)</code>, <code class="literal">pqos(8)</code>, <code class="literal">x86_energy_perf_policy(8)</code>, and <code class="literal">taskset(1)</code> man pages
					</li></ul></div></section><section class="section" id="types-of-system-topology_configuring-an-operating-system-to-optimize-cpu-utilization"><div class="titlepage"><div><div><h2 class="title">29.2. Types of system topology</h2></div></div></div><p class="_abstract _abstract">
				In modern computing, the idea of a CPU is a misleading one, as most 
modern systems have multiple processors. The topology of the system is 
the way these processors are connected to each other and to other system
 resources. This can affect system and application performance, and the 
tuning considerations for a system.
			</p><p>
				The following are the two primary types of topology used in modern computing:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Symmetric Multi-Processor (SMP) topology</code></span></dt><dd>
							SMP topology allows all processors to access memory in the same 
amount of time. However, because shared and equal memory access 
inherently forces serialized memory accesses from all the CPUs, SMP 
system scaling constraints are now generally viewed as unacceptable. For
 this reason, practically all modern server systems are NUMA machines.
						</dd><dt><span class="term"><code class="literal">Non-Uniform Memory Access (NUMA) topology</code></span></dt><dd><p class="simpara">
							NUMA topology was developed more recently than SMP topology. In a
 NUMA system, multiple processors are physically grouped on a socket. 
Each socket has a dedicated area of memory and processors that have 
local access to that memory, these are referred to collectively as a 
node. Processors on the same node have high speed access to that node’s 
memory bank, and slower access to memory banks not on their node.
						</p><p class="simpara">
							Therefore, there is a performance penalty when accessing 
non-local memory. Thus, performance sensitive applications on a system 
with NUMA topology should access memory that is on the same node as the 
processor executing the application, and should avoid accessing remote 
memory wherever possible.
						</p><p class="simpara">
							Multi-threaded applications that are sensitive to performance may
 benefit from being configured to execute on a specific NUMA node rather
 than a specific processor. Whether this is suitable depends on your 
system and the requirements of your application. If multiple application
 threads access the same cached data, then configuring those threads to 
execute on the same processor may be suitable. However, if multiple 
threads that access and cache different data execute on the same 
processor, each thread may evict cached data accessed by a previous 
thread. This means that each thread 'misses' the cache and wastes 
execution time fetching data from memory and replacing it in the cache. 
Use the <code class="literal">perf</code> tool to check for an excessive number of cache misses.
						</p></dd></dl></div><section class="section" id="displaying-system-topologies_configuring-an-operating-system-to-optimize-cpu-utilization"><div class="titlepage"><div><div><h3 class="title">29.2.1. Displaying system topologies</h3></div></div></div><p class="_abstract _abstract">
					There are a number of commands that help understand the topology of
 a system. This procedure describes how to determine the system 
topology.
				</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							To display an overview of your system topology:
						</p><pre class="screen">$ numactl --hardware
available: 4 nodes (0-3)
node 0 cpus: 0 4 8 12 16 20 24 28 32 36
node 0 size: 65415 MB
node 0 free: 43971 MB
[...]</pre></li><li class="listitem"><p class="simpara">
							To gather the information about the CPU architecture, such as the
 number of CPUs, threads, cores, sockets, and NUMA nodes:
						</p><pre class="screen">$ lscpu
Architecture:          x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                40
On-line CPU(s) list:   0-39
Thread(s) per core:    1
Core(s) per socket:    10
Socket(s):             4
NUMA node(s):          4
Vendor ID:             GenuineIntel
CPU family:            6
Model:                 47
Model name:            Intel(R) Xeon(R) CPU E7- 4870  @ 2.40GHz
Stepping:              2
CPU MHz:               2394.204
BogoMIPS:              4787.85
Virtualization:        VT-x
L1d cache:             32K
L1i cache:             32K
L2 cache:              256K
L3 cache:              30720K
NUMA node0 CPU(s):     0,4,8,12,16,20,24,28,32,36
NUMA node1 CPU(s):     2,6,10,14,18,22,26,30,34,38
NUMA node2 CPU(s):     1,5,9,13,17,21,25,29,33,37
NUMA node3 CPU(s):     3,7,11,15,19,23,27,31,35,39</pre></li><li class="listitem"><p class="simpara">
							To view a graphical representation of your system:
						</p><pre class="screen"># dnf install hwloc-gui
# lstopo</pre><div class="figure" id="idm140611465173632"><p class="title">Figure 29.1. The lstopo output</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/7ddd66e302a97d0b710e23e0af9d6524/lstopo.png" class="rh_docs--zoom" title="lstopo"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/lstopo.png" alt="lstopo"></a></div></div></div></li><li class="listitem"><p class="simpara">
							To view the detailed textual output:
						</p><pre class="screen"># dnf install hwloc
# lstopo-no-graphics
Machine (15GB)
  Package L#0 + L3 L#0 (8192KB)
    L2 L#0 (256KB) + L1d L#0 (32KB) + L1i L#0 (32KB) + Core L#0
        PU L#0 (P#0)
        PU L#1 (P#4)
       HostBridge L#0
    PCI 8086:5917
        GPU L#0 "renderD128"
        GPU L#1 "controlD64"
        GPU L#2 "card0"
    PCIBridge
        PCI 8086:24fd
          Net L#3 "wlp61s0"
    PCIBridge
        PCI 8086:f1a6
    PCI 8086:15d7
        Net L#4 "enp0s31f6"</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">numactl(8)</code>, <code class="literal">lscpu(1)</code>, and <code class="literal">lstopo(1)</code> man pages
						</li></ul></div></section></section><section class="section" id="configuring-kernel-tick-time_configuring-an-operating-system-to-optimize-cpu-utilization"><div class="titlepage"><div><div><h2 class="title">29.3. Configuring kernel tick time</h2></div></div></div><p class="_abstract _abstract">
				By default, Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9 uses a 
tickless kernel, which does not interrupt idle CPUs in order to reduce 
power usage and allow new processors to take advantage of deep sleep 
states.
			</p><p>
				Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9 also offers a dynamic 
tickless option, which is useful for latency-sensitive workloads, such 
as high performance computing or realtime computing. By default, the 
dynamic tickless option is disabled. Red&nbsp;Hat recommends using the <code class="literal">cpu-partitioning</code> <span class="strong strong"><strong>TuneD</strong></span> profile to enable the dynamic tickless option for cores specified as <code class="literal">isolated_cores</code>.
			</p><p>
				This procedure describes how to manually persistently enable dynamic tickless behavior.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To enable dynamic tickless behavior in certain cores, specify those cores on the kernel command line with the <code class="literal">nohz_full</code> parameter. On a 16 core system, enable the <code class="literal">nohz_full=1-15</code> kernel option:
					</p><pre class="screen"># grubby --update-kernel=ALL --args="nohz_full=1-15"</pre><p class="simpara">
						This enables dynamic tickless behavior on cores <code class="literal">1</code> through <code class="literal">15</code>, moving all timekeeping to the only unspecified core (core <code class="literal">0</code>).
					</p></li><li class="listitem"><p class="simpara">
						When the system boots, manually move the <code class="literal">rcu</code> threads to the non-latency-sensitive core, in this case core <code class="literal">0</code>:
					</p><pre class="screen"># for i in `pgrep rcu[^c]` ; do taskset -pc 0 $i ; done</pre></li><li class="listitem">
						Optional: Use the <code class="literal">isolcpus</code> parameter on the kernel command line to isolate certain cores from user-space tasks.
					</li><li class="listitem"><p class="simpara">
						Optional: Set the CPU affinity for the kernel’s <code class="literal">write-back bdi-flush</code> threads to the housekeeping core:
					</p><pre class="screen">echo 1 &gt; /sys/bus/workqueue/devices/writeback/cpumask</pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Once the system is rebooted, verify if <code class="literal">dynticks</code> are enabled:
					</p><pre class="screen"># journalctl -xe | grep dynticks
Mar 15 18:34:54 rhel-server kernel: NO_HZ: Full dynticks CPUs: 1-15.</pre></li><li class="listitem"><p class="simpara">
						Verify that the dynamic tickless configuration is working correctly:
					</p><pre class="screen"># perf stat -C 1 -e irq_vectors:local_timer_entry taskset -c 1 sleep 3</pre><p class="simpara">
						This command measures ticks on CPU 1 while telling CPU 1 to sleep for 3 seconds.
					</p></li><li class="listitem"><p class="simpara">
						The default kernel timer configuration shows around 3100 ticks on a regular CPU:
					</p><pre class="screen"># perf stat -C 0 -e irq_vectors:local_timer_entry taskset -c 0 sleep 3

 Performance counter stats for 'CPU(s) 0':

             3,107      irq_vectors:local_timer_entry

       3.001342790 seconds time elapsed</pre></li><li class="listitem"><p class="simpara">
						With the dynamic tickless kernel configured, you should see around 4 ticks instead:
					</p><pre class="screen"># perf stat -C 1 -e irq_vectors:local_timer_entry taskset -c 1 sleep 3

 Performance counter stats for 'CPU(s) 1':

                 4      irq_vectors:local_timer_entry

       3.001544078 seconds time elapsed</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">perf(1)</code> and <code class="literal">cpuset(7)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/2273531">All about nohz_full kernel parameter Red Hat Knowledgebase article</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/3875421">How to verify the list of "isolated" and "nohz_full" CPU information from sysfs? Red Hat Knowledgebase article</a>
					</li></ul></div></section><section class="section" id="overview-of-an-interrupt-request_configuring-an-operating-system-to-optimize-cpu-utilization"><div class="titlepage"><div><div><h2 class="title">29.4. Overview of an interrupt request</h2></div></div></div><p class="_abstract _abstract">
				An interrupt request or IRQ is a signal for immediate attention sent
 from a piece of hardware to a processor. Each device in a system is 
assigned one or more IRQ numbers which allow it to send unique 
interrupts. When interrupts are enabled, a processor that receives an 
interrupt request immediately pauses execution of the current 
application thread in order to address the interrupt request.
			</p><p>
				Because interrupt halts normal operation, high interrupt rates can 
severely degrade system performance. It is possible to reduce the amount
 of time taken by interrupts by configuring interrupt affinity or by 
sending a number of lower priority interrupts in a batch (coalescing a 
number of interrupts).
			</p><p>
				Interrupt requests have an associated affinity property, <code class="literal">smp_affinity</code>,
 which defines the processors that handle the interrupt request. To 
improve application performance, assign interrupt affinity and process 
affinity to the same processor, or processors on the same core. This 
allows the specified interrupt and application threads to share cache 
lines.
			</p><p>
				On systems that support interrupt steering, modifying the <code class="literal">smp_affinity</code>
 property of an interrupt request sets up the hardware so that the 
decision to service an interrupt with a particular processor is made at 
the hardware level with no intervention from the kernel.
			</p><section class="section" id="balancing-interrupts-manually_configuring-an-operating-system-to-optimize-cpu-utilization"><div class="titlepage"><div><div><h3 class="title">29.4.1. Balancing interrupts manually</h3></div></div></div><p class="_abstract _abstract">
					If your BIOS exports its NUMA topology, the <code class="literal">irqbalance</code> service can automatically serve interrupt requests on the node that is local to the hardware requesting service.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Check which devices correspond to the interrupt requests that you want to configure.
						</li><li class="listitem"><p class="simpara">
							Find the hardware specification for your platform. Check if the chipset on your system supports distributing interrupts.
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									If it does, you can configure interrupt delivery as described 
in the following steps. Additionally, check which algorithm your chipset
 uses to balance interrupts. Some BIOSes have options to configure 
interrupt delivery.
								</li><li class="listitem">
									If it does not, your chipset always routes all interrupts to a 
single, static CPU. You cannot configure which CPU is used.
								</li></ol></div></li><li class="listitem"><p class="simpara">
							Check which Advanced Programmable Interrupt Controller (APIC) mode is in use on your system:
						</p><pre class="screen">$ journalctl --dmesg | grep APIC</pre><p class="simpara">
							Here,
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									If your system uses a mode other than <code class="literal">flat</code>, you can see a line similar to <code class="literal">Setting APIC routing to physical flat</code>.
								</li><li class="listitem"><p class="simpara">
									If you can see no such message, your system uses <code class="literal">flat</code> mode.
								</p><p class="simpara">
									If your system uses <code class="literal">x2apic</code> mode, you can disable it by adding the <code class="literal">nox2apic</code> option to the kernel command line in the <code class="literal">bootloader</code> configuration.
								</p><p class="simpara">
									Only non-physical flat mode (<code class="literal">flat</code>) supports distributing interrupts to multiple CPUs. This mode is available only for systems that have up to <code class="literal">8</code> CPUs.
								</p></li></ul></div></li><li class="listitem">
							Calculate the <code class="literal">smp_affinity mask</code>. For more information about how to calculate the <code class="literal">smp_affinity mask</code>, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/configuring-an-operating-system-to-optimize-cpu-utilization_monitoring-and-managing-system-status-and-performance#setting-the-smp_affinity-mask_configuring-an-operating-system-to-optimize-cpu-utilization">Setting the smp_affinity mask</a>.
						</li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">journalctl(1)</code> and <code class="literal">taskset(1)</code> man pages
						</li></ul></div></section><section class="section" id="setting-the-smp_affinity-mask_configuring-an-operating-system-to-optimize-cpu-utilization"><div class="titlepage"><div><div><h3 class="title">29.4.2. Setting the smp_affinity mask</h3></div></div></div><p class="_abstract _abstract">
					The <code class="literal">smp_affinity</code> value is stored as a 
hexadecimal bit mask representing all processors in the system. Each bit
 configures a different CPU. The least significant bit is CPU 0.
				</p><p>
					The default value of the mask is <code class="literal">f</code>, 
which means that an interrupt request can be handled on any processor in
 the system. Setting this value to 1 means that only processor 0 can 
handle the interrupt.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							In binary, use the value 1 for CPUs that handle the interrupts. 
For example, to set CPU 0 and CPU 7 to handle interrupts, use <code class="literal">0000000010000001</code> as the binary code:
						</p><div class="table" id="idm140611467647904"><p class="title">Table 29.1. Binary Bits for CPUs</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="tqedrrk" id="rh-table--tqedrrk" style="--rh-table--scrollbar--width: 0px;"><table class="gt-8-cols lt-7-rows"><colgroup><col style="width: 17%; " class="col_1"><!--Empty--><col style="width: 5%; " class="col_2"><!--Empty--><col style="width: 5%; " class="col_3"><!--Empty--><col style="width: 5%; " class="col_4"><!--Empty--><col style="width: 5%; " class="col_5"><!--Empty--><col style="width: 5%; " class="col_6"><!--Empty--><col style="width: 5%; " class="col_7"><!--Empty--><col style="width: 5%; " class="col_8"><!--Empty--><col style="width: 5%; " class="col_9"><!--Empty--><col style="width: 5%; " class="col_10"><!--Empty--><col style="width: 5%; " class="col_11"><!--Empty--><col style="width: 5%; " class="col_12"><!--Empty--><col style="width: 5%; " class="col_13"><!--Empty--><col style="width: 5%; " class="col_14"><!--Empty--><col style="width: 5%; " class="col_15"><!--Empty--><col style="width: 5%; " class="col_16"><!--Empty--><col style="width: 5%; " class="col_17"><!--Empty--></colgroup><tbody><tr><td data-row="1" data-col="1" class="content--md" valign="top" align="left"> <p>
											CPU
										</p>
										 </td><td data-row="1" data-col="2" class="content--md" valign="top" align="left"> <p>
											15
										</p>
										 </td><td data-row="1" data-col="3" class="content--md" valign="top" align="left"> <p>
											14
										</p>
										 </td><td data-row="1" data-col="4" class="content--md" valign="top" align="left"> <p>
											13
										</p>
										 </td><td data-row="1" data-col="5" class="content--md" valign="top" align="left"> <p>
											12
										</p>
										 </td><td data-row="1" data-col="6" class="content--md" valign="top" align="left"> <p>
											11
										</p>
										 </td><td data-row="1" data-col="7" class="content--md" valign="top" align="left"> <p>
											10
										</p>
										 </td><td data-row="1" data-col="8" class="content--md" valign="top" align="left"> <p>
											9
										</p>
										 </td><td data-row="1" data-col="9" class="content--md" valign="top" align="left"> <p>
											8
										</p>
										 </td><td data-row="1" data-col="10" class="content--md" valign="top" align="left"> <p>
											7
										</p>
										 </td><td data-row="1" data-col="11" class="content--md" valign="top" align="left"> <p>
											6
										</p>
										 </td><td data-row="1" data-col="12" class="content--md" valign="top" align="left"> <p>
											5
										</p>
										 </td><td data-row="1" data-col="13" class="content--md" valign="top" align="left"> <p>
											4
										</p>
										 </td><td data-row="1" data-col="14" class="content--md" valign="top" align="left"> <p>
											3
										</p>
										 </td><td data-row="1" data-col="15" class="content--md" valign="top" align="left"> <p>
											2
										</p>
										 </td><td data-row="1" data-col="16" class="content--md" valign="top" align="left"> <p>
											1
										</p>
										 </td><td data-row="1" data-col="17" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td></tr><tr><td data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
											Binary
										</p>
										 </td><td data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="4" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="5" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="6" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="7" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="8" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="9" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="10" class="content--md" valign="top" align="left"> <p>
											1
										</p>
										 </td><td data-row="2" data-col="11" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="12" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="13" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="14" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="15" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="16" class="content--md" valign="top" align="left"> <p>
											0
										</p>
										 </td><td data-row="2" data-col="17" class="content--md" valign="top" align="left"> <p>
											1
										</p>
										 </td></tr></tbody></table></rh-table></div></li><li class="listitem"><p class="simpara">
							Convert the binary code to hexadecimal:
						</p><p class="simpara">
							For example, to convert the binary code using Python:
						</p><pre class="screen">&gt;&gt;&gt; hex(int('0000000010000001', 2))

'0x81'</pre><p class="simpara">
							On systems with more than 32 processors, you must delimit the <code class="literal">smp_affinity</code>
 values for discrete 32 bit groups. For example, if you want only the 
first 32 processors of a 64 processor system to service an interrupt 
request, use <code class="literal">0xffffffff,00000000</code>.
						</p></li><li class="listitem"><p class="simpara">
							The interrupt affinity value for a particular interrupt request is stored in the associated <code class="literal">/proc/irq/irq_number/smp_affinity</code> file. Set the <code class="literal">smp_affinity</code> mask in this file:
						</p><pre class="screen"># echo mask &gt; /proc/irq/irq_number/smp_affinity</pre></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">journalctl(1)</code>, <code class="literal">irqbalance(1)</code>, and <code class="literal">taskset(1)</code> man pages
						</li></ul></div></section></section></section><section class="chapter" id="tuning-scheduling-policy_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 30. Tuning scheduling policy</h1></div></div></div><p class="_abstract _abstract">
			In Red&nbsp;Hat Enterprise&nbsp;Linux, the smallest unit of process 
execution is called a thread. The system scheduler determines which 
processor runs a thread, and for how long the thread runs. However, 
because the scheduler’s primary concern is to keep the system busy, it 
may not schedule threads optimally for application performance.
		</p><p>
			For example, say an application on a NUMA system is running on Node A
 when a processor on Node B becomes available. To keep the processor on 
Node B busy, the scheduler moves one of the application’s threads to 
Node B. However, the application thread still requires access to memory 
on Node A. But, this memory will take longer to access because the 
thread is now running on Node B and Node A memory is no longer local to 
the thread. Thus, it may take longer for the thread to finish running on
 Node B than it would have taken to wait for a processor on Node A to 
become available, and then to execute the thread on the original node 
with local memory access.
		</p><section class="section" id="con_categories-of-scheduling-policies_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.1. Categories of scheduling policies</h2></div></div></div><p class="_abstract _abstract">
				Performance sensitive applications often benefit from the designer 
or administrator determining where threads are run. The Linux scheduler 
implements a number of scheduling policies which determine where and for
 how long a thread runs.
			</p><p>
				The following are the two major categories of scheduling policies:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Normal policies</code></span></dt><dd>
							Normal threads are used for tasks of normal priority.
						</dd><dt><span class="term"><code class="literal">Realtime policies</code></span></dt><dd><p class="simpara">
							Realtime policies are used for time-sensitive tasks that must 
complete without interruptions. Realtime threads are not subject to time
 slicing. This means the thread runs until they block, exit, voluntarily
 yield, or are preempted by a higher priority thread.
						</p><p class="simpara">
							The lowest priority realtime thread is scheduled before any thread with a normal policy. For more information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/tuning-scheduling-policy_monitoring-and-managing-system-status-and-performance#static-priority-scheduling-with-SCHED_FIFO_tuning-scheduling-policy">Static priority scheduling with SCHED_FIFO</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/tuning-scheduling-policy_monitoring-and-managing-system-status-and-performance#round-robin-priority-scheduling-with-sched_rr_tuning-scheduling-policy">Round robin priority scheduling with SCHED_RR</a>.
						</p></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">sched(7)</code>, <code class="literal">sched_setaffinity(2)</code>, <code class="literal">sched_getaffinity(2)</code>, <code class="literal">sched_setscheduler(2)</code>, and <code class="literal">sched_getscheduler(2)</code> man pages
					</li></ul></div></section><section class="section" id="static-priority-scheduling-with-SCHED_FIFO_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.2. Static priority scheduling with SCHED_FIFO</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">SCHED_FIFO</code>, also called static 
priority scheduling, is a realtime policy that defines a fixed priority 
for each thread. This policy allows administrators to improve event 
response time and reduce latency. It is recommended to not execute this 
policy for an extended period of time for time sensitive tasks.
			</p><p>
				When <code class="literal">SCHED_FIFO</code> is in use, the scheduler scans the list of all the <code class="literal">SCHED_FIFO</code> threads in order of priority and schedules the highest priority thread that is ready to run. The priority level of a <code class="literal">SCHED_FIFO</code> thread can be any integer from <code class="literal">1</code> to <code class="literal">99</code>, where <code class="literal">99</code>
 is treated as the highest priority. Red&nbsp;Hat recommends starting 
with a lower number and increasing priority only when you identify 
latency issues.
			</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Because realtime threads are not subject to time slicing, 
Red&nbsp;Hat does not recommend setting a priority as 99. This keeps 
your process at the same priority level as migration and watchdog 
threads; if your thread goes into a computational loop and these threads
 are blocked, they will not be able to run. Systems with a single 
processor will eventually hang in this situation.
				</p></div></div><p>
				Administrators can limit <code class="literal">SCHED_FIFO</code> bandwidth to prevent realtime application programmers from initiating realtime tasks that monopolize the processor.
			</p><p>
				The following are some of the parameters used in this policy:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">/proc/sys/kernel/sched_rt_period_us</code></span></dt><dd>
							This parameter defines the time period, in microseconds, that is 
considered to be one hundred percent of the processor bandwidth. The 
default value is <code class="literal">1000000 μs</code>, or <code class="literal">1 second</code>.
						</dd><dt><span class="term"><code class="literal">/proc/sys/kernel/sched_rt_runtime_us</code></span></dt><dd>
							This parameter defines the time period, in microseconds, that is 
devoted to running real-time threads. The default value is <code class="literal">950000 μs</code>, or <code class="literal">0.95 seconds</code>.
						</dd></dl></div></section><section class="section" id="round-robin-priority-scheduling-with-sched_rr_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.3. Round robin priority scheduling with SCHED_RR</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">SCHED_RR</code> is a round-robin variant of the <code class="literal">SCHED_FIFO</code>. This policy is useful when multiple threads need to run at the same priority level.
			</p><p>
				Like <code class="literal">SCHED_FIFO</code>, <code class="literal">SCHED_RR</code>
 is a realtime policy that defines a fixed priority for each thread. The
 scheduler scans the list of all SCHED_RR threads in order of priority 
and schedules the highest priority thread that is ready to run. However,
 unlike <code class="literal">SCHED_FIFO</code>, threads that have the same priority are scheduled in a round-robin style within a certain time slice.
			</p><p>
				You can set the value of this time slice in milliseconds with the <code class="literal">sched_rr_timeslice_ms</code> kernel parameter in the <code class="literal">/proc/sys/kernel/sched_rr_timeslice_ms</code> file. The lowest value is <code class="literal">1 millisecond</code>.
			</p></section><section class="section" id="normal-scheduling-with-sched_other_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.4. Normal scheduling with SCHED_OTHER</h2></div></div></div><p class="_abstract _abstract">
				The <code class="literal">SCHED_OTHER</code> is the default 
scheduling policy in Red&nbsp;Hat Enterprise&nbsp;Linux&nbsp;9. This 
policy uses the Completely Fair Scheduler (CFS) to allow fair processor 
access to all threads scheduled with this policy. This policy is most 
useful when there are a large number of threads or when data throughput 
is a priority, as it allows more efficient scheduling of threads over 
time.
			</p><p>
				When this policy is in use, the scheduler creates a dynamic priority
 list based partly on the niceness value of each process thread. 
Administrators can change the niceness value of a process, but cannot 
change the scheduler’s dynamic priority list directly.
			</p></section><section class="section" id="setting-scheduler-policies_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.5. Setting scheduler policies</h2></div></div></div><p class="_abstract _abstract">
				Check and adjust scheduler policies and priorities by using the <code class="literal">chrt</code>
 command line tool. It can start new processes with the desired 
properties, or change the properties of a running process. It can also 
be used for setting the policy at runtime.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						View the process ID (PID) of the active processes:
					</p><pre class="screen"># ps</pre><p class="simpara">
						Use the <code class="literal">--pid</code> or <code class="literal">-p</code> option with the <code class="literal">ps</code> command to view the details of the particular PID.
					</p></li><li class="listitem"><p class="simpara">
						Check the scheduling policy, PID, and priority of a particular process:
					</p><pre class="screen"># chrt -p <span class="emphasis"><em>468</em></span>
pid <span class="emphasis"><em>468</em></span>'s current scheduling policy: <span class="emphasis"><em>SCHED_FIFO</em></span>
pid <span class="emphasis"><em>468</em></span>'s current scheduling priority: <span class="emphasis"><em>85</em></span>

# chrt -p <span class="emphasis"><em>476</em></span>
pid <span class="emphasis"><em>476</em></span>'s current scheduling policy: <span class="emphasis"><em>SCHED_OTHER</em></span>
pid <span class="emphasis"><em>476</em></span>'s current scheduling priority: <span class="emphasis"><em>0</em></span></pre><p class="simpara">
						Here, <span class="emphasis"><em>468</em></span> and <span class="emphasis"><em>476</em></span> are PID of a process.
					</p></li><li class="listitem"><p class="simpara">
						Set the scheduling policy of a process:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								For example, to set the process with PID <span class="emphasis"><em>1000</em></span> to <span class="emphasis"><em>SCHED_FIFO</em></span>, with a priority of <span class="emphasis"><em>50</em></span>:
							</p><pre class="screen"># chrt -f -p <span class="emphasis"><em>50 1000</em></span></pre></li><li class="listitem"><p class="simpara">
								For example, to set the process with PID <span class="emphasis"><em>1000</em></span> to <span class="emphasis"><em>SCHED_OTHER</em></span>, with a priority of <span class="emphasis"><em>0</em></span>:
							</p><pre class="screen"># chrt -o -p <span class="emphasis"><em>0 1000</em></span></pre></li><li class="listitem"><p class="simpara">
								For example, to set the process with PID <span class="emphasis"><em>1000</em></span> to <span class="emphasis"><em>SCHED_RR</em></span>, with a priority of <span class="emphasis"><em>10</em></span>:
							</p><pre class="screen"># chrt -r -p <span class="emphasis"><em>10 1000</em></span></pre></li><li class="listitem"><p class="simpara">
								To start a new application with a particular policy and priority, specify the name of the application:
							</p><pre class="screen"># chrt -f <span class="emphasis"><em>36 /bin/my-app</em></span></pre></li></ol></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">chrt(1)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/tuning-scheduling-policy_monitoring-and-managing-system-status-and-performance#policy-options-for-the-chrt-command_tuning-scheduling-policy">Policy Options for the chrt command</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/tuning-scheduling-policy_monitoring-and-managing-system-status-and-performance#changing-the-priority-of-service-during-the-boot-process_tuning-scheduling-policy">Changing the priority of services during the boot process</a>
					</li></ul></div></section><section class="section" id="policy-options-for-the-chrt-command_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.6. Policy options for the chrt command</h2></div></div></div><p class="_abstract _abstract">
				Using the <code class="literal">chrt</code> command, you can view and set the scheduling policy of a process.
			</p><p>
				The following table describes the appropriate policy options, which can be used to set the scheduling policy of a process.
			</p><div class="table" id="idm140611463528448"><p class="title">Table 30.1. Policy Options for the chrt Command</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="a82nbw0" id="rh-table--a82nbw0"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--><col style="width: 33%; " class="col_2"><!--Empty--><col style="width: 33%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611463522672" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Short option</th><th id="idm140611463521584" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Long option</th><th id="idm140611463520496" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">Description</th></tr></thead><tbody><tr><td headers="idm140611463522672" data-row="2" data-col="1" class="content--sm" valign="top" align="left"> <p>
								<code class="literal">-f</code>
							</p>
							 </td><td headers="idm140611463521584" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">--fifo</code>
							</p>
							 </td><td headers="idm140611463520496" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
								Set schedule to <code class="literal">SCHED_FIFO</code>
							</p>
							 </td></tr><tr><td headers="idm140611463522672" data-row="3" data-col="1" class="content--sm" valign="top" align="left"> <p>
								<code class="literal">-o</code>
							</p>
							 </td><td headers="idm140611463521584" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">--other</code>
							</p>
							 </td><td headers="idm140611463520496" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
								Set schedule to <code class="literal">SCHED_OTHER</code>
							</p>
							 </td></tr><tr><td headers="idm140611463522672" data-row="4" data-col="1" class="content--sm" valign="top" align="left"> <p>
								<code class="literal">-r</code>
							</p>
							 </td><td headers="idm140611463521584" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								<code class="literal">--rr</code>
							</p>
							 </td><td headers="idm140611463520496" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
								Set schedule to <code class="literal">SCHED_RR</code>
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="changing-the-priority-of-service-during-the-boot-process_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.7. Changing the priority of services during the boot process</h2></div></div></div><p class="_abstract _abstract">
				Using the <code class="literal">systemd</code> service, it is possible to set up real-time priorities for services launched during the boot process. The <span class="emphasis"><em>unit configuration directives</em></span> are used to change the priority of a service during the boot process.
			</p><p>
				The boot process priority change is done by using the following directives in the service section:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">CPUSchedulingPolicy=</code></span></dt><dd>
							Sets the CPU scheduling policy for executed processes. It is used to set <code class="literal">other</code>, <code class="literal">fifo</code>, and <code class="literal">rr</code> policies.
						</dd><dt><span class="term"><code class="literal">CPUSchedulingPriority=</code></span></dt><dd>
							Sets the CPU scheduling priority for executed processes. The 
available priority range depends on the selected CPU scheduling policy. 
For real-time scheduling policies, an integer between <code class="literal">1</code> (lowest priority) and <code class="literal">99</code> (highest priority) can be used.
						</dd></dl></div><p>
				The following procedure describes how to change the priority of a service, during the boot process, using the <code class="literal">mcelog</code> service.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the TuneD package:
					</p><pre class="screen"># dnf install tuned</pre></li><li class="listitem"><p class="simpara">
						Enable and start the TuneD service:
					</p><pre class="screen"># systemctl enable --now tuned</pre></li></ol></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						View the scheduling priorities of running threads:
					</p><pre class="literallayout white-space-pre"># tuna --show_threads
                      thread       ctxt_switches
    pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd
  1      OTHER     0     0xff      3181          292         systemd
  2      OTHER     0     0xff       254            0        kthreadd
  3      OTHER     0     0xff         2            0          rcu_gp
  4      OTHER     0     0xff         2            0      rcu_par_gp
  6      OTHER     0        0         9            0 kworker/0:0H-kblockd
  7      OTHER     0     0xff      1301            1 kworker/u16:0-events_unbound
  8      OTHER     0     0xff         2            0    mm_percpu_wq
  9      OTHER     0        0       266            0     ksoftirqd/0
[...]</pre></li><li class="listitem"><p class="simpara">
						Create a supplementary <code class="literal">mcelog</code> service configuration directory file and insert the policy name and priority in this file:
					</p><pre class="screen"># cat &lt;&lt; EOF &gt; /etc/systemd/system/mcelog.system.d/priority.conf

[SERVICE]
CPUSchedulingPolicy=<span class="emphasis"><em>fifo</em></span>
CPUSchedulingPriority=<span class="emphasis"><em>20</em></span>
EOF</pre></li><li class="listitem"><p class="simpara">
						Reload the <code class="literal">systemd</code> scripts configuration:
					</p><pre class="screen"># systemctl daemon-reload</pre></li><li class="listitem"><p class="simpara">
						Restart the <code class="literal">mcelog</code> service:
					</p><pre class="screen"># systemctl restart mcelog</pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the <code class="literal">mcelog</code> priority set by <code class="literal">systemd</code> issue:
					</p><pre class="literallayout white-space-pre"># tuna -t mcelog -P
thread       ctxt_switches
  pid SCHED_ rtpri affinity voluntary nonvoluntary             cmd
826     FIFO    20  0,1,2,3        13            0          mcelog</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">systemd(1)</code> and <code class="literal">tuna(8)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/tuning-scheduling-policy_monitoring-and-managing-system-status-and-performance#priority-map_tuning-scheduling-policy">Description of the priority range</a>
					</li></ul></div></section><section class="section" id="priority-map_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.8. Priority map</h2></div></div></div><p class="_abstract _abstract">
				Priorities are defined in groups, with some groups dedicated to 
certain kernel functions. For real-time scheduling policies, an integer 
between <code class="literal">1</code> (lowest priority) and <code class="literal">99</code> (highest priority) can be used.
			</p><p>
				The following table describes the priority range, which can be used while setting the scheduling policy of a process.
			</p><div class="table" id="idm140611466387584"><p class="title">Table 30.2. Description of the priority range</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="30fsgq7" id="rh-table--30fsgq7" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--><col style="width: 33%; " class="col_2"><!--Empty--><col style="width: 33%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611466381808" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Priority</th><th id="idm140611466380720" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Threads</th><th id="idm140611467435568" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">Description</th></tr></thead><tbody><tr><td headers="idm140611466381808" data-row="2" data-col="1" class="content--sm" valign="top" align="left"> <p>
								1
							</p>
							 </td><td headers="idm140611466380720" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								Low priority kernel threads
							</p>
							 </td><td headers="idm140611467435568" data-row="2" data-col="3" class="content--lg" valign="top" align="left"> <p>
								This priority is usually reserved for the tasks that need to be just above <code class="literal">SCHED_OTHER</code>.
							</p>
							 </td></tr><tr><td headers="idm140611466381808" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								2 - 49
							</p>
							 </td><td headers="idm140611466380720" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								Available for use
							</p>
							 </td><td headers="idm140611467435568" data-row="3" data-col="3" class="content--lg" valign="top" align="left"> <p>
								The range used for typical application priorities.
							</p>
							 </td></tr><tr><td headers="idm140611466381808" data-row="4" data-col="1" class="content--sm" valign="top" align="left"> <p>
								50
							</p>
							 </td><td headers="idm140611466380720" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								Default hard-IRQ value
							</p>
							 </td><td headers="idm140611467435568" data-row="4" data-col="3" class="content--sm" valign="top" align="left">&nbsp;</td></tr><tr><td headers="idm140611466381808" data-row="5" data-col="1" class="content--md" valign="top" align="left"> <p>
								51 - 98
							</p>
							 </td><td headers="idm140611466380720" data-row="5" data-col="2" class="content--md" valign="top" align="left"> <p>
								High priority threads
							</p>
							 </td><td headers="idm140611467435568" data-row="5" data-col="3" class="content--lg" valign="top" align="left"> <p>
								Use this range for threads that execute periodically and must 
have quick response times. Do not use this range for CPU-bound threads 
as you will starve interrupts.
							</p>
							 </td></tr><tr><td headers="idm140611466381808" data-row="6" data-col="1" class="content--sm" valign="top" align="left"> <p>
								99
							</p>
							 </td><td headers="idm140611466380720" data-row="6" data-col="2" class="content--md" valign="top" align="left"> <p>
								Watchdogs and migration
							</p>
							 </td><td headers="idm140611467435568" data-row="6" data-col="3" class="content--lg" valign="top" align="left"> <p>
								System threads that must run at the highest priority.
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="tuned-cpu-partitioning-profile_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.9. TuneD cpu-partitioning profile</h2></div></div></div><p class="_abstract _abstract">
				For tuning Red&nbsp;Hat Enterprise&nbsp;Linux 9 for latency-sensitive workloads, Red&nbsp;Hat recommends to use the <code class="literal">cpu-partitioning</code> TuneD profile.
			</p><p>
				Prior to Red&nbsp;Hat Enterprise&nbsp;Linux 9, the low-latency 
Red&nbsp;Hat documentation described the numerous low-level steps needed
 to achieve low-latency tuning. In Red&nbsp;Hat Enterprise&nbsp;Linux 9,
 you can perform low-latency tuning more efficiently by using the <code class="literal">cpu-partitioning</code> TuneD profile. This profile is easily customizable according to the requirements for individual low-latency applications.
			</p><p>
				The following figure is an example to demonstrate how to use the <code class="literal">cpu-partitioning</code> profile. This example uses the CPU and node layout.
			</p><div class="figure" id="cpu-partitioning_tuning-scheduling-policy"><p class="title">Figure 30.1. Figure cpu-partitioning</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/367206bd2d1527d49965f718f51722e3/cpu-partitioning.png" class="rh_docs--zoom" title="cpu partitioning"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/cpu-partitioning.png" alt="cpu partitioning"></a></div></div></div><p>
				You can configure the cpu-partitioning profile in the <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file using the following configuration options:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Isolated CPUs with load balancing</span></dt><dd><p class="simpara">
							In the cpu-partitioning figure, the blocks numbered from 4 to 23,
 are the default isolated CPUs. The kernel scheduler’s process load 
balancing is enabled on these CPUs. It is designed for low-latency 
processes with multiple threads that need the kernel scheduler load 
balancing.
						</p><p class="simpara">
							You can configure the cpu-partitioning profile in the <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file using the <code class="literal">isolated_cores=cpu-list</code> option, which lists CPUs to isolate that will use the kernel scheduler load balancing.
						</p><p class="simpara">
							The list of isolated CPUs is comma-separated or you can specify a range using a dash, such as <code class="literal">3-5</code>. This option is mandatory. Any CPU missing from this list is automatically considered a housekeeping CPU.
						</p></dd><dt><span class="term">Isolated CPUs without load balancing</span></dt><dd><p class="simpara">
							In the cpu-partitioning figure, the blocks numbered 2 and 3, are 
the isolated CPUs that do not provide any additional kernel scheduler 
process load balancing.
						</p><p class="simpara">
							You can configure the cpu-partitioning profile in the <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file using the <code class="literal">no_balance_cores=cpu-list</code> option, which lists CPUs to isolate that will not use the kernel scheduler load balancing.
						</p><p class="simpara">
							Specifying the <code class="literal">no_balance_cores</code> option is optional, however any CPUs in this list must be a subset of the CPUs listed in the <code class="literal">isolated_cores</code> list.
						</p><p class="simpara">
							Application threads using these CPUs need to be pinned individually to each CPU.
						</p></dd><dt><span class="term">Housekeeping CPUs</span></dt><dd>
							Any CPU not isolated in the <code class="literal">cpu-partitioning-variables.conf</code>
 file is automatically considered a housekeeping CPU. On the 
housekeeping CPUs, all services, daemons, user processes, movable kernel
 threads, interrupt handlers, and kernel timers are permitted to 
execute.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-profiles-cpu-partitioning(7)</code> man page
					</li></ul></div></section><section class="section" id="using-the-tuned-cpu-partitioning-profile-for-low-latency-tuning_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.10. Using the TuneD cpu-partitioning profile for low-latency tuning</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to tune a system for low-latency using the TuneD’s <code class="literal">cpu-partitioning</code> profile. It uses the example of a low-latency application that can use <code class="literal">cpu-partitioning</code> and the CPU layout as mentioned in the <a class="link" href="#cpu-partitioning_tuning-scheduling-policy" title="Figure&nbsp;30.1.&nbsp;Figure cpu-partitioning">cpu-partitioning</a> figure.
			</p><p>
				The application in this case uses:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						One dedicated reader thread that reads data from the network will be pinned to CPU 2.
					</li><li class="listitem">
						A large number of threads that process this network data will be pinned to CPUs 4-23.
					</li><li class="listitem">
						A dedicated writer thread that writes the processed data to the network will be pinned to CPU 3.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed the <code class="literal">cpu-partitioning</code> TuneD profile by using the <code class="literal">dnf install tuned-profiles-cpu-partitioning</code> command as root.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Edit <code class="literal">/etc/tuned/cpu-partitioning-variables.conf</code> file and add the following information:
					</p><pre class="screen"># Isolated CPUs with the kernel’s scheduler load balancing:
isolated_cores=2-23
# Isolated CPUs without the kernel’s scheduler load balancing:
no_balance_cores=2,3</pre></li><li class="listitem"><p class="simpara">
						Set the <code class="literal">cpu-partitioning</code> TuneD profile:
					</p><pre class="screen"># tuned-adm profile cpu-partitioning</pre></li><li class="listitem"><p class="simpara">
						Reboot
					</p><p class="simpara">
						After rebooting, the system is tuned for low-latency, according to
 the isolation in the cpu-partitioning figure. The application can use 
taskset to pin the reader and writer threads to CPUs 2 and 3, and the 
remaining application threads on CPUs 4-23.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-profiles-cpu-partitioning(7)</code> man page
					</li></ul></div></section><section class="section" id="customizing-the-cpu-partitioning-tuned-profile_tuning-scheduling-policy"><div class="titlepage"><div><div><h2 class="title">30.11. Customizing the cpu-partitioning TuneD profile</h2></div></div></div><p class="_abstract _abstract">
				You can extend the TuneD profile to make additional tuning changes.
			</p><p>
				For example, the <code class="literal">cpu-partitioning</code> profile sets the CPUs to use <code class="literal">cstate=1</code>. In order to use the <code class="literal">cpu-partitioning</code>
 profile but to additionally change the CPU cstate from cstate1 to 
cstate0, the following procedure describes a new TuneD profile named <span class="emphasis"><em>my_profile</em></span>, which inherits the <code class="literal">cpu-partitioning</code> profile and then sets C state-0.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the <code class="literal">/etc/tuned/my_profile</code> directory:
					</p><pre class="screen"># mkdir /etc/tuned/<span class="emphasis"><em>my_profile</em></span></pre></li><li class="listitem"><p class="simpara">
						Create a <code class="literal">tuned.conf</code> file in this directory, and add the following content:
					</p><pre class="screen"># vi /etc/tuned/<span class="emphasis"><em>my_profile</em></span>/tuned.conf
[main]
summary=Customized tuning on top of cpu-partitioning
include=cpu-partitioning
[cpu]
force_latency=cstate.id:0|1</pre></li><li class="listitem"><p class="simpara">
						Use the new profile:
					</p><pre class="screen"># tuned-adm profile <span class="emphasis"><em>my_profile</em></span></pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					In the shared example, a reboot is not required. However, if the changes in the <span class="emphasis"><em>my_profile</em></span> profile require a reboot to take effect, then reboot your machine.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">tuned-profiles-cpu-partitioning(7)</code> man page
					</li></ul></div></section></section><section class="chapter" id="tuning-the-network-performance_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 31. Tuning the network performance</h1></div></div></div><p>
			Tuning the network settings is a complex process with many factors to
 consider. For example, this includes the CPU-to-memory architecture, 
the amount of CPU cores, and more. Red&nbsp;Hat Enterprise&nbsp;Linux 
uses default settings that are optimized for most scenarios. However, in
 certain cases, it can be necessary to tune network settings to increase
 the throughput or latency or to solve problems, such as packet drops.
		</p><section class="section" id="tuning-network-adapter-settings_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.1. Tuning network adapter settings</h2></div></div></div><p>
				In high-speed networks with 40 Gbps and faster, certain default 
values of network adapter-related kernel settings can be a cause of 
packet drops and performance degradation. Tuning these settings can 
prevent such problems.
			</p><section class="section" id="increasing-the-ring-buffers-to-reduce-a-high-packet-drop-rate_tuning-network-adapter-settings"><div class="titlepage"><div><div><h3 class="title">31.1.1. Increasing the ring buffers to reduce a high packet drop rate</h3></div></div></div><p class="_abstract _abstract">
					Receive ring buffers are shared between the device driver and 
network interface controller (NIC). The card assigns a transmit (TX) and
 receive (RX) ring buffer. As the name implies, the ring buffer is a 
circular buffer where an overflow overwrites existing data. There are 
two ways to move data from the NIC to the kernel, hardware interrupts 
and software interrupts, also called SoftIRQs.
				</p><p>
					The kernel uses the RX ring buffer to store incoming packets until 
they can be processed by the device driver. The device driver drains the
 RX ring, typically using SoftIRQs, which puts the incoming packets into
 a kernel data structure called an <code class="literal">sk_buff</code> or <code class="literal">skb</code> to begin its journey through the kernel and up to the application which owns the relevant socket.
				</p><p>
					The kernel uses the TX ring buffer to hold outgoing packets which 
are destined for the wire. These ring buffers reside at the bottom of 
the stack and are a crucial point at which packet drop can occur, which 
in turn will adversely affect network performance.
				</p><p>
					Increase the size of an Ethernet device’s ring buffers if the 
packet drop rate causes applications to report a loss of data, timeouts,
 or other issues.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the packet drop statistics of the interface:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -S <span class="emphasis"><em>enp1s0</em></span></strong></span>
    ...
    rx_queue_0_drops: <span class="emphasis"><em>97326</em></span>
    rx_queue_1_drops: <span class="emphasis"><em>63783</em></span>
    ...</pre><p class="simpara">
							Note that the output of the command depends on the network card and the driver.
						</p><p class="simpara">
							High values in <code class="literal">discard</code> or <code class="literal">drop</code>
 counters indicate that the available buffer fills up faster than the 
kernel can process the packets. Increasing the ring buffers can help to 
avoid such loss.
						</p></li><li class="listitem"><p class="simpara">
							Display the maximum ring buffer sizes:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -g <span class="emphasis"><em>enp1s0</em></span></strong></span>
 Ring parameters for <span class="emphasis"><em>enp1s0</em></span>:
 Pre-set maximums:
 RX:             <span class="emphasis"><em>4096</em></span>
 RX Mini:        <span class="emphasis"><em>0</em></span>
 RX Jumbo:       <span class="emphasis"><em>16320</em></span>
 TX:             <span class="emphasis"><em>4096</em></span>
 Current hardware settings:
 RX:             <span class="emphasis"><em>255</em></span>
 RX Mini:        <span class="emphasis"><em>0</em></span>
 RX Jumbo:       <span class="emphasis"><em>0</em></span>
 TX:             <span class="emphasis"><em>255</em></span></pre><p class="simpara">
							If the values in the <code class="literal">Pre-set maximums</code> section are higher than in the <code class="literal">Current hardware settings</code> section, you can change the settings in the next steps.
						</p></li><li class="listitem"><p class="simpara">
							Identify the NetworkManager connection profile that uses the interface:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection show</strong></span>
NAME                UUID                                  TYPE      DEVICE
<span class="emphasis"><em>Example-Connection</em></span>  <span class="emphasis"><em>a5eb6490-cc20-3668-81f8-0314a27f3f75</em></span>  ethernet  <span class="emphasis"><em>enp1s0</em></span></pre></li><li class="listitem"><p class="simpara">
							Update the connection profile, and increase the ring buffers:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									To increase the RX ring buffer, enter:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify <span class="emphasis"><em>Example-Connection</em></span> ethtool.ring-rx <span class="emphasis"><em>4096</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
									To increase the TX ring buffer, enter:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify <span class="emphasis"><em>Example-Connection</em></span> ethtool.ring-tx <span class="emphasis"><em>4096</em></span></strong></span></pre></li></ul></div></li><li class="listitem"><p class="simpara">
							Reload the NetworkManager connection:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection up <span class="emphasis"><em>Example-Connection</em></span></strong></span></pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								Depending on the driver your NIC uses, changing in the ring buffer can shortly interrupt the network connection.
							</p></div></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/2073223">ifconfig and ip commands report packet drops</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/742043">Should I be concerned about a 0.05% packet drop rate?</a>
						</li><li class="listitem">
							<code class="literal">ethtool(8)</code> man page
						</li></ul></div></section><section class="section" id="tuning-the-network-device-backlog-queue-to-avoid-packet-drops_tuning-network-adapter-settings"><div class="titlepage"><div><div><h3 class="title">31.1.2. Tuning the network device backlog queue to avoid packet drops</h3></div></div></div><p>
					When a network card receives packets and before the kernel protocol
 stack processes them, the kernel stores these packets in backlog 
queues. The kernel maintains a separate queue for each CPU core.
				</p><p>
					If the backlog queue for a core is full, the kernel drops all further incoming packets that the <code class="literal">netif_receive_skb()</code>
 kernel function assigns to this queue. If the server contains a 10 Gbps
 or faster network adapter or multiple 1 Gbps adapters, tune the backlog
 queue size to avoid this problem.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							A 10 Gbps or faster or multiple 1 Gbps network adapters
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Determine whether tuning the backlog queue is needed, display the counters in the <code class="literal">/proc/net/softnet_stat</code> file:
						</p><pre class="literallayout"># <span class="strong strong"><strong>awk '{for (i=1; i&lt;=NF; i++) printf strtonum("0x" $i) (i==NF?"\n":" ")}' /proc/net/softnet_stat | column -t</strong></span>
221951548  0      0  0  0  0  0  0  0  0  0  0  0
192058677  18862  0  0  0  0  0  0  0  0  0  0  1
455324886  0      0  0  0  0  0  0  0  0  0  0  2
...</pre><p class="simpara">
							This <code class="literal">awk</code> command converts the values in <code class="literal">/proc/net/softnet_stat</code> from hexadecimal to decimal format and displays them in table format. Each line represents a CPU core starting with core 0.
						</p><p class="simpara">
							The relevant columns are:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									First column: The total number of received frames
								</li><li class="listitem">
									Second column: The number of dropped frames because of a full backlog queue
								</li><li class="listitem">
									Last column: The CPU core number
								</li></ul></div></li><li class="listitem"><p class="simpara">
							If the values in the second column of the <code class="literal">/proc/net/softnet_stat</code> file increment over time, increase the size of the backlog queue:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Display the current backlog queue size:
								</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.core.netdev_max_backlog</strong></span>
net.core.netdev_max_backlog = <span class="emphasis"><em>1000</em></span></pre></li><li class="listitem"><p class="simpara">
									Create the <code class="literal">/etc/sysctl.d/10-netdev_max_backlog.conf</code> file with the following content:
								</p><pre class="literallayout"><span class="strong strong"><strong>net.core.netdev_max_backlog = <span class="emphasis"><em>2000</em></span></strong></span></pre><p class="simpara">
									Set the <code class="literal">net.core.netdev_max_backlog</code> parameter to a double of the current value.
								</p></li><li class="listitem"><p class="simpara">
									Load the settings from the <code class="literal">/etc/sysctl.d/10-netdev_max_backlog.conf</code> file:
								</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl -p /etc/sysctl.d/10-netdev_max_backlog.conf</strong></span></pre></li></ol></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Monitor the second column in the <code class="literal">/proc/net/softnet_stat</code> file:
						</p><pre class="literallayout"># <span class="strong strong"><strong>awk '{for (i=1; i&lt;=NF; i++) printf strtonum("0x" $i) (i==NF?"\n":" ")}' /proc/net/softnet_stat | column -t</strong></span></pre><p class="simpara">
							If the values still increase, double the <code class="literal">net.core.netdev_max_backlog</code> value again. Repeat this process until the packet drop counters no longer increase.
						</p></li></ul></div></section><section class="section" id="increasing-the-transmit-queue-length-of-a-nic-to-reduce-the-number-of-transmit-errors_tuning-network-adapter-settings"><div class="titlepage"><div><div><h3 class="title">31.1.3. Increasing the transmit queue length of a NIC to reduce the number of transmit errors</h3></div></div></div><p>
					The kernel stores packets in a transmit queue before transmitting 
them. The default length (1000 packets) is typically sufficient for 10 
Gbps and often also for 40 Gbps networks. However, in faster networks, 
or if you encounter an increasing number of transmit errors on an 
adapter, increase the queue length.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the current transmit queue length:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ip -s link show <span class="emphasis"><em>enp1s0</em></span></strong></span>
<span class="emphasis"><em>2</em></span>: <span class="emphasis"><em>enp1s0</em></span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="emphasis"><em>1500</em></span> qdisc <span class="emphasis"><em>fq_codel</em></span> state <span class="emphasis"><em>UP</em></span> mode <span class="emphasis"><em>DEFAULT</em></span> group <span class="emphasis"><em>default</em></span> qlen <span class="emphasis"><em>1000</em></span>
...</pre><p class="simpara">
							In this example, the transmit queue length (<code class="literal">qlen</code>) of the <code class="literal">enp1s0</code> interface is <code class="literal">1000</code>.
						</p></li><li class="listitem"><p class="simpara">
							Monitor the dropped packets counter of a network interface’s software transmit queue:
						</p><pre class="literallayout"># <span class="strong strong"><strong>tc -s qdisc show dev <span class="emphasis"><em>enp1s0</em></span></strong></span>
qdisc <span class="emphasis"><em>fq_codel</em></span> <span class="emphasis"><em>0</em></span>: <span class="emphasis"><em>root</em></span> refcnt <span class="emphasis"><em>2</em></span> limit <span class="emphasis"><em>10240p</em></span> flows <span class="emphasis"><em>1024</em></span> quantum <span class="emphasis"><em>1514</em></span> target <span class="emphasis"><em>5ms</em></span> interval <span class="emphasis"><em>100ms</em></span> memory_limit <span class="emphasis"><em>32Mb</em></span> ecn drop_batch <span class="emphasis"><em>64</em></span>
 Sent <span class="emphasis"><em>16889923</em></span> bytes <span class="emphasis"><em>426862765</em></span> pkt (dropped <span class="emphasis"><em>191980</em></span>, overlimits <span class="emphasis"><em>0</em></span> requeues <span class="emphasis"><em>2</em></span>)
 ...</pre></li><li class="listitem"><p class="simpara">
							If you encounter a high or increasing transmit error count, set a higher transmit queue length:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Identify the NetworkManager connection profile that uses this interface:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection show</strong></span>
NAME                UUID                                  TYPE      DEVICE
<span class="emphasis"><em>Example-Connection</em></span>  <span class="emphasis"><em>a5eb6490-cc20-3668-81f8-0314a27f3f75</em></span>  <span class="emphasis"><em>ethernet</em></span>  <span class="emphasis"><em>enp1s0</em></span></pre></li><li class="listitem"><p class="simpara">
									Create the <code class="literal">/etc/NetworkManager/dispatcher.d/99-set-tx-queue-length-up</code> NetworkManager dispatcher script with the following content:
								</p><pre class="programlisting language-bash">#!/bin/bash
# Set TX queue length on enp1s0 to 2000

if [ "$1" == "enp1s0" ] &amp;&amp; [ "$2" == "up" ] ; then
    ip link set dev enp1s0 txqueuelen 2000
fi</pre></li><li class="listitem"><p class="simpara">
									Set the executable bit on the <code class="literal">/etc/NetworkManager/dispatcher.d/99-set-tx-queue-length-up</code> file:
								</p><pre class="literallayout"># <span class="strong strong"><strong>chmod +x /etc/NetworkManager/dispatcher.d/99-set-tx-queue-length-up</strong></span></pre></li><li class="listitem"><p class="simpara">
									Reload the NetworkManager connection:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection up <span class="emphasis"><em>Example-Connection</em></span></strong></span></pre></li></ol></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the transmit queue length:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ip -s link show <span class="emphasis"><em>enp1s0</em></span></strong></span>
<span class="emphasis"><em>2</em></span>: <span class="emphasis"><em>enp1s0</em></span>: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="emphasis"><em>1500</em></span> qdisc <span class="emphasis"><em>fq_codel</em></span> state <span class="emphasis"><em>UP</em></span> mode <span class="emphasis"><em>DEFAULT</em></span> group <span class="emphasis"><em>default</em></span> qlen <span class="emphasis"><em>2000</em></span>
...</pre></li><li class="listitem"><p class="simpara">
							Monitor the dropped packets counter:
						</p><pre class="literallayout"># <span class="strong strong"><strong>tc -s qdisc show dev <span class="emphasis"><em>enp1s0</em></span></strong></span></pre><p class="simpara">
							If the <code class="literal">dropped</code> counter still increases, double the transmit queue length again. Repeat this process until the counter no longer increases.
						</p></li></ol></div></section></section><section class="section" id="tuning-irq-balancing_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.2. Tuning IRQ balancing</h2></div></div></div><p>
				On multi-core hosts, you can increase the performance by ensuring 
that Red&nbsp;Hat Enterprise&nbsp;Linux balances interrupt queues (IRQs)
 to distribute the interrupts across CPU cores.
			</p><section class="section" id="interrupts-and-interrupt-handlers_tuning-irq-balancing"><div class="titlepage"><div><div><h3 class="title">31.2.1. Interrupts and interrupt handlers</h3></div></div></div><p>
					When a network interface controller (NIC) receives incoming data, 
it copies the data into kernel buffers by using Direct Memory Access 
(DMA). The NIC then notifies the kernel about this data by triggering a 
hard interrupt. These interrupts are processed by interrupt handlers 
which do minimal work, as they have already interrupted another task and
 the handlers cannot interrupt themselves. Hard interrupts can be costly
 in terms of CPU usage, especially if they use kernel locks.
				</p><p>
					The hard interrupt handler then leaves the majority of packet 
reception to a software interrupt request (SoftIRQ) process. The kernel 
can schedule these processes more fairly.
				</p><div class="example" id="idm140611467929424"><p class="title">Example 31.1. Displaying hardware interrupts</p><div class="example-contents"><p>
						The kernel stores the interrupt counters in the <code class="literal">/proc/interrupts</code> file. To display the counters for a specific NIC, such as <code class="literal">enp1s0</code>, enter:
					</p><pre class="literallayout"># <span class="strong strong"><strong>egrep "CPU|<span class="emphasis"><em>enp1s0</em></span>" /proc/interrupts</strong></span>
         CPU0     CPU1     CPU2    CPU3    CPU4   CPU5
 <span class="emphasis"><em>105</em></span>:  <span class="emphasis"><em>141606</em></span>        <span class="emphasis"><em>0</em></span>        <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>      <span class="emphasis"><em>0</em></span>  <span class="emphasis"><em>IR-PCI-MSI-edge</em></span>      <span class="emphasis"><em>enp1s0-rx-0</em></span>
 <span class="emphasis"><em>106</em></span>:       <span class="emphasis"><em>0</em></span>   <span class="emphasis"><em>141091</em></span>        <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>      <span class="emphasis"><em>0</em></span>  <span class="emphasis"><em>IR-PCI-MSI-edge</em></span>      <span class="emphasis"><em>enp1s0-rx-1</em></span>
 <span class="emphasis"><em>107</em></span>:       <span class="emphasis"><em>2</em></span>        <span class="emphasis"><em>0</em></span>   <span class="emphasis"><em>163785</em></span>       <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>      <span class="emphasis"><em>0</em></span>  <span class="emphasis"><em>IR-PCI-MSI-edge</em></span>      <span class="emphasis"><em>enp1s0-rx-2</em></span>
 <span class="emphasis"><em>108</em></span>:       <span class="emphasis"><em>3</em></span>        <span class="emphasis"><em>0</em></span>        <span class="emphasis"><em>0</em></span>  <span class="emphasis"><em>194370</em></span>       <span class="emphasis"><em>0</em></span>      <span class="emphasis"><em>0</em></span>  <span class="emphasis"><em>IR-PCI-MSI-edge</em></span>      <span class="emphasis"><em>enp1s0-rx-3</em></span>
 <span class="emphasis"><em>109</em></span>:       <span class="emphasis"><em>0</em></span>        <span class="emphasis"><em>0</em></span>        <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>      <span class="emphasis"><em>0</em></span>  <span class="emphasis"><em>IR-PCI-MSI-edge</em></span>      <span class="emphasis"><em>enp1s0-tx</em></span></pre><p>
						Each queue has an interrupt vector in the first column assigned to
 it. The kernel initializes these vectors when the system boots or when a
 user loads the NIC driver module. Each receive (<code class="literal">RX</code>) and transmit (<code class="literal">TX</code>)
 queue is assigned a unique vector that informs the interrupt handler 
which NIC or queue the interrupt is coming from. The columns represent 
the number of incoming interrupts for every CPU core.
					</p></div></div></section><section class="section" id="software-interrupt-requests_tuning-irq-balancing"><div class="titlepage"><div><div><h3 class="title">31.2.2. Software interrupt requests</h3></div></div></div><p>
					Software interrupt requests (SoftIRQs) clear the receive ring 
buffers of network adapters. The kernel schedules SoftIRQ routines to 
run at a time when other tasks will not be interrupted. On Red&nbsp;Hat 
Enterprise&nbsp;Linux, processes named <code class="literal">ksoftirqd/<span class="emphasis"><em>cpu-number</em></span></code> run these routines and call driver-specific code functions.
				</p><p>
					To monitor the SoftIRQ counters for each CPU core, enter:
				</p><pre class="literallayout"># <span class="strong strong"><strong>watch -n1 'egrep "CPU|NET_RX|NET_TX" /proc/softirqs'</strong></span>
                    CPU0       CPU1	  CPU2       CPU3	CPU4	   CPU5       CPU6	 CPU7
      NET_TX:	   49672      52610	 28175      97288      12633	  19843      18746     220689
      NET_RX:         96       1615        789         46         31	   1735       1315     470798</pre><p>
					The command dynamically updates the output. Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> to interrupt the output.
				</p></section><section class="section" id="napi-polling_tuning-irq-balancing"><div class="titlepage"><div><div><h3 class="title">31.2.3. NAPI Polling</h3></div></div></div><p>
					New API (NAPI) is an extension to the device driver packet 
processing framework to improve the efficiency of incoming network 
packets. Hard interrupts are expensive because they usually cause a 
context switch from the kernel space to the user space and back again, 
and cannot interrupt themselves. Even with interrupt coalescence, the 
interrupt handler monopolizes a CPU core completely. With NAPI, the 
driver can use a polling mode instead of being hard-interrupted by the 
kernel for every packet that is received.
				</p><p>
					Under normal operation, the kernel issues an initial hard 
interrupt, followed by a soft interrupt request (SoftIRQ) handler that 
polls the network card using NAPI routines. To prevent SoftIRQs from 
monopolizing a CPU core, the polling routine has a budget that 
determines the CPU time the SoftIRQ can consume. On completion of the 
SoftIRQ poll routine, the kernel exits the routine and schedules it to 
run again at a later time to repeat the process of receiving packets 
from the network card.
				</p></section><section class="section" id="the-irqbalance-service_tuning-irq-balancing"><div class="titlepage"><div><div><h3 class="title">31.2.4. The irqbalance service</h3></div></div></div><p>
					On systems both with and without Non-Uniform Memory Access (NUMA) architecture, the <code class="literal">irqbalance</code> service balances interrupts effectively across CPU cores, based on system conditions. The <code class="literal">irqbalance</code>
 service runs in the background and monitors the CPU load every 10 
seconds. The service moves interrupts to other CPU cores when a CPU’s 
load is too high. As a result, the system performs well and handles load
 more efficiently.
				</p><p>
					If <code class="literal">irqbalance</code> is not running, usually 
the CPU core 0 handles most of the interrupts. Even at moderate load, 
this CPU core can become busy trying to handle the workload of all the 
hardware in the system. As a consequence, interrupts or interrupt-based 
work can be missed or delayed. This can result in low network and 
storage performance, packet loss, and potentially other issues.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Disabling <code class="literal">irqbalance</code> can negatively impact the network throughput.
					</p></div></div><p>
					On systems with only a single CPU core, the <code class="literal">irqbalance</code> service provides no benefit and exits on its own.
				</p><p>
					By default, the <code class="literal">irqbalance</code> service is enabled and running on Red&nbsp;Hat Enterprise&nbsp;Linux. To re-enable the service if you disabled it, enter:
				</p><pre class="literallayout"># <span class="strong strong"><strong>systemctl enable --now irqbalance</strong></span></pre><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/41535">Do we need irqbalance?</a> solution
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/4367191">How should I configure network interface IRQ channels?</a> solution
						</li></ul></div></section><section class="section" id="increasing-the-time-softirqs-can-run-on-the-cpu_tuning-irq-balancing"><div class="titlepage"><div><div><h3 class="title">31.2.5. Increasing the time SoftIRQs can run on the CPU</h3></div></div></div><p>
					If SoftIRQs do not run long enough, the rate of incoming data could
 exceed the kernel’s capability to drain the buffer fast enough. As a 
result, the network interface controller (NIC) buffers overflow and 
packets are lost.
				</p><p>
					If <code class="literal">softirqd</code> processes could not 
retrieve all packets from interfaces in one NAPI polling cycle, it is an
 indicator that the SoftIRQs do not have enough CPU time. This could be 
the case on hosts with fast NICs, such as 10 Gbps and faster. If you 
increase the values of the <code class="literal">net.core.netdev_budget</code> and <code class="literal">net.core.netdev_budget_usecs</code> kernel parameters, you can control the time and number of packets <code class="literal">softirqd</code> can process in a polling cycle.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							To determine whether tuning the <code class="literal">net.core.netdev_budget</code> parameter is needed, display the counters in the <code class="literal">/proc/net/softnet_stat</code> file:
						</p><pre class="literallayout"># <span class="strong strong"><strong>awk '{for (i=1; i&lt;=NF; i++) printf strtonum("0x" $i) (i==NF?"\n":" ")}' /proc/net/softnet_stat | column -t</strong></span>
221951548  0  0      0  0  0  0  0  0  0  0  0  0
192058677  0  20380  0  0  0  0  0  0  0  0  0  1
455324886  0  0      0  0  0  0  0  0  0  0  0  2
...</pre><p class="simpara">
							This <code class="literal">awk</code> command converts the values in <code class="literal">/proc/net/softnet_stat</code> from hexadecimal to decimal format and displays them in the table format. Each line represents a CPU core starting with core 0.
						</p><p class="simpara">
							The relevant columns are:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									First column: The total number of received frames.
								</li><li class="listitem">
									Third column: The number times <code class="literal">softirqd</code> processes that could not retrieve all packets from interfaces in one NAPI polling cycle.
								</li><li class="listitem">
									Last column: The CPU core number.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							If the counters in the third column of the <code class="literal">/proc/net/softnet_stat</code> file increment over time, tune the system:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Display the current values of the <code class="literal">net.core.netdev_budget_usecs</code> and <code class="literal">net.core.netdev_budget</code> parameters:
								</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.core.netdev_budget_usecs net.core.netdev_budget</strong></span>
net.core.netdev_budget_usecs = 2000
net.core.netdev_budget = 300</pre><p class="simpara">
									With these settings, <code class="literal">softirqd</code> 
processes have up to 2000 microseconds to process up to 300 messages 
from the NIC in one polling cycle. Polling ends based on which condition
 is met first.
								</p></li><li class="listitem"><p class="simpara">
									Create the <code class="literal">/etc/sysctl.d/10-netdev_budget.conf</code> file with the following content:
								</p><pre class="literallayout"><span class="strong strong"><strong>net.core.netdev_budget = <span class="emphasis"><em>600</em></span></strong></span>
<span class="strong strong"><strong>net.core.netdev_budget_usecs = 4000</strong></span></pre><p class="simpara">
									Set the parameters to a double of their current values.
								</p></li><li class="listitem"><p class="simpara">
									Load the settings from the <code class="literal">/etc/sysctl.d/10-netdev_budget.conf</code> file:
								</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl -p /etc/sysctl.d/10-netdev_budget.conf</strong></span></pre></li></ol></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Monitor the third column in the <code class="literal">/proc/net/softnet_stat</code> file:
						</p><pre class="literallayout"># <span class="strong strong"><strong>awk '{for (i=1; i&lt;=NF; i++) printf strtonum("0x" $i) (i==NF?"\n":" ")}' /proc/net/softnet_stat | column -t</strong></span></pre><p class="simpara">
							If the values still increase, set <code class="literal">net.core.netdev_budget_usecs</code> and <code class="literal">net.core.netdev_budget</code> to higher values. Repeat this process until the counters no longer increase.
						</p></li></ul></div></section></section><section class="section" id="improving-the-network-latency_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.3. Improving the network latency</h2></div></div></div><p>
				CPU power management features can cause unwanted delays in 
time-sensitive application processing. You can disable some or all of 
these power management features to improve the network latency.
			</p><p>
				For example, if the latency is higher when the server is idle than 
under heavy load, CPU power management settings could influence the 
latency.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Disabling CPU power management features can cause a higher power consumption and heat loss.
				</p></div></div><section class="section" id="how-the-cpu-power-states-influence-the-network-latency_improving-the-network-latency"><div class="titlepage"><div><div><h3 class="title">31.3.1. How the CPU power states influence the network latency</h3></div></div></div><p>
					The consumption state (C-states) of CPUs optimize and reduce the 
power consumption of computers. The C-states are numbered, starting at 
C0. In C0, the processor is fully powered and executing. In C1, the 
processor is fully powered but not executing. The higher the number of 
the C-state, the more components the CPU turns off.
				</p><p>
					Whenever a CPU core is idle, the built-in power saving logic steps 
in and attempts to move the core from the current C-state to a higher 
one by turning off various processor components. If the CPU core must 
process data, Red&nbsp;Hat Enterprise&nbsp;Linux (RHEL) sends an 
interrupt to the processor to wake up the core and set its C-state back 
to C0.
				</p><p>
					Moving out of deep C-states back to C0 takes time due to turning 
power back on to various components of the processor. On multi-core 
systems, it can also happen that many of the cores are simultaneously 
idle and, therefore, in deeper C-states. If RHEL tries to wake them up 
at the same time, the kernel can generate a large number of 
Inter-Processor Interrupts (IPIs) while all cores return from deep 
C-states. Due to locking that is required while processing interrupts, 
the system can then stall for some time while handling all the 
interrupts. This can result in large delays in the application response 
to events.
				</p><div class="example" id="idm140611465100656"><p class="title">Example 31.2. Displaying times in C-state per core</p><div class="example-contents"><p>
						The <code class="literal">Idle Stats</code> page in the PowerTOP application displays how much time the CPU cores spend in each C-state:
					</p><pre class="literallayout">           Pkg(HW)  |            Core(HW) |            CPU(OS) 0   CPU(OS) 4
                    |                     | C0 active   2.5%        2.2%
                    |                     | POLL        0.0%    0.0 ms  0.0%    0.1 ms
                    |                     | C1          0.1%    0.2 ms  0.0%    0.1 ms
C2 (pc2)   63.7%    |                     |
C3 (pc3)    0.0%    | C3 (cc3)    0.1%    | C3          0.1%    0.1 ms  0.1%    0.1 ms
C6 (pc6)    0.0%    | C6 (cc6)    8.3%    | C6          5.2%    0.6 ms  6.0%    0.6 ms
C7 (pc7)    0.0%    | C7 (cc7)   76.6%    | C7s         0.0%    0.0 ms  0.0%    0.0 ms
C8 (pc8)    0.0%    |                     | C8          6.3%    0.9 ms  5.8%    0.8 ms
C9 (pc9)    0.0%    |                     | C9          0.4%    3.7 ms  2.2%    2.2 ms
C10 (pc10)  0.0%    |                     |
                    |                     | C10        80.8%    3.7 ms 79.4%    4.4 ms
                    |                     | C1E         0.1%    0.1 ms  0.1%    0.1 ms
...</pre></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/managing-power-consumption-with-powertop_monitoring-and-managing-system-status-and-performance">Managing power consumption with PowerTOP</a>
						</li></ul></div></section><section class="section" id="c-state-settings-in-the-efi-firmware_improving-the-network-latency"><div class="titlepage"><div><div><h3 class="title">31.3.2. C-state settings in the EFI firmware</h3></div></div></div><p>
					In most systems with an EFI firmware, you can enable and disable 
the individual consumption states (C-states). However, on Red&nbsp;Hat 
Enterprise&nbsp;Linux (RHEL), the idle driver determines whether the 
kernel uses the settings from the firmware:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">intel_idle</code>: This is the default driver on hosts with an Intel CPU and ignores the C-state settings from the EFI firmware.
						</li><li class="listitem">
							<code class="literal">acpi_idle</code>: RHEL uses this driver on hosts with CPUs from vendors other than Intel and if <code class="literal">intel_idle</code> is disabled. By default, the <code class="literal">acpi_idle</code> driver uses the C-state settings from the EFI firmware.
						</li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">/usr/share/doc/kernel-doc-<span class="emphasis"><em>&lt;version&gt;</em></span>/Documentation/admin-guide/pm/cpuidle.rst</code> provided by the <code class="literal">kernel-doc</code> package
						</li></ul></div></section><section class="section" id="disabling-c-states-by-using-a-custom-tuned-profile_improving-the-network-latency"><div class="titlepage"><div><div><h3 class="title">31.3.3. Disabling C-states by using a custom TuneD profile</h3></div></div></div><p>
					The TuneD service uses the Power Management Quality of Service (<code class="literal">PMQOS</code>)
 interface of the kernel to set consumption states (C-states) locking. 
The kernel idle driver can communicate with this interface to 
dynamically limit the C-states. This prevents that administrators must 
hard code a maximum C-state value by using kernel command line 
parameters.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">tuned</code> package is installed.
						</li><li class="listitem">
							The <code class="literal">tuned</code> service is enabled and running.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the active profile:
						</p><pre class="literallayout"># <span class="strong strong"><strong>tuned-adm active</strong></span>
Current active profile: <span class="emphasis"><em>network-latency</em></span></pre></li><li class="listitem"><p class="simpara">
							Create a directory for the custom TuneD profile:
						</p><pre class="literallayout"># <span class="strong strong"><strong>mkdir /etc/tuned/<span class="emphasis"><em>network-latency-custom</em></span>/</strong></span></pre></li><li class="listitem"><p class="simpara">
							Create the <code class="literal">/etc/tuned/<span class="emphasis"><em>network-latency-custom</em></span>/tuned.conf</code> file with the following content:
						</p><pre class="literallayout">[main]
include=<span class="emphasis"><em>network-latency</em></span>

[cpu]
force_latency=<span class="emphasis"><em>cstate.id:1|2</em></span></pre><p class="simpara">
							This custom profile inherits all settings from the <code class="literal">network-latency</code> profile. The <code class="literal">force_latency</code>
 TuneD parameter specifies the latency in microseconds (µs). If the 
C-state latency is higher than the specified value, the idle driver in 
Red&nbsp;Hat Enterprise&nbsp;Linux prevents the CPU from moving to a 
higher C-state. With <code class="literal">force_latency=cstate.id:1|2</code>, TuneD first checks if the <code class="literal">/sys/devices/system/cpu/cpu_&lt;number&gt;_/cpuidle/state_&lt;cstate.id&gt;_/</code> directory exists. In this case, TuneD reads the latency value from the <code class="literal">latency</code> file in this directory. If the directory does not exist, TuneD uses 2 microseconds as a fallback value.
						</p></li><li class="listitem"><p class="simpara">
							Activate the <code class="literal"><span class="emphasis"><em>network-latency-custom</em></span></code> profile:
						</p><pre class="literallayout"># <span class="strong strong"><strong>tuned-adm profile <span class="emphasis"><em>network-latency-custom</em></span></strong></span></pre></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="#getting-started-with-tuned_monitoring-and-managing-system-status-and-performance" title="Chapter&nbsp;1.&nbsp;Getting started with TuneD">Getting started with TuneD</a>
						</li><li class="listitem">
							<a class="link" href="#customizing-tuned-profiles_monitoring-and-managing-system-status-and-performance" title="Chapter&nbsp;2.&nbsp;Customizing TuneD profiles">Customizing TuneD profiles</a>
						</li></ul></div></section><section class="section" id="disabling-c-states-by-using-a-kernel-command-line-option_improving-the-network-latency"><div class="titlepage"><div><div><h3 class="title">31.3.4. Disabling C-states by using a kernel command line option</h3></div></div></div><p>
					The <code class="literal">processor.max_cstate</code> and <code class="literal">intel_idle.max_cstat</code>
 kernel command line parameters configure the maximum consumption states
 (C-state) CPU cores can use. For example, setting the parameters to <code class="literal">1</code> ensures that the CPU will never request a C-state below C1.
				</p><p>
					Use this method to test whether the latency of applications on a 
host are being affected by C-states. To not hard code a specific state, 
consider using a more dynamic solution. See <a class="link" href="#disabling-c-states-by-using-a-custom-tuned-profile_improving-the-network-latency" title="31.3.3.&nbsp;Disabling C-states by using a custom TuneD profile">Disabling C-states by using a custom TuneD profile</a>.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">tuned</code> service is not running or configured to not update C-state settings.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the idle driver the system uses:
						</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/devices/system/cpu/cpuidle/current_driver</strong></span>
<span class="emphasis"><em>intel_idle</em></span></pre></li><li class="listitem"><p class="simpara">
							If the host uses the <code class="literal">intel_idle</code> driver, set the <code class="literal">intel_idle.max_cstate</code> kernel parameter to define the highest C-state that CPU cores should be able to use:
						</p><pre class="literallayout"># <span class="strong strong"><strong>grubby --update-kernel=ALL --args="intel_idle.max_cstate=<span class="emphasis"><em>0</em></span>"</strong></span></pre><p class="simpara">
							Setting <code class="literal">intel_idle.max_cstate=0</code> disables the <code class="literal">intel_idle</code> driver. Consequently, the kernel uses the <code class="literal">acpi_idle</code> driver that uses the C-state values set in the EFI firmware. For this reason, also set <code class="literal">processor.max_cstate</code> to override these C-state settings.
						</p></li><li class="listitem"><p class="simpara">
							On every host, independent from the CPU vendor, set the highest C-state that CPU cores should be able to use:
						</p><pre class="literallayout"># <span class="strong strong"><strong>grubby --update-kernel=ALL --args="processor.max_cstate=<span class="emphasis"><em>0</em></span>"</strong></span></pre><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								If you set <code class="literal">processor.max_cstate=0</code> in addition to <code class="literal">intel_idle.max_cstate=0</code>, the <code class="literal">acpi_idle</code> driver overrides the value of <code class="literal">processor.max_cstate</code> and sets it to <code class="literal">1</code>. As a result, with <code class="literal">processor.max_cstate=0 intel_idle.max_cstate=0</code>, the highest C-state the kernel will use is C1, not C0.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Restart the host for the changes to take effect:
						</p><pre class="literallayout"># <span class="strong strong"><strong>reboot</strong></span></pre></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the maximum C-state:
						</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/module/processor/parameters/max_cstate</strong></span>
1</pre></li><li class="listitem"><p class="simpara">
							If the host uses the <code class="literal">intel_idle</code> driver, display the maximum C-state:
						</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/module/intel_idle/parameters/max_cstate</strong></span>
0</pre></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/202743">What are CPU "C-states" and how to disable them if needed?</a>
						</li><li class="listitem">
							<code class="literal">/usr/share/doc/kernel-doc-<span class="emphasis"><em>&lt;version&gt;</em></span>/Documentation/admin-guide/pm/cpuidle.rst</code> provided by the <code class="literal">kernel-doc</code> package
						</li></ul></div></section></section><section class="section" id="improving-the-throughput-of-large-amounts-of-contiguous-data-streams_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.4. Improving the throughput of large amounts of contiguous data streams</h2></div></div></div><p>
				According to the IEEE 802.3 standard, a default Ethernet frame 
without Virtual Local Area Network (VLAN) tag has a maximum size of 1518
 bytes. Each of these frames includes an 18 bytes header, leaving 1500 
bytes for payload. Consequently, for every 1500 bytes of data the server
 transmits over the network, 18 bytes (1.2%) Ethernet frame header are 
overhead and transmitted as well. Headers from layer 3 and 4 protocols 
increase the overhead per packet further.
			</p><p>
				Consider employing jumbo frames to save overhead if hosts on your 
network often send numerous contiguous data streams, such as backup 
servers or file servers hosting numerous huge files. Jumbo frames are 
non-standardized frames that have a larger Maximum Transmission Unit 
(MTU) than the standard Ethernet payload size of 1500 bytes. For 
example, if you configure jumbo frames with the maximum allowed MTU of 
9000 bytes payload, the overhead of each frame reduces to 0.2%.
			</p><p>
				Depending on the network and services, it can be beneficial to 
enable jumbo frames only in specific parts of a network, such as the 
storage backend of a cluster. This avoids packet fragmentation.
			</p><section class="section" id="considerations-before-configuring-jumbo-frames_improving-the-throughput-of-large-amounts-of-contiguous-data-streams"><div class="titlepage"><div><div><h3 class="title">31.4.1. Considerations before configuring jumbo frames</h3></div></div></div><p>
					Depending on your hardware, applications, and services in your 
network, jumbo frames can have different impacts. Decide carefully 
whether enabling jumbo frames provides a benefit in your scenario.
				</p><div class="formalpara"><p class="title"><strong>Prerequisites</strong></p><p>
						All network devices on the transmission path must support jumbo 
frames and use the same Maximum Transmission Unit (MTU) size. In the 
opposite case, you can face the following problems:
					</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Dropped packets.
						</li><li class="listitem">
							Higher latency due to fragmented packets.
						</li><li class="listitem">
							Increased risk of packet loss caused by fragmentation. For 
example, if a router fragments a single 9000-bytes frame into six 
1500-bytes frames, and any of those 1500-byte frames are lost, the whole
 frame is lost because it cannot be reassembled.
						</li></ul></div><p>
					In the following diagram, all hosts in the three subnets must use 
the same MTU if a host from network A sends a packet to a host in 
network C:
				</p><div class="informalfigure"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/bdb3f9c9c7fb0e8b2a8d1def0584ef0d/network-diagram-MTU.png" class="rh_docs--zoom" title="network diagram MTU"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/network-diagram-MTU.png" alt="network diagram MTU"></a></div></div><div class="itemizedlist"><p class="title"><strong>Benefits of jumbo frames</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							Higher throughput: Each frame contains more user data while the protocol overhead is fixed.
						</li><li class="listitem">
							Lower CPU utilization: Jumbo frames cause fewer interrupts and, therefore, save CPU cycles.
						</li></ul></div><div class="itemizedlist"><p class="title"><strong>Drawbacks of jumbo frames</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							Higher latency: Larger frames delay packets that follow.
						</li><li class="listitem">
							Increased memory buffer usage: Larger frames can fill buffer queue memory more quickly.
						</li></ul></div></section><section class="section" id="configuring-the-mtu-in-an-existing-networkmanager-connection-profile_improving-the-throughput-of-large-amounts-of-contiguous-data-streams"><div class="titlepage"><div><div><h3 class="title">31.4.2. Configuring the MTU in an existing NetworkManager connection profile</h3></div></div></div><p>
					If your network requires a different Maximum Transmission Unit 
(MTU) than the default, you can configure this setting in the 
corresponding NetworkManager connection profile.
				</p><p>
					Jumbo frames are network packets with a payload of between 1500 and
 9000 bytes. All devices in the same broadcast domain have to support 
those frames.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							All devices in the broadcast domain use the same MTU.
						</li><li class="listitem">
							You know the MTU of the network.
						</li><li class="listitem">
							You already configured a connection profile for the network with the divergent MTU.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Optional: Display the current MTU:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ip link show</strong></span>
...
3: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="strong strong"><strong>1500</strong></span> qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:74:79:56 brd ff:ff:ff:ff:ff:ff
...</pre></li><li class="listitem"><p class="simpara">
							Optional: Display the NetworkManager connection profiles:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection show</strong></span>
NAME     UUID                                  TYPE      DEVICE
<span class="emphasis"><em>Example</em></span>  <span class="emphasis"><em>f2f33f29-bb5c-3a07-9069-be72eaec3ecf</em></span>  ethernet  <span class="emphasis"><em>enp1s0</em></span>
...</pre></li><li class="listitem"><p class="simpara">
							Set the MTU in the profile that manages the connection to the network with the divergent MTU:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify <span class="emphasis"><em>Example</em></span> mtu <span class="emphasis"><em>9000</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
							Reactivate the connection:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection up <span class="emphasis"><em>Example</em></span></strong></span></pre></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the MTU setting:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ip link show</strong></span>
...
3: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="strong strong"><strong>9000</strong></span> qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 52:54:00:74:79:56 brd ff:ff:ff:ff:ff:ff
...</pre></li><li class="listitem"><p class="simpara">
							Verify that no host on the transmission paths fragments the packets:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									On the receiver side, display the IP reassembly statistics of the kernel:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nstat -az IpReasm</strong></span>*
#kernel
IpReasmTimeout 0 0.0
IpReasmReqds 0 0.0
IpReasmOKs 0 0.0
IpReasmFails 0 0.0</pre><p class="simpara">
									If the counters return <code class="literal">0</code>, packets were not reassembled.
								</p></li><li class="listitem"><p class="simpara">
									On the sender side, transmit an ICMP request with the prohibit-fragmentation-bit:
								</p><pre class="literallayout"># <span class="strong strong"><strong>ping -c1 -Mdo -s <span class="emphasis"><em>8972</em></span> <span class="emphasis"><em>destination_host</em></span></strong></span></pre><p class="simpara">
									If the command succeeds, the packet was not fragmented.
								</p><p class="simpara">
									Calculate the value for the <code class="literal">-s</code> packet size option as follows: MTU size - 8 bytes ICMP header - 20 bytes IPv4 header = packet size
								</p></li></ul></div></li></ol></div></section></section><section class="section" id="tuning-tcp-connections-for-high-throughput_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.5. Tuning TCP connections for high throughput</h2></div></div></div><p>
				Tune TCP-related settings on Red&nbsp;Hat Enterprise&nbsp;Linux to 
increase the throughput, reduce the latency, or prevent problems, such 
as packet loss.
			</p><section class="section" id="testing-the-tcp-throughput-using-iperf3_tuning-tcp-connections-for-high-throughput"><div class="titlepage"><div><div><h3 class="title">31.5.1. Testing the TCP throughput using iperf3</h3></div></div></div><p>
					The <code class="literal">iperf3</code> utility provides a server and client mode to perform network throughput tests between two hosts.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The throughput of applications depends on many factors, such as 
the buffer sizes that the application uses. Therefore, the results 
measured with testing utilities, such as <code class="literal">iperf3</code>, can be significantly different from those of applications on a server under production workload.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">iperf3</code> package is installed on both the client and server.
						</li><li class="listitem">
							No other services on either host cause network traffic that substantially affects the test result.
						</li><li class="listitem">
							For 40 Gbps and faster connections, the network card supports 
Accelerated Receive Flow Steering (ARFS) and the feature is enabled on 
the interface.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Optional: Display the maximum network speed of the network interface controller (NIC) on both the server and client:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool enp1s0 | grep "Speed"</strong></span>
   Speed: 100000Mb/s</pre></li><li class="listitem"><p class="simpara">
							On the server:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Temporarily open the default <code class="literal">iperf3</code> TCP port 5201 in the <code class="literal">firewalld</code> service:
								</p><pre class="literallayout"># <span class="strong strong"><strong>firewall-cmd --add-port=5201/tcp</strong></span>
# <span class="strong strong"><strong>firewall-cmd --reload</strong></span></pre></li><li class="listitem"><p class="simpara">
									Start <code class="literal">iperf3</code> in server mode:
								</p><pre class="literallayout"># <span class="strong strong"><strong>iperf3 --server</strong></span></pre><p class="simpara">
									The service now is waiting for incoming client connections.
								</p></li></ol></div></li><li class="listitem"><p class="simpara">
							On the client:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Start measuring the throughput:
								</p><pre class="literallayout"># <span class="strong strong"><strong>iperf3 --time <span class="emphasis"><em>60</em></span> --zerocopy --client <span class="emphasis"><em>192.0.2.1</em></span></strong></span></pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
											<code class="literal">--time <span class="emphasis"><em>&lt;seconds&gt;</em></span></code>: Defines the time in seconds when the client stops the transmission.
										</p><p class="simpara">
											Set this parameter to a value that you expect to work and 
increase it in later measurements. If the server sends packets at a 
faster rate than the devices on the transmit path or the client can 
process, packets can be dropped.
										</p></li><li class="listitem">
											<code class="literal">--zerocopy</code>: Enables a zero copy method instead of using the <code class="literal">write()</code>
 system call. You require this option only if you want to simulate a 
zero-copy-capable application or to reach 40 Gbps and more on a single 
stream.
										</li><li class="listitem">
											<code class="literal">--client &lt;server&gt;</code>: Enables the client mode and sets the IP address or name of the server that runs the <code class="literal">iperf3</code> server.
										</li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Wait until <code class="literal">iperf3</code> completes the 
test. Both the server and the client display statistics every second and
 a summary at the end. For example, the following is a summary displayed
 on a client:
						</p><pre class="literallayout">[ ID] Interval         Transfer    Bitrate         Retr
[  5] 0.00-60.00  sec  101 GBytes   14.4 Gbits/sec   0   sender
[  5] 0.00-60.04  sec  101 GBytes   14.4 Gbits/sec       receiver</pre><p class="simpara">
							In this example, the average bitrate was 14.4 Gbps.
						</p></li><li class="listitem"><p class="simpara">
							On the server:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> to stop the <code class="literal">iperf3</code> server.
								</li><li class="listitem"><p class="simpara">
									Close the TCP port 5201 in <code class="literal">firewalld</code>:
								</p><pre class="literallayout"># <span class="strong strong"><strong>firewall-cmd --remove-port=5201/tcp</strong></span>
# <span class="strong strong"><strong>firewall-cmd --reload</strong></span></pre></li></ol></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">iperf3(1)</code> man page
						</li></ul></div></section><section class="section" id="the-system-wide-tcp-socket-buffer-settings_tuning-tcp-connections-for-high-throughput"><div class="titlepage"><div><div><h3 class="title">31.5.2. The system-wide TCP socket buffer settings</h3></div></div></div><p>
					Socket buffers temporarily store data that the kernel has received or should send:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The read socket buffer holds packets that the kernel has received but which the application has not read yet.
						</li><li class="listitem">
							The write socket buffer holds packets that an application has 
written to the buffer but which the kernel has not passed to the IP 
stack and network driver yet.
						</li></ul></div><p>
					If a TCP packet is too large and exceeds the buffer size or packets
 are sent or received at a too fast rate, the kernel drops any new 
incoming TCP packet until the data is removed from the buffer. In this 
case, increasing the socket buffers can prevent packet loss.
				</p><p>
					Both the <code class="literal">net.ipv4.tcp_rmem</code> (read) and <code class="literal">net.ipv4.tcp_wmem</code> (write) socket buffer kernel settings contain three values:
				</p><pre class="literallayout">net.ipv4.tcp_rmem = 4096  131072  6291456
net.ipv4.tcp_wmem = 4096  16384   4194304</pre><p>
					The displayed values are in bytes and Red&nbsp;Hat Enterprise&nbsp;Linux uses them in the following way:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The first value is the minimum buffer size. New sockets cannot have a smaller size.
						</li><li class="listitem">
							The second value is the default buffer size. If an application sets no buffer size, this is the default value.
						</li><li class="listitem">
							The third value is the maximum size of automatically tuned buffers. Using the <code class="literal">setsockopt()</code> function with the <code class="literal">SO_SNDBUF</code> socket option in an application disables this maximum buffer size.
						</li></ul></div><p>
					Note that the <code class="literal">net.ipv4.tcp_rmem</code> and <code class="literal">net.ipv4.tcp_wmem</code> parameters set the socket sizes for both the IPv4 and IPv6 protocols.
				</p></section><section class="section" id="increasing-the-system-wide-tcp-socket-buffers_tuning-tcp-connections-for-high-throughput"><div class="titlepage"><div><div><h3 class="title">31.5.3. Increasing the system-wide TCP socket buffers</h3></div></div></div><p>
					The system-wide TCP socket buffers temporarily store data that the kernel has received or should send. Both <code class="literal">net.ipv4.tcp_rmem</code> (read) and <code class="literal">net.ipv4.tcp_wmem</code> (write) socket buffer kernel settings each contain three settings: A minimum, default, and maximum value.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Setting too large buffer sizes wastes memory. Each socket can be 
set to the size that the application requests, and the kernel doubles 
this value. For example, if an application requests a 256 KiB socket 
buffer size and opens 1 million sockets, the system can use up to 512 GB
 RAM (512 KiB x 1 million) only for the potential socket buffer space.
					</p><p>
						Additionally, a too large value for the maximum buffer size can increase the latency.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You encountered a significant rate of dropped TCP packets.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Determine the latency of the connection. For example, ping from 
the client to server to measure the average Round Trip Time (RTT):
						</p><pre class="literallayout"># <span class="strong strong"><strong>ping -c <span class="emphasis"><em>10</em></span> <span class="emphasis"><em>server.example.com</em></span></strong></span>
...
--- <span class="emphasis"><em>server.example.com</em></span> ping statistics ---
<span class="emphasis"><em>10</em></span> packets transmitted, <span class="emphasis"><em>10</em></span> received, <span class="emphasis"><em>0%</em></span> packet loss, time <span class="emphasis"><em>9014ms</em></span>
rtt min/avg/max/mdev = <span class="emphasis"><em>117.208</em></span>/<span class="strong strong"><strong><span class="emphasis"><em>117.056</em></span></strong></span>/<span class="emphasis"><em>119.333</em></span>/<span class="emphasis"><em>0.616</em></span> ms</pre><p class="simpara">
							In this example, the latency is 117 ms.
						</p></li><li class="listitem"><p class="simpara">
							Use the following formula to calculate the Bandwidth Delay Product (BDP) for the traffic you want to tune:
						</p><pre class="literallayout">connection speed in bytes * latency in ms = BDP in bytes</pre><p class="simpara">
							For example, to calculate the BDP for a 10 Gbps connection that has a 117 ms latency:
						</p><pre class="literallayout">(10 * 1000 * 1000 * 1000 / 8) * 117 = 10683760 bytes</pre></li><li class="listitem"><p class="simpara">
							Create the <code class="literal">/etc/sysctl.d/10-tcp-socket-buffers.conf</code> file and either set the maximum read or write buffer size, or both, based on your requirements:
						</p><pre class="literallayout"><span class="strong strong"><strong>net.ipv4.tcp_rmem = <span class="emphasis"><em>4096</em></span> <span class="emphasis"><em>262144</em></span> <span class="emphasis"><em>21367520</em></span></strong></span>
<span class="strong strong"><strong>net.ipv4.tcp_wmem = <span class="emphasis"><em>4096</em></span> <span class="emphasis"><em>24576</em></span> <span class="emphasis"><em>21367520</em></span></strong></span></pre><p class="simpara">
							Specify the values in bytes. Use the following rule of thumb when
 you try to identify optimized values for your environment:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Default buffer size (second value): Increase this value only slightly or set it to <code class="literal">524288</code> (512 KiB) at most. A too high default buffer size can cause buffer collapsing and, consequently, latency spikes.
								</li><li class="listitem">
									Maximum buffer size (third value): A value double to triple of the BDP is often sufficient.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Load the settings from the <code class="literal">/etc/sysctl.d/10-tcp-socket-buffers.conf</code> file:
						</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl -p /etc/sysctl.d/<span class="emphasis"><em>10-tcp-socket-buffers.conf</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
							Configure your applications to use a larger socket buffer size. The third value in the <code class="literal">net.ipv4.tcp_rmem</code> and <code class="literal">net.ipv4.tcp_wmem</code> parameters defines the maximum buffer size that the <code class="literal">setsockopt()</code> function in an application can request.
						</p><p class="simpara">
							For further details, see the documentation of the programming 
language of your application. If you are not the developer of the 
application, contact the developer.
						</p></li><li class="listitem"><p class="simpara">
							If you have changed the second value in the <code class="literal">net.ipv4.tcp_rmem</code> or <code class="literal">net.ipv4.tcp_wmem</code> parameter, restart the applications to use the new TCP buffer sizes.
						</p><p class="simpara">
							If you have changed only the third value, you do not need to 
restart the application because auto-tuning applies these settings 
dynamically.
						</p></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Optional: <a class="link" href="#testing-the-tcp-throughput-using-iperf3_tuning-tcp-connections-for-high-throughput" title="31.5.1.&nbsp;Testing the TCP throughput using iperf3">Test the TCP throughput using iperf3</a>.
						</li><li class="listitem"><p class="simpara">
							Monitor the packet drop statistics using the same method that you used when you encountered the packet drops.
						</p><p class="simpara">
							If packet drops still occur but at a lower rate, increase the buffer sizes further.
						</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/85913">What are the implications of changing socket buffer sizes?</a> solution
						</li><li class="listitem">
							<code class="literal">tcp(7)</code> man page
						</li><li class="listitem">
							<code class="literal">socket(7)</code> man page
						</li></ul></div></section><section class="section" id="tcp-window-scaling_tuning-tcp-connections-for-high-throughput"><div class="titlepage"><div><div><h3 class="title">31.5.4. TCP Window Scaling</h3></div></div></div><p>
					The TCP Window Scaling feature, which is enabled by default in 
Red&nbsp;Hat Enterprise&nbsp;Linux, is an extension of the TCP protocol 
that significantly improves the throughput.
				</p><p>
					For example, on a 1 Gbps connection with 1.5 ms Round Trip Time (RTT):
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							With TCP Window Scaling enabled, approximately 630 Mbps are realistic.
						</li><li class="listitem">
							With TCP Window Scaling disabled, the throughput goes down to 380 Mbps.
						</li></ul></div><p>
					One of the features TCP provides is flow control. With flow 
control, a sender can send as much data as the receiver can receive, but
 no more. To achieve this, the receiver advertises a <code class="literal">window</code> value, which is the amount of data a sender can send.
				</p><p>
					TCP originally supported window sizes up to 64 KiB, but at high 
Bandwidth Delay Products (BDP), this value becomes a restriction because
 the sender cannot send more than 64 KiB at a time. High-speed 
connections can transfer much more than 64 KiB of data at a given time. 
For example, a 10 Gbps link with 1 ms of latency between systems can 
have more than 1 MiB of data in transit at a given time. It would be 
inefficient if a host sends only 64 KiB, then pauses until the other 
host receives that 64 KiB.
				</p><p>
					To remove this bottleneck, the TCP Window Scaling extension allows 
the TCP window value to be arithmetically shifted left to increase the 
window size beyond 64 KiB. For example, the largest window value of <code class="literal">65535</code>
 shifted 7 places to the left, resulting in a window size of almost 8 
MiB. This enables transferring much more data at a given time.
				</p><p>
					TCP Window Scaling is negotiated during the three-way TCP handshake
 that opens every TCP connection. Both sender and receiver must support 
TCP Window Scaling for the feature to work. If either or both 
participants do not advertise window scaling ability in their handshake,
 the connection reverts to using the original 16-bit TCP window size.
				</p><p>
					By default, TCP Window Scaling is enabled in Red&nbsp;Hat Enterprise&nbsp;Linux:
				</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.ipv4.tcp_window_scaling</strong></span>
net.ipv4.tcp_window_scaling = 1</pre><p>
					If TCP Window Scaling is disabled (<code class="literal">0</code>) on your server, revert the setting in the same way as you set it.
				</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://www.rfc-editor.org/rfc/rfc1323">RFC 1323: TCP Extensions for High Performance</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_monitoring_and_updating_the_kernel/configuring-kernel-parameters-at-runtime_managing-monitoring-and-updating-the-kernel">Configuring kernel parameters at runtime</a>
						</li></ul></div></section><section class="section" id="how-tcp-sack-reduces-the-packet-drop-rate_tuning-tcp-connections-for-high-throughput"><div class="titlepage"><div><div><h3 class="title">31.5.5. How TCP SACK reduces the packet drop rate</h3></div></div></div><p>
					The TCP Selective Acknowledgment (TCP SACK) feature, which is 
enabled by default in Red&nbsp;Hat Enterprise&nbsp;Linux (RHEL), is an 
enhancement of the TCP protocol and increases the efficiency of TCP 
connections.
				</p><p>
					In TCP transmissions, the receiver sends an ACK packet to the 
sender for every packet it receives. For example, a client sends the TCP
 packets 1-10 to the server but the packets number 5 and 6 get lost. 
Without TCP SACK, the server drops packets 7-10, and the client must 
retransmit all packets from the point of loss, which is inefficient. 
With TCP SACK enabled on both hosts, the client must re-transmit only 
the lost packets 5 and 6.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Disabling TCP SACK decreases the performance and causes a higher 
packet drop rate on the receiver side in a TCP connection.
					</p></div></div><p>
					By default, TCP SACK is enabled in RHEL. To verify:
				</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.ipv4.tcp_sack</strong></span>
1</pre><p>
					If TCP SACK is disabled (<code class="literal">0</code>) on your server, revert the setting in the same way as you set it.
				</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="http://tools.ietf.org/html/rfc2018">RFC 2018: TCP Selective Acknowledgment Options</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/742043">Should I be concerned about a 0.05% packet drop rate?</a> solution
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_monitoring_and_updating_the_kernel/configuring-kernel-parameters-at-runtime_managing-monitoring-and-updating-the-kernel">Configuring kernel parameters at runtime</a>
						</li></ul></div></section></section><section class="section" id="tuning-udp-connections_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.6. Tuning UDP connections</h2></div></div></div><p>
				Before you start tuning Red&nbsp;Hat Enterprise&nbsp;Linux to 
improve the throughput of UDP traffic, it is important to have the 
realistic expectations. UDP is a simple protocol. Compared to TCP, UDP 
does not contain features, such as flow control, congestion control, and
 data reliability. This makes it difficult to reach reliable 
communication over UDP with a throughput rate that is close to the 
maximum speed of the network interface controller (NIC).
			</p><section class="section" id="detecting-packet-drops_tuning-udp-connections"><div class="titlepage"><div><div><h3 class="title">31.6.1. Detecting packet drops</h3></div></div></div><p>
					There are multiple levels in the network stack in which the kernel 
can drop packets. Red&nbsp;Hat Enterprise&nbsp;Linux provides different 
utilities to display statistics of these levels. Use them to identify 
potential problems.
				</p><p>
					Note that you can ignore a very small rate of dropped packets. 
However, if you encounter a significant rate, consider tuning measures.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The kernel drops network packets if the networking stack cannot handle the incoming traffic.
					</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Identify if the network interface controller (NIC) drops packets:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Display the NIC and driver-specific statistics:
								</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -S <span class="emphasis"><em>enp1s0</em></span></strong></span>
NIC statistics:
     ...
     rx_queue<span class="emphasis"><em>_0</em></span>_drops: 17657
     ...</pre><p class="simpara">
									The naming of the statistics and if they are available depend on the NIC and the driver.
								</p></li><li class="listitem"><p class="simpara">
									Display the interface statistics:
								</p><pre class="literallayout"># <span class="strong strong"><strong>ip -s link show <span class="emphasis"><em>enp1s0</em></span></strong></span>
<span class="emphasis"><em>2: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000</em></span>
    <span class="emphasis"><em>link/ether 52:54:00:74:79:56 brd ff:ff:ff:ff:ff:ff</em></span>
    RX:   bytes  packets errors dropped  missed   mcast_
    <span class="emphasis"><em>84697611107</em></span> <span class="emphasis"><em>56866482</em></span>      <span class="emphasis"><em>0</em></span>   <span class="emphasis"><em>10904</em></span>       <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>
    TX:   bytes  packets errors dropped carrier collsns_
     <span class="emphasis"><em>5540028184</em></span>  <span class="emphasis"><em>3722234</em></span>      <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span>       <span class="emphasis"><em>0</em></span></pre><p class="simpara">
									<code class="literal">RX</code> represents the statistics of received packets and <code class="literal">TX</code> of transmitted packets.
								</p></li></ol></div></li><li class="listitem"><p class="simpara">
							Identify UDP protocol-specific packet drops due to too small socket buffers or slow application processing:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nstat -az UdpSndbufErrors UdpRcvbufErrors</strong></span>
#kernel
UdpSndbufErrors           4    0.0
UdpRcvbufErrors    45716659    0.0</pre><p class="simpara">
							The second column in the output lists the counters.
						</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/21301">RHEL network interface dropping packets</a> solution
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/742043">Should I be concerned about a 0.05% packet drop rate?</a> solution
						</li></ul></div></section><section class="section" id="testing-the-udp-throughput-using-iperf3_tuning-udp-connections"><div class="titlepage"><div><div><h3 class="title">31.6.2. Testing the UDP throughput using iperf3</h3></div></div></div><p>
					The <code class="literal">iperf3</code> utility provides a server and client mode to perform network throughput tests between two hosts.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						The throughput of applications depend on many factors, such as the
 buffer sizes that the application uses. Therefore, the results measured
 with testing utilities, such as <code class="literal">iperf3</code>, can significantly be different from those of applications on a server under production workload.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The <code class="literal">iperf3</code> package is installed on both the client and server.
						</li><li class="listitem">
							No other services on both hosts cause network traffic that substantially affects the test result.
						</li><li class="listitem">
							Optional: You increased the maximum UDP socket sizes on both the server and the client. For details, see <a class="link" href="#increasing-the-system-wide-udp-socket-buffers_tuning-udp-connections" title="31.6.5.&nbsp;Increasing the system-wide UDP socket buffers">Increasing the system-wide UDP socket buffers</a>.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Optional: Display the maximum network speed of the network interface controller (NIC) on both the server and client:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool enp1s0 | grep "Speed"</strong></span>
   Speed: 10000Mb/s</pre></li><li class="listitem"><p class="simpara">
							On the server:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Display the maximum UDP socket read buffer size, and note the value:
								</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.core.rmem_max</strong></span>
net.core.rmem_max = <span class="emphasis"><em>16777216</em></span></pre><p class="simpara">
									The displayed value is in bytes.
								</p></li><li class="listitem"><p class="simpara">
									Temporarily open the default <code class="literal">iperf3</code> port 5201 in the <code class="literal">firewalld</code> service:
								</p><pre class="literallayout"># <span class="strong strong"><strong>firewall-cmd --add-port=5201/tcp --add-port=5201/udp</strong></span>
# <span class="strong strong"><strong>firewall-cmd --reload</strong></span></pre><p class="simpara">
									Note that, <code class="literal">iperf3</code> opens only a TCP
 socket on the server. If a clients wants to use UDP, it first connects 
to this TCP port, and then the server opens a UDP socket on the same 
port number for performing the UDP traffic throughput test. For this 
reason, you must open port 5201 for both the TCP and UDP protocol in the
 local firewall.
								</p></li><li class="listitem"><p class="simpara">
									Start <code class="literal">iperf3</code> in server mode:
								</p><pre class="literallayout"># <span class="strong strong"><strong>iperf3 --server</strong></span></pre><p class="simpara">
									The service now waits for incoming client connections.
								</p></li></ol></div></li><li class="listitem"><p class="simpara">
							On the client:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
									Display the Maximum Transmission Unit (MTU) of the interface 
that the client will use for the connection to the server, and note the 
value:
								</p><pre class="literallayout"># <span class="strong strong"><strong>ip link show enp1s0</strong></span>
<span class="emphasis"><em>2: enp1s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span class="strong strong"><strong>1500</strong></span> qdisc fq_codel state UP mode DEFAULT group default qlen 1000</em></span>
...</pre></li><li class="listitem"><p class="simpara">
									Display the maximum UDP socket write buffer size, and note the value:
								</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.core.wmem_max</strong></span>
net.core.wmem_max = <span class="emphasis"><em>16777216</em></span></pre><p class="simpara">
									The displayed value is in bytes.
								</p></li><li class="listitem"><p class="simpara">
									Start measuring the throughput:
								</p><pre class="literallayout"># <span class="strong strong"><strong>iperf3 --udp --time <span class="emphasis"><em>60</em></span> --window <span class="emphasis"><em>16777216</em></span> --length <span class="emphasis"><em>1472</em></span> --bitrate 2G --client <span class="emphasis"><em>192.0.2.1</em></span></strong></span></pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
											<code class="literal">--udp</code>: Use the UDP protocol for the test.
										</li><li class="listitem">
											<code class="literal">--time <span class="emphasis"><em>&lt;seconds&gt;</em></span></code>: Defines the time in seconds when the client stops the transmission.
										</li><li class="listitem">
											<code class="literal">--window <span class="emphasis"><em>&lt;size&gt;</em></span></code>:
 Sets the UDP socket buffer size. Ideally, the sizes are the same on 
both the client and server. In case that they are different, set this 
parameter to the value that is smaller: <code class="literal">net.core.wmem_max</code> on the client or <code class="literal">net.core.rmem_max</code> on the server.
										</li><li class="listitem">
											<code class="literal">--length <span class="emphasis"><em>&lt;size&gt;</em></span></code>:
 Sets the length of the buffer to read and write. Set this option to the
 largest unfragmented payload. Calculate the ideal value as follows: MTU
 - IP header (20 bytes for IPv4 and 40 bytes for IPv6) - 8 bytes UDP 
header.
										</li><li class="listitem"><p class="simpara">
											<code class="literal">--bitrate <span class="emphasis"><em>&lt;rate&gt;</em></span></code>: Limits the bit rate to the specified value in bits per second. You can specify units, such as <code class="literal">2G</code> for 2 Gbps.
										</p><p class="simpara">
											Set this parameter to a value that you expect to work and 
increase it in later measurements. If the server sends packets at a 
faster rate than the devices on the transmit path or the client can 
process them, packets can be dropped.
										</p></li><li class="listitem">
											<code class="literal">--client &lt;server&gt;</code>: Enables the client mode and sets the IP address or name of the server that runs the <code class="literal">iperf3</code> server.
										</li></ul></div></li></ol></div></li><li class="listitem"><p class="simpara">
							Wait until <code class="literal">iperf3</code> completes the 
test. Both the server and the client display statistics every second and
 a summary at the end. For example, the following is a summary displayed
 on a client:
						</p><pre class="literallayout">[ ID] Interval       Transfer      Bitrate         Jitter    Lost/Total Datagrams
[ 5] 0.00-60.00 sec  14.0 GBytes   2.00 Gbits/sec  0.000 ms  0/10190216 (0%) sender
[ 5] 0.00-60.04 sec  14.0 GBytes   2.00 Gbits/sec  0.002 ms  0/10190216 (0%) receiver</pre><p class="simpara">
							In this example, the average bit rate was 2 Gbps, and no packets were lost.
						</p></li><li class="listitem"><p class="simpara">
							On the server:
						</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem">
									Press <span class="keycap"><strong>Ctrl</strong></span>+<span class="keycap"><strong>C</strong></span> to stop the <code class="literal">iperf3</code> server.
								</li><li class="listitem"><p class="simpara">
									Close port 5201 in <code class="literal">firewalld</code>:
								</p><pre class="literallayout"># <span class="strong strong"><strong>firewall-cmd --remove-port=5201/tcp --remove-port=5201/udp</strong></span>
# <span class="strong strong"><strong>firewall-cmd --reload</strong></span></pre></li></ol></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">iperf3(1)</code> man page
						</li></ul></div></section><section class="section" id="impact-of-the-mtu-size-on-udp-traffic-throughput_tuning-udp-connections"><div class="titlepage"><div><div><h3 class="title">31.6.3. Impact of the MTU size on UDP traffic throughput</h3></div></div></div><p>
					If your application uses a large UDP message size, using jumbo 
frames can improve the throughput. According to the IEEE 802.3 standard,
 a default Ethernet frame without Virtual Local Area Network (VLAN) tag 
has a maximum size of 1518 bytes. Each of these frames includes an 18 
bytes header, leaving 1500 bytes for payload. Consequently, for every 
1500 bytes of data the server transmits over the network, 18 bytes 
(1.2%) are overhead.
				</p><p>
					Jumbo frames are non-standardized frames that have a larger Maximum
 Transmission Unit (MTU) than the standard Ethernet payload size of 1500
 bytes. For example, if you configure jumbo Frames with the maximum 
allowed MTU of 9000 bytes payload, the overhead of each frame reduces to
 0.2%.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						All network devices on the transmission path and the involved 
broadcast domains must support jumbo frames and use the same MTU. Packet
 fragmentation and reassembly due to inconsistent MTU settings on the 
transmission path reduces the network throughput.
					</p></div></div><p>
					Different connection types have certain MTU limitations:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Ethernet: the MTU is limited to 9000 bytes.
						</li><li class="listitem">
							IP over InfiniBand (IPoIB) in datagram mode: The MTU is limited to 4 bytes less than the InfiniBand MTU.
						</li><li class="listitem">
							In-memory networking commonly supports larger MTUs. For details, see the respective documentation.
						</li></ul></div></section><section class="section" id="impact-of-the-cpu-speed-on-udp-traffic-throughput_tuning-udp-connections"><div class="titlepage"><div><div><h3 class="title">31.6.4. Impact of the CPU speed on UDP traffic throughput</h3></div></div></div><p>
					In bulk transfers, the UDP&nbsp;protocol is much less efficient 
than TCP, mainly due to the missing packet aggregation in UDP. By 
default, the Generic Receive Offload (GRO) and Transmit Segmentation 
Offload (TSO) features are not enabled. Consequently, the CPU frequency 
can limit the UDP throughput for bulk transfer on high speed links.
				</p><p>
					For example, on a tuned host with a high Maximum Transmission Unit 
(MTU) and large socket buffers, a 3 GHz CPU can process the traffic of a
 10 GBit NIC that sends or receives UDP traffic at full speed. However, 
you can expect about 1-2 Gbps speed loss for every 100 MHz CPU speed 
under 3 GHz when you transmit UDP traffic. Also, if a CPU speed of 3 GHz
 can closely achieve 10 Gbps, the same CPU restricts UDP traffic on a 40
 GBit NIC to roughly 20-25 Gbps.
				</p></section><section class="section" id="increasing-the-system-wide-udp-socket-buffers_tuning-udp-connections"><div class="titlepage"><div><div><h3 class="title">31.6.5. Increasing the system-wide UDP socket buffers</h3></div></div></div><p>
					Socket buffers temporarily store data that the kernel has received or should send:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The read socket buffer holds packets that the kernel has received but which the application has not read yet.
						</li><li class="listitem">
							The write socket buffer holds packets that an application has 
written to the buffer but which the kernel has not passed to the IP 
stack and network driver yet.
						</li></ul></div><p>
					If a UDP packet is too large and exceeds the buffer size or packets
 are sent or received at a too fast rate, the kernel drops any new 
incoming UDP packet until the data is removed from the buffer. In this 
case, increasing the socket buffers can prevent packet loss.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						Setting too large buffer sizes wastes memory. Each socket can be 
set to the size that the application requests, and the kernel doubles 
this value. For example, if an application requests a 256 KiB socket 
buffer size and opens 1 million sockets, the system requires 512 GB RAM 
(512 KiB x 1 million) only for the potential socket buffer space.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You encountered a significant rate of dropped UDP packets.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Create the <code class="literal">/etc/sysctl.d/10-udp-socket-buffers.conf</code> file and either set the maximum read or write buffer size, or both, based on your requirements:
						</p><pre class="literallayout"><span class="strong strong"><strong>net.core.rmem_max = <span class="emphasis"><em>16777216</em></span></strong></span>
<span class="strong strong"><strong>net.core.wmem_max = <span class="emphasis"><em>16777216</em></span></strong></span></pre><p class="simpara">
							Specify the values in bytes. The values in this example set the 
maximum size of buffers to 16 MiB. The default values of both parameters
 are <code class="literal">212992</code> bytes (208 KiB).
						</p></li><li class="listitem"><p class="simpara">
							Load the settings from the <code class="literal">/etc/sysctl.d/10-udp-socket-buffers.conf</code> file:
						</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl -p /etc/sysctl.d/<span class="emphasis"><em>10-udp-socket-buffers.conf</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
							Configure your applications to use the larger socket buffer sizes.
						</p><p class="simpara">
							The <code class="literal">net.core.rmem_max</code> and <code class="literal">net.core.wmem_max</code> parameters define the maximum buffer size that the <code class="literal">setsockopt()</code> function in an application can request. Note that, if you configure your application to not use the <code class="literal">setsockopt()</code> function, the kernel uses the values from the <code class="literal">rmem_default</code> and <code class="literal">wmem_default</code> parameters.
						</p><p class="simpara">
							For further details, see the documentation of the programming 
language of your application. If you are not the developer of the 
application, contact the developer.
						</p></li><li class="listitem">
							Restart the applications to use the new UDP buffer sizes.
						</li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Monitor the packet drop statistics using the same method as you used when you encountered the packet drops.
						</p><p class="simpara">
							If packet drops still occur but at a lower rate, increase the buffer sizes further.
						</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/85913">What are the implications of changing socket buffer sizes?</a> solution
						</li><li class="listitem">
							<code class="literal">udp(7)</code> man page
						</li><li class="listitem">
							<code class="literal">socket(7)</code> man page
						</li></ul></div></section></section><section class="section" id="identifying-application-read-socket-buffer-bottlenecks_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.7. Identifying application read socket buffer bottlenecks</h2></div></div></div><p>
				If TCP applications do not clear the read socket buffers frequently 
enough, performance can suffer and packets can be lost. Red&nbsp;Hat 
Enterprise&nbsp;Linux provides different utilities to identify such 
problems.
			</p><section class="section" id="identifying-receive-buffer-collapsing-and-pruning_identifying-application-read-socket-buffer-bottlenecks"><div class="titlepage"><div><div><h3 class="title">31.7.1. Identifying receive buffer collapsing and pruning</h3></div></div></div><p>
					When the data in the receive queue exceeds the receive buffer size,
 the TCP stack tries to free some space by removing unnecessary metadata
 from the socket buffer. This step is known as collapsing.
				</p><p>
					If collapsing fails to free sufficient space for additional 
traffic, the kernel prunes new data that arrives. This means that the 
kernel removes the data from the memory and the packet is lost.
				</p><p>
					To avoid collapsing and pruning operations, monitor whether TCP 
buffer collapsing and pruning happens on your server and, in this case, 
tune the TCP buffers.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Use the <code class="literal">nstat</code> utility to query the <code class="literal">TcpExtTCPRcvCollapsed</code> and <code class="literal">TcpExtRcvPruned</code> counters:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nstat -az TcpExtTCPRcvCollapsed TcpExtRcvPruned</strong></span>
#kernel
TcpExtRcvPruned            0         0.0
TcpExtTCPRcvCollapsed      612859    0.0</pre></li><li class="listitem"><p class="simpara">
							Wait some time and re-run the <code class="literal">nstat</code> command:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nstat -az TcpExtTCPRcvCollapsed TcpExtRcvPruned</strong></span>
#kernel
TcpExtRcvPruned            0         0.0
TcpExtTCPRcvCollapsed      620358    0.0</pre></li><li class="listitem"><p class="simpara">
							If the values of the counters have increased compared to the first run, tuning is required:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									If the application uses the <code class="literal">setsockopt(SO_RCVBUF)</code>
 call, consider removing it. With this call, the application only uses 
the receive buffer size specified in the call and turns off the socket’s
 ability to auto-tune its size.
								</li><li class="listitem">
									If the application does not use the <code class="literal">setsockopt(SO_RCVBUF)</code> call, tune the default and maximum values of the TCP read socket buffer.
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Display the receive backlog queue (<code class="literal">Recv-Q</code>):
						</p><pre class="literallayout"># <span class="strong strong"><strong>ss -nti</strong></span>
State   Recv-Q   Send-Q   Local Address:Port   Peer Address:Port   Process
ESTAB   0        0        192.0.2.1:443        192.0.2.125:41574
      :7,7 ... lastrcv:543 ...
ESTAB   78       0        192.0.2.1:443        192.0.2.56:42612
      :7,7 ... lastrcv:658 ...
ESTAB   88       0        192.0.2.1:443        192.0.2.97:40313
      :7,7 ... lastrcv:5764 ...
...</pre></li><li class="listitem"><p class="simpara">
							Run the <code class="literal">ss -nt</code> command multiple times with a few seconds waiting time between each run.
						</p><p class="simpara">
							If the output lists only one case of a high value in the <code class="literal">Recv-Q</code> column, the application was between two receive operations. However, if the values in <code class="literal">Recv-Q</code> stays constant while <code class="literal">lastrcv</code> continually grows, or <code class="literal">Recv-Q</code> continually increases over time, one of the following problems can be the cause:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The application does not check its socket buffers often enough.
 Contact the application vendor for details about how you can solve this
 problem.
								</li><li class="listitem"><p class="simpara">
									The application does not get enough CPU time. To further debug this problem:
								</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p class="simpara">
											Display on which CPU cores the application runs:
										</p><pre class="literallayout"># <span class="strong strong"><strong>ps -eo pid,tid,psr,pcpu,stat,wchan:20,comm</strong></span>
    PID     TID PSR %CPU STAT WCHAN                COMMAND
...
  44594   44594   5  0.0 Ss   do_select            httpd
  44595   44595   3  0.0 S    skb_wait_for_more_pa httpd
  44596   44596   5  0.0 Sl   pipe_read            httpd
  44597   44597   5  0.0 Sl   pipe_read            httpd
  44602   44602   5  0.0 Sl   pipe_read            httpd
...</pre><p class="simpara">
											The <code class="literal">PSR</code> column displays the CPU cores the process is currently assigned to.
										</p></li><li class="listitem">
											Identify other processes running on the same cores and consider assigning them to other cores.
										</li></ol></div></li></ul></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="#increasing-the-system-wide-tcp-socket-buffers_tuning-tcp-connections-for-high-throughput" title="31.5.3.&nbsp;Increasing the system-wide TCP socket buffers">Increasing the system-wide TCP socket buffers</a>
						</li></ul></div></section></section><section class="section" id="tuning-applications-with-a-large-number-of-incoming-requests_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.8. Tuning applications with a large number of incoming requests</h2></div></div></div><p>
				If you run an application that handles a large number of incoming 
requests, such as web servers, it can be necessary to tune Red&nbsp;Hat 
Enterprise&nbsp;Linux to optimize the performance.
			</p><section class="section" id="tuning-the-tcp-listen-backlog-to-process-a-high-number-of-tcp-connection-attempts_tuning-applications-with-a-large-number-of-incoming-requests"><div class="titlepage"><div><div><h3 class="title">31.8.1. Tuning the TCP listen backlog to process a high number of TCP connection attempts</h3></div></div></div><p>
					When an application opens a TCP socket in <code class="literal">LISTEN</code>
 state, the kernel limits the number of accepted client connections this
 socket can handle. If clients try to establish more connections than 
the application can process, the new connections get lost or the kernel 
sends SYN cookies to the client.
				</p><p>
					If the system is under normal workload and too many connections 
from legitimate clients cause the kernel to send SYN cookies, tune 
Red&nbsp;Hat Enterprise&nbsp;Linux (RHEL) to avoid them.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							RHEL logs <code class="literal">possible SYN flooding on port <span class="emphasis"><em>&lt;ip_address&gt;</em></span>:<span class="emphasis"><em>&lt;port_number&gt;</em></span></code> error messages in the Systemd journal.
						</li><li class="listitem">
							The high number of connection attempts are from valid sources and not caused by an attack.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							To verify whether tuning is required, display the statistics for the affected port:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ss -ntl '( sport = :<span class="emphasis"><em>443</em></span> )'</strong></span>
State    Recv-Q   Send-Q   Local Address:Port   Peer Address:Port  Process
LISTEN   <span class="emphasis"><em>650</em></span>      <span class="emphasis"><em>500</em></span>      <span class="emphasis"><em>192.0.2.1:443</em></span>        0.0.0.0:*</pre><p class="simpara">
							If the current number of connections in the backlog (<code class="literal">Recv-Q</code>) is larger than the socket backlog (<code class="literal">Send-Q</code>), the listen backlog is still not large enough and tuning is required.
						</p></li><li class="listitem"><p class="simpara">
							Optional: Display the current TCP listen backlog limit:
						</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.core.somaxconn</strong></span>
net.core.somaxconn = <span class="emphasis"><em>4096</em></span></pre></li><li class="listitem"><p class="simpara">
							Create the <code class="literal">/etc/sysctl.d/10-socket-backlog-limit.conf</code> file, and set a larger listen backlog limit:
						</p><pre class="literallayout"><span class="strong strong"><strong>net.core.somaxconn = <span class="emphasis"><em>8192</em></span></strong></span></pre><p class="simpara">
							Note that applications can request a larger listen backlog than specified in the <code class="literal">net.core.somaxconn</code> kernel parameter but the kernel limits the application to the number you set in this parameter.
						</p></li><li class="listitem"><p class="simpara">
							Load the setting from the <code class="literal">/etc/sysctl.d/10-socket-backlog-limit.conf</code> file:
						</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl -p /etc/sysctl.d/10-socket-backlog-limit.conf</strong></span></pre></li><li class="listitem"><p class="simpara">
							Reconfigure the application to use the new listen backlog limit:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									If the application provides a config option for the limit, update it. For example, the Apache HTTP Server provides the <code class="literal">ListenBacklog</code> configuration option to set the listen backlog limit for this service.
								</li><li class="listitem">
									If you cannot configure the limit, recompile the application.
								</li></ul></div></li><li class="listitem">
							Restart the application.
						</li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem">
							Monitor the Systemd journal for further occurrences of <code class="literal">possible SYN flooding on port <span class="emphasis"><em>&lt;port_number&gt;</em></span></code> error messages.
						</li><li class="listitem"><p class="simpara">
							Monitor the current number of connections in the backlog and compare it with the socket backlog:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ss -ntl '( sport = :<span class="emphasis"><em>443</em></span> )'</strong></span>
State    Recv-Q   Send-Q   Local Address:Port   Peer Address:Port  Process
LISTEN   <span class="emphasis"><em>0</em></span>        <span class="emphasis"><em>500</em></span>      <span class="emphasis"><em>192.0.2.1:443</em></span>        0.0.0.0:*</pre><p class="simpara">
							If the current number of connections in the backlog (<code class="literal">Recv-Q</code>) is larger than the socket backlog (<code class="literal">Send-Q</code>), the listen backlog is not large enough and further tuning is required.
						</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/articles/1391433">kernel: Possible SYN flooding on port #. Sending cookies</a> solution
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/3193562">Listening TCP server ignores SYN or ACK for new connection handshake</a> solution
						</li><li class="listitem">
							<code class="literal">listen(2)</code> man page
						</li></ul></div></section></section><section class="section" id="avoiding-listen-queue-lock-contention_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.9. Avoiding listen queue lock contention</h2></div></div></div><p>
				Queue lock contention can cause packet drops and higher CPU usage 
and, consequently, a higher latency. You can avoid queue lock contention
 on the receive (RX) and transmit (TX) queue by tuning your application 
and using transmit packet steering.
			</p><section class="section" id="avoiding-rx-queue-lock-contention-the-so_reuseport-and-so_reuseport_bpf-socket-options_avoiding-listen-queue-lock-contention"><div class="titlepage"><div><div><h3 class="title">31.9.1. Avoiding RX queue lock contention: The SO_REUSEPORT and SO_REUSEPORT_BPF socket options</h3></div></div></div><p>
					On a multi-core system, you can improve the performance of 
multi-threaded network server applications if the application opens the 
port by using the <code class="literal">SO_REUSEPORT</code> or <code class="literal">SO_REUSEPORT_BPF</code>
 socket option. If the application does not use one of these socket 
options, all threads are forced to share a single socket to receive the 
incoming traffic. Using a single socket causes:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							Significant contention on the receive buffer, which can cause packet drops and higher CPU usage.
						</li><li class="listitem">
							A significant increase of CPU usage
						</li><li class="listitem">
							Possibly packet drops
						</li></ul></div><div class="informalfigure"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/4a88b5b3bbe5fb65cf923949642f94e3/lock-contention.png" class="rh_docs--zoom" title="lock contention"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/lock-contention.png" alt="lock contention"></a></div></div><p>
					With the <code class="literal">SO_REUSEPORT</code> or <code class="literal">SO_REUSEPORT_BPF</code> socket option, multiple sockets on one host can bind to the same port:
				</p><div class="informalfigure"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/d98510d7449bbab560553bb46e5828fe/so_reuseport.png" class="rh_docs--zoom" title="so reuseport"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/so_reuseport.png" alt="so reuseport"></a></div></div><p>
					Red&nbsp;Hat Enterprise&nbsp;Linux provides a code example of how to use the <code class="literal">SO_REUSEPORT</code> socket options in the kernel sources. To access the code example:
				</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Enable the <code class="literal">rhel-9-for-x86_64-baseos-debug-rpms</code> repository:
						</p><pre class="literallayout"># <span class="strong strong"><strong>subscription-manager repos --enable rhel-9-for-x86_64-baseos-debug-rpms</strong></span></pre></li><li class="listitem"><p class="simpara">
							Install the <code class="literal">kernel-debuginfo-common-x86_64</code> package:
						</p><pre class="literallayout"># <span class="strong strong"><strong>dnf install kernel-debuginfo-common-x86_64</strong></span></pre></li><li class="listitem">
							The code example is now available in the <code class="literal">/usr/src/debug/kernel-<span class="emphasis"><em>&lt;version&gt;</em></span>/linux-&lt;version&gt;/tools/testing/selftests/net/reuseport_bpf_cpu.c</code> file.
						</li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">socket(7)</code> man page
						</li><li class="listitem">
							<code class="literal">/usr/src/debug/kernel-<span class="emphasis"><em>&lt;version&gt;</em></span>/linux-&lt;version&gt;/tools/testing/selftests/net/reuseport_bpf_cpu.c</code>
						</li></ul></div></section><section class="section" id="avoiding-tx-queue-lock-contention-transmit-packet-steering_avoiding-listen-queue-lock-contention"><div class="titlepage"><div><div><h3 class="title">31.9.2. Avoiding TX queue lock contention: Transmit packet steering</h3></div></div></div><p>
					In hosts with a network interface controller (NIC) that supports 
multiple queues, transmit packet steering (XPS) distributes the 
processing of outgoing network packets among several queues. This 
enables multiple CPUs to process the outgoing network traffic and to 
avoid transmit queue lock contention and, consequently, packet drops.
				</p><p>
					Certain drivers, such as <code class="literal">ixgbe</code>, <code class="literal">i40e</code>, and <code class="literal">mlx5</code>
 automatically configure XPS. To identify if the driver supports this 
capability, consult the documentation of your NIC driver. Consult your 
NIC driver’s documentation to identify if the driver supports this 
capability. If the driver does not support XPS auto-tuning, you can 
manually assign CPU cores to the transmit queues.
				</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
						Red&nbsp;Hat Enterprise&nbsp;Linux does not provide an option to 
permanently assign transmit queues to CPU cores. Use the commands in a 
script and run it when the system boots.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The NIC supports multiple queues.
						</li><li class="listitem">
							The <code class="literal">numactl</code> package is installed.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the count of available queues:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -l <span class="emphasis"><em>enp1s0</em></span></strong></span>
Channel parameters for <span class="emphasis"><em>enp1s0</em></span>:
Pre-set maximums:
RX:		<span class="emphasis"><em>0</em></span>
TX:		<span class="emphasis"><em>0</em></span>
Other:		<span class="emphasis"><em>0</em></span>
Combined:	<span class="emphasis"><em>4</em></span>
Current hardware settings:
RX:		<span class="emphasis"><em>0</em></span>
TX:		<span class="emphasis"><em>0</em></span>
Other:		<span class="emphasis"><em>0</em></span>
Combined:	<span class="emphasis"><em>1</em></span></pre><p class="simpara">
							The <code class="literal">Pre-set maximums</code> section shows the total number of queues and <code class="literal">Current hardware settings</code> the number of queues that are currently assigned to the receive, transmit, other, or combined queues.
						</p></li><li class="listitem"><p class="simpara">
							Optional: If you require queues on specific channels, assign them
 accordingly. For example, to assign the 4 queues to the <code class="literal">Combined</code> channel, enter:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -L <span class="emphasis"><em>enp1s0</em></span> combined 4</strong></span></pre></li><li class="listitem"><p class="simpara">
							Display to which Non-Uniform Memory Access (NUMA) node the NIC is assigned:
						</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/class/net/<span class="emphasis"><em>enp1s0</em></span>/device/numa_node</strong></span>
0</pre><p class="simpara">
							If the file is not found or the command returns <code class="literal">-1</code>, the host is not a NUMA system.
						</p></li><li class="listitem"><p class="simpara">
							If the host is a NUMA system, display which CPUs are assigned to which NUMA node:
						</p><pre class="literallayout"># <span class="strong strong"><strong>lscpu | grep NUMA</strong></span>
NUMA node(s):       2
NUMA node0 CPU(s):  0-3
NUMA node1 CPU(s):  4-7</pre></li><li class="listitem"><p class="simpara">
							In the example above, the NIC has 4 queues and the NIC is 
assigned to NUMA node 0. This node uses the CPU cores 0-3. Consequently,
 map each transmit queue to one of the CPU cores from 0-3:
						</p><pre class="literallayout"># <span class="strong strong"><strong>echo <span class="emphasis"><em>1</em></span> &gt; /sys/class/net/<span class="emphasis"><em>enp1s0</em></span>/queues/tx-<span class="emphasis"><em>0</em></span>/xps_cpus</strong></span>
# <span class="strong strong"><strong>echo <span class="emphasis"><em>2</em></span> &gt; /sys/class/net/<span class="emphasis"><em>enp1s0</em></span>/queues/tx-<span class="emphasis"><em>1</em></span>/xps_cpus</strong></span>
# <span class="strong strong"><strong>echo <span class="emphasis"><em>4</em></span> &gt; /sys/class/net/<span class="emphasis"><em>enp1s0</em></span>/queues/tx-<span class="emphasis"><em>2</em></span>/xps_cpus</strong></span>
# <span class="strong strong"><strong>echo <span class="emphasis"><em>8</em></span> &gt; /sys/class/net/<span class="emphasis"><em>enp1s0</em></span>/queues/tx-<span class="emphasis"><em>3</em></span>/xps_cpus</strong></span></pre><p class="simpara">
							If the number of CPU cores and transmit (TX) queues is the same, 
use a 1 to 1 mapping to avoid any kind of contention on the TX queue. 
Otherwise, if you map multiple CPUs on the same TX queue, transmit 
operations on different CPUs will cause TX queue lock contention and 
negatively impacts the transmit throughput.
						</p><p class="simpara">
							Note that you must pass the bitmap, containing the CPU’s core 
numbers, to the queues. Use the following command to calculate the 
bitmap:
						</p><pre class="literallayout"># <span class="strong strong"><strong>printf %x $((1 &lt;&lt; <span class="emphasis"><em>&lt;core_number&gt;</em></span> ))</strong></span></pre></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Identify the process IDs (PIDs) of services that send traffic:
						</p><pre class="literallayout"># <span class="strong strong"><strong>pidof <span class="emphasis"><em>&lt;process_name&gt;</em></span></strong></span>
<span class="emphasis"><em>12345</em></span> <span class="emphasis"><em>98765</em></span></pre></li><li class="listitem"><p class="simpara">
							Pin the PIDs to cores that use XPS:
						</p><pre class="literallayout"># <span class="strong strong"><strong>numactl -C <span class="emphasis"><em>0-3</em></span> <span class="emphasis"><em>12345</em></span> <span class="emphasis"><em>98765</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
							Monitor the <code class="literal">requeues</code> counter while the process send traffic:
						</p><pre class="literallayout"># <span class="strong strong"><strong>tc -s qdisc</strong></span>
<span class="emphasis"><em>qdisc fq_codel 0: dev enp10s0u1 root refcnt 2 limit 10240p flows 1024 quantum 1514 target 5ms interval 100ms memory_limit 32Mb ecn drop_batch 64</em></span>
 Sent <span class="emphasis"><em>125728849</em></span> bytes <span class="emphasis"><em>1067587</em></span> pkt (dropped <span class="emphasis"><em>0</em></span>, overlimits <span class="emphasis"><em>0</em></span> requeues <span class="emphasis"><em>30</em></span>)
 backlog <span class="emphasis"><em>0b 0p</em></span> requeues <span class="emphasis"><em>30</em></span>
 ...</pre><p class="simpara">
							If the <code class="literal">requeues</code> counter no longer increases at a significant rate, TX queue lock contention no longer happens.
						</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">/usr/share/doc/kernel-doc-_&lt;version&gt;/Documentation/networking/scaling.rst</code>
						</li></ul></div></section><section class="section" id="disabling-the-generic-receive-offload-feature-on-servers-with-high-udp-traffic_avoiding-listen-queue-lock-contention"><div class="titlepage"><div><div><h3 class="title">31.9.3. Disabling the Generic Receive Offload feature on servers with high UDP traffic</h3></div></div></div><p>
					Applications that use high-speed UDP bulk transfer should enable 
and use UDP Generic Receive Offload (GRO) on the UDP socket. However, 
you can disable GRO to increase the throughput if the following 
conditions apply:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							The application does not support GRO and the feature cannot be added.
						</li><li class="listitem"><p class="simpara">
							TCP throughput is not relevant.
						</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
								Disabling GRO significantly reduces the receive throughput of 
TCP traffic. Therefore, do not disable GRO on hosts where TCP 
performance is relevant.
							</p></div></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The host mainly processes UDP traffic.
						</li><li class="listitem">
							The application does not use GRO.
						</li><li class="listitem">
							The host does not use UDP tunnel protocols, such as VXLAN.
						</li><li class="listitem">
							The host does not run virtual machines (VMs) or containers.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Optional: Display the NetworkManager connection profiles:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection show</strong></span>
NAME     UUID                                  TYPE      DEVICE
<span class="emphasis"><em>example</em></span>  <span class="emphasis"><em>f2f33f29-bb5c-3a07-9069-be72eaec3ecf</em></span>  <span class="emphasis"><em>ethernet</em></span>  <span class="emphasis"><em>enp1s0</em></span></pre></li><li class="listitem"><p class="simpara">
							Disable GRO support in the connection profile:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify <span class="emphasis"><em>example</em></span> ethtool.feature-gro off</strong></span></pre></li><li class="listitem"><p class="simpara">
							Reactivate the connection profile:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection up <span class="emphasis"><em>example</em></span></strong></span></pre></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Verify that GRO is disabled:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -k <span class="emphasis"><em>enp1s0</em></span> | grep generic-receive-offload</strong></span>
generic-receive-offload: off</pre></li><li class="listitem">
							Monitor the throughput on the server. Re-enable GRO in the 
NetworkManager profile if the setting has negative side effects to other
 applications on the host.
						</li></ol></div></section></section><section class="section" id="tuning-the-device-driver-and-nic_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.10. Tuning the device driver and NIC</h2></div></div></div><p>
				In RHEL, kernel modules provide drivers for network interface 
controllers (NICs). These modules support parameters to tune and 
optimize the device driver and the NIC. For example, if the driver 
supports delaying the generation of receive interrupts, you can reduce 
the value of the corresponding parameter to avoid running out of receive
 descriptors.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Not all modules support custom parameters, and the features depend 
on the hardware, as well as the driver and firmware version.
				</p></div></div><section class="section" id="configuring-custom-nic-driver-parameters_tuning-the-device-driver-and-nic"><div class="titlepage"><div><div><h3 class="title">31.10.1. Configuring custom NIC driver parameters</h3></div></div></div><p>
					Many kernel modules support setting parameters to tune the driver 
and the network interface controller (NIC). You can customize the 
settings according to the hardware and the driver.
				</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
						If you set parameters on a kernel module, RHEL applies these settings to all devices that use this driver.
					</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							A NIC is installed in the host.
						</li><li class="listitem">
							The kernel module that provides the driver for the NIC supports the required tuning feature.
						</li><li class="listitem">
							You are logged in locally or using a network interface that is 
different from the one that uses the driver for which you want to change
 the parameters.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Identify the driver:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -i <span class="emphasis"><em>enp0s31f6</em></span></strong></span>
driver: <span class="emphasis"><em>e1000e</em></span>
version: ...
firmware-version: ...
...</pre><p class="simpara">
							Note that certain features can require a specific driver and firmware version.
						</p></li><li class="listitem"><p class="simpara">
							Display the available parameters of the kernel module:
						</p><pre class="literallayout"># <span class="strong strong"><strong>modinfo -p <span class="emphasis"><em>e1000e</em></span></strong></span>
...
SmartPowerDownEnable:Enable PHY smart power down (array of int)
parm:RxIntDelay:Receive Interrupt Delay (array of int)</pre><p class="simpara">
							For further details on the parameters, see the kernel module’s 
documentation. For modules in RHEL, see the documentation in the <code class="literal">/usr/share/doc/kernel-doc-<span class="emphasis"><em>&lt;version&gt;</em></span>/Documentation/networking/device_drivers/</code> directory that is provided by the <code class="literal">kernel-doc</code> package.
						</p></li><li class="listitem"><p class="simpara">
							Create the <code class="literal">/etc/modprobe.d/<span class="emphasis"><em>nic-parameters.conf</em></span></code> file and specify the parameters for the module:
						</p><pre class="literallayout">options <span class="emphasis"><em>&lt;module_name&gt;</em></span> <span class="emphasis"><em>&lt;parameter1&gt;</em></span>=<span class="emphasis"><em>&lt;value&gt;</em></span> <span class="emphasis"><em>&lt;parameter2&gt;</em></span>=<span class="emphasis"><em>&lt;value&gt;</em></span></pre><p class="simpara">
							For example, to enable the port power saving mechanism and set the generation of receive interrupts to 4 units, enter:
						</p><pre class="literallayout"><span class="strong strong"><strong>options <span class="emphasis"><em>e1000e SmartPowerDownEnable=1 RxIntDelay=4</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
							Unload the module:
						</p><pre class="literallayout"># <span class="strong strong"><strong>modprobe -r <span class="emphasis"><em>e1000e</em></span></strong></span></pre><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
								Unloading a module that an active network interface uses, 
immediately terminates the connection and you can lock yourself out of 
the server.
							</p></div></div></li><li class="listitem"><p class="simpara">
							Load the module:
						</p><pre class="literallayout"># <span class="strong strong"><strong>modprobe <span class="emphasis"><em>e1000e</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
							Reactivate the network connections:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection up <span class="emphasis"><em>&lt;profile_name&gt;</em></span></strong></span></pre></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the kernel messages:
						</p><pre class="literallayout"># <span class="strong strong"><strong>dmesg</strong></span>
...
[35309.225765] e1000e 0000:00:1f.6: Transmit Interrupt Delay set to 16
[35309.225769] e1000e 0000:00:1f.6: PHY Smart Power Down Enabled
...</pre><p class="simpara">
							Note that not all modules log parameter settings to the kernel ring buffer.
						</p></li><li class="listitem"><p class="simpara">
							Certain kernel modules create files for each module parameter in the <code class="literal">/sys/module/<span class="emphasis"><em>&lt;driver&gt;</em></span>/parameters/</code> directory. Each of these files contain the current value of this parameter. You can display these files to verify a setting:
						</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/module/<span class="emphasis"><em>&lt;driver_name&gt;</em></span>/parameters/<span class="emphasis"><em>&lt;parameter_name&gt;</em></span></strong></span></pre></li></ol></div></section></section><section class="section" id="configuring-network-adapter-offload-settings_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.11. Configuring network adapter offload settings</h2></div></div></div><p>
				To reduce CPU load, certain network adapters use offloading features
 which move the network processing load to the network interface 
controller (NIC). For example, with Encapsulating Security Payload (ESP)
 offload, the NIC performs ESP operations to accelerate IPsec 
connections and reduce CPU load.
			</p><p>
				By default, most offloading features in Red&nbsp;Hat 
Enterprise&nbsp;Linux are enabled. Only disable them in the following 
cases:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						Temporarily disable offload features for troubleshooting purposes.
					</li><li class="listitem">
						Permanently disable offload features when a specific feature negatively impacts your host.
					</li></ul></div><p>
				If a performance-related offload feature is not enabled by default in a network driver, you can enable it manually.
			</p><section class="section" id="temporarily-setting-an-offload-feature_configuring-network-adapter-offload-settings"><div class="titlepage"><div><div><h3 class="title">31.11.1. Temporarily setting an offload feature</h3></div></div></div><p>
					If you expect that an offload feature causes problems or reduces 
the performance of your host, you can attempt to narrow down the cause 
by temporarily enabling or disabling it, depending on its current state.
				</p><p>
					If you temporarily enable or disable an offload feature, it returns to its previous value on the next reboot.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							The network card supports offload features.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the interface’s available offload features and their current state:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -k <span class="emphasis"><em>enp1s0</em></span></strong></span>
...
<span class="emphasis"><em>esp-hw-offload: on</em></span>
<span class="emphasis"><em>ntuple-filters: off</em></span>
<span class="emphasis"><em>rx-vlan-filter: off [fixed]</em></span>
...</pre><p class="simpara">
							The output depends on the capabilities of the hardware and its 
driver. Note that you cannot change the state of features that are 
flagged with <code class="literal">[fixed]</code>.
						</p></li><li class="listitem"><p class="simpara">
							Temporarily disable an offload feature:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -K <span class="emphasis"><em>&lt;interface&gt;</em></span> <span class="emphasis"><em>&lt;feature&gt;</em></span> <span class="emphasis"><em>[on|off]</em></span></strong></span></pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									For example, to temporarily disable IPsec Encapsulating Security Payload (ESP) offload on the <code class="literal">enp10s0u1</code> interface, enter:
								</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -K <span class="emphasis"><em>enp10s0u1</em></span> <span class="emphasis"><em>esp-hw-offload</em></span> off</strong></span></pre></li><li class="listitem"><p class="simpara">
									For example, to temporarily enable accelerated Receive Flow Steering (aRFS) filtering on the <code class="literal">enp10s0u1</code> interface, enter:
								</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -K <span class="emphasis"><em>enp10s0u1</em></span> <span class="emphasis"><em>ntuple-filters</em></span> on</strong></span></pre></li></ul></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Display the states of the offload features:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -k <span class="emphasis"><em>enp1s0</em></span></strong></span>
...
<span class="emphasis"><em>esp-hw-offload: off</em></span>
<span class="emphasis"><em>ntuple-filters: on</em></span>
...</pre></li><li class="listitem"><p class="simpara">
							Test whether the problem you encountered before changing the offload feature still exists.
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									If the problem no longer exists after changing a specific offload feature:
								</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
											Contact <a class="link" href="https://access.redhat.com/support">Red&nbsp;Hat Support</a> and report the problem.
										</li><li class="listitem">
											Consider <a class="link" href="#permanently-setting-an-offload-feature_configuring-network-adapter-offload-settings" title="31.11.2.&nbsp;Permanently setting an offload feature">permanently setting the offload feature</a> until a fix is available.
										</li></ol></div></li><li class="listitem"><p class="simpara">
									If the problem still exists after disabling a specific offload feature:
								</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem">
											Reset the setting to its previous state by using the <code class="literal">ethtool -K <span class="emphasis"><em>&lt;interface&gt;</em></span> <span class="emphasis"><em>&lt;feature&gt;</em></span> <span class="emphasis"><em>[on|off]</em></span></code> command.
										</li><li class="listitem">
											Enable or disable a different offload feature to narrow down the problem.
										</li></ol></div></li></ul></div></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<code class="literal">ethtool(8)</code> man page
						</li></ul></div></section><section class="section" id="permanently-setting-an-offload-feature_configuring-network-adapter-offload-settings"><div class="titlepage"><div><div><h3 class="title">31.11.2. Permanently setting an offload feature</h3></div></div></div><p>
					If you have identified a specific offload feature that limits the 
performance on your host, you can permanently enable or disable it, 
depending on its current state.
				</p><p>
					If you permanently enable or disable an offload feature, 
NetworkManager ensures that the feature still has this state after a 
reboot.
				</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
							You identified a specific offload feature to limit the performance on your host.
						</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Identify the connection profile that uses the network interface 
on which you want to change the state of the offload feature:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection show</strong></span>
NAME     UUID                                  TYPE      DEVICE
<span class="emphasis"><em>Example</em></span>  <span class="emphasis"><em>a5eb6490-cc20-3668-81f8-0314a27f3f75</em></span>  ethernet  <span class="emphasis"><em>enp1ss0</em></span>
...</pre></li><li class="listitem"><p class="simpara">
							Permanently change the state of the offload feature:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify <span class="emphasis"><em>&lt;connection_name&gt;</em></span> <span class="emphasis"><em>&lt;feature&gt;</em></span> <span class="emphasis"><em>[on|off]</em></span></strong></span></pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									For example, to permanently disable IPsec Encapsulating Security Payload (ESP) offload in the <code class="literal">Example</code> connection profile, enter:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify <span class="emphasis"><em>Example</em></span> <span class="emphasis"><em>ethtool.feature-esp-hw-offload</em></span> off</strong></span></pre></li><li class="listitem"><p class="simpara">
									For example, to permanently enable accelerated Receive Flow Steering (aRFS) filtering in the <code class="literal">Example</code> connection profile, enter:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify <span class="emphasis"><em>Example</em></span> <span class="emphasis"><em>ethtool.feature-ntuple</em></span> on</strong></span></pre></li></ul></div></li><li class="listitem"><p class="simpara">
							Reactivate the connection profile:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection up <span class="emphasis"><em>Example</em></span></strong></span></pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Display the output states of the offload features:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -k <span class="emphasis"><em>enp1s0</em></span></strong></span>
...
<span class="emphasis"><em>esp-hw-offload: off</em></span>
<span class="emphasis"><em>ntuple-filters: on</em></span>
...</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_and_managing_networking/configuring-ethtool-offload-features_configuring-and-managing-networking#offload-features-supported-by-networkmanager_configuring-ethtool-offload-features">Offload features supported by NetworkManager</a>
						</li></ul></div></section></section><section class="section" id="tuning-interrupt-coalescence-settings_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.12. Tuning interrupt coalescence settings</h2></div></div></div><p>
				Interrupt coalescence is a mechanism for reducing the number of 
interrupts generated by a network card. Generally, fewer interrupts can 
enhance the latency and overall performance of your network.
			</p><p>
				Tuning the interrupt coalescence settings involves adjusting the parameters that control:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The number of packets that are combined into a single interrupt.
					</li><li class="listitem">
						The delay before generating an interrupt.
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					The optimal coalescence settings depend on the specific network 
conditions and hardware in use. Therefore, it might take several 
attempts to find the settings that work best for your environment and 
needs.
				</p></div></div><section class="section" id="optimizing-rhel-for-latency-or-throughput-sensitive-services_tuning-interrupt-coalescence-settings"><div class="titlepage"><div><div><h3 class="title">31.12.1. Optimizing RHEL for latency or throughput-sensitive services</h3></div></div></div><p>
					The goal of coalesce tuning is to minimize the number of interrupts
 required for a given workload. In high-throughput situations, the goal 
is to have as few interrupts as possible while maintaining a high data 
rate. In low-latency situations, more interrupts can be used to handle 
traffic quickly.
				</p><p>
					You can adjust the settings on your network card to increase or 
decrease the number of packets that are combined into a single 
interrupt. As a result, you can achieve improved throughput or latency 
for your traffic.
				</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
							Identify the network interface that is experiencing the bottleneck:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -S <span class="emphasis"><em>enp1s0</em></span></strong></span>
NIC statistics:
     rx_packets: 1234
     tx_packets: 5678
     rx_bytes: 12345678
     tx_bytes: 87654321
     rx_errors: 0
     tx_errors: 0
     rx_missed: 0
     tx_dropped: 0
     coalesced_pkts: 0
     coalesced_events: 0
     coalesced_aborts: 0</pre><p class="simpara">
							Identify the packet counters containing "drop", "discard", or 
"error" in their name. These particular statistics measure the actual 
packet loss at the network interface card (NIC) packet buffer, which can
 be caused by NIC coalescence.
						</p></li><li class="listitem"><p class="simpara">
							Monitor values of packet counters you identified in the previous step.
						</p><p class="simpara">
							Compare them to the expected values for your network to determine
 whether any particular interface experiences a bottleneck. Some common 
signs of a network bottleneck include, but are not limited to:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Many errors on a network interface
								</li><li class="listitem">
									High packet loss
								</li><li class="listitem"><p class="simpara">
									Heavy usage of the network interface
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										Other important factors are for example CPU usage, memory usage, and disk I/O when identifying a network bottleneck.
									</p></div></div></li></ul></div></li><li class="listitem"><p class="simpara">
							View the current coalescence settings:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool enp1s0</strong></span>
Settings for enp1s0:
        Supported ports: [ TP ]
        Supported link modes:   10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full
        Supported pause frame use: No
        Supports auto-negotiation: Yes
        Advertised link modes:  10baseT/Half 10baseT/Full
                                100baseT/Half 100baseT/Full
                                1000baseT/Full
        Advertised pause frame use: No
        Advertised auto-negotiation: Yes
        Speed: 1000Mb/s
        Duplex: Full
        Port: Twisted Pair
        PHYAD: 0
        Transceiver: internal
        Auto-negotiation: on
        MDI-X: Unknown
        Supports Wake-on: g
        Wake-on: g
        Current message level: 0x00000033 (51)
                               drv probe link
        Link detected: yes</pre><p class="simpara">
							In this output, monitor the <code class="literal">Speed</code> and <code class="literal">Duplex</code>
 fields. These fields display information about the network interface 
operation and whether it is running at its expected values.
						</p></li><li class="listitem"><p class="simpara">
							Check the current interrupt coalescence settings:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -c enp1s0</strong></span>
Coalesce parameters for enp1s0:
        Adaptive RX: off
        Adaptive TX: off
        RX usecs: 100
        RX frames: 8
        RX usecs irq: 100
        RX frames irq: 8
        TX usecs: 100
        TX frames: 8
        TX usecs irq: 100
        TX frames irq: 8</pre><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									The <code class="literal">usecs</code> values refer to the number of microseconds that the receiver or transmitter waits before generating an interrupt.
								</li><li class="listitem">
									The <code class="literal">frames</code> values refer to the number of frames that the receiver or transmitter waits before generating an interrupt.
								</li><li class="listitem"><p class="simpara">
									The <code class="literal">irq</code> values are used to configure the interrupt moderation when the network interface is already handling an interrupt.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										Not all network interface cards support reporting and changing all values from the example output.
									</p></div></div></li><li class="listitem">
									The <code class="literal">Adaptive RX/TX</code> value 
represents the adaptive interrupt coalescence mechanism, which adjusts 
the interrupt coalescence settings dynamically. Based on the packet 
conditions, the NIC driver auto-calculates coalesce values when <code class="literal">Adaptive RX/TX</code> are enabled (the algorithm differs for every NIC driver).
								</li></ul></div></li><li class="listitem"><p class="simpara">
							Modify the coalescence settings as needed. For example:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
									While <code class="literal">ethtool.coalesce-adaptive-rx</code> is disabled, configure <code class="literal">ethtool.coalesce-rx-usecs</code> to set the delay before generating an interrupt to 100 microseconds for the RX packets:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify enp1s0 ethtool.coalesce-rx-usecs <span class="emphasis"><em>100</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
									Enable <code class="literal">ethtool.coalesce-adaptive-rx</code> while <code class="literal">ethtool.coalesce-rx-usecs</code> is set to its default value:
								</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection modify enp1s0 ethtool.coalesce-adaptive-rx on</strong></span></pre><p class="simpara">
									Red Hat recommends that modifying the Adaptive-RX setting as follows:
								</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
											Users concerned with low latency (sub-50us) should not enable <code class="literal">Adaptive-RX</code>.
										</li><li class="listitem">
											Users concerned with throughput can probably enable <code class="literal">Adaptive-RX</code>
 with no harm. If they do not want to use the adaptive interrupt 
coalescence mechanism, they can try setting large values like 100us, or 
250us to <code class="literal">ethtool.coalesce-rx-usecs</code>.
										</li><li class="listitem">
											Users unsure about their needs should not modify this setting until an issue occurs.
										</li></ul></div></li></ul></div></li><li class="listitem"><p class="simpara">
							Re-activate the connection:
						</p><pre class="literallayout"># <span class="strong strong"><strong>nmcli connection up enp1s0</strong></span></pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
							Monitor the network performance and check for dropped packets:
						</p><pre class="literallayout"># <span class="strong strong"><strong>ethtool -S enp1s0</strong></span>
NIC statistics:
     rx_packets: 1234
     tx_packets: 5678
     rx_bytes: 12345678
     tx_bytes: 87654321
     rx_errors: 0
     tx_errors: 0
     rx_missed: 0
     tx_dropped: 0
     coalesced_pkts: 12
     coalesced_events: 34
     coalesced_aborts: 56
...</pre><p class="simpara">
							The value of the <code class="literal">rx_errors</code>, <code class="literal">rx_dropped</code>, <code class="literal">tx_errors</code>, and <code class="literal">tx_dropped</code>
 fields should be 0 or close to it (up to few hundreds, depending on the
 network traffic and system resources). A high value in these fields 
indicates a network problem. Your counters can have different names. 
Closely monitor packet counters containing "drop", "discard", or "error"
 in their name.
						</p><p class="simpara">
							The value of the <code class="literal">rx_packets</code>, <code class="literal">tx_packets</code>, <code class="literal">rx_bytes</code>, and <code class="literal">tx_bytes</code>
 should increase over time. If the values do not increase, there might 
be a network problem. The packet counters can have different names, 
depending on your NIC driver.
						</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
								The <code class="literal">ethtool</code> command output can vary depending on the NIC and driver in use.
							</p></div></div><p class="simpara">
							Users with focus on extremely low latency can use 
application-level metrics or the kernel packet time-stamping API for 
their monitoring purposes.
						</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
							<a class="link" href="https://access.redhat.com/articles/1162133">Initial investigation for any performance issue</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/108513">What are the kernel parameters available for network tuning?</a>
						</li><li class="listitem">
							<a class="link" href="https://access.redhat.com/solutions/2127401">How to make NIC ethtool settings persistent (apply automatically at boot)</a>
						</li><li class="listitem">
							<a class="link" href="https://www.kernel.org/doc/html/latest/networking/timestamping.html">Timestamping</a>
						</li></ul></div></section></section><section class="section" id="benefits-of-tcp-timestamps_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.13. Benefits of TCP Timestamps</h2></div></div></div><p>
				TCP Timestamps are optional information in the TCP header and an 
extension of the TCP protocol. By default, TCP Timestamps are enabled in
 Red&nbsp;Hat Enterprise&nbsp;Linux, and the kernel uses TCP Timestamps 
to better estimate the round trip time (RTT) in TCP connections. This 
results in more accurate TCP window and buffer calculations.
			</p><p>
				Additionally, TCP Timestamps provide an alternative method to 
determine the age and order of a segment, and protect against wrapped 
sequence numbers. TCP packet headers record the sequence number in a 
32-bit field. On a 10 Gbps connection, the value of this field can wrap 
after 1.7 seconds. Without TCP Timestamps, the receiver could not 
determine whether a segment with a wrapped sequence number is a new 
segment or an old duplicate. With TCP Timestamps, however, the receiver 
can make the correct choice to receive or discard the segment. 
Therefore, enabling TCP Timestamps on systems with fast network 
interfaces is essential.
			</p><p>
				The <code class="literal">net.ipv4.tcp_timestamps</code> kernel parameter can have one of the following values:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">0</code>: TCP Timestamps are disabled.
					</li><li class="listitem">
						<code class="literal">1</code>: TCP Timestamps are enabled (default).
					</li><li class="listitem"><p class="simpara">
						<code class="literal">2</code>: TCP Timestamps are enabled but without random offsets.
					</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							Without random offsets for each connection, it is possible to 
approximately determine the host’s uptime and fingerprint and use this 
information in attacks.
						</p></div></div></li></ul></div><p>
				By default, TCP Timestamps are enabled in Red&nbsp;Hat 
Enterprise&nbsp;Linux and use random offsets for each connection instead
 of only storing the current time:
			</p><pre class="literallayout"># <span class="strong strong"><strong>sysctl net.ipv4.tcp_timestamps</strong></span>
net.ipv4.tcp_timestamps = 1</pre><p>
				If the <code class="literal">net.ipv4.tcp_timestamps</code> parameter has a different value than the default (<code class="literal">1</code>), revert the setting in the same way as you set it.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://www.rfc-editor.org/rfc/rfc1323">RFC 1323: TCP Extensions for High Performance</a>
					</li></ul></div></section><section class="section" id="ref_flow-control-in-ethernet-networks_tuning-the-network-performance"><div class="titlepage"><div><div><h2 class="title">31.14. Flow control for Ethernet networks</h2></div></div></div><p>
				On an Ethernet link, continuous data transmission between a network 
interface and a switch port can lead to full buffer capacity. Full 
buffer capacity results in network congestion. In this case, when the 
sender transmits data at a higher rate than the processing capacity of 
the receiver, packet loss can occur due to the lower data processing 
capacity of a network interface on the other end of the link which is a 
switch port.
			</p><p>
				The flow control mechanism manages data transmission across the 
Ethernet link where each sender and receiver has different sending and 
receiving capacities. To avoid packet loss, the Ethernet flow control 
mechanism temporarily suspends the packet transmission to manage a 
higher transmission rate from a switch port. Note that routers do not 
forward pause frames beyond a switch port.
			</p><p>
				When receive (RX) buffers become full, a receiver sends pause frames
 to the transmitter. The transmitter then stops data transmission for a 
short sub-second time frame, while continuing to buffer incoming data 
during this pause period. This duration provides enough time for the 
receiver to empty its interface buffers and prevent buffer overflow.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Either end of the Ethernet link can send pause frames to another 
end. If the receive buffers of a network interface are full, the network
 interface will send pause frames to the switch port. Similarly, when 
the receive buffers of a switch port are full, the switch port sends 
pause frames to the network interface.
				</p></div></div><p>
				By default, most of the network drivers in Red&nbsp;Hat 
Enterprise&nbsp;Linux have pause frame support enabled. To display the 
current settings of a network interface, enter:
			</p><pre class="screen"># <span class="strong strong"><strong>ethtool --show-pause <span class="emphasis"><em>enp1s0</em></span></strong></span>
Pause parameters for enp1s0:
...
RX:     on
TX:     on
...</pre><p>
				Verify with your switch vendor to confirm if your switch supports pause frames.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">ethtool(8)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/68817">What is network link flow control and how does it work in Red Hat Enterprise Linux?</a>
					</li></ul></div></section></section><section class="chapter" id="factors-affecting-i-o-and-file-system-performance_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 32. Factors affecting I/O and file system performance</h1></div></div></div><p class="_abstract _abstract">
			The appropriate settings for storage and file system performance are highly dependent on the storage purpose.
		</p><p>
			I/O and file system performance can be affected by any of the following factors:
		</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
					Data write or read patterns
				</li><li class="listitem">
					Sequential or random
				</li><li class="listitem">
					Buffered or Direct IO
				</li><li class="listitem">
					Data alignment with underlying geometry
				</li><li class="listitem">
					Block size
				</li><li class="listitem">
					File system size
				</li><li class="listitem">
					Journal size and location
				</li><li class="listitem">
					Recording access times
				</li><li class="listitem">
					Ensuring data reliability
				</li><li class="listitem">
					Pre-fetching data
				</li><li class="listitem">
					Pre-allocating disk space
				</li><li class="listitem">
					File fragmentation
				</li><li class="listitem">
					Resource contention
				</li></ul></div><section class="section" id="tools-for-monitoring-and-diagnosing-i-o-and-file-system-issues_factors-affecting-i-o-and-file-system-performance"><div class="titlepage"><div><div><h2 class="title">32.1. Tools for monitoring and diagnosing I/O and file system issues</h2></div></div></div><p class="_abstract _abstract">
				The following tools are available in Red&nbsp;Hat 
Enterprise&nbsp;Linux 9 for monitoring system performance and diagnosing
 performance problems related to I/O, file systems, and their 
configuration:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">vmstat</code> tool reports on processes, 
memory, paging, block I/O, interrupts, and CPU activity across the 
entire system. It can help administrators determine whether the I/O 
subsystem is responsible for any performance issues. If analysis with <code class="literal">vmstat</code> shows that the I/O subsystem is responsible for reduced performance, administrators can use the <code class="literal">iostat</code> tool to determine the responsible I/O device.
					</li><li class="listitem">
						<code class="literal">iostat</code> reports on I/O device load in your system. It is provided by the <code class="literal">sysstat</code> package.
					</li><li class="listitem">
						<code class="literal">blktrace</code> provides detailed information about how time is spent in the I/O subsystem. The companion utility <code class="literal">blkparse</code> reads the raw output from <code class="literal">blktrace</code> and produces a human readable summary of input and output operations recorded by <code class="literal">blktrace</code>.
					</li><li class="listitem"><p class="simpara">
						<code class="literal">btt</code> analyzes <code class="literal">blktrace</code>
 output and displays the amount of time that data spends in each area of
 the I/O stack, making it easier to spot bottlenecks in the I/O 
subsystem. This utility is provided as part of the <code class="literal">blktrace</code> package. Some of the important events tracked by the <code class="literal">blktrace</code> mechanism and analyzed by <code class="literal">btt</code> are:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								Queuing of the I/O event (<code class="literal">Q</code>)
							</li><li class="listitem">
								Dispatch of the I/O to the driver event (<code class="literal">D</code>)
							</li><li class="listitem">
								Completion of I/O event (<code class="literal">C</code>)
							</li></ul></div></li><li class="listitem">
						<code class="literal">iowatcher</code> can use the <code class="literal">blktrace</code>
 output to graph I/O over time. It focuses on the Logical Block Address 
(LBA) of disk I/O, throughput in megabytes per second, the number of 
seeks per second, and I/O operations per second. This can help to 
identify when you are hitting the operations-per-second limit of a 
device.
					</li><li class="listitem"><p class="simpara">
						BPF Compiler Collection (BCC) is a library, which facilitates the creation of the extended Berkeley Packet Filter (<code class="literal">eBPF</code>) programs. The <code class="literal">eBPF</code> programs are triggered on events, such as disk I/O, TCP connections, and process creations. The BCC tools are installed in the <code class="literal">/usr/share/bcc/tools/</code> directory. The following <code class="literal">bcc-tools</code> helps to analyze performance:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">biolatency</code> summarizes the latency 
in block device I/O (disk I/O) in histogram. This allows the 
distribution to be studied, including two modes for device cache hits 
and for cache misses, and latency outliers.
							</li><li class="listitem">
								<code class="literal">biosnoop</code> is a basic block I/O 
tracing tool for displaying each I/O event along with the issuing 
process ID, and the I/O latency. Using this tool, you can investigate 
disk I/O performance issues.
							</li><li class="listitem">
								<code class="literal">biotop</code> is used for block i/o operations in the kernel.
							</li><li class="listitem">
								<code class="literal">filelife</code> tool traces the <code class="literal">stat()</code> syscalls.
							</li><li class="listitem">
								<code class="literal">fileslower</code> traces slow synchronous file reads and writes.
							</li><li class="listitem">
								<code class="literal">filetop</code> displays file reads and writes by process.
							</li><li class="listitem"><p class="simpara">
								<code class="literal">ext4slower</code>, <code class="literal">nfsslower</code>, and <code class="literal">xfsslower</code> are tools that show file system operations slower than a certain threshold, which defaults to <code class="literal">10ms</code>.
							</p><p class="simpara">
								For more information, see the <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_monitoring_and_updating_the_kernel/analyzing-system-performance-with-bpf-compiler_collection_managing-monitoring-and-updating-the-kernel">Analyzing system performance with BPF Compiler Collection</a>.
							</p></li></ul></div></li><li class="listitem">
						<code class="literal">bpftace</code> is a tracing language for <code class="literal">eBPF</code>
 used for analyzing performance issues. It also provides trace utilities
 like BCC for system observation, which is useful for investigating I/O 
performance issues.
					</li><li class="listitem"><p class="simpara">
						The following <code class="literal">SystemTap</code> scripts may be useful in diagnosing storage or file system performance problems:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">disktop.stp</code>: Checks the status of reading or writing disk every 5 seconds and outputs the top ten entries during that period.
							</li><li class="listitem">
								<code class="literal">iotime.stp</code>: Prints the amount of time spent on read and write operations, and the number of bytes read and written.
							</li><li class="listitem">
								<code class="literal">traceio.stp</code>: Prints the top ten executable based on cumulative I/O traffic observed, every second.
							</li><li class="listitem">
								<code class="literal">traceio2.stp</code>: Prints the executable name and process identifier as reads and writes to the specified device occur.
							</li><li class="listitem">
								<code class="literal">Inodewatch.stp</code>: Prints the 
executable name and process identifier each time a read or write occurs 
to the specified inode on the specified major or minor device.
							</li><li class="listitem">
								<code class="literal">inodewatch2.stp</code>: Prints the 
executable name, process identifier, and attributes each time the 
attributes are changed on the specified inode on the specified major or 
minor device.
							</li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">vmstat(8)</code>, <code class="literal">iostat(1)</code>, <code class="literal">blktrace(8)</code>, <code class="literal">blkparse(1)</code>, <code class="literal">btt(1)</code>, <code class="literal">bpftrace</code>, and <code class="literal">iowatcher(1)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#analyzing-system-performance-with-bpf-compiler_collection_monitoring-and-managing-system-status-and-performance">Analyzing system performance with BPF Compiler Collection</a>
					</li></ul></div></section><section class="section" id="available-tuning-options-for-formatting-a-file-system_factors-affecting-i-o-and-file-system-performance"><div class="titlepage"><div><div><h2 class="title">32.2. Available tuning options for formatting a file system</h2></div></div></div><p class="_abstract _abstract">
				Some file system configuration decisions cannot be changed after the device is formatted.
			</p><p>
				The following are the options available before formatting a storage device:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Size</code></span></dt><dd>
							Create an appropriately-sized file system for your workload. 
Smaller file systems require less time and memory for file system 
checks. However, if a file system is too small, its performance suffers 
from high fragmentation.
						</dd><dt><span class="term"><code class="literal">Block size</code></span></dt><dd><p class="simpara">
							The block is the unit of work for the file system. The block size
 determines how much data can be stored in a single block, and therefore
 the smallest amount of data that is written or read at one time.
						</p><p class="simpara">
							The default block size is appropriate for most use cases. 
However, your file system performs better and stores data more 
efficiently if the block size or the size of multiple blocks is the same
 as or slightly larger than the amount of data that is typically read or
 written at one time. A small file still uses an entire block. Files can
 be spread across multiple blocks, but this can create additional 
runtime overhead.
						</p><p class="simpara">
							Additionally, some file systems are limited to a certain number 
of blocks, which in turn limits the maximum size of the file system. 
Block size is specified as part of the file system options when 
formatting a device with the <code class="literal">mkfs</code> command. The parameter that specifies the block size varies with the file system.
						</p></dd><dt><span class="term"><code class="literal">Geometry</code></span></dt><dd><p class="simpara">
							File system geometry is concerned with the distribution of data 
across a file system. If your system uses striped storage, like RAID, 
you can improve performance by aligning data and metadata with the 
underlying storage geometry when you format the device.
						</p><p class="simpara">
							Many devices export recommended geometry, which is then set 
automatically when the devices are formatted with a particular file 
system. If your device does not export these recommendations, or you 
want to change the recommended settings, you must specify geometry 
manually when you format the device with the <code class="literal">mkfs</code> command.
						</p><p class="simpara">
							The parameters that specify file system geometry vary with the file system.
						</p></dd><dt><span class="term"><code class="literal">External journals</code></span></dt><dd>
							Journaling file systems document the changes that will be made 
during a write operation in a journal file prior to the operation being 
executed. This reduces the likelihood that a storage device will become 
corrupted in the event of a system crash or power failure, and speeds up
 the recovery process.
						</dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Red&nbsp;Hat does not recommend using the external journals option.
				</p></div></div><p>
				Metadata-intensive workloads involve very frequent updates to the 
journal. A larger journal uses more memory, but reduces the frequency of
 write operations. Additionally, you can improve the seek time of a 
device with a metadata-intensive workload by placing its journal on 
dedicated storage that is as fast as, or faster than, the primary 
storage.
			</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
					Ensure that external journals are reliable. Losing an external 
journal device causes file system corruption. External journals must be 
created at format time, with journal devices being specified at mount 
time.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">mkfs(8)</code> and <code class="literal">mount(8)</code> man pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/managing_file_systems/assembly_overview-of-available-file-systems_managing-file-systems">Overview of available file systems</a>
					</li></ul></div></section><section class="section" id="available-tuning-options-for-mounting-a-file-system_factors-affecting-i-o-and-file-system-performance"><div class="titlepage"><div><div><h2 class="title">32.3. Available tuning options for mounting a file system</h2></div></div></div><p class="_abstract _abstract">
				The following are the options available to most file systems and can be specified as the device is mounted:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Access Time</code></span></dt><dd><p class="simpara">
							Every time a file is read, its metadata is updated with the time at which access occurred (<code class="literal">atime</code>). This involves additional write I/O. The <code class="literal">relatime</code> is the default <code class="literal">atime</code> setting for most file systems.
						</p><p class="simpara">
							However, if updating this metadata is time consuming, and if 
accurate access time data is not required, you can mount the file system
 with the <code class="literal">noatime</code> mount option. This disables updates to metadata when a file is read. It also enables <code class="literal">nodiratime</code> behavior, which disables updates to metadata when a directory is read.
						</p></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Disabling <code class="literal">atime</code> updates by using the <code class="literal">noatime mount</code> option can break applications that rely on them, for example, backup programs.
				</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Read-ahead</code></span></dt><dd><p class="simpara">
							<code class="literal">Read-ahead</code> behavior speeds up file 
access by pre-fetching data that is likely to be needed soon and loading
 it into the page cache, where it can be retrieved more quickly than if 
it were on disk. The higher the read-ahead value, the further ahead the 
system pre-fetches data.
						</p><p class="simpara">
							Red&nbsp;Hat Enterprise&nbsp;Linux attempts to set an appropriate
 read-ahead value based on what it detects about your file system. 
However, accurate detection is not always possible. For example, if a 
storage array presents itself to the system as a single LUN, the system 
detects the single LUN, and does not set the appropriate read-ahead 
value for an array.
						</p><p class="simpara">
							Workloads that involve heavy streaming of sequential I/O often 
benefit from high read-ahead values. The storage-related tuned profiles 
provided with Red&nbsp;Hat Enterprise&nbsp;Linux raise the read-ahead 
value, as does using LVM striping, but these adjustments are not always 
sufficient for all workloads.
						</p></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">mount(8)</code>, <code class="literal">xfs(5)</code>, and <code class="literal">ext4(5)</code> man pages
					</li></ul></div></section><section class="section" id="types-of-discarding-unused-blocks_factors-affecting-i-o-and-file-system-performance"><div class="titlepage"><div><div><h2 class="title">32.4. Types of discarding unused blocks</h2></div></div></div><p class="_abstract _abstract">
				Regularly discarding blocks that are not in use by the file system 
is a recommended practice for both solid-state disks and 
thinly-provisioned storage.
			</p><p>
				The following are the two methods of discarding unused blocks:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Batch discard</code></span></dt><dd>
							This type of discard is part of the <code class="literal">fstrim</code>
 command. It discards all unused blocks in a file system that match 
criteria specified by the administrator. Red&nbsp;Hat 
Enterprise&nbsp;Linux 9 supports batch discard on XFS and ext4 formatted
 devices that support physical discard operations.
						</dd><dt><span class="term"><code class="literal">Online discard</code></span></dt><dd><p class="simpara">
							This type of discard operation is configured at mount time with 
the discard option, and runs in real time without user intervention. 
However, it only discards blocks that are transitioning from used to 
free. Red&nbsp;Hat Enterprise&nbsp;Linux 9 supports online discard on 
XFS and ext4 formatted devices.
						</p><p class="simpara">
							Red&nbsp;Hat recommends batch discard, except where online 
discard is required to maintain performance, or where batch discard is 
not feasible for the system’s workload.
						</p></dd></dl></div><p>
				Pre-allocation marks disk space as being allocated to a file without
 writing any data into that space. This can be useful in limiting data 
fragmentation and poor read performance. Red&nbsp;Hat 
Enterprise&nbsp;Linux 9 supports pre-allocating space on XFS, ext4, and 
GFS2 file systems. Applications can also benefit from pre-allocating 
space by using the <code class="literal">fallocate(2) glibc</code> call.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">mount(8)</code> and <code class="literal">fallocate(2)</code> man pages
					</li></ul></div></section><section class="section" id="solid-state-disks-tuning-considerations_factors-affecting-i-o-and-file-system-performance"><div class="titlepage"><div><div><h2 class="title">32.5. Solid-state disks tuning considerations</h2></div></div></div><p class="_abstract _abstract">
				Solid-state disks (SSD) use NAND flash chips rather than rotating 
magnetic platters to store persistent data. SSD provides a constant 
access time for data across their full Logical Block Address range, and 
does not incur measurable seek costs like their rotating counterparts. 
They are more expensive per gigabyte of storage space and have a lesser 
storage density, but they also have lower latency and greater throughput
 than HDDs.
			</p><p>
				Performance generally degrades as the used blocks on an SSD approach
 the capacity of the disk. The degree of degradation varies by vendor, 
but all devices experience degradation in this circumstance. Enabling 
discard behavior can help to alleviate this degradation. For more 
information, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/setting-up-graphical-representation-of-pcp-metrics_monitoring-and-managing-system-status-and-performance#types-of-discarding-unused-blocks_factors-affecting-i-o-and-file-system-performance">Types of discarding unused blocks</a>.
			</p><p>
				The default I/O scheduler and virtual memory options are suitable 
for use with SSDs. Consider the following factors when configuring 
settings that can affect SSD performance:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">I/O Scheduler</code></span></dt><dd><p class="simpara">
							Any I/O scheduler is expected to perform well with most SSDs. 
However, as with any other storage type, Red&nbsp;Hat recommends 
benchmarking to determine the optimal configuration for a given 
workload. When using SSDs, Red&nbsp;Hat advises changing the I/O 
scheduler only for benchmarking particular workloads. For instructions 
on how to switch between I/O schedulers, see the <code class="literal">/usr/share/doc/kernel-version/Documentation/block/switching-sched.txt</code> file.
						</p><p class="simpara">
							For single queue HBA, the default I/O scheduler is <code class="literal">deadline</code>. For multiple queue HBA, the default I/O scheduler is <code class="literal">none</code>. For information about how to set the I/O scheduler, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/setting-the-disk-scheduler_monitoring-and-managing-system-status-and-performance">Setting the disk scheduler</a>.
						</p></dd><dt><span class="term"><code class="literal">Virtual Memory</code></span></dt><dd>
							Like the I/O scheduler, virtual memory (VM) subsystem requires no
 special tuning. Given the fast nature of I/O on SSD, try turning down 
the <code class="literal">vm_dirty_background_ratio</code> and <code class="literal">vm_dirty_ratio</code>
 settings, as increased write-out activity does not usually have a 
negative impact on the latency of other operations on the disk. However,
 this tuning can generate more overall I/O, and is therefore not 
generally recommended without workload-specific testing.
						</dd><dt><span class="term"><code class="literal">Swap</code></span></dt><dd>
							An SSD can also be used as a swap device, and is likely to produce good page-out and page-in performance.
						</dd></dl></div></section><section class="section" id="generic-block-device-tuning-parameters_factors-affecting-i-o-and-file-system-performance"><div class="titlepage"><div><div><h2 class="title">32.6. Generic block device tuning parameters</h2></div></div></div><p class="_abstract _abstract">
				The generic tuning parameters listed here are available in the <code class="literal">/sys/block/sdX/queue/</code> directory.
			</p><p>
				The following listed tuning parameters are separate from I/O scheduler tuning, and are applicable to all I/O schedulers:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">add_random</code></span></dt><dd>
							Some I/O events contribute to the entropy pool for the <code class="literal">/dev/random</code>. This parameter can be set to <code class="literal">0</code> if the overhead of these contributions become measurable.
						</dd><dt><span class="term"><code class="literal">iostats</code></span></dt><dd><p class="simpara">
							By default, <code class="literal">iostats</code> is enabled and the default value is <code class="literal">1</code>. Setting <code class="literal">iostats</code> value to <code class="literal">0</code> disables the gathering of I/O statistics for the device, which removes a small amount of overhead with the I/O path. Setting <code class="literal">iostats</code> to <code class="literal">0</code>
 might slightly improve performance for very high performance devices, 
such as certain NVMe solid-state storage devices. It is recommended to 
leave <code class="literal">iostats</code> enabled unless otherwise specified for the given storage model by the vendor.
						</p><p class="simpara">
							If you disable <code class="literal">iostats</code>, the I/O statistics for the device are no longer present within the <code class="literal">/proc/diskstats</code> file. The content of <code class="literal">/sys/diskstats</code> file is the source of I/O information for monitoring I/O tools, such as <code class="literal">sar</code> or <code class="literal">iostats</code>. Therefore, if you disable the <code class="literal">iostats</code> parameter for a device, the device is no longer present in the output of I/O monitoring tools.
						</p></dd><dt><span class="term"><code class="literal">max_sectors_kb</code></span></dt><dd><p class="simpara">
							Specifies the maximum size of an I/O request in kilobytes. The default value is <code class="literal">512</code>
 KB. The minimum value for this parameter is determined by the logical 
block size of the storage device. The maximum value for this parameter 
is determined by the value of the <code class="literal">max_hw_sectors_kb</code>.
						</p><p class="simpara">
							Red&nbsp;Hat recommends <code class="literal">max_sectors_kb</code> to always be a multiple of the optimal I/O size and the internal erase block size. Use a value of <code class="literal">logical_block_size</code> for either parameter if they are zero or not specified by the storage device.
						</p></dd><dt><span class="term"><code class="literal">nomerges</code></span></dt><dd>
							Most workloads benefit from request merging. However, disabling 
merges can be useful for debugging purposes. By default, the <code class="literal">nomerges</code> parameter is set to <code class="literal">0</code>, which enables merging. To disable simple one-hit merging, set <code class="literal">nomerges</code> to <code class="literal">1</code>. To disable all types of merging, set <code class="literal">nomerges</code> to <code class="literal">2</code>.
						</dd><dt><span class="term"><code class="literal">nr_requests</code></span></dt><dd>
							It is the maximum allowed number of the queued I/O. If the current I/O scheduler is <code class="literal">none</code>, this number can only be reduced; otherwise the number can be increased or reduced.
						</dd><dt><span class="term"><code class="literal">optimal_io_size</code></span></dt><dd>
							Some storage devices report an optimal I/O size through this 
parameter. If this value is reported, Red&nbsp;Hat recommends that 
applications issue I/O aligned to and in multiples of the optimal I/O 
size wherever possible.
						</dd><dt><span class="term"><code class="literal">read_ahead_kb</code></span></dt><dd><p class="simpara">
							Defines the maximum number of kilobytes that the operating system
 may read ahead during a sequential read operation. As a result, the 
necessary information is already present within the kernel page cache 
for the next sequential read, which improves read I/O performance.
						</p><p class="simpara">
							Device mappers often benefit from a high <code class="literal">read_ahead_kb</code> value. <code class="literal">128</code> KB for each device to be mapped is a good starting point, but increasing the <code class="literal">read_ahead_kb</code> value up to request queue’s <code class="literal">max_sectors_kb</code> of the disk might improve performance in application environments where sequential reading of large files takes place.
						</p></dd><dt><span class="term"><code class="literal">rotational</code></span></dt><dd>
							Some solid-state disks do not correctly advertise their 
solid-state status, and are mounted as traditional rotational disks. 
Manually set the <code class="literal">rotational</code> value to <code class="literal">0</code> to disable unnecessary seek-reducing logic in the scheduler.
						</dd><dt><span class="term"><code class="literal">rq_affinity</code></span></dt><dd>
							The default value of the <code class="literal">rq_affinity</code> is <code class="literal">1</code>.
 It completes the I/O operations on one CPU core, which is in the same 
CPU group of the issued CPU core. To perform completions only on the 
processor that issued the I/O request, set the <code class="literal">rq_affinity</code> to <code class="literal">2</code>. To disable the mentioned two abilities, set it to <code class="literal">0</code>.
						</dd><dt><span class="term"><code class="literal">scheduler</code></span></dt><dd>
							To set the scheduler or scheduler preference order for a particular storage device, edit the <code class="literal">/sys/block/<span class="emphasis"><em>devname</em></span>/queue/scheduler</code> file, where <span class="emphasis"><em>devname</em></span> is the name of the device you want to configure.
						</dd></dl></div></section></section><section class="chapter" id="assembly_using-systemd-to-manage-resources-used-by-applications_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 33. Using systemd to manage resources used by applications</h1></div></div></div><p>
			RHEL 9 moves the resource management settings from the process level to the application level by binding the system of <code class="literal">cgroup</code> hierarchies with the <code class="literal">systemd</code> unit tree. Therefore, you can manage the system resources with the <code class="literal">systemctl</code> command, or by modifying the <code class="literal">systemd</code> unit files.
		</p><p>
			To achieve this, <code class="literal">systemd</code> takes various configuration options from the unit files or directly via the <code class="literal">systemctl</code> command. Then <code class="literal">systemd</code> applies those options to specific process groups by utilizing the Linux kernel system calls and features like <code class="literal">cgroups</code> and <code class="literal">namespaces</code>.
		</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
				You can review the full set of configuration options for <code class="literal">systemd</code> in the following manual pages:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">systemd.resource-control(5)</code>
					</li><li class="listitem">
						<code class="literal">systemd.exec(5)</code>
					</li></ul></div></div></div><section class="section" id="proc_allocating-system-resources-using-systemd_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.1. Allocating system resources using systemd</h2></div></div></div><p>
				To modify the distribution of system resources, you can apply one or more of the following distribution models:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Weights</span></dt><dd><p class="simpara">
							You can distribute the resource by adding up the weights of all 
sub-groups and giving each sub-group the fraction matching its ratio 
against the sum.
						</p><p class="simpara">
							For example, if you have 10 cgroups, each with weight of value 
100, the sum is 1000. Each cgroup receives one tenth of the resource.
						</p><p class="simpara">
							Weight is usually used to distribute stateless resources. For example the&nbsp;<span class="emphasis"><em>CPUWeight=</em></span> option is an implementation of this resource distribution model.
						</p></dd><dt><span class="term">Limits</span></dt><dd><p class="simpara">
							A cgroup can consume up to the configured amount of the resource.
 The sum of sub-group limits can exceed the limit of the parent cgroup. 
Therefore it is possible to overcommit resources in this model.
						</p><p class="simpara">
							For example the&nbsp;<span class="emphasis"><em>MemoryMax=</em></span> option is an implementation of this resource distribution model.
						</p></dd><dt><span class="term">Protections</span></dt><dd><p class="simpara">
							You can set up a protected amount of a resource for a cgroup. If 
the resource usage is below the protection boundary, the kernel will try
 not to penalize this cgroup in favor of other cgroups that compete for 
the same resource. An overcommit is also possible.
						</p><p class="simpara">
							For example the <span class="emphasis"><em>MemoryLow=</em></span> option is an implementation of this resource distribution model.
						</p></dd><dt><span class="term">Allocations</span></dt><dd>
							Exclusive allocations of an absolute amount of a finite resource.
 An overcommit is not possible. An example of this resource type in 
Linux is the real-time budget.
						</dd><dt><span class="term">unit file option</span></dt><dd><p class="simpara">
							A setting for resource control configuration.
						</p><p class="simpara">
							For example, you can configure CPU resource with options like <span class="emphasis"><em>CPUAccounting=</em></span>, or <span class="emphasis"><em>CPUQuota=</em></span>. Similarly, you can configure memory or I/O resources with options like <span class="emphasis"><em>AllowedMemoryNodes=</em></span> and <span class="emphasis"><em>IOAccounting=</em></span>.
						</p></dd></dl></div><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					To change the required value of the unit file option of your service, you can adjust the value in the unit file, or use <code class="literal">systemctl</code> command:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Check the assigned values for the service of your choice.
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl show</strong></span> --property <span class="emphasis"><em>&lt;unit file option&gt;</em></span> <span class="emphasis"><em>&lt;service name&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
						Set the required value of the CPU time allocation policy option:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl set-property</strong></span> <span class="emphasis"><em>&lt;service name&gt;</em></span> <span class="emphasis"><em>&lt;unit file option&gt;</em></span>=<span class="emphasis"><em>&lt;value&gt;</em></span></pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Check the newly assigned values for the service of your choice.
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl show</strong></span> --property <span class="emphasis"><em>&lt;unit file option&gt;</em></span> <span class="emphasis"><em>&lt;service name&gt;</em></span></pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">systemd.resource-control(5)</code>, <code class="literal">systemd.exec(5)</code> manual pages
					</li></ul></div></section><section class="section" id="con_role-of-systemd-in-resource-management_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.2. Role of systemd in resource management</h2></div></div></div><p>
				The core function of <code class="literal">systemd</code> is service management and supervision. The <code class="literal">systemd</code>
 system and service manager ensures that managed services start at the 
right time and in the correct order during the boot process. The 
services have to run smoothly to use the underlying hardware platform 
optimally. Therefore, <code class="literal">systemd</code> also provides
 capabilities to define resource management policies, and to tune 
various options, which can improve the performance of the service.
			</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					In general, Red Hat recommends you use <code class="literal">systemd</code> for controlling the usage of system resources. You should manually configure the <code class="literal">cgroups</code> virtual file system only in special cases. For example, when you need to use <code class="literal">cgroup-v1</code> controllers that have no equivalents in <code class="literal">cgroup-v2</code> hierarchy.
				</p></div></div></section><section class="section" id="con_overview-of-systemd-hierarchy-for-cgroups_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.3. Overview of systemd hierarchy for cgroups</h2></div></div></div><p>
				On the backend, the <code class="literal">systemd</code> system and service manager makes use of the <code class="literal">slice</code>, the <code class="literal">scope</code> and the <code class="literal">service</code>
 units to organize and structure processes in the control groups. You 
can further modify this hierarchy by creating custom unit files or using
 the <code class="literal">systemctl</code> command. Also, <code class="literal">systemd</code> automatically mounts hierarchies for important kernel resource controllers at the <code class="literal">/sys/fs/cgroup/</code> directory.
			</p><p>
				Three <code class="literal">systemd</code> unit types are used for resource control:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Service</strong></span> - A process or a group of processes, which <code class="literal">systemd</code>
 started according to a unit configuration file. Services encapsulate 
the specified processes so that they can be started and stopped as one 
set. Services are named in the following way:
					</p><pre class="literallayout">&lt;<span class="emphasis"><em>name</em></span>&gt;.service</pre></li><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Scope</strong></span> - A 
group of externally created processes. Scopes encapsulate processes that
 are started and stopped by the arbitrary processes through the <code class="literal">fork()</code> function and then registered by <code class="literal">systemd</code> at runtime. For example, user sessions, containers, and virtual machines are treated as scopes. Scopes are named as follows:
					</p><pre class="literallayout">&lt;<span class="emphasis"><em>name</em></span>&gt;.scope</pre></li><li class="listitem"><p class="simpara">
						<span class="strong strong"><strong>Slice</strong></span> - A 
group of hierarchically organized units. Slices organize a hierarchy in 
which scopes and services are placed. The actual processes are contained
 in scopes or in services. Every name of a slice unit corresponds to the
 path to a location in the hierarchy. The dash ("-") character acts as a
 separator of the path components to a slice from the <code class="literal">-.slice</code> root slice. In the following example:
					</p><pre class="literallayout">&lt;<span class="emphasis"><em>parent-name</em></span>&gt;.slice</pre><p class="simpara">
						<code class="literal">parent-name.slice</code> is a sub-slice of <code class="literal">parent.slice</code>, which is a sub-slice of the <code class="literal">-.slice</code> root slice. <code class="literal">parent-name.slice</code> can have its own sub-slice named <code class="literal">parent-name-name2.slice</code>, and so on.
					</p></li></ul></div><p>
				The <code class="literal">service</code>, the <code class="literal">scope</code>, and the <code class="literal">slice</code>
 units directly map to objects in the control group hierarchy. When 
these units are activated, they map directly to control group paths 
built from the unit names.
			</p><p>
				The following is an abbreviated example of a control group hierarchy:
			</p><pre class="literallayout">Control group /:
-.slice
├─user.slice
│ ├─user-42.slice
│ │ ├─session-c1.scope
│ │ │ ├─ 967 gdm-session-worker [pam/gdm-launch-environment]
│ │ │ ├─1035 /usr/libexec/gdm-x-session gnome-session --autostart /usr/share/gdm/greeter/autostart
│ │ │ ├─1054 /usr/libexec/Xorg vt1 -displayfd 3 -auth /run/user/42/gdm/Xauthority -background none -noreset -keeptty -verbose 3
│ │ │ ├─1212 /usr/libexec/gnome-session-binary --autostart /usr/share/gdm/greeter/autostart
│ │ │ ├─1369 /usr/bin/gnome-shell
│ │ │ ├─1732 ibus-daemon --xim --panel disable
│ │ │ ├─1752 /usr/libexec/ibus-dconf
│ │ │ ├─1762 /usr/libexec/ibus-x11 --kill-daemon
│ │ │ ├─1912 /usr/libexec/gsd-xsettings
│ │ │ ├─1917 /usr/libexec/gsd-a11y-settings
│ │ │ ├─1920 /usr/libexec/gsd-clipboard
…​
├─init.scope
│ └─1 /usr/lib/systemd/systemd --switched-root --system --deserialize 18
└─system.slice
  ├─rngd.service
  │ └─800 /sbin/rngd -f
  ├─systemd-udevd.service
  │ └─659 /usr/lib/systemd/systemd-udevd
  ├─chronyd.service
  │ └─823 /usr/sbin/chronyd
  ├─auditd.service
  │ ├─761 /sbin/auditd
  │ └─763 /usr/sbin/sedispatch
  ├─accounts-daemon.service
  │ └─876 /usr/libexec/accounts-daemon
  ├─example.service
  │ ├─ 929 /bin/bash /home/jdoe/example.sh
  │ └─4902 sleep 1
  …​</pre><p>
				The example above shows that services and scopes contain processes 
and are placed in slices that do not contain processes of their own.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<span class="emphasis"><em><span class="citetitle citetitle"><a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/managing-system-services-with-systemctl_configuring-basic-system-settings">Configuring basic system settings</a></span></em></span> in Red Hat Enterprise Linux
					</li><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						<code class="literal">systemd.resource-control(5)</code>, <code class="literal">systemd.exec(5)</code>, <code class="literal">cgroups(7)</code>, <code class="literal">fork()</code>, <code class="literal">fork(2)</code> manual pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/managing_monitoring_and_updating_the_kernel/index#setting-limits-for-applications_managing-monitoring-and-updating-the-kernel">Understanding cgroups</a>
					</li></ul></div></section><section class="section" id="listing-systemd_units_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.4. Listing systemd units</h2></div></div></div><p class="_abstract _abstract">
				Use the <code class="literal">systemd</code> system and service manager to list its units.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						List all active units on the system with the <code class="literal"># systemctl</code> command. The terminal will return an output similar to the following example:
					</p><pre class="literallayout"><span class="strong strong"><strong># systemctl</strong></span>
UNIT                                                LOAD   ACTIVE SUB       DESCRIPTION
…​
init.scope                                          loaded active running   System and Service Manager
session-2.scope                                     loaded active running   Session 2 of user jdoe
abrt-ccpp.service                                   loaded active exited    Install ABRT coredump hook
abrt-oops.service                                   loaded active running   ABRT kernel log watcher
abrt-vmcore.service                                 loaded active exited    Harvest vmcores for ABRT
abrt-xorg.service                                   loaded active running   ABRT Xorg log watcher
…​
-.slice                                             loaded active active    Root Slice
machine.slice                                       loaded active active    Virtual Machine and Container Slice system-getty.slice                                                                       loaded active active    system-getty.slice
system-lvm2\x2dpvscan.slice                         loaded active active    system-lvm2\x2dpvscan.slice
system-sshd\x2dkeygen.slice                         loaded active active    system-sshd\x2dkeygen.slice
system-systemd\x2dhibernate\x2dresume.slice         loaded active active    system-systemd\x2dhibernate\x2dresume&gt;
system-user\x2druntime\x2ddir.slice                 loaded active active    system-user\x2druntime\x2ddir.slice
system.slice                                        loaded active active    System Slice
user-1000.slice                                     loaded active active    User Slice of UID 1000
user-42.slice                                       loaded active active    User Slice of UID 42
user.slice                                          loaded active active    User and Session Slice
…​</pre><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								<code class="literal">UNIT</code> - a name of a unit that also 
reflects the unit position in a control group hierarchy. The units 
relevant for resource control are a <span class="emphasis"><em>slice</em></span>, a <span class="emphasis"><em>scope</em></span>, and a <span class="emphasis"><em>service</em></span>.
							</li><li class="listitem">
								<code class="literal">LOAD</code> - indicates whether the unit 
configuration file was properly loaded. If the unit file failed to load,
 the field contains the state <span class="emphasis"><em>error</em></span> instead of <span class="emphasis"><em>loaded</em></span>. Other unit load states are: <span class="emphasis"><em>stub</em></span>, <span class="emphasis"><em>merged</em></span>, and <span class="emphasis"><em>masked</em></span>.
							</li><li class="listitem">
								<code class="literal">ACTIVE</code> - the high-level unit activation state, which is a generalization of <code class="literal">SUB</code>.
							</li><li class="listitem">
								<code class="literal">SUB</code> - the low-level unit activation state. The range of possible values depends on the unit type.
							</li><li class="listitem">
								<code class="literal">DESCRIPTION</code> - the description of the unit content and functionality.
							</li></ul></div></li><li class="listitem"><p class="simpara">
						List inactive units.
					</p><pre class="literallayout"># <span class="strong strong"><strong>systemctl --all</strong></span></pre></li><li class="listitem"><p class="simpara">
						Limit the amount of information in the output.
					</p><pre class="literallayout"># <span class="strong strong"><strong>systemctl --type service,masked</strong></span></pre><p class="simpara">
						The <code class="literal">--type</code> option requires a comma-separated list of unit types such as a <span class="emphasis"><em>service</em></span> and a <span class="emphasis"><em>slice</em></span>, or unit load states such as <span class="emphasis"><em>loaded</em></span> and <span class="emphasis"><em>masked</em></span>.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<span class="emphasis"><em><span class="citetitle citetitle"><a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/configuring_basic_system_settings/managing-system-services-with-systemctl_configuring-basic-system-settings">Configuring basic system settings</a></span></em></span> in RHEL
					</li><li class="listitem">
						The <code class="literal">systemd.resource-control(5)</code>, <code class="literal">systemd.exec(5)</code> manual pages
					</li></ul></div></section><section class="section" id="viewing-systemd-control-group-hierarchy_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.5. Viewing systemd control group hierarchy</h2></div></div></div><p class="_abstract _abstract">
				Display control groups (<code class="literal">cgroups</code>) hierarchy and processes running in specific <code class="literal">cgroups</code>.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Display the whole <code class="literal">cgroups</code> hierarchy on your system with the <code class="literal">systemd-cgls</code> command.
					</p><pre class="literallayout"># <span class="strong strong"><strong>systemd-cgls</strong></span>
Control group /:
-.slice
├─user.slice
│ ├─user-42.slice
│ │ ├─session-c1.scope
│ │ │ ├─ 965 gdm-session-worker [pam/gdm-launch-environment]
│ │ │ ├─1040 /usr/libexec/gdm-x-session gnome-session --autostart /usr/share/gdm/greeter/autostart
…​
├─init.scope
│ └─1 /usr/lib/systemd/systemd --switched-root --system --deserialize 18
└─system.slice
  …​
  ├─example.service
  │ ├─6882 /bin/bash /home/jdoe/example.sh
  │ └─6902 sleep 1
  ├─systemd-journald.service
    └─629 /usr/lib/systemd/systemd-journald
  …​</pre><p class="simpara">
						The example output returns the entire <code class="literal">cgroups</code> hierarchy, where the highest level is formed by <span class="emphasis"><em>slices</em></span>.
					</p></li><li class="listitem"><p class="simpara">
						Display the <code class="literal">cgroups</code> hierarchy filtered by a resource controller with the <code class="literal">systemd-cgls &lt;<span class="emphasis"><em>resource_controller</em></span>&gt;</code> command.
					</p><pre class="literallayout"># <span class="strong strong"><strong>systemd-cgls memory</strong></span>
Controller memory; Control group /:
├─1 /usr/lib/systemd/systemd --switched-root --system --deserialize 18
├─user.slice
│ ├─user-42.slice
│ │ ├─session-c1.scope
│ │ │ ├─ 965 gdm-session-worker [pam/gdm-launch-environment]
…​
└─system.slice
  |
  …​
  ├─chronyd.service
  │ └─844 /usr/sbin/chronyd
  ├─example.service
  │ ├─8914 /bin/bash /home/jdoe/example.sh
  │ └─8916 sleep 1
  …​</pre><p class="simpara">
						The example output of the above command lists the services that interact with the selected controller.
					</p></li><li class="listitem"><p class="simpara">
						Display detailed information about a certain unit and its part of the <code class="literal">cgroups</code> hierarchy with the <code class="literal">systemctl status &lt;<span class="emphasis"><em>system_unit</em></span>&gt;</code> command.
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl status example.service</strong></span>
● example.service - My example service
   Loaded: loaded (/usr/lib/systemd/system/example.service; enabled; vendor preset: disabled)
   Active: active (running) since Tue 2019-04-16 12:12:39 CEST; 3s ago
 Main PID: 17737 (bash)
    Tasks: 2 (limit: 11522)
   Memory: 496.0K (limit: 1.5M)
   CGroup: /system.slice/example.service
           ├─17737 /bin/bash /home/jdoe/example.sh
           └─17743 sleep 1
Apr 16 12:12:39 redhat systemd[1]: Started My example service.
Apr 16 12:12:39 redhat bash[17737]: The current time is Tue Apr 16 12:12:39 CEST 2019
Apr 16 12:12:40 redhat bash[17737]: The current time is Tue Apr 16 12:12:40 CEST 2019</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						The <code class="literal">systemd.resource-control(5)</code>, <code class="literal">cgroups(7)</code> manual pages
					</li></ul></div></section><section class="section" id="proc_viewing-cgroups-of-processes_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.6. Viewing cgroups of processes</h2></div></div></div><p>
				The following procedure describes how to learn which <span class="emphasis"><em>control group</em></span> (<code class="literal">cgroup</code>) a process belongs to. Then you can check the <code class="literal">cgroup</code> to learn which controllers and controller-specific configurations it uses.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To view which <code class="literal">cgroup</code> a process belongs to, run the <code class="literal"># cat proc/&lt;<span class="emphasis"><em>PID</em></span>&gt;/cgroup</code> command:
					</p><pre class="literallayout"># <span class="strong strong"><strong>cat /proc/2467/cgroup</strong></span>
0::/system.slice/example.service</pre><p class="simpara">
						The example output relates to a process of interest. In this case, it is a process identified by <code class="literal">PID 2467</code>, which belongs to the <code class="literal">example.service</code> unit. You can determine whether the process was placed in a correct control group as defined by the <code class="literal">systemd</code> unit file specifications.
					</p></li><li class="listitem"><p class="simpara">
						To display what controllers the <code class="literal">cgroup</code> utilizes and the respective configuration files, check the <code class="literal">cgroup</code> directory:
					</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/fs/cgroup/system.slice/example.service/cgroup.controllers</strong></span>
memory pids

# <span class="strong strong"><strong>ls /sys/fs/cgroup/system.slice/example.service/</strong></span>
cgroup.controllers
cgroup.events
…​
cpu.pressure
cpu.stat
io.pressure
memory.current
memory.events
…​
pids.current
pids.events
pids.max</pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					The version 1 hierarchy of <code class="literal">cgroups</code> uses a per-controller model. Therefore the output from the <code class="literal">/proc/<span class="emphasis"><em>PID</em></span>/cgroup</code> file shows, which <code class="literal">cgroups</code> under each controller the PID belongs to. You can find the respective <code class="literal">cgroups</code> under the controller directories at <code class="literal">/sys/fs/cgroup/<span class="emphasis"><em>&lt;controller_name&gt;</em></span>/</code>.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">cgroups(7)</code> manual page
					</li><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						Documentation in the <code class="literal">/usr/share/doc/kernel-doc-&lt;kernel_version&gt;/Documentation/admin-guide/cgroup-v2.rst</code> file (after installing the <code class="literal">kernel-doc</code> package)
					</li></ul></div></section><section class="section" id="monitoring-resource-consumption_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.7. Monitoring resource consumption</h2></div></div></div><p class="_abstract _abstract">
				View a list of currently running control groups (<code class="literal">cgroups</code>) and their resource consumption in real-time.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Display a dynamic account of currently running <code class="literal">cgroups</code> with the <code class="literal">systemd-cgtop</code> command.
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemd-cgtop</strong></span>
Control Group                            Tasks   %CPU   Memory  Input/s Output/s
/                                          607   29.8     1.5G        -        -
/system.slice                              125      -   428.7M        -        -
/system.slice/ModemManager.service           3      -     8.6M        -        -
/system.slice/NetworkManager.service         3      -    12.8M        -        -
/system.slice/accounts-daemon.service        3      -     1.8M        -        -
/system.slice/boot.mount                     -      -    48.0K        -        -
/system.slice/chronyd.service                1      -     2.0M        -        -
/system.slice/cockpit.socket                 -      -     1.3M        -        -
/system.slice/colord.service                 3      -     3.5M        -        -
/system.slice/crond.service                  1      -     1.8M        -        -
/system.slice/cups.service                   1      -     3.1M        -        -
/system.slice/dev-hugepages.mount            -      -   244.0K        -        -
/system.slice/dev-mapper-rhel\x2dswap.swap   -      -   912.0K        -        -
/system.slice/dev-mqueue.mount               -      -    48.0K        -        -
/system.slice/example.service                2      -     2.0M        -        -
/system.slice/firewalld.service              2      -    28.8M        -        -
...</pre><p class="simpara">
						The example output displays currently running <code class="literal">cgroups</code>
 ordered by their resource usage (CPU, memory, disk I/O load). The list 
refreshes every 1 second by default. Therefore, it offers a dynamic 
insight into the actual resource usage of each control group.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						The <code class="literal">systemd-cgtop(1)</code> manual page
					</li></ul></div></section><section class="section" id="proc_using-systemd-unit-files-to-set-limits-for-applications_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.8. Using systemd unit files to set limits for applications</h2></div></div></div><p>
				Each existing or running unit is supervised by the <code class="literal">systemd</code>, which also creates control groups for them. The units have configuration files in the <code class="literal">/usr/lib/systemd/system/</code>
 directory. You can manually modify the unit files to set limits, 
prioritize, or control access to hardware resources for groups of 
processes.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have the <code class="literal">root</code> privileges.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Modify the <code class="literal">/usr/lib/systemd/system/example.service</code> file to limit the memory usage of a service:
					</p><pre class="literallayout white-space-pre">…​
[Service]
MemoryMax=1500K
…​</pre><p class="simpara">
						The configuration above places a maximum memory limit, which the processes in a control group cannot exceed. The <code class="literal">example.service</code>
 service is part of such a control group which has imposed limitations. 
You can use suffixes K, M, G, or T to identify Kilobyte, Megabyte, 
Gigabyte, or Terabyte as a unit of measurement.
					</p></li><li class="listitem"><p class="simpara">
						Reload all unit configuration files:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl daemon-reload</strong></span></pre></li><li class="listitem"><p class="simpara">
						Restart the service:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl restart</strong></span> <span class="emphasis"><em>example.service</em></span></pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					You can review the full set of configuration options for <code class="literal">systemd</code> in the following manual pages:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">systemd.resource-control(5)</code>
						</li><li class="listitem">
							<code class="literal">systemd.exec(5)</code>
						</li></ul></div></div></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Check that the changes took effect:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>cat /sys/fs/cgroup/system.slice/example.service/memory.max</strong></span>
1536000</pre><p class="simpara">
						The example output shows that the memory consumption was limited at around 1,500 KB.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/managing_monitoring_and_updating_the_kernel/index#setting-limits-for-applications_managing-monitoring-and-updating-the-kernel">Understanding cgroups</a>
					</li><li class="listitem">
						<span class="emphasis"><em><span class="citetitle citetitle"><a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/configuring_basic_system_settings/index#managing-system-services-with-systemctl_configuring-basic-system-settings">Configuring basic system settings</a></span></em></span> in Red Hat Enterprise Linux
					</li><li class="listitem">
						<code class="literal">systemd.resource-control(5)</code>, <code class="literal">systemd.exec(5)</code>, <code class="literal">cgroups(7)</code> manual pages
					</li></ul></div></section><section class="section" id="proc_using-systemctl-command-to-set-limits-to-applications_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.9. Using systemctl command to set limits to applications</h2></div></div></div><p class="_abstract _abstract">
				CPU affinity settings help you restrict the access of a particular 
process to some CPUs. Effectively, the CPU scheduler never schedules the
 process to run on the CPU that is not in the affinity mask of the 
process.
			</p><p>
				The default CPU affinity mask applies to all services managed by <code class="literal">systemd</code>.
			</p><p>
				To configure CPU affinity mask for a particular <code class="literal">systemd</code> service, <code class="literal">systemd</code> provides <code class="literal">CPUAffinity=</code> both as a unit file option and a manager configuration option in the <code class="literal">/etc/systemd/system.conf</code> file.
			</p><p>
				The <span class="strong strong"><strong><code class="literal">CPUAffinity=</code> unit file option</strong></span> sets a list of CPUs or CPU ranges that are merged and used as the affinity mask.
			</p><p>
				After configuring CPU affinity mask for a particular <code class="literal">systemd</code> service, you must restart the service to apply the changes.
			</p><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					To set CPU affinity mask for a particular <code class="literal">systemd</code> service using the <span class="strong strong"><strong><code class="literal">CPUAffinity</code> unit file</strong></span> option:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Check the values of the <code class="literal">CPUAffinity</code> unit file option in the service of your choice:
					</p><pre class="literallayout white-space-pre">$ <span class="strong strong"><strong>systemctl show</strong></span> --property <span class="emphasis"><em>&lt;CPU affinity configuration option&gt;</em></span> <span class="emphasis"><em>&lt;service name&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
						As a root, set the required value of the <code class="literal">CPUAffinity</code> unit file option for the CPU ranges used as the affinity mask:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl set-property</strong></span> <span class="emphasis"><em>&lt;service name&gt;</em></span> CPUAffinity=<span class="emphasis"><em>&lt;value&gt;</em></span></pre></li><li class="listitem"><p class="simpara">
						Restart the service to apply the changes.
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl restart</strong></span> <span class="emphasis"><em>&lt;service name&gt;</em></span></pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					You can review the full set of configuration options for <code class="literal">systemd</code> in the following manual pages:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">systemd.resource-control(5)</code>
						</li><li class="listitem">
							<code class="literal">systemd.exec(5)</code>
						</li></ul></div></div></div></section><section class="section" id="proc_setting-global-default-cpu-affinity-through-manager-configuration_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.10. Setting global default CPU affinity through manager configuration</h2></div></div></div><p>
				The <span class="strong strong"><strong><code class="literal">CPUAffinity</code> option</strong></span> in the <code class="literal">/etc/systemd/system.conf</code>
 file defines an affinity mask for the process identification number 
(PID) 1 and all processes forked off of PID1. You can then override the <code class="literal">CPUAffinity</code> on a per-service basis.
			</p><p>
				To set default CPU affinity mask for all systemd services using the <span class="strong strong"><strong>manager configuration</strong></span> option:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Set the CPU numbers for the <code class="literal">CPUAffinity=</code> option in the <code class="literal">/etc/systemd/system.conf</code> file.
					</li><li class="listitem"><p class="simpara">
						Save the edited file and reload the <code class="literal">systemd</code> service:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl daemon-reload</strong></span></pre></li><li class="listitem">
						Reboot the server to apply the changes.
					</li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					You can review the full set of configuration options for <code class="literal">systemd</code> in the following manual pages:
				</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							<code class="literal">systemd.resource-control(5)</code>
						</li><li class="listitem">
							<code class="literal">systemd.exec(5)</code>
						</li></ul></div></div></div></section><section class="section" id="proc_configuring-numa-using-systemd_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.11. Configuring NUMA policies using systemd</h2></div></div></div><p class="_abstract _abstract">
				Non-uniform memory access (NUMA) is a computer memory subsystem 
design, in which the memory access time depends on the physical memory 
location relative to the processor.
			</p><p>
				Memory close to the CPU has lower latency (local memory) than memory
 that is local for a different CPU (foreign memory) or is shared between
 a set of CPUs.
			</p><p>
				In terms of the Linux kernel, NUMA policy governs where (for 
example, on which NUMA nodes) the kernel allocates physical memory pages
 for the process.
			</p><p>
				<code class="literal">systemd</code> provides unit file options <code class="literal">NUMAPolicy</code> and <code class="literal">NUMAMask</code> to control memory allocation policies for services.
			</p><div class="formalpara"><p class="title"><strong>Procedure</strong></p><p>
					To set the NUMA memory policy through the <span class="strong strong"><strong><code class="literal">NUMAPolicy</code> unit file</strong></span> option:
				</p></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Check the values of the <code class="literal">NUMAPolicy</code> unit file option in the service of your choice:
					</p><pre class="literallayout white-space-pre">$ <span class="strong strong"><strong>systemctl show --property <span class="emphasis"><em>&lt;NUMA policy configuration option&gt;</em></span> <span class="emphasis"><em>&lt;service name&gt;</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
						As a root, set the required policy type of the <code class="literal">NUMAPolicy</code> unit file option:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl set-property <span class="emphasis"><em>&lt;service name&gt;</em></span> NUMAPolicy=<span class="emphasis"><em>&lt;value&gt;</em></span></strong></span></pre></li><li class="listitem"><p class="simpara">
						Restart the service to apply the changes.
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl restart <span class="emphasis"><em>&lt;service name&gt;</em></span></strong></span></pre></li></ol></div><p>
				To set a global <code class="literal">NUMAPolicy</code> setting through the <span class="strong strong"><strong>manager configuration</strong></span> option:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						Search in the <code class="literal">/etc/systemd/system.conf</code> file for the <code class="literal">NUMAPolicy</code> option.
					</li><li class="listitem">
						Edit the policy type and save the file.
					</li><li class="listitem"><p class="simpara">
						Reload the <code class="literal">systemd</code> configuration:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemd daemon-reload</strong></span></pre></li><li class="listitem">
						Reboot the server.
					</li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					When you configure a strict NUMA policy, for example <code class="literal">bind</code>, make sure that you also appropriately set the <code class="literal">CPUAffinity=</code> unit file option.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#proc_using-systemctl-command-to-set-limits-to-applications_assembly_using-systemd-to-manage-resources-used-by-applications" title="33.9.&nbsp;Using systemctl command to set limits to applications">Using systemctl command to set limits to applications</a>
					</li><li class="listitem">
						The <code class="literal">systemd.resource-control(5)</code>, <code class="literal">systemd.exec(5)</code>, <code class="literal">set_mempolicy(2)</code> manual pages.
					</li></ul></div></section><section class="section" id="ref_numa-policy-configuration-options-with-systemd_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.12. NUMA policy configuration options for systemd</h2></div></div></div><p class="_abstract _abstract">
				Systemd provides the following options to configure the NUMA policy:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">NUMAPolicy</code></span></dt><dd><p class="simpara">
							Controls the NUMA memory policy of the executed processes. The following policy types are possible:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									default
								</li><li class="listitem">
									preferred
								</li><li class="listitem">
									bind
								</li><li class="listitem">
									interleave
								</li><li class="listitem">
									local
								</li></ul></div></dd><dt><span class="term"><code class="literal">NUMAMask</code></span></dt><dd><p class="simpara">
							Controls the NUMA node list which is associated with the selected NUMA policy.
						</p><p class="simpara">
							Note that the <code class="literal">NUMAMask</code> option is not required to be specified for the following policies:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									default
								</li><li class="listitem">
									local
								</li></ul></div><p class="simpara">
							For the preferred policy, the list specifies only a single NUMA node.
						</p></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">systemd.resource-control(5)</code>, <code class="literal">systemd.exec(5)</code>, and <code class="literal">set_mempolicy(2)</code> manual pages
					</li></ul></div></section><section class="section" id="creating-transient-control-groups_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.13. Creating transient cgroups using systemd-run command</h2></div></div></div><p class="_abstract _abstract">
				The transient <code class="literal">cgroups</code> set limits on resources consumed by a unit (service or scope) during its runtime.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To create a transient control group, use the <code class="literal">systemd-run</code> command in the following format:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemd-run</strong></span> --unit=<span class="emphasis"><em>&lt;name&gt;</em></span> --slice=<span class="emphasis"><em>&lt;name&gt;</em></span>.slice <span class="emphasis"><em>&lt;command&gt;</em></span></pre><p class="simpara">
						This command creates and starts a transient service or a scope unit and runs a custom command in such a unit.
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
								The <code class="literal">--unit=&lt;name&gt;</code> option gives a name to the unit. If <code class="literal">--unit</code> is not specified, the name is generated automatically.
							</li><li class="listitem">
								The <code class="literal">--slice=&lt;<span class="emphasis"><em>name</em></span>&gt;.slice</code> option makes your service or scope unit a member of a specified slice. Replace <code class="literal">&lt;<span class="emphasis"><em>name</em></span>&gt;.slice</code> with the name of an existing slice (as shown in the output of <code class="literal">systemctl -t slice</code>), or create a new slice by passing a unique name. By default, services and scopes are created as members of the <code class="literal">system.slice</code>.
							</li><li class="listitem"><p class="simpara">
								Replace <code class="literal">&lt;<span class="emphasis"><em>command</em></span>&gt;</code> with the command you wish to execute in the service or the scope unit.
							</p><p class="simpara">
								The following message is displayed to confirm that you created and started the service or the scope successfully:
							</p><pre class="literallayout white-space-pre"># Running as unit <span class="emphasis"><em>&lt;name&gt;</em></span>.service</pre></li></ul></div></li><li class="listitem"><p class="simpara">
						Optionally, keep the unit running after its processes finished to collect run-time information:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemd-run</strong></span> --unit=<span class="emphasis"><em>&lt;name&gt;</em></span> --slice=<span class="emphasis"><em>&lt;name&gt;</em></span>.slice --remain-after-exit <span class="emphasis"><em>&lt;command&gt;</em></span></pre><p class="simpara">
						The command creates and starts a transient service unit and runs a custom command in such a unit. The <code class="literal">--remain-after-exit</code> option ensures that the service keeps running after its processes have finished.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#understanding-control-groups_setting-limits-for-applications" title="34.1.&nbsp;Understanding control groups">Understanding control groups</a>
					</li><li class="listitem">
						<span class="emphasis"><em><span class="citetitle citetitle"><a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/configuring_basic_system_settings/index#managing-system-services-with-systemctl_configuring-basic-system-settings">Configuring basic system settings</a></span></em></span> in RHEL
					</li><li class="listitem">
						the <code class="literal">systemd-run(1)</code> manual page
					</li></ul></div></section><section class="section" id="removing-transient-control-groups_assembly_using-systemd-to-manage-resources-used-by-applications"><div class="titlepage"><div><div><h2 class="title">33.14. Removing transient control groups</h2></div></div></div><p class="_abstract _abstract">
				You can use the <code class="literal">systemd</code> system and service manager to remove transient control groups (<code class="literal">cgroups</code>) if you no longer need to limit, prioritize, or control access to hardware resources for groups of processes.
			</p><p>
				Transient <code class="literal">cgroups</code> are automatically released once all the processes that a service or a scope unit contains, finish.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To stop the service unit with all its processes, execute:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl stop</strong></span> <span class="emphasis"><em>name</em></span>.service</pre></li><li class="listitem"><p class="simpara">
						To terminate one or more of the unit processes, execute:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>systemctl kill</strong></span> <span class="emphasis"><em>name</em></span>.service --kill-who=<span class="emphasis"><em>PID,...</em></span> --signal=<span class="emphasis"><em>&lt;signal&gt;</em></span></pre><p class="simpara">
						The command above uses the <code class="literal">--kill-who</code>
 option to select process(es) from the control group you wish to 
terminate. To kill multiple processes at the same time, pass a 
comma-separated list of PIDs. The <code class="literal">--signal</code> option determines the type of POSIX signal to be sent to the specified processes. The default signal is <span class="emphasis"><em>SIGTERM</em></span>.
					</p></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#understanding-control-groups_setting-limits-for-applications" title="34.1.&nbsp;Understanding control groups">Understanding control groups</a>
					</li><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						<code class="literal">systemd.resource-control(5)</code>, <code class="literal">cgroups(7)</code> manual pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/managing_monitoring_and_updating_the_kernel/index#role-of-systemd-in-control-groups-version-1_setting-limits-for-applications">Role of systemd in control groups</a>
					</li><li class="listitem">
						<span class="emphasis"><em><span class="citetitle citetitle"><a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/configuring_basic_system_settings/index#managing-system-services-with-systemctl_configuring-basic-system-settings">Configuring basic system settings</a></span></em></span> in RHEL
					</li></ul></div></section></section><section class="chapter" id="setting-limits-for-applications_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 34. Understanding cgroups</h1></div></div></div><p class="_abstract _abstract">
			You can use the <span class="emphasis"><em>control groups</em></span> (<code class="literal">cgroups</code>)
 kernel functionality to set limits, prioritize or isolate the hardware 
resources of processes. This allows you to granularly control resource 
usage of applications to utilize them more efficiently.
		</p><section class="section" id="understanding-control-groups_setting-limits-for-applications"><div class="titlepage"><div><div><h2 class="title">34.1. Understanding control groups</h2></div></div></div><p class="_abstract _abstract">
				<span class="emphasis"><em>Control groups</em></span> is a Linux kernel feature that enables you to organize processes into hierarchically ordered groups - <code class="literal">cgroups</code>. The hierarchy (control groups tree) is defined by providing structure to <code class="literal">cgroups</code> virtual file system, mounted by default on the <code class="literal">/sys/fs/cgroup/</code> directory. The <code class="literal">systemd</code> system and service manager utilizes <code class="literal">cgroups</code> to organize all units and services that it governs. Alternatively, you can manage <code class="literal">cgroups</code> hierarchies manually by creating and removing sub-directories in the <code class="literal">/sys/fs/cgroup/</code> directory.
			</p><p>
				The resource controllers (a kernel component) then modify the behavior of processes in <code class="literal">cgroups</code>
 by limiting, prioritizing or allocating system resources, (such as CPU 
time, memory, network bandwidth, or various combinations) of those 
processes.
			</p><p>
				The added value of <code class="literal">cgroups</code> is process 
aggregation which enables division of hardware resources among 
applications and users. Thereby an increase in overall efficiency, 
stability and security of users' environment can be achieved.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Control groups version 1</span></dt><dd><p class="simpara">
							<span class="emphasis"><em>Control groups version 1</em></span> (<code class="literal">cgroups-v1</code>)
 provide a per-resource controller hierarchy. It means that each 
resource, such as CPU, memory, I/O, and so on, has its own control group
 hierarchy. It is possible to combine different control group 
hierarchies in a way that one controller can coordinate with another one
 in managing their respective resources. However, the two controllers 
may belong to different process hierarchies, which does not permit their
 proper coordination.
						</p><p class="simpara">
							The <code class="literal">cgroups-v1</code> controllers were 
developed across a large time span and as a result, the behavior and 
naming of their control files is not uniform.
						</p></dd><dt><span class="term">Control groups version 2</span></dt><dd><p class="simpara">
							The problems with controller coordination, which stemmed from hierarchy flexibility, led to the development of <span class="emphasis"><em>control groups version 2</em></span>.
						</p><p class="simpara">
							<span class="emphasis"><em>Control groups version 2</em></span> (<code class="literal">cgroups-v2</code>) provides a single control group hierarchy against which all resource controllers are mounted.
						</p><p class="simpara">
							The control file behavior and naming is consistent among different controllers.
						</p></dd></dl></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					RHEL 9, by default, mounts and utilizes <code class="literal">cgroups-v2</code>.
				</p></div></div><p>
				This sub-section was based on a Devconf.cz 2019 presentation.<a href="#ftn.idm140611467237344" class="footnote"><sup class="footnote" id="idm140611467237344">[1]</sup></a>
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						<code class="literal">cgroups(7)</code> manual page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/labs/rhcb/RHEL-9.0/kernel-5.14.0-1.7.1.el9/source/Documentation/admin-guide/cgroup-v1">cgroups-v1</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/labs/rhcb/RHEL-9.0/kernel-5.14.0-1.7.1.el9/source/blob/Documentation/admin-guide/cgroup-v2.rst">cgroups-v2</a>
					</li></ul></div></section><section class="section" id="what-kernel-resource-controllers-are_setting-limits-for-applications"><div class="titlepage"><div><div><h2 class="title">34.2. What are kernel resource controllers</h2></div></div></div><p class="_abstract _abstract">
				The functionality of control groups is enabled by kernel resource controllers. RHEL 9 supports various controllers for <span class="emphasis"><em>control groups version 1</em></span> (<code class="literal">cgroups-v1</code>) and <span class="emphasis"><em>control groups version 2</em></span> (<code class="literal">cgroups-v2</code>).
			</p><p>
				A resource controller, also called a control group subsystem, is a 
kernel subsystem that represents a single resource, such as CPU time, 
memory, network bandwidth or disk I/O. The Linux kernel provides a range
 of resource controllers that are mounted automatically by the <code class="literal">systemd</code> system and service manager. Find a list of currently mounted resource controllers in the <code class="literal">/proc/cgroups</code> file.
			</p><p>
				The following controllers are available for <code class="literal">cgroups-v1</code>:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">blkio</code> - can set limits on input/output access to and from block devices.
					</li><li class="listitem">
						<code class="literal">cpu</code> - can adjust the parameters of 
the Completely Fair Scheduler (CFS) scheduler for control group’s tasks.
 It is mounted together with the <code class="literal">cpuacct</code> controller on the same mount.
					</li><li class="listitem">
						<code class="literal">cpuacct</code> - creates automatic reports on CPU resources used by tasks in a control group. It is mounted together with the <code class="literal">cpu</code> controller on the same mount.
					</li><li class="listitem">
						<code class="literal">cpuset</code> - can be used to restrict 
control group tasks to run only on a specified subset of CPUs and to 
direct the tasks to use memory only on specified memory nodes.
					</li><li class="listitem">
						<code class="literal">devices</code> - can control access to devices for tasks in a control group.
					</li><li class="listitem">
						<code class="literal">freezer</code> - can be used to suspend or resume tasks in a control group.
					</li><li class="listitem">
						<code class="literal">memory</code> - can be used to set limits on
 memory use by tasks in a control group and generates automatic reports 
on memory resources used by those tasks.
					</li><li class="listitem">
						<code class="literal">net_cls</code> - tags network packets with a class identifier (<code class="literal">classid</code>) that enables the Linux traffic controller (the <code class="literal">tc</code> command) to identify packets that originate from a particular control group task. A subsystem of <code class="literal">net_cls</code>, the <code class="literal">net_filter</code> (iptables), can also use this tag to perform actions on such packets. The <code class="literal">net_filter</code> tags network sockets with a firewall identifier (<code class="literal">fwid</code>) that allows the Linux firewall (through <code class="literal">iptables</code> command) to identify packets originating from a particular control group task.
					</li><li class="listitem">
						<code class="literal">net_prio</code> - sets the priority of network traffic.
					</li><li class="listitem">
						<code class="literal">pids</code> - can set limits for a number of processes and their children in a control group.
					</li><li class="listitem">
						<code class="literal">perf_event</code> - can group tasks for monitoring by the <code class="literal">perf</code> performance monitoring and reporting utility.
					</li><li class="listitem">
						<code class="literal">rdma</code> - can set limits on Remote Direct Memory Access/InfiniBand specific resources in a control group.
					</li><li class="listitem">
						<code class="literal">hugetlb</code> - can be used to limit the usage of large size virtual memory pages by tasks in a control group.
					</li></ul></div><p>
				The following controllers are available for <code class="literal">cgroups-v2</code>:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">io</code> - A follow-up to <code class="literal">blkio</code> of <code class="literal">cgroups-v1</code>.
					</li><li class="listitem">
						<code class="literal">memory</code> - A follow-up to <code class="literal">memory</code> of <code class="literal">cgroups-v1</code>.
					</li><li class="listitem">
						<code class="literal">pids</code> - Same as <code class="literal">pids</code> in <code class="literal">cgroups-v1</code>.
					</li><li class="listitem">
						<code class="literal">rdma</code> - Same as <code class="literal">rdma</code> in <code class="literal">cgroups-v1</code>.
					</li><li class="listitem">
						<code class="literal">cpu</code> - A follow-up to <code class="literal">cpu</code> and <code class="literal">cpuacct</code> of <code class="literal">cgroups-v1</code>.
					</li><li class="listitem">
						<code class="literal">cpuset</code> - Supports only the core functionality (<code class="literal">cpus{,.effective}</code>, <code class="literal">mems{,.effective}</code>) with a new partition feature.
					</li><li class="listitem">
						<code class="literal">perf_event</code> - Support is inherent, no explicit control file. You can specify a <code class="literal">v2 cgroup</code> as a parameter to the <code class="literal">perf</code> command that will profile all the tasks within that <code class="literal">cgroup</code>.
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					A resource controller can be used either in a <code class="literal">cgroups-v1</code> hierarchy or a <code class="literal">cgroups-v2</code> hierarchy, not simultaneously in both.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">cgroups(7)</code> manual page
					</li><li class="listitem">
						Documentation in <code class="literal">/usr/share/doc/kernel-doc-&lt;kernel_version&gt;/Documentation/cgroups-v1/</code> directory (after installing the <code class="literal">kernel-doc</code> package).
					</li></ul></div></section><section class="section" id="what-namespaces-are_setting-limits-for-applications"><div class="titlepage"><div><div><h2 class="title">34.3. What are namespaces</h2></div></div></div><p class="_abstract _abstract">
				Namespaces are one of the most important methods for organizing and identifying software objects.
			</p><p>
				A namespace wraps a global system resource (for example a mount 
point, a network device, or a hostname) in an abstraction that makes it 
appear to processes within the namespace that they have their own 
isolated instance of the global resource. One of the most common 
technologies that utilize namespaces are containers.
			</p><p>
				Changes to a particular global resource are visible only to 
processes in that namespace and do not affect the rest of the system or 
other namespaces.
			</p><p>
				To inspect which namespaces a process is a member of, you can check the symbolic links in the <code class="literal">/proc/&lt;<span class="emphasis"><em>PID</em></span>&gt;/ns/</code> directory.
			</p><p>
				The following table shows supported namespaces and resources which they isolate:
			</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="vxk30k5" id="rh-table--vxk30k5" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 50%; " class="col_1"><!--Empty--><col style="width: 50%; " class="col_2"><!--Empty--></colgroup><thead><tr><th id="idm140611467562656" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Namespace</th><th id="idm140611467561568" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Isolates</th></tr></thead><tbody><tr><td headers="idm140611467562656" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								<span class="strong strong"><strong>Mount</strong></span>
							</p>
							 </td><td headers="idm140611467561568" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
								Mount points
							</p>
							 </td></tr><tr><td headers="idm140611467562656" data-row="3" data-col="1" class="content--sm" valign="top" align="left"> <p>
								<span class="strong strong"><strong>UTS</strong></span>
							</p>
							 </td><td headers="idm140611467561568" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
								Hostname and NIS domain name
							</p>
							 </td></tr><tr><td headers="idm140611467562656" data-row="4" data-col="1" class="content--sm" valign="top" align="left"> <p>
								<span class="strong strong"><strong>IPC</strong></span>
							</p>
							 </td><td headers="idm140611467561568" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
								System V IPC, POSIX message queues
							</p>
							 </td></tr><tr><td headers="idm140611467562656" data-row="5" data-col="1" class="content--sm" valign="top" align="left"> <p>
								<span class="strong strong"><strong>PID</strong></span>
							</p>
							 </td><td headers="idm140611467561568" data-row="5" data-col="2" class="content--md" valign="top" align="left"> <p>
								Process IDs
							</p>
							 </td></tr><tr><td headers="idm140611467562656" data-row="6" data-col="1" class="content--md" valign="top" align="left"> <p>
								<span class="strong strong"><strong>Network</strong></span>
							</p>
							 </td><td headers="idm140611467561568" data-row="6" data-col="2" class="content--md" valign="top" align="left"> <p>
								Network devices, stacks, ports, etc
							</p>
							 </td></tr><tr><td headers="idm140611467562656" data-row="7" data-col="1" class="content--md" valign="top" align="left"> <p>
								<span class="strong strong"><strong>User</strong></span>
							</p>
							 </td><td headers="idm140611467561568" data-row="7" data-col="2" class="content--md" valign="top" align="left"> <p>
								User and group IDs
							</p>
							 </td></tr><tr><td headers="idm140611467562656" data-row="8" data-col="1" class="content--md" valign="top" align="left"> <p>
								<span class="strong strong"><strong>Control groups</strong></span>
							</p>
							 </td><td headers="idm140611467561568" data-row="8" data-col="2" class="content--md" valign="top" align="left"> <p>
								Control group root directory
							</p>
							 </td></tr></tbody></table></rh-table><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">namespaces(7)</code> and <code class="literal">cgroup_namespaces(7)</code> manual pages
					</li><li class="listitem">
						<a class="link" href="#understanding-control-groups_setting-limits-for-applications" title="34.1.&nbsp;Understanding control groups">Understanding control groups</a>
					</li></ul></div></section><div class="footnotes"><br><hr width="100" align="left"><div id="ftn.idm140611467237344" class="footnote"><div class="para"><a href="#idm140611467237344" class="simpara"><sup class="simpara">[1] </sup></a>
					Linux Control Group v2 - An Introduction, Devconf.cz 2019 presentation by Waiman Long
				</div></div></div></section><section class="chapter" id="assembly_improving-system-performance-with-zswap_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 35. Improving system performance with zswap</h1></div></div></div><p class="_abstract _abstract">
			You can improve system performance by enabling the <code class="literal">zswap</code> kernel feature.
		</p><section class="section" id="con_what-is-zswap_assembly_improving-system-performance-with-zswap"><div class="titlepage"><div><div><h2 class="title">35.1. What is zswap</h2></div></div></div><p class="_abstract _abstract">
				<code class="literal">zswap</code> is a kernel feature that provides a compressed RAM cache for swap pages, which can lead to system performance improvement.
			</p><p>
				The mechanism works as follows: <code class="literal">zswap</code> 
takes pages that are in the process of being swapped out and attempts to
 compress them into a dynamically allocated RAM-based memory pool. When 
the pool becomes full or the RAM becomes exhausted, <code class="literal">zswap</code>
 evicts pages from compressed cache on an LRU basis (least recently 
used) to the backing swap device. After the page has been decompressed 
into the swap cache, <code class="literal">zswap</code> frees the compressed version in the pool.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">The benefits of <code class="literal">zswap</code></span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									significant I/O reduction
								</li><li class="listitem">
									significant improvement of workload performance
								</li></ul></div></dd></dl></div><p>
				In Red Hat Enterprise Linux 9, <code class="literal">zswap</code> is enabled by default.
			</p><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/6888781">What is Zswap?</a>
					</li></ul></div></section><section class="section" id="proc_enabling-zswap-at-runtime_assembly_improving-system-performance-with-zswap"><div class="titlepage"><div><div><h2 class="title">35.2. Enabling zswap at runtime</h2></div></div></div><p class="_abstract _abstract">
				You can enable the <code class="literal">zswap</code> feature at system runtime using the <code class="literal">sysfs</code> interface.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have root permissions.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Enable <code class="literal">zswap</code>:
					</p><pre class="literallayout"># <span class="strong strong"><strong>echo 1 &gt; /sys/module/zswap/parameters/enabled</strong></span></pre></li></ul></div><div class="itemizedlist"><p class="title"><strong>Verification step</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify that <code class="literal">zswap</code> is enabled:
					</p><pre class="literallayout"># <span class="strong strong"><strong>grep -r . /sys/kernel/debug/zswap</strong></span>

duplicate_entry:0
pool_limit_hit:13422200
pool_total_size:6184960 (pool size in total in pages)
reject_alloc_fail:5
reject_compress_poor:0
reject_kmemcache_fail:0
reject_reclaim_fail:13422200
stored_pages:4251 (pool size after compression)
written_back_pages:0</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/6889221">How to enable Zswap feature?</a>
					</li></ul></div></section><section class="section" id="proc_enabling-zswap-permanently_assembly_improving-system-performance-with-zswap"><div class="titlepage"><div><div><h2 class="title">35.3. Enabling zswap permanently</h2></div></div></div><p class="_abstract _abstract">
				You can enable the <code class="literal">zswap</code> feature permanently by providing the <code class="literal">zswap.enabled=1</code> kernel command-line parameter.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have root permissions.
					</li><li class="listitem">
						The <code class="literal">grubby</code> or <code class="literal">zipl</code> utility is installed on your system.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Enable <code class="literal">zswap</code> permanently:
					</p><pre class="literallayout"># <span class="strong strong"><strong>grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args="zswap.enabled=1"</strong></span></pre></li><li class="listitem">
						Reboot the system for the changes to take effect.
					</li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Verify that <code class="literal">zswap</code> is enabled:
					</p><pre class="literallayout"># <span class="strong strong"><strong>cat /proc/cmdline</strong></span>

BOOT_IMAGE=(hd0,msdos1)/vmlinuz-5.14.0-70.5.1.el9_0.x86_64
root=/dev/mapper/rhel-root ro crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M
resume=/dev/mapper/rhel-swap rd.lvm.lv=rhel/root
rd.lvm.lv=rhel/swap rhgb quiet
<span class="strong strong"><strong>zswap.enabled=1</strong></span></pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="https://access.redhat.com/solutions/6889221">How to enable Zswap feature?</a>
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/managing_monitoring_and_updating_the_kernel/index#configuring-kernel-command-line-parameters_managing-monitoring-and-updating-the-kernel">Configuring kernel command-line parameters</a>
					</li></ul></div></section></section><section class="chapter" id="assembly_using-cgroupfs-to-manually-manage-cgroups_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 36. Using cgroupfs to manually manage cgroups</h1></div></div></div><p>
			You can manage <code class="literal">cgroup</code> hierarchies on your system by creating directories on the <code class="literal">cgroupfs</code> virtual file system. The file system is mounted by default on the <code class="literal">/sys/fs/cgroup/</code> directory and you can specify desired configurations in dedicated control files.
		</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
				In general, Red Hat recommends you use <code class="literal">systemd</code> for controlling the usage of system resources. You should manually configure the <code class="literal">cgroups</code> virtual file system only in special cases. For example, when you need to use <code class="literal">cgroup-v1</code> controllers that have no equivalents in <code class="literal">cgroup-v2</code> hierarchy.
			</p></div></div><section class="section" id="proc_creating-cgroups-and-enabling-controllers-in-cgroups-v2-file-system_assembly_using-cgroupfs-to-manually-manage-cgroups"><div class="titlepage"><div><div><h2 class="title">36.1. Creating cgroups and enabling controllers in cgroups-v2 file system</h2></div></div></div><p>
				You can manage the <span class="emphasis"><em>control groups</em></span> (<code class="literal">cgroups</code>) by creating or removing directories and by writing to files in the <code class="literal">cgroups</code> virtual file system. The file system is by default mounted on the <code class="literal">/sys/fs/cgroup/</code> directory. To use settings from the <code class="literal">cgroups</code> controllers, you also need to enable the desired controllers for child <code class="literal">cgroups</code>. The root <code class="literal">cgroup</code> has, by default, enabled the <code class="literal">memory</code> and <code class="literal">pids</code> controllers for its child <code class="literal">cgroups</code>. Therefore, Red Hat recommends to create at least two levels of child <code class="literal">cgroups</code> inside the <code class="literal">/sys/fs/cgroup/</code> root <code class="literal">cgroup</code>. This way you optionally remove the <code class="literal">memory</code> and <code class="literal">pids</code> controllers from the child <code class="literal">cgroups</code> and maintain better organizational clarity of <code class="literal">cgroup</code> files.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have root permissions.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Create the <code class="literal">/sys/fs/cgroup/Example/</code> directory:
					</p><pre class="literallayout"># <span class="strong strong"><strong>mkdir /sys/fs/cgroup/Example/</strong></span></pre><p class="simpara">
						The <code class="literal">/sys/fs/cgroup/Example/</code> directory defines a child group. When you create the <code class="literal">/sys/fs/cgroup/Example/</code> directory, some <code class="literal">cgroups-v2</code> interface files are automatically created in the directory. The <code class="literal">/sys/fs/cgroup/Example/</code> directory contains also controller-specific files for the <code class="literal">memory</code> and <code class="literal">pids</code> controllers.
					</p></li><li class="listitem"><p class="simpara">
						Optionally, inspect the newly created child control group:
					</p><pre class="literallayout"># <span class="strong strong"><strong>ll /sys/fs/cgroup/Example/</strong></span>
-r—​r—​r--. 1 root root 0 Jun  1 10:33 cgroup.controllers
-r—​r—​r--. 1 root root 0 Jun  1 10:33 cgroup.events
-rw-r—​r--. 1 root root 0 Jun  1 10:33 cgroup.freeze
-rw-r—​r--. 1 root root 0 Jun  1 10:33 cgroup.procs
…​
-rw-r—​r--. 1 root root 0 Jun  1 10:33 cgroup.subtree_control
-r—​r—​r--. 1 root root 0 Jun  1 10:33 memory.events.local
-rw-r—​r--. 1 root root 0 Jun  1 10:33 memory.high
-rw-r—​r--. 1 root root 0 Jun  1 10:33 memory.low
…​
-r—​r—​r--. 1 root root 0 Jun  1 10:33 pids.current
-r—​r—​r--. 1 root root 0 Jun  1 10:33 pids.events
-rw-r—​r--. 1 root root 0 Jun  1 10:33 pids.max</pre><p class="simpara">
						The example output shows general <code class="literal">cgroup</code> control interface files such as <code class="literal">cgroup.procs</code> or <code class="literal">cgroup.controllers</code>. These files are common to all control groups, regardless of enabled controllers.
					</p><p class="simpara">
						The files such as <code class="literal">memory.high</code> and <code class="literal">pids.max</code> relate to the <code class="literal">memory</code> and <code class="literal">pids</code> controllers, which are in the root control group (<code class="literal">/sys/fs/cgroup/</code>), and are enabled by default by <code class="literal">systemd</code>.
					</p><p class="simpara">
						By default, the newly created child group inherits all settings from the parent <code class="literal">cgroup</code>. In this case, there are no limits from the root <code class="literal">cgroup</code>.
					</p></li><li class="listitem"><p class="simpara">
						Verify that the desired controllers are available in the <code class="literal">/sys/fs/cgroup/cgroup.controllers</code> file:
					</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/fs/cgroup/cgroup.controllers</strong></span>
cpuset cpu io memory hugetlb pids rdma</pre></li><li class="listitem"><p class="simpara">
						Enable the desired controllers. In this example it is <code class="literal">cpu</code> and <code class="literal">cpuset</code> controllers:
					</p><pre class="literallayout"># <span class="strong strong"><strong>echo "+cpu" &gt;&gt; /sys/fs/cgroup/cgroup.subtree_control</strong></span>
# <span class="strong strong"><strong>echo "+cpuset" &gt;&gt; /sys/fs/cgroup/cgroup.subtree_control</strong></span></pre><p class="simpara">
						These commands enable the <code class="literal">cpu</code> and <code class="literal">cpuset</code> controllers for the immediate child groups of the <code class="literal">/sys/fs/cgroup/</code> root control group. Including the newly created <code class="literal">Example</code> control group. A <span class="emphasis"><em>child group</em></span> is where you can specify processes and apply control checks to each of the processes based on your criteria.
					</p><p class="simpara">
						Users can read the contents of the <code class="literal">cgroup.subtree_control</code> file at any level to get an idea of what controllers are going to be available for enablement in the immediate child group.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							By default, the <code class="literal">/sys/fs/cgroup/cgroup.subtree_control</code> file in the root control group contains <code class="literal">memory</code> and <code class="literal">pids</code> controllers.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Enable the desired controllers for child <code class="literal">cgroups</code> of the <code class="literal">Example</code> control group:
					</p><pre class="literallayout"># <span class="strong strong"><strong>echo "+cpu +cpuset" &gt;&gt; /sys/fs/cgroup/Example/cgroup.subtree_control</strong></span></pre><p class="simpara">
						This command ensures that the immediate child control group will <span class="emphasis"><em>only</em></span> have controllers relevant to regulate the CPU time distribution - not to <code class="literal">memory</code> or <code class="literal">pids</code> controllers.
					</p></li><li class="listitem"><p class="simpara">
						Create the <code class="literal">/sys/fs/cgroup/Example/tasks/</code> directory:
					</p><pre class="literallayout"># <span class="strong strong"><strong>mkdir /sys/fs/cgroup/Example/tasks/</strong></span></pre><p class="simpara">
						The <code class="literal">/sys/fs/cgroup/Example/tasks/</code> directory defines a child group with files that relate purely to <code class="literal">cpu</code> and <code class="literal">cpuset</code> controllers. You can now assign processes to this control group and utilize <code class="literal">cpu</code> and <code class="literal">cpuset</code> controller options for your processes.
					</p></li><li class="listitem"><p class="simpara">
						Optionally, inspect the child control group:
					</p><pre class="literallayout"># <span class="strong strong"><strong>ll /sys/fs/cgroup/Example/tasks</strong></span>
-r—​r—​r--. 1 root root 0 Jun  1 11:45 cgroup.controllers
-r—​r—​r--. 1 root root 0 Jun  1 11:45 cgroup.events
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cgroup.freeze
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cgroup.max.depth
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cgroup.max.descendants
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cgroup.procs
-r—​r—​r--. 1 root root 0 Jun  1 11:45 cgroup.stat
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cgroup.subtree_control
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cgroup.threads
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cgroup.type
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cpu.max
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cpu.pressure
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cpuset.cpus
-r—​r—​r--. 1 root root 0 Jun  1 11:45 cpuset.cpus.effective
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cpuset.cpus.partition
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cpuset.mems
-r—​r—​r--. 1 root root 0 Jun  1 11:45 cpuset.mems.effective
-r—​r—​r--. 1 root root 0 Jun  1 11:45 cpu.stat
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cpu.weight
-rw-r—​r--. 1 root root 0 Jun  1 11:45 cpu.weight.nice
-rw-r—​r--. 1 root root 0 Jun  1 11:45 io.pressure
-rw-r—​r--. 1 root root 0 Jun  1 11:45 memory.pressure</pre></li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					The <code class="literal">cpu</code> controller is only activated 
if the relevant child control group has at least 2 processes which 
compete for time on a single CPU.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Optional: confirm that you have created a new <code class="literal">cgroup</code> with only the desired controllers active:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>cat /sys/fs/cgroup/Example/tasks/cgroup.controllers</strong></span>
cpuset cpu</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#understanding-control-groups_setting-limits-for-applications" title="34.1.&nbsp;Understanding control groups">Understanding control groups</a>
					</li><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						<a class="link" href="#proc_mounting-cgroups-v1_assembly_using-cgroupfs-to-manually-manage-cgroups" title="36.3.&nbsp;Mounting cgroups-v1">Mounting cgroups-v1</a>
					</li><li class="listitem">
						<code class="literal">cgroups(7)</code>, <code class="literal">sysfs(5)</code> manual pages
					</li></ul></div></section><section class="section" id="proc_controlling-distribution-of-cpu-time-for-applications-by-adjusting-cpu-weight_assembly_using-cgroupfs-to-manually-manage-cgroups"><div class="titlepage"><div><div><h2 class="title">36.2. Controlling distribution of CPU time for applications by adjusting CPU weight</h2></div></div></div><p class="_abstract _abstract">
				You need to assign values to the relevant files of the <code class="literal">cpu</code> controller to regulate distribution of the CPU time to applications under the specific cgroup tree.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have root permissions.
					</li><li class="listitem">
						You have applications for which you want to control distribution of CPU time.
					</li><li class="listitem"><p class="simpara">
						You created a two level hierarchy of <span class="emphasis"><em>child control groups</em></span> inside the <code class="literal">/sys/fs/cgroup/</code> <span class="emphasis"><em>root control group</em></span> as in the following example:
					</p><pre class="literallayout">…​
&nbsp; ├── Example
&nbsp; │&nbsp;&nbsp; ├── g1
&nbsp; │&nbsp;&nbsp; ├── g2
&nbsp; │&nbsp;&nbsp; └── g3
…​</pre></li><li class="listitem">
						You enabled the <code class="literal">cpu</code> controller in the parent control group and in child control groups similarly as described in <a class="link" href="#proc_creating-cgroups-and-enabling-controllers-in-cgroups-v2-file-system_assembly_using-cgroupfs-to-manually-manage-cgroups" title="36.1.&nbsp;Creating cgroups and enabling controllers in cgroups-v2 file system">Creating cgroups and enabling controllers in cgroups-v2 file system</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure desired CPU weights to achieve resource restrictions within the control groups:
					</p><pre class="literallayout"># <span class="strong strong"><strong>echo "150" &gt; /sys/fs/cgroup/Example/g1/cpu.weight</strong></span>
# <span class="strong strong"><strong>echo "100" &gt; /sys/fs/cgroup/Example/g2/cpu.weight</strong></span>
# <span class="strong strong"><strong>echo "50" &gt; /sys/fs/cgroup/Example/g3/cpu.weight</strong></span></pre></li><li class="listitem"><p class="simpara">
						Add the applications' PIDs to the <code class="literal">g1</code>, <code class="literal">g2</code>, and <code class="literal">g3</code> child groups:
					</p><pre class="literallayout"># <span class="strong strong"><strong>echo "33373" &gt; /sys/fs/cgroup/Example/g1/cgroup.procs</strong></span>
# <span class="strong strong"><strong>echo "33374" &gt; /sys/fs/cgroup/Example/g2/cgroup.procs</strong></span>
# <span class="strong strong"><strong>echo "33377" &gt; /sys/fs/cgroup/Example/g3/cgroup.procs</strong></span></pre><p class="simpara">
						The example commands ensure that desired applications become members of the <code class="literal">Example/g*/</code> child cgroups and will get their CPU time distributed as per the configuration of those cgroups.
					</p><p class="simpara">
						The weights of the children cgroups (<code class="literal">g1</code>, <code class="literal">g2</code>, <code class="literal">g3</code>) that have running processes are summed up at the level of the parent cgroup (<code class="literal">Example</code>). The CPU resource is then distributed proportionally based on the respective weights.
					</p><p class="simpara">
						As a result, when all processes run at the same time, the kernel 
allocates to each of them the proportionate CPU time based on their 
respective cgroup’s <code class="literal">cpu.weight</code> file:
					</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="fx1dvkf" id="rh-table--fx1dvkf"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--><col style="width: 30%; " class="col_2"><!--Empty--><col style="width: 40%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611467375728" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Child cgroup</th><th id="idm140611467374640" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left"><code class="literal">cpu.weight</code> file</th><th id="idm140611467373232" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">CPU time allocation</th></tr></thead><tbody><tr><td headers="idm140611467375728" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
										g1
									</p>
									 </td><td headers="idm140611467374640" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
										150
									</p>
									 </td><td headers="idm140611467373232" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
										~50% (150/300)
									</p>
									 </td></tr><tr><td headers="idm140611467375728" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
										g2
									</p>
									 </td><td headers="idm140611467374640" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
										100
									</p>
									 </td><td headers="idm140611467373232" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
										~33% (100/300)
									</p>
									 </td></tr><tr><td headers="idm140611467375728" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
										g3
									</p>
									 </td><td headers="idm140611467374640" data-row="4" data-col="2" class="content--md" valign="top" align="left"> <p>
										50
									</p>
									 </td><td headers="idm140611467373232" data-row="4" data-col="3" class="content--md" valign="top" align="left"> <p>
										~16% (50/300)
									</p>
									 </td></tr></tbody></table></rh-table><p class="simpara">
						The value of the <code class="literal">cpu.weight</code> controller file is not a percentage.
					</p><p class="simpara">
						If one process stopped running, leaving cgroup <code class="literal">g2</code> with no running processes, the calculation would omit the cgroup <code class="literal">g2</code> and only account weights of cgroups <code class="literal">g1</code> and <code class="literal">g3</code>:
					</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="vtjnves" id="rh-table--vtjnves"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 30%; " class="col_1"><!--Empty--><col style="width: 30%; " class="col_2"><!--Empty--><col style="width: 40%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611467346608" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Child cgroup</th><th id="idm140611467345520" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left"><code class="literal">cpu.weight</code> file</th><th id="idm140611467344112" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">CPU time allocation</th></tr></thead><tbody><tr><td headers="idm140611467346608" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
										g1
									</p>
									 </td><td headers="idm140611467345520" data-row="2" data-col="2" class="content--md" valign="top" align="left"> <p>
										150
									</p>
									 </td><td headers="idm140611467344112" data-row="2" data-col="3" class="content--md" valign="top" align="left"> <p>
										~75% (150/200)
									</p>
									 </td></tr><tr><td headers="idm140611467346608" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
										g3
									</p>
									 </td><td headers="idm140611467345520" data-row="3" data-col="2" class="content--md" valign="top" align="left"> <p>
										50
									</p>
									 </td><td headers="idm140611467344112" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
										~25% (50/200)
									</p>
									 </td></tr></tbody></table></rh-table><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							If a child cgroup had multiple running processes, the CPU time 
allocated to the respective cgroup would be distributed equally to the 
member processes of that cgroup.
						</p></div></div></li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Verify that the applications run in the specified control groups:
					</p><pre class="literallayout"># <span class="strong strong"><strong>cat /proc/33373/cgroup /proc/33374/cgroup /proc/33377/cgroup</strong></span>
0::/Example/g1
0::/Example/g2
0::/Example/g3</pre><p class="simpara">
						The command output shows the processes of the specified applications that run in the <code class="literal">Example/g*/</code> child cgroups.
					</p></li><li class="listitem"><p class="simpara">
						Inspect the current CPU consumption of the throttled applications:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>top</strong></span>
top - 05:17:18 up 1 day, 18:25,  1 user,  load average: 3.03, 3.03, 3.00
Tasks:  95 total,   4 running,  91 sleeping,   0 stopped,   0 zombie
%Cpu(s): 18.1 us, 81.6 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.3 hi,  0.0 si,  0.0 st
MiB Mem :   3737.0 total,   3233.7 free,    132.8 used,    370.5 buff/cache
MiB Swap:   4060.0 total,   4060.0 free,      0.0 used.   3373.1 avail Mem

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
  33373 root      20   0   18720   1748   1460 R  <span class="strong strong"><strong>49.5</strong></span>   0.0 415:05.87 sha1sum
  33374 root      20   0   18720   1756   1464 R  <span class="strong strong"><strong>32.9</strong></span>   0.0 412:58.33 sha1sum
  33377 root      20   0   18720   1860   1568 R  <span class="strong strong"><strong>16.3</strong></span>   0.0 411:03.12 sha1sum
    760 root      20   0  416620  28540  15296 S   0.3   0.7   0:10.23 tuned
      1 root      20   0  186328  14108   9484 S   0.0   0.4   0:02.00 systemd
      2 root      20   0       0      0      0 S   0.0   0.0   0:00.01 kthread
...</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							We forced all the example processes to run on a single CPU for 
clearer illustration. The CPU weight applies the same principles also 
when used on multiple CPUs.
						</p></div></div><p class="simpara">
						Notice that the CPU resource for the <code class="literal">PID 33373</code>, <code class="literal">PID 33374</code>, and <code class="literal">PID 33377</code>
 was allocated based on the weights, 150, 100, 50, you assigned to the 
respective child cgroups. The weights correspond to around 50%, 33%, and
 16% allocation of CPU time for each application.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#understanding-control-groups_setting-limits-for-applications" title="34.1.&nbsp;Understanding control groups">Understanding control groups</a>
					</li><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						<a class="link" href="#proc_creating-cgroups-and-enabling-controllers-in-cgroups-v2-file-system_assembly_using-cgroupfs-to-manually-manage-cgroups" title="36.1.&nbsp;Creating cgroups and enabling controllers in cgroups-v2 file system">Creating cgroups and enabling controllers in cgroups-v2 file system</a>
					</li><li class="listitem">
						<a class="link" href="https://www.kernel.org/doc/html/latest/admin-guide/cgroup-v2.html#resource-distribution-models">Resource Distribution Models</a>
					</li><li class="listitem">
						<code class="literal">cgroups(7)</code>, <code class="literal">sysfs(5)</code> manual pages
					</li></ul></div></section><section class="section" id="proc_mounting-cgroups-v1_assembly_using-cgroupfs-to-manually-manage-cgroups"><div class="titlepage"><div><div><h2 class="title">36.3. Mounting cgroups-v1</h2></div></div></div><p>
				During the boot process, RHEL 9 mounts the <code class="literal">cgroup-v2</code> virtual filesystem by default. To utilize <code class="literal">cgroup-v1</code> functionality in limiting resources for your applications, manually configure the system.
			</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Both <code class="literal">cgroup-v1</code> and <code class="literal">cgroup-v2</code> are fully enabled in the kernel. There is no default control group version from the kernel point of view, and is decided by <code class="literal">systemd</code> to mount at startup.
				</p></div></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have root permissions.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Configure the system to mount <code class="literal">cgroups-v1</code> by default during system boot by the <code class="literal">systemd</code> system and service manager:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args="systemd.unified_cgroup_hierarchy=0 systemd.legacy_systemd_cgroup_controller"</strong></span></pre><p class="simpara">
						This adds the necessary kernel command-line parameters to the current boot entry.
					</p><p class="simpara">
						To add the same parameters to all kernel boot entries:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>grubby --update-kernel=ALL --args="systemd.unified_cgroup_hierarchy=0 systemd.legacy_systemd_cgroup_controller"</strong></span></pre></li><li class="listitem">
						Reboot the system for the changes to take effect.
					</li></ol></div><div class="orderedlist"><p class="title"><strong>Verification</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Optionally, verify that the <code class="literal">cgroups-v1</code> filesystem was mounted:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>mount -l | grep cgroup</strong></span>
tmpfs on /sys/fs/cgroup type tmpfs (ro,nosuid,nodev,noexec,seclabel,size=4096k,nr_inodes=1024,mode=755,inode64)
cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd)
cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,perf_event)
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,cpu,cpuacct)
cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,pids)
cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,cpuset)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,net_cls,net_prio)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,hugetlb)
cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,memory)
cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,blkio)
cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,devices)
cgroup on /sys/fs/cgroup/misc type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,misc)
cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,freezer)
cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,seclabel,rdma)</pre><p class="simpara">
						The <code class="literal">cgroups-v1</code> filesystems that correspond to various <code class="literal">cgroup-v1</code> controllers, were successfully mounted on the <code class="literal">/sys/fs/cgroup/</code> directory.
					</p></li><li class="listitem"><p class="simpara">
						Optionally, inspect the contents of the <code class="literal">/sys/fs/cgroup/</code> directory:
					</p><pre class="literallayout"># <span class="strong strong"><strong>ll /sys/fs/cgroup/</strong></span>
dr-xr-xr-x. 10 root root  0 Mar 16 09:34 blkio
lrwxrwxrwx.  1 root root 11 Mar 16 09:34 cpu → cpu,cpuacct
lrwxrwxrwx.  1 root root 11 Mar 16 09:34 cpuacct → cpu,cpuacct
dr-xr-xr-x. 10 root root  0 Mar 16 09:34 cpu,cpuacct
dr-xr-xr-x.  2 root root  0 Mar 16 09:34 cpuset
dr-xr-xr-x. 10 root root  0 Mar 16 09:34 devices
dr-xr-xr-x.  2 root root  0 Mar 16 09:34 freezer
dr-xr-xr-x.  2 root root  0 Mar 16 09:34 hugetlb
dr-xr-xr-x. 10 root root  0 Mar 16 09:34 memory
dr-xr-xr-x.  2 root root  0 Mar 16 09:34 misc
lrwxrwxrwx.  1 root root 16 Mar 16 09:34 net_cls → net_cls,net_prio
dr-xr-xr-x.  2 root root  0 Mar 16 09:34 net_cls,net_prio
lrwxrwxrwx.  1 root root 16 Mar 16 09:34 net_prio → net_cls,net_prio
dr-xr-xr-x.  2 root root  0 Mar 16 09:34 perf_event
dr-xr-xr-x. 10 root root  0 Mar 16 09:34 pids
dr-xr-xr-x.  2 root root  0 Mar 16 09:34 rdma
dr-xr-xr-x. 11 root root  0 Mar 16 09:34 systemd</pre><p class="simpara">
						The <code class="literal">/sys/fs/cgroup/</code> directory, also called the <span class="emphasis"><em>root control group</em></span>, by default, contains controller-specific directories such as <code class="literal">cpuset</code>. In addition, there are some directories related to <code class="literal">systemd</code>.
					</p></li></ol></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#understanding-control-groups_setting-limits-for-applications" title="34.1.&nbsp;Understanding control groups">Understanding control groups</a>
					</li><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What are kernel resource controllers</a>
					</li><li class="listitem">
						<code class="literal">cgroups(7)</code>, <code class="literal">sysfs(5)</code> manual pages
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/9.0_release_notes/index#BZ-1953515">cgroup-v2 enabled by default in RHEL 9</a>
					</li></ul></div></section><section class="section" id="setting-cpu-limits-to-applications-using-cgroups-v1_assembly_using-cgroupfs-to-manually-manage-cgroups"><div class="titlepage"><div><div><h2 class="title">36.4. Setting CPU limits to applications using cgroups-v1</h2></div></div></div><p class="_abstract _abstract">
				Sometimes an application consumes a lot of CPU time, which may 
negatively impact the overall health of your environment. Use the <code class="literal">/sys/fs/</code> virtual file system to configure CPU limits to an application using <span class="emphasis"><em>control groups version 1</em></span> (<code class="literal">cgroups-v1</code>).
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have root permissions.
					</li><li class="listitem">
						You have an application whose CPU consumption you want to restrict.
					</li><li class="listitem"><p class="simpara">
						You configured the system to mount <code class="literal">cgroups-v1</code> by default during system boot by the <code class="literal">systemd</code> system and service manager:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args="systemd.unified_cgroup_hierarchy=0 systemd.legacy_systemd_cgroup_controller"</strong></span></pre><p class="simpara">
						This adds the necessary kernel command-line parameters to the current boot entry.
					</p></li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Identify the process ID (PID) of the application you want to restrict in CPU consumption:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>top</strong></span>
top - 11:34:09 up 11 min,  1 user,  load average: 0.51, 0.27, 0.22
Tasks: 267 total,   3 running, 264 sleeping,   0 stopped,   0 zombie
%Cpu(s): 49.0 us,  3.3 sy,  0.0 ni, 47.5 id,  0.0 wa,  0.2 hi,  0.0 si,  0.0 st
MiB Mem :   1826.8 total,    303.4 free,   1046.8 used,    476.5 buff/cache
MiB Swap:   1536.0 total,   1396.0 free,    140.0 used.    616.4 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
 6955 root      20   0  228440   1752   1472 R  <span class="strong strong"><strong>99.3</strong></span>   0.1   0:32.71 sha1sum
 5760 jdoe      20   0 3603868 205188  64196 S   3.7  11.0   0:17.19 gnome-shell
 6448 jdoe      20   0  743648  30640  19488 S   0.7   1.6   0:02.73 gnome-terminal-
    1 root      20   0  245300   6568   4116 S   0.3   0.4   0:01.87 systemd
  505 root      20   0       0      0      0 I   0.3   0.0   0:00.75 kworker/u4:4-events_unbound
...</pre><p class="simpara">
						The example output of the <code class="literal">top</code> program reveals that <code class="literal">PID 6955</code> (illustrative application <code class="literal">sha1sum</code>) consumes a lot of CPU resources.
					</p></li><li class="listitem"><p class="simpara">
						Create a sub-directory in the <code class="literal">cpu</code> resource controller directory:
					</p><pre class="literallayout"># <span class="strong strong"><strong>mkdir /sys/fs/cgroup/cpu/Example/</strong></span></pre><p class="simpara">
						The directory above represents a control group, where you can 
place specific processes and apply certain CPU limits to the processes. 
At the same time, some <code class="literal">cgroups-v1</code> interface files and <code class="literal">cpu</code> controller-specific files will be created in the directory.
					</p></li><li class="listitem"><p class="simpara">
						Optionally, inspect the newly created control group:
					</p><pre class="literallayout"># <span class="strong strong"><strong>ll /sys/fs/cgroup/cpu/Example/</strong></span>
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cgroup.clone_children
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cgroup.procs
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.stat
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.usage
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.usage_all
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.usage_percpu
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.usage_percpu_sys
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.usage_percpu_user
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.usage_sys
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpuacct.usage_user
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cpu.cfs_period_us
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cpu.cfs_quota_us
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cpu.rt_period_us
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cpu.rt_runtime_us
-rw-r—​r--. 1 root root 0 Mar 11 11:42 cpu.shares
-r—​r—​r--. 1 root root 0 Mar 11 11:42 cpu.stat
-rw-r—​r--. 1 root root 0 Mar 11 11:42 notify_on_release
-rw-r—​r--. 1 root root 0 Mar 11 11:42 tasks</pre><p class="simpara">
						The example output shows files, such as <code class="literal">cpuacct.usage</code>, <code class="literal">cpu.cfs._period_us</code>, that represent specific configurations and/or limits, which can be set for processes in the <code class="literal">Example</code>
 control group. Notice that the respective file names are prefixed with 
the name of the control group controller to which they belong.
					</p><p class="simpara">
						By default, the newly created control group inherits access to the system’s entire CPU resources without a limit.
					</p></li><li class="listitem"><p class="simpara">
						Configure CPU limits for the control group:
					</p><pre class="literallayout"># <span class="strong strong"><strong>echo "1000000" &gt; /sys/fs/cgroup/cpu/Example/cpu.cfs_period_us</strong></span>
# <span class="strong strong"><strong>echo "200000" &gt; /sys/fs/cgroup/cpu/Example/cpu.cfs_quota_us</strong></span></pre><p class="simpara">
						The <code class="literal">cpu.cfs_period_us</code> file represents
 a period of time in microseconds (µs, represented here as "us") for how
 frequently a control group’s access to CPU resources should be 
reallocated. The upper limit is 1 second and the lower limit is 1000 
microseconds.
					</p><p class="simpara">
						The <code class="literal">cpu.cfs_quota_us</code> file represents 
the total amount of time in microseconds for which all processes 
collectively in a control group can run during one period (as defined by
 <code class="literal">cpu.cfs_period_us</code>). As soon as processes 
in a control group, during a single period, use up all the time 
specified by the quota, they are throttled for the remainder of the 
period and not allowed to run until the next period. The lower limit is 
1000 microseconds.
					</p><p class="simpara">
						The example commands above set the CPU time limits so that all processes collectively in the <code class="literal">Example</code> control group will be able to run only for 0.2 seconds (defined by <code class="literal">cpu.cfs_quota_us</code>) out of every 1 second (defined by <code class="literal">cpu.cfs_period_us</code>).
					</p></li><li class="listitem"><p class="simpara">
						Optionally, verify the limits:
					</p><pre class="literallayout"># <span class="strong strong"><strong>cat /sys/fs/cgroup/cpu/Example/cpu.cfs_period_us /sys/fs/cgroup/cpu/Example/cpu.cfs_quota_us</strong></span>
1000000
200000</pre></li><li class="listitem"><p class="simpara">
						Add the application’s PID to the <code class="literal">Example</code> control group:
					</p><pre class="literallayout"># <span class="strong strong"><strong>echo "6955" &gt; /sys/fs/cgroup/cpu/Example/cgroup.procs</strong></span>

or

# <span class="strong strong"><strong>echo "6955" &gt; /sys/fs/cgroup/cpu/Example/tasks</strong></span></pre><p class="simpara">
						The previous command ensures that a desired application becomes a member of the <code class="literal">Example</code> control group and hence does not exceed the CPU limits configured for the <code class="literal">Example</code> control group. The PID should represent an existing process in the system. The <code class="literal">PID 6955</code> here was assigned to process <code class="literal">sha1sum /dev/zero &amp;</code>, used to illustrate the use-case of the <code class="literal">cpu</code> controller.
					</p></li><li class="listitem"><p class="simpara">
						Verify that the application runs in the specified control group:
					</p><pre class="literallayout"># <span class="strong strong"><strong>cat /proc/6955/cgroup</strong></span>
12:cpuset:/
11:hugetlb:/
10:net_cls,net_prio:/
9:memory:/user.slice/user-1000.slice/user@1000.service
8:devices:/user.slice
7:blkio:/
6:freezer:/
5:rdma:/
4:pids:/user.slice/user-1000.slice/user@1000.service
3:perf_event:/
2:cpu,cpuacct:/Example
1:name=systemd:/user.slice/user-1000.slice/user@1000.service/gnome-terminal-server.service</pre><p class="simpara">
						The example output above shows that the process of the desired application runs in the <code class="literal">Example</code> control group, which applies CPU limits to the application’s process.
					</p></li><li class="listitem"><p class="simpara">
						Identify the current CPU consumption of your throttled application:
					</p><pre class="literallayout white-space-pre"># <span class="strong strong"><strong>top</strong></span>
top - 12:28:42 up  1:06,  1 user,  load average: 1.02, 1.02, 1.00
Tasks: 266 total,   6 running, 260 sleeping,   0 stopped,   0 zombie
%Cpu(s): 11.0 us,  1.2 sy,  0.0 ni, 87.5 id,  0.0 wa,  0.2 hi,  0.0 si,  0.2 st
MiB Mem :   1826.8 total,    287.1 free,   1054.4 used,    485.3 buff/cache
MiB Swap:   1536.0 total,   1396.7 free,    139.2 used.    608.3 avail Mem

  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
 6955 root      20   0  228440   1752   1472 R  <span class="strong strong"><strong>20.6</strong></span>   0.1  47:11.43 sha1sum
 5760 jdoe      20   0 3604956 208832  65316 R   2.3  11.2   0:43.50 gnome-shell
 6448 jdoe      20   0  743836  31736  19488 S   0.7   1.7   0:08.25 gnome-terminal-
  505 root      20   0       0      0      0 I   0.3   0.0   0:03.39 kworker/u4:4-events_unbound
 4217 root      20   0   74192   1612   1320 S   0.3   0.1   0:01.19 spice-vdagentd
...</pre><p class="simpara">
						Notice that the CPU consumption of the <code class="literal">PID 6955</code> has decreased from 99% to 20%.
					</p></li></ol></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					The <code class="literal">cgroups-v2</code> counterpart for <code class="literal">cpu.cfs_period_us</code> and <code class="literal">cpu.cfs_quota_us</code> is the <code class="literal">cpu.max</code> file. The <code class="literal">cpu.max</code> file is available through the <code class="literal">cpu</code> controller.
				</p></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<a class="link" href="#understanding-control-groups_setting-limits-for-applications" title="34.1.&nbsp;Understanding control groups">Understanding control groups</a>
					</li><li class="listitem">
						<a class="link" href="#what-kernel-resource-controllers-are_setting-limits-for-applications" title="34.2.&nbsp;What are kernel resource controllers">What kernel resource controllers are</a>
					</li><li class="listitem">
						<code class="literal">cgroups(7)</code>, <code class="literal">sysfs(5)</code> manual pages
					</li></ul></div></section></section><section class="chapter" id="analyzing-system-performance-with-bpf-compiler_collection_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 37. Analyzing system performance with BPF Compiler Collection</h1></div></div></div><p class="_abstract _abstract">
			As a system administrator, you can use the BPF Compiler Collection 
(BCC) library to create tools for analyzing the performance of your 
Linux operating system and gathering information, which could be 
difficult to obtain through other interfaces.
		</p><section class="section" id="installing-the-bcc-tools-package_analyzing-system-performance-with-bpf-compiler_collection"><div class="titlepage"><div><div><h2 class="title">37.1. Installing the bcc-tools package</h2></div></div></div><p class="_abstract _abstract">
				Install the <code class="literal">bcc-tools</code> package, which also installs the BPF Compiler Collection (BCC) library as a dependency.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install <code class="literal">bcc-tools</code>.
					</p><pre class="literallayout white-space-pre"><code class="literal">#</code> <code class="literal command"><span class="strong strong"><strong>dnf install bcc-tools</strong></span></code></pre><p class="simpara">
						The BCC tools are installed in the <code class="literal">/usr/share/bcc/tools/</code> directory.
					</p></li><li class="listitem"><p class="simpara">
						Optionally, inspect the tools:
					</p><pre class="literallayout white-space-pre"><code class="literal">#</code> <code class="literal command"><span class="strong strong"><strong>ll /usr/share/bcc/tools/</strong></span></code>
...
-rwxr-xr-x. 1 root root  4198 Dec 14 17:53 dcsnoop
-rwxr-xr-x. 1 root root  3931 Dec 14 17:53 dcstat
-rwxr-xr-x. 1 root root 20040 Dec 14 17:53 deadlock_detector
-rw-r--r--. 1 root root  7105 Dec 14 17:53 deadlock_detector.c
drwxr-xr-x. 3 root root  8192 Mar 11 10:28 doc
-rwxr-xr-x. 1 root root  7588 Dec 14 17:53 execsnoop
-rwxr-xr-x. 1 root root  6373 Dec 14 17:53 ext4dist
-rwxr-xr-x. 1 root root 10401 Dec 14 17:53 ext4slower
...</pre><p class="simpara">
						The <code class="literal systemitem">doc</code> directory in the listing above contains documentation for each tool.
					</p></li></ol></div></section><section class="section" id="using-selected-bcc-tools-for-performance-analyses_analyzing-system-performance-with-bpf-compiler_collection"><div class="titlepage"><div><div><h2 class="title">37.2. Using selected bcc-tools for performance analyses</h2></div></div></div><p class="_abstract _abstract">
				Use certain pre-created programs from the BPF Compiler Collection 
(BCC) library to efficiently and securely analyze the system performance
 on the per-event basis. The set of pre-created programs in the BCC 
library can serve as examples for creation of additional programs.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						<a class="link" href="#installing-the-bcc-tools-package_analyzing-system-performance-with-bpf-compiler_collection" title="37.1.&nbsp;Installing the bcc-tools package">Installed bcc-tools package</a>
					</li><li class="listitem">
						Root permissions
					</li></ul></div><h4 id="using_execsnoop_to_examine_the_system_processes">Using execsnoop to examine the system processes</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Run the <code class="literal">execsnoop</code> program in one terminal:
					</p><pre class="screen"># <span class="strong strong"><strong>/usr/share/bcc/tools/execsnoop</strong></span></pre></li><li class="listitem"><p class="simpara">
						In another terminal run, for example:
					</p><pre class="screen">$ <span class="strong strong"><strong>ls /usr/share/bcc/tools/doc/</strong></span></pre><p class="simpara">
						The above creates a short-lived process of the <code class="literal">ls</code> command.
					</p></li><li class="listitem"><p class="simpara">
						The terminal running <code class="literal">execsnoop</code> shows the output similar to the following:
					</p><pre class="screen">PCOMM	PID    PPID   RET ARGS
ls   	8382   8287     0 /usr/bin/ls --color=auto /usr/share/bcc/tools/doc/
...</pre><p class="simpara">
						The <code class="literal">execsnoop</code> program prints a line 
of output for each new process, which consumes system resources. It even
 detects processes of programs that run very shortly, such as <code class="literal">ls</code>, and most monitoring tools would not register them.
					</p><p class="simpara">
						The <code class="literal">execsnoop</code> output displays the following fields:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>PCOMM</strong></span> - The parent process name. (<code class="literal">ls</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>PID</strong></span> - The process ID. (<code class="literal">8382</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>PPID</strong></span> - The parent process ID. (<code class="literal">8287</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>RET</strong></span> - The return value of the <code class="literal">exec()</code> system call (<code class="literal">0</code>), which loads program code into new processes.
							</li><li class="listitem">
								<span class="strong strong"><strong>ARGS</strong></span> - The location of the started program with arguments.
							</li></ul></div></li></ol></div><p>
				To see more details, examples, and options for <code class="literal">execsnoop</code>, refer to the <code class="literal">/usr/share/bcc/tools/doc/execsnoop_example.txt</code> file.
			</p><p>
				For more information about <code class="literal">exec()</code>, see <code class="literal">exec(3)</code> manual pages.
			</p><h4 id="using_opensnoop_to_track_what_files_a_command_opens">Using opensnoop to track what files a command opens</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Run the <code class="literal">opensnoop</code> program in one terminal:
					</p><pre class="screen"># <span class="strong strong"><strong>/usr/share/bcc/tools/opensnoop -n uname</strong></span></pre><p class="simpara">
						The above prints output for files, which are opened only by the process of the <code class="literal">uname</code> command.
					</p></li><li class="listitem"><p class="simpara">
						In another terminal, enter:
					</p><pre class="screen"><span class="strong strong"><strong>$ uname</strong></span></pre><p class="simpara">
						The command above opens certain files, which are captured in the next step.
					</p></li><li class="listitem"><p class="simpara">
						The terminal running <code class="literal">opensnoop</code> shows the output similar to the following:
					</p><pre class="screen">PID    COMM 	FD ERR PATH
8596   uname 	3  0   /etc/ld.so.cache
8596   uname 	3  0   /lib64/libc.so.6
8596   uname 	3  0   /usr/lib/locale/locale-archive
...</pre><p class="simpara">
						The <code class="literal">opensnoop</code> program watches the <code class="literal">open()</code> system call across the whole system, and prints a line of output for each file that <code class="literal">uname</code> tried to open along the way.
					</p><p class="simpara">
						The <code class="literal">opensnoop</code> output displays the following fields:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>PID</strong></span> - The process ID. (<code class="literal">8596</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>COMM</strong></span> - The process name. (<code class="literal">uname</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>FD</strong></span> - The file descriptor - a value that <code class="literal">open()</code> returns to refer to the open file. (<code class="literal">3</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>ERR</strong></span> - Any errors.
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>PATH</strong></span> - The location of files that <code class="literal">open()</code> tried to open.
							</p><p class="simpara">
								If a command tries to read a non-existent file, then the <code class="literal">FD</code> column returns <code class="literal">-1</code> and the <code class="literal">ERR</code> column prints a value corresponding to the relevant error. As a result, <code class="literal">opensnoop</code> can help you identify an application that does not behave properly.
							</p></li></ul></div></li></ol></div><p>
				To see more details, examples, and options for <code class="literal">opensnoop</code>, refer to the <code class="literal">/usr/share/bcc/tools/doc/opensnoop_example.txt</code> file.
			</p><p>
				For more information about <code class="literal">open()</code>, see <code class="literal">open(2)</code> manual pages.
			</p><h4 id="using_biotop_to_examine_the_i_o_operations_on_the_disk">Using biotop to examine the I/O operations on the disk</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Run the <code class="literal">biotop</code> program in one terminal:
					</p><pre class="screen"># <span class="strong strong"><strong>/usr/share/bcc/tools/biotop 30</strong></span></pre><p class="simpara">
						The command enables you to monitor the top processes, which 
perform I/O operations on the disk. The argument ensures that the 
command will produce a 30 second summary.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							When no argument provided, the output screen by default refreshes every 1 second.
						</p></div></div></li><li class="listitem"><p class="simpara">
						In another terminal enter, for example :
					</p><pre class="screen"># <span class="strong strong"><strong>dd if=/dev/vda of=/dev/zero</strong></span></pre><p class="simpara">
						The command above reads the content from the local hard disk device and writes the output to the <code class="literal">/dev/zero</code> file. This step generates certain I/O traffic to illustrate <code class="literal">biotop</code>.
					</p></li><li class="listitem"><p class="simpara">
						The terminal running <code class="literal">biotop</code> shows the output similar to the following:
					</p><pre class="screen">PID    COMM             D MAJ MIN DISK       I/O  Kbytes     AVGms
9568   dd               R 252 0   vda      16294 14440636.0  3.69
48     kswapd0          W 252 0   vda       1763 120696.0    1.65
7571   gnome-shell      R 252 0   vda        834 83612.0     0.33
1891   gnome-shell      R 252 0   vda       1379 19792.0     0.15
7515   Xorg             R 252 0   vda        280  9940.0     0.28
7579   llvmpipe-1       R 252 0   vda        228  6928.0     0.19
9515   gnome-control-c  R 252 0   vda         62  6444.0     0.43
8112   gnome-terminal-  R 252 0   vda         67  2572.0     1.54
7807   gnome-software   R 252 0   vda         31  2336.0     0.73
9578   awk              R 252 0   vda         17  2228.0     0.66
7578   llvmpipe-0       R 252 0   vda        156  2204.0     0.07
9581   pgrep            R 252 0   vda         58  1748.0     0.42
7531   InputThread      R 252 0   vda         30  1200.0     0.48
7504   gdbus            R 252 0   vda          3  1164.0     0.30
1983   llvmpipe-1       R 252 0   vda         39   724.0     0.08
1982   llvmpipe-0       R 252 0   vda         36   652.0     0.06
...</pre><p class="simpara">
						The <code class="literal">biotop</code> output displays the following fields:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>PID</strong></span> - The process ID. (<code class="literal">9568</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>COMM</strong></span> - The process name. (<code class="literal">dd</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>DISK</strong></span> - The disk performing the read operations. (<code class="literal">vda</code>)
							</li><li class="listitem">
								<span class="strong strong"><strong>I/O</strong></span> - The number of read operations performed. (16294)
							</li><li class="listitem">
								<span class="strong strong"><strong>Kbytes</strong></span> - The amount of Kbytes reached by the read operations. (14,440,636)
							</li><li class="listitem">
								<span class="strong strong"><strong>AVGms</strong></span> - The average I/O time of read operations. (3.69)
							</li></ul></div></li></ol></div><p>
				To see more details, examples, and options for <code class="literal">biotop</code>, refer to the <code class="literal">/usr/share/bcc/tools/doc/biotop_example.txt</code> file.
			</p><p>
				For more information about <code class="literal">dd</code>, see <code class="literal">dd(1)</code> manual pages.
			</p><h4 id="using_xfsslower_to_expose_unexpectedly_slow_file_system_operations">Using xfsslower to expose unexpectedly slow file system operations</h4><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Run the <code class="literal">xfsslower</code> program in one terminal:
					</p><pre class="screen"># <span class="strong strong"><strong>/usr/share/bcc/tools/xfsslower 1</strong></span></pre><p class="simpara">
						The command above measures the time the XFS file system spends in performing read, write, open or sync (<code class="literal">fsync</code>) operations. The <code class="literal">1</code> argument ensures that the program shows only the operations that are slower than 1 ms.
					</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							When no arguments provided, <code class="literal">xfsslower</code> by default displays operations slower than 10 ms.
						</p></div></div></li><li class="listitem"><p class="simpara">
						In another terminal enter, for example, the following:
					</p><pre class="screen">$ <span class="strong strong"><strong>vim text</strong></span></pre><p class="simpara">
						The command above creates a text file in the <code class="literal">vim</code> editor to initiate certain interaction with the XFS file system.
					</p></li><li class="listitem"><p class="simpara">
						The terminal running <code class="literal">xfsslower</code> shows something similar upon saving the file from the previous step:
					</p><pre class="screen">TIME     COMM           PID    T BYTES   OFF_KB   LAT(ms) FILENAME
13:07:14 b'bash'        4754   R 256     0           7.11 b'vim'
13:07:14 b'vim'         4754   R 832     0           4.03 b'libgpm.so.2.1.0'
13:07:14 b'vim'         4754   R 32      20          1.04 b'libgpm.so.2.1.0'
13:07:14 b'vim'         4754   R 1982    0           2.30 b'vimrc'
13:07:14 b'vim'         4754   R 1393    0           2.52 b'getscriptPlugin.vim'
13:07:45 b'vim'         4754   S 0       0           6.71 b'text'
13:07:45 b'pool'        2588   R 16      0           5.58 b'text'
...</pre><p class="simpara">
						Each line above represents an operation in the file system, which took more time than a certain threshold. <code class="literal">xfsslower</code> is good at exposing possible file system problems, which can take form of unexpectedly slow operations.
					</p><p class="simpara">
						The <code class="literal">xfsslower</code> output displays the following fields:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
								<span class="strong strong"><strong>COMM</strong></span> - The process name. (<code class="literal">b’bash'</code>)
							</li><li class="listitem"><p class="simpara">
								<span class="strong strong"><strong>T</strong></span> - The operation type. (<code class="literal">R</code>)
							</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem">
										<span class="strong strong"><strong>R</strong></span>ead
									</li><li class="listitem">
										<span class="strong strong"><strong>W</strong></span>rite
									</li><li class="listitem">
										<span class="strong strong"><strong>S</strong></span>ync
									</li></ul></div></li><li class="listitem">
								<span class="strong strong"><strong>OFF_KB</strong></span> - The file offset in KB. (0)
							</li><li class="listitem">
								<span class="strong strong"><strong>FILENAME</strong></span> - The file being read, written, or synced.
							</li></ul></div></li></ol></div><p>
				To see more details, examples, and options for <code class="literal">xfsslower</code>, refer to the <code class="literal">/usr/share/bcc/tools/doc/xfsslower_example.txt</code> file.
			</p><p>
				For more information about <code class="literal">fsync</code>, see <code class="literal">fsync(2)</code> manual pages.
			</p></section></section><section class="chapter" id="configuring-an-operating-system-to-optimize-memory-access_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 38. Configuring an operating system to optimize memory access</h1></div></div></div><p class="_abstract _abstract">
			You can configure the operating system to optimize memory access across workloads with the tools that are included in RHEL
		</p><section class="section" id="tools-for-monitoring-and-diagnosing-system-memory-issues_configuring-an-operating-system-to-optimize-memory-access"><div class="titlepage"><div><div><h2 class="title">38.1. Tools for monitoring and diagnosing system memory issues</h2></div></div></div><p class="_abstract _abstract">
				The following tools are available in Red&nbsp;Hat 
Enterprise&nbsp;Linux 9 for monitoring system performance and diagnosing
 performance problems related to system memory:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">vmstat</code> tool, provided by the <code class="literal">procps-ng</code>
 package, displays reports of a system’s processes, memory, paging, 
block I/O, traps, disks, and CPU activity. It provides an instantaneous 
report of the average of these events since the machine was last turned 
on, or since the previous report.
					</li><li class="listitem"><p class="simpara">
						<code class="literal">valgrind</code> framework provides instrumentation to user-space binaries. Install this tool, using the <code class="literal">dnf install valgrind</code> command. It includes a number of tools, that you can use to profile and analyze program performance, such as:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								<code class="literal">memcheck</code> option is the default <code class="literal">valgrind</code> tool. It detects and reports on a number of memory errors that can be difficult to detect and diagnose, such as:
							</p><div class="itemizedlist"><ul class="itemizedlist" type="square"><li class="listitem">
										Memory access that should not occur
									</li><li class="listitem">
										Undefined or uninitialized value use
									</li><li class="listitem">
										Incorrectly freed heap memory
									</li><li class="listitem">
										Pointer overlap
									</li><li class="listitem"><p class="simpara">
										Memory leaks
									</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
											Memcheck can only report these errors, it cannot prevent them from occurring. However, <code class="literal">memcheck</code> logs an error message immediately before the error occurs.
										</p></div></div></li></ul></div></li><li class="listitem">
								<code class="literal">cachegrind</code> option simulates 
application interaction with a system’s cache hierarchy and branch 
predictor. It gathers statistics for the duration of application’s 
execution and outputs a summary to the console.
							</li><li class="listitem">
								<code class="literal">massif</code> option measures the heap 
space used by a specified application. It measures both useful space and
 any additional space allocated for bookkeeping and alignment purposes.
							</li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">vmstat(8)</code> and <code class="literal">valgrind(1)</code> man pages
					</li><li class="listitem">
						<code class="literal">/usr/share/doc/valgrind-version/valgrind_manual.pdf</code> file
					</li></ul></div></section><section class="section" id="overview-of-a-systems-memory_configuring-an-operating-system-to-optimize-memory-access"><div class="titlepage"><div><div><h2 class="title">38.2. Overview of a system’s memory</h2></div></div></div><p class="_abstract _abstract">
				The Linux Kernel is designed to maximize the utilization of a 
system’s memory resources (RAM). Due to these design characteristics, 
and depending on the memory requirements of the workload, part of the 
system’s memory is in use within the kernel on behalf of the workload, 
while a small part of the memory is free. This free memory is reserved 
for special system allocations, and for other low or high priority 
system services.
			</p><p>
				The rest of the system’s memory is dedicated to the workload itself, and divided into the following two categories:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">File memory</code></span></dt><dd><p class="simpara">
							Pages added in this category represent parts of files in 
permanent storage. These pages, from the page cache, can be mapped or 
unmapped in an application’s address spaces. You can use applications to
 map files into their address space using the <code class="literal">mmap</code> system calls, or to operate on files via the buffered I/O read or write system calls.
						</p><p class="simpara">
							Buffered I/O system calls, as well as applications that map pages
 directly, can re-utilize unmapped pages. As a result, these pages are 
stored in the cache by the kernel, especially when the system is not 
running any memory intensive tasks, to avoid re-issuing costly I/O 
operations over the same set of pages.
						</p></dd><dt><span class="term"><code class="literal">Anonymous memory</code></span></dt><dd>
							Pages in this category are in use by a dynamically allocated 
process, or are not related to files in permanent storage. This set of 
pages back up the in-memory control structures of each task, such as the
 application stack and heap areas.
						</dd></dl></div><div class="figure" id="idm140611465521184"><p class="title">Figure 38.1. Memory usage patterns</p><div class="figure-contents"><div class="mediaobject"><a href="https://access.redhat.com/webassets/avalon/d/Red_Hat_Enterprise_Linux-9-Monitoring_and_managing_system_status_and_performance-en-US/images/81d9c47bcca9529ab234cc7297b69aad/RHEL_Memory_Usage_Patterns.png" class="rh_docs--zoom" title="RHEL Memory Usage Patterns"><img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/RHEL_Memory_Usage_Patterns.png" alt="RHEL Memory Usage Patterns"></a></div></div></div></section><section class="section" id="virtual-memory-parameters_configuring-an-operating-system-to-optimize-memory-access"><div class="titlepage"><div><div><h2 class="title">38.3. Virtual memory parameters</h2></div></div></div><p class="_abstract _abstract">
				The virtual memory parameters are listed in the <code class="literal">/proc/sys/vm</code> directory.
			</p><p>
				The following are the available virtual memory parameters:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">vm.dirty_ratio</code></span></dt><dd>
							Is a percentage value. When this percentage of the total system 
memory is modified, the system begins writing the modifications to the 
disk with the <code class="literal">pdflush</code> operation. The default value is <code class="literal">20</code> percent.
						</dd><dt><span class="term"><code class="literal">vm.dirty_background_ratio</code></span></dt><dd>
							A percentage value. When this percentage of total system memory 
is modified, the system begins writing the modifications to the disk in 
the background. The default value is <code class="literal">10</code> percent.
						</dd><dt><span class="term"><code class="literal">vm.overcommit_memory</code></span></dt><dd><p class="simpara">
							Defines the conditions that determine whether a large memory request is accepted or denied.The default value is <code class="literal">0</code>.
						</p><p class="simpara">
							By default, the kernel performs checks if a virtual memory 
allocation request fits into the present amount of memory (total + swap)
 and rejects only large requests. Otherwise virtual memory allocations 
are granted, and this means they allow memory overcommitment.
						</p><p class="simpara">
							Setting the <code class="literal">overcommit_memory</code> parameter’s value:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									When this parameter is set to <code class="literal">1</code>, 
the kernel performs no memory overcommit handling. This increases the 
possibility of memory overload, but improves performance for 
memory-intensive tasks.
								</li><li class="listitem">
									When this parameter is set to <code class="literal">2</code>, 
the kernel denies requests for memory equal to or larger than the sum of
 the total available swap space and the percentage of physical RAM 
specified in the <code class="literal">overcommit_ratio</code>. This 
reduces the risk of overcommitting memory, but is recommended only for 
systems with swap areas larger than their physical memory.
								</li></ul></div></dd><dt><span class="term"><code class="literal">vm.overcommit_ratio</code></span></dt><dd>
							Specifies the percentage of physical RAM considered when <code class="literal">overcommit_memory</code> is set to <code class="literal">2</code>. The default value is <code class="literal">50</code>.
						</dd><dt><span class="term"><code class="literal">vm.max_map_count</code></span></dt><dd>
							Defines the maximum number of memory map areas that a process can use. The default value is <code class="literal">65530</code>. Increase this value if your application needs more memory map areas.
						</dd><dt><span class="term"><code class="literal">vm.min_free_kbytes</code></span></dt><dd><p class="simpara">
							Sets the size of the reserved free pages pool. It is also responsible for setting the <code class="literal">min_page</code>, <code class="literal">low_page</code>, and <code class="literal">high_page</code>
 thresholds that govern the behavior of the Linux kernel’s page reclaim 
algorithms. It also specifies the minimum number of kilobytes to keep 
free across the system. This calculates a specific value for each low 
memory zone, each of which is assigned a number of reserved free pages 
in proportion to their size.
						</p><p class="simpara">
							Setting the <code class="literal">vm.min_free_kbytes</code> parameter’s value:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Increasing the parameter value effectively reduces the 
application working set usable memory. Therefore, you might want to use 
it for only kernel-driven workloads, where driver buffers need to be 
allocated in atomic contexts.
								</li><li class="listitem"><p class="simpara">
									Decreasing the parameter value might render the kernel unable 
to service system requests, if memory becomes heavily contended in the 
system.
								</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
										Extreme values can be detrimental to the system’s performance. Setting the <code class="literal">vm.min_free_kbytes</code>
 to an extremely low value prevents the system from reclaiming memory 
effectively, which can result in system crashes and failure to service 
interrupts or other kernel services. However, setting <code class="literal">vm.min_free_kbytes</code>
 too high considerably increases system reclaim activity, causing 
allocation latency due to a false direct reclaim state. This might cause
 the system to enter an out-of-memory state immediately.
									</p></div></div><p class="simpara">
									The <code class="literal">vm.min_free_kbytes</code> parameter also sets a page reclaim watermark, called <code class="literal">min_pages</code>. This watermark is used as a factor when determining the two other memory watermarks, <code class="literal">low_pages</code>, and <code class="literal">high_pages</code>, that govern page reclaim algorithms.
								</p></li></ul></div></dd><dt><span class="term"><code class="literal">/proc/<span class="emphasis"><em>PID</em></span>/oom_adj</code></span></dt><dd><p class="simpara">
							In the event that a system runs out of memory, and the <code class="literal">panic_on_oom</code> parameter is set to <code class="literal">0</code>, the <code class="literal">oom_killer</code> function kills processes, starting with the process that has the highest <code class="literal">oom_score</code>, until the system recovers.
						</p><p class="simpara">
							The <code class="literal">oom_adj</code> parameter determines the <code class="literal">oom_score</code> of a process. This parameter is set per process identifier. A value of <code class="literal">-17</code> disables the <code class="literal">oom_killer</code> for that process. Other valid values range from <code class="literal">-16</code> to <code class="literal">15</code>.
						</p></dd></dl></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Processes created by an adjusted process inherit the <code class="literal">oom_score</code> of that process.
				</p></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">vm.swappiness</code></span></dt><dd><p class="simpara">
							The swappiness value, ranging from <code class="literal">0</code> to <code class="literal">200</code>,
 controls the degree to which the system favors reclaiming memory from 
the anonymous memory pool, or the page cache memory pool.
						</p><p class="simpara">
							Setting the <code class="literal">swappiness</code> parameter’s value:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									Higher values favor file-mapped driven workloads while swapping
 out the less actively accessed processes’ anonymous mapped memory of 
RAM. This is useful for file-servers or streaming applications that 
depend on data, from files in the storage, to reside on memory to reduce
 I/O latency for the service requests.
								</li><li class="listitem"><p class="simpara">
									Low values favor anonymous-mapped driven workloads while 
reclaiming the page cache (file mapped memory). This setting is useful 
for applications that do not depend heavily on the file system 
information, and heavily utilize dynamically allocated and private 
memory, such as mathematical and number crunching applications, and few 
hardware virtualization supervisors like QEMU.
								</p><p class="simpara">
									The default value of the <code class="literal">vm.swappiness</code> parameter is <code class="literal">60</code>.
								</p><div class="admonition warning"><div class="admonition_header">Warning</div><div><p>
										Setting the <code class="literal">vm.swappiness</code> to <code class="literal">0</code> aggressively avoids swapping anonymous memory out to a disk, this increases the risk of processes being killed by the <code class="literal">oom_killer</code> function when under memory or I/O intensive workloads.
									</p></div></div></li></ul></div></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">sysctl(8)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/index#setting-memory-related-kernel-parameters_configuring-an-operating-system-to-optimize-memory-access">Setting memory-related kernel parameters</a>
					</li></ul></div></section><section class="section" id="file-system-parameters_configuring-an-operating-system-to-optimize-memory-access"><div class="titlepage"><div><div><h2 class="title">38.4. File system parameters</h2></div></div></div><p class="_abstract _abstract">
				The file system parameters are listed in the <code class="literal">/proc/sys/fs</code> directory. The following are the available file system parameters:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">aio-max-nr</code></span></dt><dd>
							Defines the maximum allowed number of events in all active asynchronous input/output contexts. The default value is <code class="literal">65536</code>, and modifying this value does not pre-allocate or resize any kernel data structures.
						</dd><dt><span class="term"><code class="literal">file-max</code></span></dt><dd><p class="simpara">
							Determines the maximum number of file handles for the entire 
system. The default value on Red&nbsp;Hat Enterprise&nbsp;Linux 9 is 
either <code class="literal">8192</code> or one tenth of the free memory pages available at the time the kernel starts, whichever is higher.
						</p><p class="simpara">
							Raising this value can resolve errors caused by a lack of available file handles.
						</p></dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">sysctl(8)</code> man page
					</li></ul></div></section><section class="section" id="kernel-parameters_configuring-an-operating-system-to-optimize-memory-access"><div class="titlepage"><div><div><h2 class="title">38.5. Kernel parameters</h2></div></div></div><p class="_abstract _abstract">
				The default values for the kernel parameters are located in the <code class="literal">/proc/sys/kernel/</code> directory. These are set default values provided by the kernel or values specified by a user via <code class="literal">sysctl</code>.
			</p><p>
				The following are the available kernel parameters used to set up limits for the <code class="literal">msg*</code> and <code class="literal">shm*</code> System V IPC (<code class="literal">sysvipc</code>) system calls:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">msgmax</code></span></dt><dd>
							Defines the maximum allowed size in bytes of any single message 
in a message queue. This value must not exceed the size of the queue (<code class="literal">msgmnb</code>). Use the <code class="literal">sysctl msgmax</code> command to determine the current <code class="literal">msgmax</code> value on your system.
						</dd><dt><span class="term"><code class="literal">msgmnb</code></span></dt><dd>
							Defines the maximum size in bytes of a single message queue. Use the <code class="literal">sysctl msgmnb</code> command to determine the current <code class="literal">msgmnb</code> value on your system.
						</dd><dt><span class="term"><code class="literal">msgmni</code></span></dt><dd>
							Defines the maximum number of message queue identifiers, and therefore the maximum number of queues. Use the <code class="literal">sysctl msgmni</code> command to determine the current <code class="literal">msgmni</code> value on your system.
						</dd><dt><span class="term"><code class="literal">shmall</code></span></dt><dd>
							Defines the total amount of shared memory <code class="literal">pages</code> that can be used on the system at one time. For example, a page is <code class="literal">4096</code> bytes on the AMD64 and Intel 64 architecture. Use the <code class="literal">sysctl shmall</code> command to determine the current <code class="literal">shmall</code> value on your system.
						</dd><dt><span class="term"><code class="literal">shmmax</code></span></dt><dd>
							Defines the maximum size in bytes of a single shared memory 
segment allowed by the kernel. Shared memory segments up to 1Gb are now 
supported in the kernel. Use the <code class="literal">sysctl shmmax</code> command to determine the current <code class="literal">shmmax</code> value on your system.
						</dd><dt><span class="term"><code class="literal">shmmni</code></span></dt><dd>
							Defines the system-wide maximum number of shared memory segments. The default value is <code class="literal">4096</code> on all systems.
						</dd></dl></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">sysvipc(7)</code> and <code class="literal">sysctl(8)</code> man pages
					</li></ul></div></section><section class="section" id="setting-memory-related-kernel-parameters_configuring-an-operating-system-to-optimize-memory-access"><div class="titlepage"><div><div><h2 class="title">38.6. Setting memory-related kernel parameters</h2></div></div></div><p class="_abstract _abstract">
				Setting a parameter temporarily is useful for determining the effect
 the parameter has on a system. You can later set the parameter 
persistently when you are sure that the parameter value has the desired 
effect.
			</p><p>
				This procedure describes how to set a memory-related kernel parameter temporarily and persistently.
			</p><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						To temporarily set the memory-related kernel parameters, edit the respective files in the <code class="literal">/proc</code> file system or the <code class="literal">sysctl</code> tool.
					</p><p class="simpara">
						For example, to temporarily set the <code class="literal">vm.overcommit_memory</code> parameter to <span class="emphasis"><em>1</em></span>:
					</p><pre class="screen"># echo <span class="emphasis"><em>1</em></span> &gt; /proc/sys/vm/overcommit_memory
# sysctl -w vm.overcommit_memory=<span class="emphasis"><em>1</em></span></pre></li><li class="listitem"><p class="simpara">
						To persistently set the memory-related kernel parameter, edit the <code class="literal">/etc/sysctl.conf</code> file and reload the settings.
					</p><p class="simpara">
						For example, to persistently set the <code class="literal">vm.overcommit_memory</code> parameter to <span class="emphasis"><em>1</em></span>:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								Add the following content in the <code class="literal">/etc/sysctl.conf</code> file:
							</p><pre class="screen">vm.overcommit_memory=<span class="emphasis"><em>1</em></span></pre></li><li class="listitem"><p class="simpara">
								Reload the <code class="literal">sysctl</code> settings from the <code class="literal">/etc/sysctl.conf</code> file:
							</p><pre class="screen"># sysctl -p</pre></li></ul></div></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">sysctl(8)</code> man page
					</li><li class="listitem">
						<code class="literal">proc(5)</code> man page
					</li></ul></div></section></section><section class="chapter" id="configuring-huge-pages_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 39. Configuring huge pages</h1></div></div></div><p class="_abstract _abstract">
			Physical memory is managed in fixed-size chunks called pages. On the 
x86_64 architecture, supported by Red&nbsp;Hat Enterprise&nbsp;Linux 9, 
the default size of a memory page is <code class="literal">4 KB</code>. 
This default page size has proved to be suitable for general-purpose 
operating systems, such as Red Hat Enterprise Linux, which supports many
 different kinds of workloads.
		</p><p>
			However, specific applications can benefit from using larger page 
sizes in certain cases. For example, an application that works with a 
large and relatively fixed data set of hundreds of megabytes or even 
dozens of gigabytes can have performance issues when using <code class="literal">4 KB</code> pages. Such data sets can require a huge amount of <code class="literal">4 KB</code> pages, which can lead to overhead in the operating system and the CPU.
		</p><p>
			This section provides information about huge pages available in RHEL 9 and how you can configure them.
		</p><section class="section" id="available-hugepage-features_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.1. Available huge page features</h2></div></div></div><p class="_abstract _abstract">
				With Red&nbsp;Hat Enterprise&nbsp;Linux 9, you can use huge pages 
for applications that work with big data sets, and improve the 
performance of such applications.
			</p><p>
				The following are the huge page methods, which are supported in RHEL 9:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">HugeTLB pages</code></span></dt><dd><p class="simpara">
							HugeTLB pages are also called static huge pages. There are two ways of reserving HugeTLB pages:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									At boot time: It increases the possibility of success because 
the memory has not yet been significantly fragmented. However, on NUMA 
machines, the number of pages is automatically split among the NUMA 
nodes.
								</li></ul></div></dd></dl></div><p>
				For more information about parameters that influence HugeTLB page behavior at boot time, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#parameters-for-reserving-hugetlb-pages-at-boot-time_configuring-huge-pages">Parameters for reserving HugeTLB pages at boot time</a> and how to use these parameters to configure HugeTLB pages at boot time, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#configuring-hugetlb-at-boot-time_configuring-huge-pages">Configuring HugeTLB at boot time</a>.
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						At run time: It allows you to reserve the huge pages per NUMA 
node. If the run-time reservation is done as early as possible in the 
boot process, the probability of memory fragmentation is lower.
					</li></ul></div><p>
				For more information about parameters that influence HugeTLB page behavior at run time, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#parameters-for-reserving-hugetlb-pages-at-run-time_configuring-huge-pages">Parameters for reserving HugeTLB pages at run time</a> and how to use these parameters to configure HugeTLB pages at run time, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#configuring-hugetlb-at-run-time_configuring-huge-pages">Configuring HugeTLB at run time</a>.
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">Transparent HugePages (THP)</code></span></dt><dd><p class="simpara">
							With THP, the kernel automatically assigns huge pages to 
processes, and therefore there is no need to manually reserve the static
 huge pages. The following are the two modes of operation in THP:
						</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
									<code class="literal">system-wide</code>: Here, the kernel 
tries to assign huge pages to a process whenever it is possible to 
allocate the huge pages and the process is using a large contiguous 
virtual memory area.
								</li><li class="listitem"><p class="simpara">
									<code class="literal">per-process</code>: Here, the kernel only assigns huge pages to the memory areas of individual processes which you can specify using the <code class="literal">madvise</code>() system call.
								</p><div class="admonition note"><div class="admonition_header">Note</div><div><p>
										The THP feature only supports <code class="literal">2 MB</code> pages.
									</p></div></div></li></ul></div></dd></dl></div><p>
				For more information about parameters that influence HugeTLB page behavior at boot time, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#enabling-transparent-hugepages_configuring-huge-pages">Enabling transparent hugepages</a> and <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#disabling-transparent-hugepages_configuring-huge-pages">Disabling transparent hugepages</a>.
			</p></section><section class="section" id="parameters-for-reserving-hugetlb-pages-at-boot-time_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.2. Parameters for reserving HugeTLB pages at boot time</h2></div></div></div><p class="_abstract _abstract">
				Use the following parameters to influence HugeTLB page behavior at boot time.
			</p><p>
				For more infomration on how to use these parameters to configure HugeTLB pages at boot time, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#configuring-hugetlb-at-boot-time_configuring-huge-pages">Configuring HugeTLB at boot time</a>.
			</p><div class="table" id="idm140611464051456"><p class="title">Table 39.1. Parameters used to configure HugeTLB pages at boot time</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="peghgf3" id="rh-table--peghgf3" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--><col style="width: 33%; " class="col_2"><!--Empty--><col style="width: 33%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611464045664" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Parameter</th><th id="idm140611464044576" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Description</th><th id="idm140611464043488" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">Default value</th></tr></thead><tbody><tr><td headers="idm140611464045664" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">hugepages</code>
							</p>
							 </td><td headers="idm140611464044576" data-row="2" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Defines the number of persistent huge pages configured in the kernel at boot time.
							</p>
							 <p>
								In a NUMA system, huge pages, that have this parameter defined, are divided equally between nodes.
							</p>
							 <p>
								You can assign huge pages to specific nodes at runtime by changing the value of the nodes in the <code class="literal">/sys/devices/system/node/node_id/hugepages/hugepages-size/nr_hugepages</code> file.
							</p>
							 </td><td headers="idm140611464043488" data-row="2" data-col="3" class="content--lg" valign="top" align="left"> <p>
								The default value is <code class="literal">0</code>.
							</p>
							 <p>
								To update this value at boot, change the value of this parameter in the <code class="literal">/proc/sys/vm/nr_hugepages</code> file.
							</p>
							 </td></tr><tr><td headers="idm140611464045664" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">hugepagesz</code>
							</p>
							 </td><td headers="idm140611464044576" data-row="3" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Defines the size of persistent huge pages configured in the kernel at boot time.
							</p>
							 </td><td headers="idm140611464043488" data-row="3" data-col="3" class="content--lg" valign="top" align="left"> <p>
								Valid values are <code class="literal">2 MB</code> and <code class="literal">1 GB</code>. The default value is <code class="literal">2 MB</code>.
							</p>
							 </td></tr><tr><td headers="idm140611464045664" data-row="4" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">default_hugepagesz</code>
							</p>
							 </td><td headers="idm140611464044576" data-row="4" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Defines the default size of persistent huge pages configured in the kernel at boot time.
							</p>
							 </td><td headers="idm140611464043488" data-row="4" data-col="3" class="content--lg" valign="top" align="left"> <p>
								Valid values are <code class="literal">2 MB</code> and <code class="literal">1 GB</code>. The default value is <code class="literal">2 MB</code>.
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="configuring-hugetlb-at-boot-time_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.3. Configuring HugeTLB at boot time</h2></div></div></div><p class="_abstract _abstract">
				The page size, which the HugeTLB subsystem supports, depends on the architecture. The x86_64 architecture supports <code class="literal">2 MB</code> huge pages and <code class="literal">1 GB</code> gigantic pages.
			</p><p>
				This procedure describes how to reserve a <code class="literal">1 GB</code> page at boot time.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						To create a HugeTLB pool for <code class="literal">1 GB</code> pages, enable the <code class="literal">default_hugepagesz=1G</code> and <code class="literal">hugepagesz=1G</code> kernel options:
					</p><pre class="screen"># grubby --update-kernel=ALL --args="default_hugepagesz=1G hugepagesz=1G"</pre></li><li class="listitem"><p class="simpara">
						Create a new file called <code class="literal">hugetlb-gigantic-pages.service</code> in the <code class="literal">/usr/lib/systemd/system/</code> directory and add the following content:
					</p><pre class="screen">[Unit]
Description=HugeTLB Gigantic Pages Reservation
DefaultDependencies=no
Before=dev-hugepages.mount
ConditionPathExists=/sys/devices/system/node
ConditionKernelCommandLine=hugepagesz=1G

[Service]
Type=oneshot
RemainAfterExit=yes
ExecStart=/usr/lib/systemd/hugetlb-reserve-pages.sh

[Install]
WantedBy=sysinit.target</pre></li><li class="listitem"><p class="simpara">
						Create a new file called <code class="literal">hugetlb-reserve-pages.sh</code> in the <code class="literal">/usr/lib/systemd/</code> directory and add the following content:
					</p><p class="simpara">
						While adding the following content, replace <span class="emphasis"><em>number_of_pages</em></span> with the number of 1GB pages you want to reserve, and <span class="emphasis"><em>node</em></span> with the name of the node on which to reserve these pages.
					</p><pre class="screen">#!/bin/sh

nodes_path=/sys/devices/system/node/
if [ ! -d $nodes_path ]; then
    echo "ERROR: $nodes_path does not exist"
    exit 1
fi

reserve_pages()
{
    echo $1 &gt; $nodes_path/$2/hugepages/hugepages-1048576kB/nr_hugepages
}

reserve_pages <span class="emphasis"><em>number_of_pages</em></span> <span class="emphasis"><em>node</em></span></pre><p class="simpara">
						For example, to reserve two <code class="literal">1 GB</code> pages on <span class="emphasis"><em>node0</em></span> and one 1GB page on <span class="emphasis"><em>node1</em></span>, replace the <span class="emphasis"><em>number_of_pages</em></span> with 2 for <span class="emphasis"><em>node0</em></span> and 1 for <span class="emphasis"><em>node1</em></span>:
					</p><pre class="screen">reserve_pages 2 node0
reserve_pages 1 node1</pre></li><li class="listitem"><p class="simpara">
						Create an executable script:
					</p><pre class="screen"># chmod +x /usr/lib/systemd/hugetlb-reserve-pages.sh</pre></li><li class="listitem"><p class="simpara">
						Enable early boot reservation:
					</p><pre class="screen"># systemctl enable hugetlb-gigantic-pages</pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
							You can try reserving more <code class="literal">1 GB</code> pages at runtime by writing to <code class="literal">nr_hugepages</code> at any time. However, to prevent failures due to memory fragmentation, reserve <code class="literal">1 GB</code> pages early during the boot process.
						</li><li class="listitem">
							Reserving static huge pages can effectively reduce the amount of 
memory available to the system, and prevents it from properly utilizing 
its full memory capacity. Although a properly sized pool of reserved 
huge pages can be beneficial to applications that utilize it, an 
oversized or unused pool of reserved huge pages will eventually be 
detrimental to overall system performance. When setting a reserved huge 
page pool, ensure that the system can properly utilize its full memory 
capacity.
						</li></ul></div></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">systemd.service(5)</code> man page
					</li><li class="listitem">
						<code class="literal">/usr/share/doc/kernel-doc-kernel_version/Documentation/vm/hugetlbpage.txt</code> file
					</li></ul></div></section><section class="section" id="parameters-for-reserving-hugetlb-pages-at-run-time_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.4. Parameters for reserving HugeTLB pages at run time</h2></div></div></div><p class="_abstract _abstract">
				Use the following parameters to influence HugeTLB page behavior at run time.
			</p><p>
				For more information about how to use these parameters to configure HugeTLB pages at run time, see <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#configuring-hugetlb-at-run-time_configuring-huge-pages">Configuring HugeTLB at run time</a>.
			</p><div class="table" id="idm140611463981136"><p class="title">Table 39.2. Parameters used to configure HugeTLB pages at run time</p><rh-table class="table-contents rh-table--processed" pfelement="" type="content" data-id="u4h8trt" id="rh-table--u4h8trt" style="--rh-table--scrollbar--width: 0px;"><table class="lt-4-cols lt-7-rows"><colgroup><col style="width: 33%; " class="col_1"><!--Empty--><col style="width: 33%; " class="col_2"><!--Empty--><col style="width: 33%; " class="col_3"><!--Empty--></colgroup><thead><tr><th id="idm140611463975344" scope="col" data-row="1" data-col="1" class="content--sm" valign="top" align="left">Parameter</th><th id="idm140611463974256" scope="col" data-row="1" data-col="2" class="content--sm" valign="top" align="left">Description</th><th id="idm140611463973168" scope="col" data-row="1" data-col="3" class="content--sm" valign="top" align="left">File name</th></tr></thead><tbody><tr><td headers="idm140611463975344" data-row="2" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">nr_hugepages</code>
							</p>
							 </td><td headers="idm140611463974256" data-row="2" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Defines the number of huge pages of a specified size assigned to a specified NUMA node.
							</p>
							 </td><td headers="idm140611463973168" data-row="2" data-col="3" class="content--lg" valign="top" align="left"> <p>
								<code class="literal">/sys/devices/system/node/node_id/hugepages/hugepages-size/nr_hugepages</code>
							</p>
							 </td></tr><tr><td headers="idm140611463975344" data-row="3" data-col="1" class="content--md" valign="top" align="left"> <p>
								<code class="literal">nr_overcommit_hugepages</code>
							</p>
							 </td><td headers="idm140611463974256" data-row="3" data-col="2" class="content--lg" valign="top" align="left"> <p>
								Defines the maximum number of additional huge pages that can be 
created and used by the system through overcommitting memory.
							</p>
							 <p>
								Writing any non-zero value into this file indicates that the 
system obtains that number of huge pages from the kernel’s normal page 
pool if the persistent huge page pool is exhausted. As these surplus 
huge pages become unused, they are then freed and returned to the 
kernel’s normal page pool.
							</p>
							 </td><td headers="idm140611463973168" data-row="3" data-col="3" class="content--md" valign="top" align="left"> <p>
								<code class="literal">/proc/sys/vm/nr_overcommit_hugepages</code>
							</p>
							 </td></tr></tbody></table></rh-table></div></section><section class="section" id="configuring-hugetlb-at-run-time_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.5. Configuring HugeTLB at run time</h2></div></div></div><p class="_abstract _abstract">
				This procedure describes how to add <span class="emphasis"><em>20</em></span> <span class="emphasis"><em>2048 kB</em></span> huge pages to <span class="emphasis"><em>node2</em></span>.
			</p><p>
				To reserve pages based on your requirements, replace:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<span class="emphasis"><em>20</em></span> with the number of huge pages you wish to reserve,
					</li><li class="listitem">
						<span class="emphasis"><em>2048kB</em></span> with the size of the huge pages,
					</li><li class="listitem">
						<span class="emphasis"><em>node2</em></span> with the node on which you wish to reserve the pages.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Display the memory statistics:
					</p><pre class="screen"># numastat -cm | egrep 'Node|Huge'
                 Node 0 Node 1 Node 2 Node 3  Total add
AnonHugePages         0      2      0      8     10
HugePages_Total       0      0      0      0      0
HugePages_Free        0      0      0      0      0
HugePages_Surp        0      0      0      0      0</pre></li><li class="listitem"><p class="simpara">
						Add the number of huge pages of a specified size to the node:
					</p><pre class="screen"># echo <span class="emphasis"><em>20</em></span> &gt; /sys/devices/system/node/node2/hugepages/hugepages-<span class="emphasis"><em>2048kB</em></span>/nr_hugepages</pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Ensure that the number of huge pages are added:
					</p><pre class="screen"># numastat -cm | egrep 'Node|Huge'
                 Node 0 Node 1 Node 2 Node 3  Total
AnonHugePages         0      2      0      8     10
HugePages_Total       0      0     40      0     40
HugePages_Free        0      0     40      0     40
HugePages_Surp        0      0      0      0      0</pre></li></ul></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">numastat(8)</code> man page
					</li></ul></div></section><section class="section" id="enabling-transparent-hugepages_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.6. Enabling transparent hugepages</h2></div></div></div><p class="_abstract _abstract">
				THP is enabled by default in Red&nbsp;Hat Enterprise&nbsp;Linux 9. However, you can enable or disable THP.
			</p><p>
				This procedure describes how to enable THP.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Check the current status of THP:
					</p><pre class="screen"># cat /sys/kernel/mm/transparent_hugepage/enabled</pre></li><li class="listitem"><p class="simpara">
						Enable THP:
					</p><pre class="screen"># echo always &gt; /sys/kernel/mm/transparent_hugepage/enabled</pre></li><li class="listitem"><p class="simpara">
						To prevent applications from allocating more memory resources than
 necessary, disable the system-wide transparent huge pages and only 
enable them for the applications that explicitly request it through the <code class="literal">madvise</code>:
					</p><pre class="screen"># echo madvise &gt; /sys/kernel/mm/transparent_hugepage/enabled</pre></li></ol></div><div class="admonition note"><div class="admonition_header">Note</div><div><p>
					Sometimes, providing low latency to short-lived allocations has 
higher priority than immediately achieving the best performance with 
long-lived allocations. In such cases, you can disable direct compaction
 while leaving THP enabled.
				</p><p>
					Direct compaction is a synchronous memory compaction during the 
huge page allocation. Disabling direct compaction provides no guarantee 
of saving memory, but can decrease the risk of higher latencies during 
frequent page faults. Note that if the workload benefits significantly 
from THP, the performance decreases. Disable direct compaction:
				</p><pre class="screen"># echo madvise &gt; /sys/kernel/mm/transparent_hugepage/defrag</pre></div></div><div class="itemizedlist _additional-resources"><p class="title"><strong>Additional resources</strong></p><ul class="itemizedlist _additional-resources" type="disc"><li class="listitem">
						<code class="literal">madvise(2)</code> man page
					</li><li class="listitem">
						<a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html-single/monitoring_and_managing_system_status_and_performance/configuring-huge-pages_monitoring-and-managing-system-status-and-performance#disabling-transparent-hugepage_configuring-huge-pages">Disabling transparent hugepages</a>.
					</li></ul></div></section><section class="section" id="disabling-transparent-hugepages_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.7. Disabling transparent hugepages</h2></div></div></div><p class="_abstract _abstract">
				THP is enabled by default in Red&nbsp;Hat Enterprise&nbsp;Linux 9. However, you can enable or disable THP.
			</p><p>
				This procedure describes how to disable THP.
			</p><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Check the current status of THP:
					</p><pre class="screen"># cat /sys/kernel/mm/transparent_hugepage/enabled</pre></li><li class="listitem"><p class="simpara">
						Disable THP:
					</p><pre class="screen"># echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</pre></li></ol></div></section><section class="section" id="impact-of-page-size-on-translation-lookaside-buffer-size_configuring-huge-pages"><div class="titlepage"><div><div><h2 class="title">39.8. Impact of page size on translation lookaside buffer size</h2></div></div></div><p class="_abstract _abstract">
				Reading address mappings from the page table is time-consuming and 
resource-expensive, so CPUs are built with a cache for recently-used 
addresses, called the Translation Lookaside Buffer (TLB). However, the 
default TLB can only cache a certain number of address mappings.
			</p><p>
				If a requested address mapping is not in the TLB, called a TLB miss,
 the system still needs to read the page table to determine the physical
 to virtual address mapping. Because of the relationship between 
application memory requirements and the size of pages used to cache 
address mappings, applications with large memory requirements are more 
likely to suffer performance degradation from TLB misses than 
applications with minimal memory requirements. It is therefore important
 to avoid TLB misses wherever possible.
			</p><p>
				Both HugeTLB and Transparent Huge Page features allow applications to use pages larger than <code class="literal">4 KB</code>.
 This allows addresses stored in the TLB to reference more memory, which
 reduces TLB misses and improves application performance.
			</p></section></section><section class="chapter" id="getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 40. Getting started with SystemTap</h1></div></div></div><p class="_abstract _abstract">
			As a system administrator, you can use SystemTap to identify 
underlying causes of a bug or performance problem on a running Linux 
system.
		</p><p>
			As an application developer, you can use SystemTap to monitor in fine
 detail how your application behaves within the Linux system.
		</p><section class="section" id="the-purpose-of-systemtap_getting-started-with-systemtap"><div class="titlepage"><div><div><h2 class="title">40.1. The purpose of SystemTap</h2></div></div></div><p class="_abstract _abstract">
				SystemTap is a tracing and probing tool that you can use to study 
and monitor the activities of your operating system (particularly, the 
kernel) in fine detail. SystemTap provides information similar to the 
output of tools such as <code class="literal">netstat</code>, <code class="literal">ps</code>, <code class="literal">top</code>, and <code class="literal">iostat</code>.
 However, SystemTap provides more filtering and analysis options for 
collected information. In SystemTap scripts, you specify the information
 that SystemTap gathers.
			</p><p>
				SystemTap aims to supplement the existing suite of Linux monitoring 
tools by providing users with the infrastructure to track kernel 
activity and combining this capability with two attributes:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="strong strong"><strong>Flexibility</strong></span></span></dt><dd>
							the SystemTap framework enables you to develop simple scripts for
 investigating and monitoring a wide variety of kernel functions, system
 calls, and other events that occur in kernel space. With this, 
SystemTap is not so much a tool as it is a system that allows you to 
develop your own kernel-specific forensic and monitoring tools.
						</dd><dt><span class="term"><span class="strong strong"><strong>Ease-of-Use</strong></span></span></dt><dd>
							SystemTap enables you to monitor kernel activity without having to recompile the kernel or reboot the system.
						</dd></dl></div></section><section class="section" id="installing-systemtap_getting-started-with-systemtap"><div class="titlepage"><div><div><h2 class="title">40.2. Installing SystemTap</h2></div></div></div><p class="_abstract _abstract">
				To begin using SystemTap, install the required packages. To use 
SystemTap on more than one kernel where a system has multiple kernels 
installed, install the corresponding required kernel packages for <span class="emphasis"><em>each</em></span> kernel version.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have enabled debug repositories as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/developing_c_and_cpp_applications_in_rhel_9/setting-up-a-development-workstation_developing-applications#enabling-debug-and-source-repositories_setting-up-a-development-workstation">Enabling debug and source repositories</a>.
					</li></ul></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Install the required SystemTap packages:
					</p><pre class="screen"># dnf install systemtap</pre></li><li class="listitem"><p class="simpara">
						Install the required kernel packages:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Using <code class="literal">stap-prep</code>:
							</p><pre class="screen"># stap-prep</pre></li><li class="listitem"><p class="simpara">
								If <code class="literal">stap-prep</code> does not work, install the required kernel packages manually:
							</p><pre class="screen"># dnf install kernel-debuginfo-$(uname -r) kernel-debuginfo-common-$(uname -i)-$(uname -r) kernel-devel-$(uname -r)</pre><p class="simpara">
								<code class="literal">$(uname -i)</code> is automatically replaced with the hardware platform of your system and <code class="literal">$(uname -r)</code> is automatically replaced with the version of your running kernel.
							</p></li></ol></div></li></ol></div><div class="itemizedlist"><p class="title"><strong>Verification steps</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						If the kernel to be probed with SystemTap is currently in use, test if your installation was successful:
					</p><pre class="screen"># stap -v -e 'probe kernel.function("vfs_read") {printf("read performed\n"); exit()}'</pre><p class="simpara">
						A successful SystemTap deployment results in an output similar to the following:
					</p><pre class="screen">Pass 1: parsed user script and 45 library script(s) in 340usr/0sys/358real ms.
Pass 2: analyzed script: 1 probe(s), 1 function(s), 0 embed(s), 0 global(s) in 290usr/260sys/568real ms.
Pass 3: translated to C into "/tmp/stapiArgLX/stap_e5886fa50499994e6a87aacdc43cd392_399.c" in 490usr/430sys/938real ms.
Pass 4: compiled C into "stap_e5886fa50499994e6a87aacdc43cd392_399.ko" in 3310usr/430sys/3714real ms.
Pass 5: starting run. <span class="token number" id="parent.CO1-1"><a class="colist-num" href="#footnote--CO1-1"><i class="conum" id="CO1-1">1</i></a></span>
read performed <span class="token number" id="parent.CO1-2"><a class="colist-num" href="#footnote--CO1-2"><i class="conum" id="CO1-2">2</i></a></span>
Pass 5: run completed in 10usr/40sys/73real ms. <span class="token number" id="parent.CO1-3"><a class="colist-num" href="#footnote--CO1-3"><i class="conum" id="CO1-3">3</i></a></span></pre><p class="simpara">
						The last three lines of output (beginning with <code class="literal">Pass 5</code>) indicate that:
					</p><div class="calloutlist"><dl class="calloutlist"><dt><a class="colist-num" href="#CO1-1" id="footnote--CO1-1"><i class="conum">1</i></a> </dt><dd><div class="para">
								SystemTap successfully created the instrumentation to probe the kernel and ran the instrumentation.
							</div></dd><dt><a class="colist-num" href="#CO1-2" id="footnote--CO1-2"><i class="conum">2</i></a> </dt><dd><div class="para">
								SystemTap detected the specified event (in this case, A VFS read).
							</div></dd><dt><a class="colist-num" href="#CO1-3" id="footnote--CO1-3"><i class="conum">3</i></a> </dt><dd><div class="para">
								SystemTap executed a valid handler (printed text and then closed it with no errors).
							</div></dd></dl></div></li></ul></div></section><section class="section" id="privileges-to-run-systemtap_getting-started-with-systemtap"><div class="titlepage"><div><div><h2 class="title">40.3. Privileges to run SystemTap</h2></div></div></div><p class="_abstract _abstract">
				Running SystemTap scripts requires elevated system privileges but, 
in some instances, non-privileged users might need to run SystemTap 
instrumentation on their machine.
			</p><p>
				To allow users to run SystemTap without root access, add users to <span class="strong strong"><strong>both</strong></span> of these user groups:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">stapdev</code></span></dt><dd><p class="simpara">
							Members of this group can use <code class="literal">stap</code> to run SystemTap scripts, or <code class="literal">staprun</code> to run SystemTap instrumentation modules.
						</p><p class="simpara">
							Running <code class="literal">stap</code> involves compiling 
SystemTap scripts into kernel modules and loading them into the kernel. 
This requires elevated privileges to the system, which are granted to <code class="literal">stapdev</code> members. Unfortunately, such privileges also grant effective root access to <code class="literal">stapdev</code> members. As such, only grant <code class="literal">stapdev</code> group membership to users who can be trusted with root access.
						</p></dd><dt><span class="term"><code class="literal">stapusr</code></span></dt><dd>
							Members of this group can only use <code class="literal">staprun</code> to run SystemTap instrumentation modules. In addition, they can only run those modules from the <code class="literal">/lib/modules/<span class="emphasis"><em>kernel_version</em></span>/systemtap/</code> directory. This directory must be owned only by the root user, and must only be writable by the root user.
						</dd></dl></div></section><section class="section" id="running-systemtap-scripts_getting-started-with-systemtap"><div class="titlepage"><div><div><h2 class="title">40.4. Running SystemTap scripts</h2></div></div></div><p class="_abstract _abstract">
				You can run SystemTap scripts from standard input or from a file.
			</p><p>
				Sample scripts that are distributed with the installation of SystemTap can be found in the <code class="literal">/usr/share/systemtap/examples</code> directory.
			</p><div class="orderedlist"><p class="title"><strong>Prerequisites</strong></p><ol class="orderedlist" type="1"><li class="listitem">
						SystemTap and the associated required kernel packages are installed as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li><li class="listitem"><p class="simpara">
						To run SystemTap scripts as a normal user, add the user to the SystemTap groups:
					</p><pre class="screen"># usermod --append --groups
stapdev,stapusr <span class="emphasis"><em>user-name</em></span></pre></li></ol></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the SystemTap script:
					</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p class="simpara">
								From standard input:
							</p><pre class="screen"># echo "probe timer.s(1) {exit()}" | stap -</pre><p class="simpara">
								This command instructs <code class="literal">stap</code> to run the script passed by <code class="literal">echo</code> to standard input. To add <code class="literal">stap</code> options, insert them before the <code class="literal">-</code> character. For example, to make the results from this command more verbose, the command is:
							</p><pre class="screen"># echo "probe timer.s(1) {exit()}" | stap -v -</pre></li><li class="listitem"><p class="simpara">
								From a file:
							</p><pre class="screen"># stap <span class="emphasis"><em>file_name</em></span></pre></li></ul></div></li></ul></div></section></section><section class="chapter" id="cross-instrumentation-of-systemtap_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 41. Cross-instrumentation of SystemTap</h1></div></div></div><p class="_abstract _abstract">
			Cross-instrumentation of SystemTap is creating SystemTap 
instrumentation modules from a SystemTap script on one system to be used
 on another system that does not have SystemTap fully deployed.
		</p><section class="section" id="systemtap-cross-instrumentation_cross-instrumentation-of-systemtap"><div class="titlepage"><div><div><h2 class="title">41.1. SystemTap cross-instrumentation</h2></div></div></div><p class="_abstract _abstract">
				When you run a SystemTap script, a kernel module is built out of 
that script. SystemTap then loads the module into the kernel.
			</p><p>
				Normally, SystemTap scripts can run only on systems where SystemTap 
is deployed. To run SystemTap on ten systems, SystemTap needs to be 
deployed on all those systems. In some cases, this might be neither 
feasible nor desired. For example, corporate policy might prohibit you 
from installing packages that provide compilers or debug information 
about specific machines, which will prevent the deployment of SystemTap.
			</p><p>
				To work around this, use <span class="emphasis"><em>cross-instrumentation</em></span>.
 Cross-instrumentation is the process of generating SystemTap 
instrumentation modules from a SystemTap script on one system to be used
 on another system. This process offers the following benefits:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						The kernel information packages for various machines can be installed on a single host machine.
					</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							Kernel packaging bugs may prevent the installation. In such cases, the <code class="literal">kernel-debuginfo</code> and <code class="literal">kernel-devel</code> packages for the <span class="emphasis"><em>host system</em></span> and <span class="emphasis"><em>target system</em></span> must match. If a bug occurs, report the bug at <a class="link" href="https://bugzilla.redhat.com/">https://bugzilla.redhat.com/</a>.
						</p></div></div></li><li class="listitem"><p class="simpara">
						Each <span class="emphasis"><em>target machine</em></span> needs only one package to be installed to use the generated SystemTap instrumentation module: <code class="literal">systemtap-runtime</code>.
					</p><div class="admonition important"><div class="admonition_header">Important</div><div><p>
							The <span class="emphasis"><em>host system</em></span> must be the same architecture and running the same distribution of Linux as the <span class="emphasis"><em>target system</em></span> in order for the built <span class="emphasis"><em>instrumentation module</em></span> to work.
						</p></div></div></li></ul></div><div class="admonition note"><div class="admonition_header">Terminology</div><div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="emphasis"><em>instrumentation module</em></span></span></dt><dd>
								The kernel module built from a SystemTap script; the SystemTap module is built on the <span class="emphasis"><em>host system</em></span>, and will be loaded on the <span class="emphasis"><em>target kernel</em></span> of the <span class="emphasis"><em>target system</em></span>.
							</dd><dt><span class="term"><span class="emphasis"><em>host system</em></span></span></dt><dd>
								The system on which the instrumentation modules (from SystemTap scripts) are compiled, to be loaded on <span class="emphasis"><em>target systems</em></span>.
							</dd><dt><span class="term"><span class="emphasis"><em>target system</em></span></span></dt><dd>
								The system in which the <span class="emphasis"><em>instrumentation module</em></span> is being built (from SystemTap scripts).
							</dd><dt><span class="term"><span class="emphasis"><em>target kernel</em></span></span></dt><dd>
								The kernel of the <span class="emphasis"><em>target system</em></span>. This is the kernel that loads and runs the <span class="emphasis"><em>instrumentation module</em></span>.
							</dd></dl></div></div></div></section><section class="section" id="initializing-cross-instrumentation-of-systemtap_cross-instrumentation-of-systemtap"><div class="titlepage"><div><div><h2 class="title">41.2. Initializing cross-instrumentation of SystemTap</h2></div></div></div><p class="_abstract _abstract">
				Initialize cross-instrumentation of SystemTap to build SystemTap 
instrumentation modules from a SystemTap script on one system and use 
them on another system that does not have SystemTap fully deployed.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						SystemTap is installed on the <span class="emphasis"><em>host system</em></span> as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li><li class="listitem"><p class="simpara">
						The <code class="literal">systemtap-runtime</code> package is installed on each <span class="emphasis"><em>target system</em></span>:
					</p><pre class="screen"># dnf install systemtap-runtime</pre></li><li class="listitem">
						Both the <span class="emphasis"><em>host system</em></span> and <span class="emphasis"><em>target system</em></span> are the same architecture.
					</li><li class="listitem">
						Both the <span class="emphasis"><em>host system</em></span> and <span class="emphasis"><em>target system</em></span> are running the same major version of Red&nbsp;Hat Enterprise&nbsp;Linux (such as Red&nbsp;Hat Enterprise&nbsp;Linux 9).
					</li></ul></div><div class="admonition important"><div class="admonition_header">Important</div><div><p>
					Kernel packaging bugs may prevent multiple <code class="literal">kernel-debuginfo</code> and <code class="literal">kernel-devel</code> packages from being installed on one system. In such cases, the minor version for the <span class="emphasis"><em>host system</em></span> and <span class="emphasis"><em>target system</em></span> must match. If a bug occurs, report it at <a class="link" href="https://bugzilla.redhat.com/">https://bugzilla.redhat.com/</a>.
				</p></div></div><div class="orderedlist"><p class="title"><strong>Procedure</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p class="simpara">
						Determine the kernel running on each <span class="emphasis"><em>target system</em></span>:
					</p><pre class="screen">$ uname -r</pre><p class="simpara">
						Repeat this step for each <span class="emphasis"><em>target system</em></span>.
					</p></li><li class="listitem">
						On the <span class="emphasis"><em>host system</em></span>, install the <span class="emphasis"><em>target kernel</em></span> and related packages for each <span class="emphasis"><em>target system</em></span> by the method described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li><li class="listitem"><p class="simpara">
						Build an instrumentation module on the <span class="emphasis"><em>host system</em></span>, copy this module to and run this module on on the <span class="emphasis"><em>target system</em></span> either:
					</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p class="simpara">
								Using remote implementation:
							</p><pre class="screen"># stap --remote <span class="emphasis"><em>target_system</em></span> <span class="emphasis"><em>script</em></span></pre><p class="simpara">
								This command remotely implements the specified script on the <span class="emphasis"><em>target system</em></span>. You must ensure an SSH connection can be made to the <span class="emphasis"><em>target system</em></span> from the <span class="emphasis"><em>host system</em></span> for this to be successful.
							</p></li><li class="listitem"><p class="simpara">
								Manually:
							</p><div class="orderedlist"><ol class="orderedlist" type="i"><li class="listitem"><p class="simpara">
										Build the instrumentation module on the <span class="emphasis"><em>host system</em></span>:
									</p><pre class="screen"># stap -r <span class="emphasis"><em>kernel_version</em></span> <span class="emphasis"><em>script</em></span> -m <span class="emphasis"><em>module_name</em></span> -p 4</pre><p class="simpara">
										Here, <span class="emphasis"><em>kernel_version</em></span> refers to the version of the <span class="emphasis"><em>target kernel</em></span> determined in step 1, <span class="emphasis"><em>script</em></span> refers to the script to be converted into an <span class="emphasis"><em>instrumentation module</em></span>, and <span class="emphasis"><em>module_name</em></span> is the desired name of the <span class="emphasis"><em>instrumentation module</em></span>. The <code class="literal">-p4</code> option tells SystemTap to not load and run the compiled module.
									</p></li><li class="listitem"><p class="simpara">
										Once the <span class="emphasis"><em>instrumentation module</em></span> is compiled, copy it to the target system and load it using the following command:
									</p><pre class="screen"># staprun <span class="emphasis"><em>module_name</em></span>.ko</pre></li></ol></div></li></ol></div></li></ol></div></section></section><section class="chapter" id="monitoring-network-activity-with-systemtap_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 42. Monitoring network activity with SystemTap</h1></div></div></div><p class="_abstract _abstract">
			You can use helpful example SystemTap scripts available in the <code class="literal">/usr/share/systemtap/testsuite/systemtap.examples/</code> directory, upon installing the <code class="literal">systemtap-testsuite</code> package, to monitor and investigate the network activity of your system.
		</p><section class="section" id="profiling-network-activity-with-systemtap_assembly_monitoring-network-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">42.1. Profiling network activity with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <code class="literal">nettop.stp</code> example 
SystemTap script to profile network activity. The script tracks which 
processes are generating network traffic on the system, and provides the
 following information about each process:
			</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">PID </span></dt><dd>
							The ID of the listed process.
						</dd><dt><span class="term">UID </span></dt><dd>
							User ID. A user ID of 0 refers to the root user.
						</dd><dt><span class="term">DEV </span></dt><dd>
							Which ethernet device the process used to send or receive data (for example, eth0, eth1).
						</dd><dt><span class="term">XMIT_PK </span></dt><dd>
							The number of packets transmitted by the process.
						</dd><dt><span class="term">RECV_PK </span></dt><dd>
							The number of packets received by the process.
						</dd><dt><span class="term">XMIT_KB </span></dt><dd>
							The amount of data sent by the process, in kilobytes.
						</dd><dt><span class="term">RECV_KB </span></dt><dd>
							The amount of data received by the service, in kilobytes.
						</dd></dl></div><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="#installing-systemtap_getting-started-with-systemtap" title="40.2.&nbsp;Installing SystemTap">Installing SystemTap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <code class="literal">nettop.stp</code> script:
					</p><pre class="screen"># stap  --example nettop.stp</pre><p class="simpara">
						The <code class="literal">nettop.stp</code> script provides network profile sampling every 5 seconds.
					</p><p class="simpara">
						Output of the <code class="literal">nettop.stp</code> script looks similar to the following:
					</p><pre class="literallayout white-space-pre">[...]
  PID   UID DEV     XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND
    0     0 eth0          0       5       0       0 swapper
11178     0 eth0          2       0       0       0 synergyc
  PID   UID DEV     XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND
 2886     4 eth0         79       0       5       0 cups-polld
11362     0 eth0          0      61       0       5 firefox
    0     0 eth0          3      32       0       3 swapper
 2886     4 lo            4       4       0       0 cups-polld
11178     0 eth0          3       0       0       0 synergyc
  PID   UID DEV     XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND
    0     0 eth0          0       6       0       0 swapper
 2886     4 lo            2       2       0       0 cups-polld
11178     0 eth0          3       0       0       0 synergyc
 3611     0 eth0          0       1       0       0 Xorg
  PID   UID DEV     XMIT_PK RECV_PK XMIT_KB RECV_KB COMMAND
    0     0 eth0          3      42       0       2 swapper
11178     0 eth0         43       1       3       0 synergyc
11362     0 eth0          0       7       0       0 firefox
 3897     0 eth0          0       1       0       0 multiload-apple</pre></li></ul></div></section><section class="section" id="tracing-functions-called-in-network-socket-code-with-systemtap_assembly_monitoring-network-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">42.2. Tracing functions called in network socket code with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <code class="literal">socket-trace.stp</code> 
example SystemTap script to trace functions called from the kernel’s 
net/socket.c file. This helps you identify, in finer detail, how each 
process interacts with the network at the kernel level.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="#installing-systemtap_getting-started-with-systemtap" title="40.2.&nbsp;Installing SystemTap">Installing SystemTap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <code class="literal">socket-trace.stp</code> script:
					</p><pre class="screen"># stap  --example socket-trace.stp</pre><p class="simpara">
						A 3-second excerpt of the output of the <code class="literal">socket-trace.stp</code> script looks similar to the following:
					</p><pre class="literallayout white-space-pre">[...]
0 Xorg(3611): -&gt; sock_poll
3 Xorg(3611): &lt;- sock_poll
0 Xorg(3611): -&gt; sock_poll
3 Xorg(3611): &lt;- sock_poll
0 gnome-terminal(11106): -&gt; sock_poll
5 gnome-terminal(11106): &lt;- sock_poll
0 scim-bridge(3883): -&gt; sock_poll
3 scim-bridge(3883): &lt;- sock_poll
0 scim-bridge(3883): -&gt; sys_socketcall
4 scim-bridge(3883):  -&gt; sys_recv
8 scim-bridge(3883):   -&gt; sys_recvfrom
12 scim-bridge(3883):-&gt; sock_from_file
16 scim-bridge(3883):&lt;- sock_from_file
20 scim-bridge(3883):-&gt; sock_recvmsg
24 scim-bridge(3883):&lt;- sock_recvmsg
28 scim-bridge(3883):   &lt;- sys_recvfrom
31 scim-bridge(3883):  &lt;- sys_recv
35 scim-bridge(3883): &lt;- sys_socketcall
[...]</pre></li></ul></div></section><section class="section" id="proc_monitoring-network-packet-drops-with-systemtap_assembly_monitoring-network-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">42.3. Monitoring network packet drops with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				The network stack in Linux can discard packets for various reasons. Some Linux kernels include a tracepoint, <code class="literal">kernel.trace("kfree_skb")`</code>, which tracks where packets are discarded.
			</p><p>
				The <code class="literal">dropwatch.stp</code> SystemTap script uses <code class="literal">kernel.trace("kfree_skb")</code> to trace packet discards; the script summarizes what locations discard packets in every 5-second interval.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="#installing-systemtap_getting-started-with-systemtap" title="40.2.&nbsp;Installing SystemTap">Installing SystemTap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <code class="literal">dropwatch.stp</code> script:
					</p><pre class="screen"># stap  --example dropwatch.stp</pre><p class="simpara">
						Running the <code class="literal">dropwatch.stp</code> script for 15 seconds results in output similar to the following:
					</p><pre class="screen">Monitoring for dropped packets
51 packets dropped at location 0xffffffff8024cd0f
2 packets dropped at location 0xffffffff8044b472
51 packets dropped at location 0xffffffff8024cd0f
1 packets dropped at location 0xffffffff8044b472
97 packets dropped at location 0xffffffff8024cd0f
1 packets dropped at location 0xffffffff8044b472
Stopping dropped packet monitor</pre><div class="admonition note"><div class="admonition_header">Note</div><div><p>
							To make the location of packet drops more meaningful, see the <code class="literal">/boot/System.map-$(uname -r)</code> file. This file lists the starting addresses for each function, enabling you to map the addresses in the output of the <code class="literal">dropwatch.stp</code> script to a specific function name. Given the following snippet of the <code class="literal">/boot/System.map-$(uname -r)</code> file, the address <code class="literal">0xffffffff8024cd0f</code> maps to the function <code class="literal">unix_stream_recvmsg</code> and the address <code class="literal">0xffffffff8044b472</code> maps to the function <code class="literal">arp_rcv</code>:
						</p><pre class="literallayout white-space-pre">[...]
ffffffff8024c5cd T unlock_new_inode
ffffffff8024c5da t unix_stream_sendmsg
ffffffff8024c920 t unix_stream_recvmsg
ffffffff8024cea1 t udp_v4_lookup_longway
[...]
ffffffff8044addc t arp_process
ffffffff8044b360 t arp_rcv
ffffffff8044b487 t parp_redo
ffffffff8044b48c t arp_solicit
[...]</pre></div></div></li></ul></div></section></section><section class="chapter" id="assembly_profiling-kernel-activity-with-systemtap_monitoring-and-managing-system-status-and-performance"><div class="titlepage"><div><div><h1 class="title">Chapter 43. Profiling kernel activity with SystemTap</h1></div></div></div><p class="_abstract _abstract">
			You can profile the kernel activity by monitoring function calls with the following scripts.
		</p><section class="section" id="proc_counting-function-calls-with-systemtap_assembly_profiling-kernel-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">43.1. Counting function calls with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>functioncallcount.stp</strong></span> SystemTap script to count specific kernel function calls. You can also use this script to target multiple kernel functions.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>functioncallcount.stp</strong></span> script:
					</p><pre class="screen"># stap --example functioncallcount.stp <span class="emphasis"><em>'argument'</em></span></pre><p class="simpara">
						This script takes the targeted kernel function as an argument. You
 can use the argument wildcards to target multiple kernel functions up 
to a certain extent.
					</p><p class="simpara">
						The output of the script, in alphabetical order, contains the 
names of the functions called and how many times it was called during 
the sample time.
					</p><p class="simpara">
						Consider the following example:
					</p><pre class="screen"># stap -w -v --example functioncallcount.stp "*@mm*.c" -c /bin/true</pre><p class="simpara">
						where:
					</p></li><li class="listitem">
						-w : Suppresses warnings.
					</li><li class="listitem">
						-v : Makes the output of starting kernel visible.
					</li><li class="listitem"><p class="simpara">
						-c <span class="emphasis"><em>command</em></span> : Tells SystemTap to count function calls during the execution of a command, in this example being <code class="literal">/bin/true</code>.
					</p><p class="simpara">
						The output should look similar to the following:
					</p><pre class="screen">[...]
__vma_link 97
__vma_link_file 66
__vma_link_list 97
__vma_link_rb 97
__xchg 103
add_page_to_active_list 102
add_page_to_inactive_list 19
add_to_page_cache 19
add_to_page_cache_lru 7
all_vm_events 6
alloc_pages_node 4630
alloc_slabmgmt 67
anon_vma_alloc 62
anon_vma_free 62
anon_vma_lock 66
anon_vma_prepare 98
anon_vma_unlink 97
anon_vma_unlock 66
arch_get_unmapped_area_topdown 94
arch_get_unmapped_exec_area 3
arch_unmap_area_topdown 97
atomic_add 2
atomic_add_negative 97
atomic_dec_and_test 5153
atomic_inc 470
atomic_inc_and_test 1
[...]</pre></li></ul></div></section><section class="section" id="proc_tracing-function-calls-with-systemtap_assembly_profiling-kernel-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">43.2. Tracing function calls with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>para-callgraph.stp</strong></span> SystemTap script to trace function calls and function returns.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Run the <span class="strong strong"><strong>para-callgraph.stp</strong></span> script.
					</li></ul></div><pre class="screen"># stap --example para-callgraph.stp <span class="emphasis"><em>'argument1'</em></span> <span class="emphasis"><em>'argument2'</em></span></pre><p>
				The script <span class="strong strong"><strong>para-callgraph.stp</strong></span> takes two command-line arguments:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						The name of the function(s) whose entry/exit you’d like to trace.
					</li><li class="listitem">
						An optional trigger function, which enables or disables tracing on
 a per-thread basis. Tracing in each thread will continue as long as the
 trigger function has not exited yet.
					</li></ol></div><p>
				Consider the following example:
			</p><pre class="screen"># stap -wv --example para-callgraph.stp 'kernel.function("*@fs/proc.c*")' 'kernel.function("vfs_read")' -c "cat /proc/sys/vm/* || true"</pre><p>
				where:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						-w : Suppresses warnings.
					</li><li class="listitem">
						-v : Makes the output of starting kernel visible.
					</li><li class="listitem">
						-c <span class="emphasis"><em>command</em></span> : Tells SystemTap to count function calls during the execution of a command, in this example being <code class="literal">/bin/true</code>.
					</li></ul></div><p>
				The output should look similar to the following:
			</p><pre class="screen">[...]
   267 gnome-terminal(2921): &lt;-do_sync_read return=0xfffffffffffffff5
   269 gnome-terminal(2921):&lt;-vfs_read return=0xfffffffffffffff5
     0 gnome-terminal(2921):-&gt;fput file=0xffff880111eebbc0
     2 gnome-terminal(2921):&lt;-fput
     0 gnome-terminal(2921):-&gt;fget_light fd=0x3 fput_needed=0xffff88010544df54
     3 gnome-terminal(2921):&lt;-fget_light return=0xffff8801116ce980
     0 gnome-terminal(2921):-&gt;vfs_read file=0xffff8801116ce980 buf=0xc86504 count=0x1000 pos=0xffff88010544df48
     4 gnome-terminal(2921): -&gt;rw_verify_area read_write=0x0 file=0xffff8801116ce980 ppos=0xffff88010544df48 count=0x1000
     7 gnome-terminal(2921): &lt;-rw_verify_area return=0x1000
    12 gnome-terminal(2921): -&gt;do_sync_read filp=0xffff8801116ce980 buf=0xc86504 len=0x1000 ppos=0xffff88010544df48
    15 gnome-terminal(2921): &lt;-do_sync_read return=0xfffffffffffffff5
    18 gnome-terminal(2921):&lt;-vfs_read return=0xfffffffffffffff5
     0 gnome-terminal(2921):-&gt;fput file=0xffff8801116ce980</pre></section><section class="section" id="proc_determining-time-spent-in-kernel-and-user-space-with-systemtap_assembly_profiling-kernel-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">43.3. Determining time spent in kernel and user space with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>thread-times.stp</strong></span> SystemTap script to determine the amount of time any given thread is spending in either the kernel or user-space.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>thread-times.stp</strong></span> script:
					</p><pre class="screen"># stap --example thread-times.stp</pre><p class="simpara">
						This script will display the top 20 processes taking up CPU time 
during a 5-second period, along with the total number of CPU ticks made 
during the sample. The output of this script also notes the percentage 
of CPU time each process used, as well as whether that time was spent in
 kernel space or user space.
					</p><pre class="screen">tid   %user %kernel (of 20002 ticks)
  0   0.00%  87.88%
32169   5.24%   0.03%
9815   3.33%   0.36%
9859   0.95%   0.00%
3611   0.56%   0.12%
9861   0.62%   0.01%
11106   0.37%   0.02%
32167   0.08%   0.08%
3897   0.01%   0.08%
3800   0.03%   0.00%
2886   0.02%   0.00%
3243   0.00%   0.01%
3862   0.01%   0.00%
3782   0.00%   0.00%
21767   0.00%   0.00%
2522   0.00%   0.00%
3883   0.00%   0.00%
3775   0.00%   0.00%
3943   0.00%   0.00%
3873   0.00%   0.00%</pre></li></ul></div></section><section class="section" id="proc_monitoring-polling-applications-with-systemtap_assembly_profiling-kernel-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">43.4. Monitoring polling applications with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use <span class="strong strong"><strong>timeout.stp</strong></span>
 SystemTap script to identify and monitor which applications are 
polling. Doing so allows you to track unnecessary or excessive polling, 
which helps you pinpoint areas for improvement in terms of CPU usage and
 power savings.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>timeout.stp</strong></span> script:
					</p><pre class="screen"># stap --example timeout.stp</pre><p class="simpara">
						This script will track how many times each application uses the following system calls over time:
					</p></li><li class="listitem">
						<code class="literal">poll</code>
					</li><li class="listitem">
						<code class="literal">select</code>
					</li><li class="listitem">
						<code class="literal">epoll</code>
					</li><li class="listitem">
						<code class="literal">itimer</code>
					</li><li class="listitem">
						<code class="literal">futex</code>
					</li><li class="listitem">
						<code class="literal">nanosleep</code>
					</li><li class="listitem">
						<code class="literal">signal</code>
					</li></ul></div><p>
				In this example output you can see which process used which system call and how many times.
			</p><pre class="screen">uid |   poll  select   epoll  itimer   futex nanosle  signal| process
28937 | 148793       0       0    4727   37288       0       0| firefox
22945 |      0   56949       0       1       0       0       0| scim-bridge
  0 |      0       0       0   36414       0       0       0| swapper
4275 |  23140       0       0       1       0       0       0| mixer_applet2
4191 |      0   14405       0       0       0       0       0| scim-launcher
22941 |   7908       1       0      62       0       0       0| gnome-terminal
4261 |      0       0       0       2       0    7622       0| escd
3695 |      0       0       0       0       0    7622       0| gdm-binary
3483 |      0    7206       0       0       0       0       0| dhcdbd
4189 |   6916       0       0       2       0       0       0| scim-panel-gtk
1863 |   5767       0       0       0       0       0       0| iscsid</pre></section><section class="section" id="proc_tracking-most-frequently-used-system-calls-with-systemtap_assembly_profiling-kernel-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">43.5. Tracking most frequently used system calls with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>topsys.stp</strong></span>
 SystemTap script to list the top 20 system calls used by the system per
 5-second interval. It also lists how many times each system call was 
used during that period.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>topsys.stp</strong></span> script:
					</p><pre class="screen"># stap --example topsys.stp</pre><p class="simpara">
						Consider the following example:
					</p><pre class="screen"># stap -v --example topsys.stp</pre><p class="simpara">
						where -v makes the output of starting kernel visible.
					</p><p class="simpara">
						The output should look similar to the following:
					</p></li></ul></div><pre class="screen">--------------------------------------------------------------
                  SYSCALL      COUNT
             gettimeofday       1857
                     read       1821
                    ioctl       1568
                     poll       1033
                    close        638
                     open        503
                   select        455
                    write        391
                   writev        335
                    futex        303
                  recvmsg        251
                   socket        137
            clock_gettime        124
           rt_sigprocmask        121
                   sendto        120
                setitimer        106
                     stat         90
                     time         81
                sigreturn         72
                    fstat         66
--------------------------------------------------------------</pre></section><section class="section" id="proc_tracking-system-call-volume-per-process-with-systemtap_assembly_profiling-kernel-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">43.6. Tracking system call volume per process with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>syscalls_by_proc.stp</strong></span>
 SystemTap script to see which processes are performing the highest 
volume of system calls. It displays 20 processes performing the most of 
system calls.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>syscalls_by_proc.stp</strong></span> script:
					</p><pre class="screen"># stap --example syscalls_by_proc.stp</pre><p class="simpara">
						Output of the <span class="strong strong"><strong>syscalls_by_proc.stp</strong></span> script looks similar to the following:
					</p><pre class="screen">Collecting data... Type Ctrl-C to exit and display results
#SysCalls  Process Name
1577       multiload-apple
692        synergyc
408        pcscd
376        mixer_applet2
299        gnome-terminal
293        Xorg
206        scim-panel-gtk
95         gnome-power-man
90         artsd
85         dhcdbd
84         scim-bridge
78         gnome-screensav
66         scim-launcher
[...]</pre></li></ul></div></section></section><section class="chapter" id="assembly_monitoring-disk-and-i-o-activity-with-systemtap_assembly_profiling-kernel-activity-with-systemtap"><div class="titlepage"><div><div><h1 class="title">Chapter 44. Monitoring disk and I/O activity with SystemTap</h1></div></div></div><p class="_abstract _abstract">
			You can monitor disk and I/O activity with the following scripts.
		</p><section class="section" id="proc_summarizing-disk-read-write-traffic-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">44.1. Summarizing disk read/write traffic with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>disktop.stp</strong></span> SystemTap script to identify which processes are performing the heaviest disk reads and writes to the system.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>disktop.stp</strong></span> script:
					</p><pre class="screen"># stap --example disktop.stp</pre><p class="simpara">
						The script displays the top ten processes responsible for the heaviest reads or writes to a disk.
					</p><p class="simpara">
						The output includes the following data per listed process:
					</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">UID </span></dt><dd>
									User ID. A user ID of <code class="literal">0</code> refers to the root user.
								</dd><dt><span class="term">PID </span></dt><dd>
									The ID of the listed process.
								</dd><dt><span class="term">PPID </span></dt><dd>
									The process ID of the listed process’s parent process.
								</dd><dt><span class="term">CMD </span></dt><dd>
									The name of the listed process.
								</dd><dt><span class="term">DEVICE </span></dt><dd>
									Which storage device the listed process is reading from or writing to.
								</dd><dt><span class="term">T </span></dt><dd>
									The type of action performed by the listed process, where <code class="literal">W</code> refers to write, and <code class="literal">R</code> refers to read.
								</dd><dt><span class="term">BYTES </span></dt><dd>
									The amount of data read to or written from disk.
								</dd></dl></div></li></ul></div><p>
				Output of the <code class="literal">disktop.stp</code> script looks similar to the following:
			</p><pre class="screen">[...]
Mon Sep 29 03:38:28 2008 , Average:  19Kb/sec, Read: 7Kb, Write: 89Kb
UID      PID     PPID                       CMD   DEVICE    T    BYTES
0    26319    26294                   firefox     sda5    W        90229
0     2758     2757           pam_timestamp_c     sda5    R         8064
0     2885        1                     cupsd     sda5    W         1678
Mon Sep 29 03:38:38 2008 , Average:   1Kb/sec, Read: 7Kb, Write: 1Kb
UID      PID     PPID                       CMD   DEVICE    T    BYTES
0     2758     2757           pam_timestamp_c     sda5    R         8064
0     2885        1                     cupsd     sda5    W         1678</pre></section><section class="section" id="proc_tracking-i-o-time-for-each-file-read-or-write-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">44.2. Tracking I/O time for each file read or write with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>iotime.stp</strong></span>
 SystemTap script to monitor the amount of time it takes for each 
process to read from or write to any file. This helps you to determine 
what files are slow to load on a system.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>iotime.stp</strong></span> script:
					</p><pre class="screen"># stap --example iotime.stp</pre><p class="simpara">
						The script tracks each time a system call opens, closes, reads 
from, and writes to a file. For each file any system call accesses, It 
counts the number of microseconds it takes for any reads or writes to 
finish and tracks the amount of data , in bytes, read from or written to
 the file.
					</p><p class="simpara">
						The output contains:
					</p></li><li class="listitem">
						A timestamp, in microseconds
					</li><li class="listitem">
						Process ID and process name
					</li><li class="listitem">
						An <code class="literal">access</code> or <code class="literal">iotime</code> flag
					</li><li class="listitem"><p class="simpara">
						The file accessed
					</p><p class="simpara">
						If a process was able to read or write any data, a pair of access and <code class="literal">iotime</code>
 lines should appear together. The access line refers to the time that a
 given process started accessing a file. The end of the access line will
 show the amount of data read or written. The <code class="literal">iotime</code> line will show the amount of time, in microseconds, that the process took in order to perform the read or write.
					</p></li></ul></div><p>
				Output of the <code class="literal">iotime.stp</code> script looks similar to the following:
			</p><pre class="screen">[...]
825946 3364 (NetworkManager) access /sys/class/net/eth0/carrier read: 8190 write: 0
825955 3364 (NetworkManager) iotime /sys/class/net/eth0/carrier time: 9
[...]
117061 2460 (pcscd) access /dev/bus/usb/003/001 read: 43 write: 0
117065 2460 (pcscd) iotime /dev/bus/usb/003/001 time: 7
[...]
3973737 2886 (sendmail) access /proc/loadavg read: 4096 write: 0
3973744 2886 (sendmail) iotime /proc/loadavg time: 11
[...]</pre></section><section class="section" id="proc_tracking-cumulative-i-o-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">44.3. Tracking cumulative I/O with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>traceio.stp</strong></span> SystemTap script to track the cumulative amount of I/O to the system.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
						Run the <span class="strong strong"><strong>traceio.stp</strong></span> script:
					</p><pre class="screen"># stap --example traceio.stp</pre><p class="simpara">
						The script prints the top ten executables generating I/O traffic 
over time. It also tracks the cumulative amount of I/O reads and writes 
done by those executables. This information is tracked and printed out 
in 1-second intervals, and in descending order.
					</p><p class="simpara">
						Output of the <code class="literal">traceio.stp</code> script looks similar to the following:
					</p></li></ul></div><pre class="screen">[...]
           Xorg r:   583401 KiB w:        0 KiB
       floaters r:       96 KiB w:     7130 KiB
multiload-apple r:      538 KiB w:      537 KiB
           sshd r:       71 KiB w:       72 KiB
pam_timestamp_c r:      138 KiB w:        0 KiB
        staprun r:       51 KiB w:       51 KiB
          snmpd r:       46 KiB w:        0 KiB
          pcscd r:       28 KiB w:        0 KiB
     irqbalance r:       27 KiB w:        4 KiB
          cupsd r:        4 KiB w:       18 KiB
           Xorg r:   588140 KiB w:        0 KiB
       floaters r:       97 KiB w:     7143 KiB
multiload-apple r:      543 KiB w:      542 KiB
           sshd r:       72 KiB w:       72 KiB
pam_timestamp_c r:      138 KiB w:        0 KiB
        staprun r:       51 KiB w:       51 KiB
          snmpd r:       46 KiB w:        0 KiB
          pcscd r:       28 KiB w:        0 KiB
     irqbalance r:       27 KiB w:        4 KiB
          cupsd r:        4 KiB w:       18 KiB</pre></section><section class="section" id="proc_monitoring-i-o-activity-on-a-specific-device-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">44.4. Monitoring I/O activity on a specific device with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>traceio2.stp</strong></span> SystemTap script to monitor I/O activity on a specific device.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Run the <span class="strong strong"><strong>traceio2.stp</strong></span> script.
					</li></ul></div><pre class="screen"># stap --example traceio2.stp <span class="emphasis"><em>'argument'</em></span></pre><p>
				This script takes the whole device number as an argument. To find this number you can use:
			</p><pre class="screen"># stat -c "0x%D" <span class="emphasis"><em>directory</em></span></pre><p>
				Where <span class="emphasis"><em>directory</em></span> is located on the device you want to monitor.
			</p><p>
				The output contains following:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The name and ID of any process performing a read or write
					</li><li class="listitem">
						The function it is performing (<code class="literal">vfs_read</code> or <code class="literal">vfs_write</code>)
					</li><li class="listitem">
						The kernel device number
					</li></ul></div><p>
				Consider following output of <code class="literal"># stap traceio2.stp 0x805</code>
			</p><pre class="screen">[...]
synergyc(3722) vfs_read 0x800005
synergyc(3722) vfs_read 0x800005
cupsd(2889) vfs_write 0x800005
cupsd(2889) vfs_write 0x800005
cupsd(2889) vfs_write 0x800005
[...]</pre></section><section class="section" id="proc_monitoring-reads-and-writes-to-a-file-with-systemtap_assembly_monitoring-disk-and-i-o-activity-with-systemtap"><div class="titlepage"><div><div><h2 class="title">44.5. Monitoring reads and writes to a file with SystemTap</h2></div></div></div><p class="_abstract _abstract">
				You can use the <span class="strong strong"><strong>inodewatch.stp</strong></span> SystemTap script to monitor reads from and writes to a file in real time.
			</p><div class="itemizedlist"><p class="title"><strong>Prerequisites</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						You have installed SystemTap as described in <a class="link" href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/monitoring_and_managing_system_status_and_performance/getting-started-with-systemtap_monitoring-and-managing-system-status-and-performance#installing-systemtap_getting-started-with-systemtap">Installing Systemtap</a>.
					</li></ul></div><div class="itemizedlist"><p class="title"><strong>Procedure</strong></p><ul class="itemizedlist" type="disc"><li class="listitem">
						Run the <code class="literal">inodewatch.stp</code> script.
					</li></ul></div><pre class="screen"># stap --example inodewatch.stp <span class="emphasis"><em>'argument1'</em></span> <span class="emphasis"><em>'argument2'</em></span> <span class="emphasis"><em>'argument3'</em></span></pre><p>
				The script <code class="literal">inodewatch.stp</code> takes three command-line arguments:
			</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">
						The file’s major device number.
					</li><li class="listitem">
						The file’s minor device number.
					</li><li class="listitem">
						The file’s inode number.
					</li></ol></div><p>
				You can get these numbers using:
			</p><pre class="screen"># stat -c '%D %i' <span class="emphasis"><em>filename</em></span></pre><p>
				Where <span class="emphasis"><em>filename</em></span> is an absolute path.
			</p><p>
				Consider following example:
			</p><pre class="screen"># stat -c '%D %i' /etc/crontab</pre><p>
				The output should look like:
			</p><pre class="screen">805 1078319</pre><p>
				where:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						<code class="literal">805</code> is the base-16 (hexadecimal) 
device number. The last two digits are the minor device number, and the 
remaining digits are the major number.
					</li><li class="listitem">
						<code class="literal">1078319</code> is the inode number.
					</li></ul></div><p>
				To start monitoring <code class="literal">/etc/crontab</code>, run:
			</p><pre class="screen"># stap inodewatch.stp 0x8 0x05 1078319</pre><p>
				In the first two arguments you must use 0x prefixes for base-16 numbers.
			</p><p>
				The output contains following:
			</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
						The name and ID of any process performing a read or write
					</li><li class="listitem">
						The function it is performing (<code class="literal">vfs_read</code> or <code class="literal">vfs_write</code>)
					</li><li class="listitem">
						The kernel device number
					</li></ul></div><p>
				The output of this example should look like:
			</p><pre class="screen">cat(16437) vfs_read 0x800005/1078319
cat(16437) vfs_read 0x800005/1078319</pre></section></section><div><div xml:lang="en-US" class="legalnotice" id="idm140611482534224"><h1 class="legalnotice">Legal Notice</h1><div class="para">
		Copyright <span class="trademark"><!--Empty--></span>© 2023 Red Hat, Inc.
	</div><div class="para">
		The text of and illustrations in this document are licensed by Red Hat
 under a Creative Commons Attribution–Share Alike 3.0 Unported license 
("CC-BY-SA"). An explanation of CC-BY-SA is available at <a class="uri" href="http://creativecommons.org/licenses/by-sa/3.0/">http://creativecommons.org/licenses/by-sa/3.0/</a>.
 In accordance with CC-BY-SA, if you distribute this document or an 
adaptation of it, you must provide the URL for the original version.
	</div><div class="para">
		Red Hat, as the licensor of this document, waives the right to 
enforce, and agrees not to assert, Section 4d of CC-BY-SA to the fullest
 extent permitted by applicable law.
	</div><div class="para">
		Red Hat, Red Hat Enterprise Linux, the Shadowman logo, the Red Hat 
logo, JBoss, OpenShift, Fedora, the Infinity logo, and RHCE are 
trademarks of Red Hat, Inc., registered in the United States and other 
countries.
	</div><div class="para">
		<span class="trademark">Linux</span>® is the registered trademark of Linus Torvalds in the United States and other countries.
	</div><div class="para">
		<span class="trademark">Java</span>® is a registered trademark of Oracle and/or its affiliates.
	</div><div class="para">
		<span class="trademark">XFS</span>® is a trademark of Silicon Graphics International Corp. or its subsidiaries in the United States and/or other countries.
	</div><div class="para">
		<span class="trademark">MySQL</span>® is a registered trademark of MySQL AB in the United States, the European Union and other countries.
	</div><div class="para">
		<span class="trademark">Node.js</span>® is an official trademark of 
Joyent. Red Hat is not formally related to or endorsed by the official 
Joyent Node.js open source or commercial project.
	</div><div class="para">
		The <span class="trademark">OpenStack</span>® Word Mark and OpenStack 
logo are either registered trademarks/service marks or 
trademarks/service marks of the OpenStack Foundation, in the United 
States and other countries and are used with the OpenStack Foundation's 
permission. We are not affiliated with, endorsed or sponsored by the 
OpenStack Foundation, or the OpenStack community.
	</div><div class="para">
		All other trademarks are the property of their respective owners.
	</div></div></div></div>


  <nav class="pvof-doc__book-nav">
  <ol class="book-nav__list">
              </ol>
</nav>


          </div>
              </div>
              <div id="comments-footer" class="book-comments">
          

  

        </div>
          </div>
  </article>
<meta itemscope="" itemref="md1">



    </div>
      <!-- CP_PRIMER_FOOTER -->            </div>
        </main>
    </div>
    <!--googleoff: all-->
    <div id="to-top"><a class="btn_slideto affix-top" href="#masthead" aria-label="Back to Top"><span class="web-icon-upload"></span></a></div>
    <footer class="footer-main">
        <div class="footer-top">
            <div class="container">

              <div class="brand">
                <a href="https://redhat.com/">
                  <svg class="rh-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 613 145">
                    <defs>
                      <style>
                        .rh-logo-hat {
                          fill: #e00;
                        }
                        .rh-logo-type {
                          fill: #fff;
                        }
                      </style>
                    </defs>
                    <title>Red Hat</title>
                    <path class="rh-logo-hat" d="M127.47,83.49c12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89,8.69,103.76.5,97.51.5,91.69.5,90,8,83.06,8c-6.68,0-11.64-5.6-17.89-5.6-6,0-9.91,4.09-12.93,12.5,0,0-8.41,23.72-9.49,27.16A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33C22.27,52,.5,55,.5,74.22c0,31.48,74.59,70.28,133.65,70.28,45.28,0,56.7-20.48,56.7-36.65,0-12.72-11-27.16-30.83-35.78"></path>
                      <path class="rh-logo-band" d="M160,72.07c1.73,8.19,1.73,9.05,1.73,10.13,0,14-15.74,21.77-36.43,21.77C78.54,104,37.58,76.6,37.58,58.49a18.45,18.45,0,0,1,1.51-7.33l3.66-9.06A6.43,6.43,0,0,0,42.53,44c0,9.22,36.3,39.45,84.94,39.45,12.51,0,30.61-2.58,30.61-17.46a14,14,0,0,0-.31-3.42Z"></path>
                      <path class="rh-logo-type" d="M579.74,92.8c0,11.89,7.15,17.67,20.19,17.67a52.11,52.11,0,0,0,11.89-1.68V95a24.84,24.84,0,0,1-7.68,1.16c-5.37,0-7.36-1.68-7.36-6.73V68.3h15.56V54.1H596.78v-18l-17,3.68V54.1H568.49V68.3h11.25Zm-53,.32c0-3.68,3.69-5.47,9.26-5.47a43.12,43.12,0,0,1,10.1,1.26v7.15a21.51,21.51,0,0,1-10.63,2.63c-5.46,0-8.73-2.1-8.73-5.57m5.2,17.56c6,0,10.84-1.26,15.36-4.31v3.37h16.82V74.08c0-13.56-9.14-21-24.39-21-8.52,0-16.94,2-26,6.1l6.1,12.52c6.52-2.74,12-4.42,16.83-4.42,7,0,10.62,2.73,10.62,8.31v2.73a49.53,49.53,0,0,0-12.62-1.58c-14.31,0-22.93,6-22.93,16.73,0,9.78,7.78,17.24,20.19,17.24m-92.44-.94h18.09V80.92h30.29v28.82H506V36.12H487.93V64.41H457.64V36.12H439.55ZM370.62,81.87c0-8,6.31-14.1,14.62-14.1A17.22,17.22,0,0,1,397,72.09V91.54A16.36,16.36,0,0,1,385.24,96c-8.2,0-14.62-6.1-14.62-14.09m26.61,27.87h16.83V32.44l-17,3.68V57.05a28.3,28.3,0,0,0-14.2-3.68c-16.19,0-28.92,12.51-28.92,28.5a28.25,28.25,0,0,0,28.4,28.6,25.12,25.12,0,0,0,14.93-4.83ZM320,67c5.36,0,9.88,3.47,11.67,8.83H308.47C310.15,70.3,314.36,67,320,67M291.33,82c0,16.2,13.25,28.82,30.28,28.82,9.36,0,16.2-2.53,23.25-8.42l-11.26-10c-2.63,2.74-6.52,4.21-11.14,4.21a14.39,14.39,0,0,1-13.68-8.83h39.65V83.55c0-17.67-11.88-30.39-28.08-30.39a28.57,28.57,0,0,0-29,28.81M262,51.58c6,0,9.36,3.78,9.36,8.31S268,68.2,262,68.2H244.11V51.58Zm-36,58.16h18.09V82.92h13.77l13.89,26.82H292l-16.2-29.45a22.27,22.27,0,0,0,13.88-20.72c0-13.25-10.41-23.45-26-23.45H226Z"></path>
                  </svg>
                </a>
              </div>

              <div role="navigation" aria-label="quick">
                  <h3>Quick Links</h3>
                  <ul>
                      <li><a class="download-software" href="https://access.redhat.com/downloads/">Downloads</a></li>
                      <li><a class="manage-subscriptions" href="https://access.redhat.com/management">Subscriptions</a></li>
                      <li><a class="support-cases" href="https://access.redhat.com/support">Support Cases</a></li>
                      <li><a class="customer-service" href="https://access.redhat.com/support/customer-service">Customer Service</a></li>
                      <li><a class="quick-docs" href="https://access.redhat.com/documentation">Product Documentation</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="help">
                  <h3>Help</h3>
                  <ul>
                      <li><a class="contact-us" href="https://access.redhat.com/support/contact/">Contact Us</a></li>
                      <li><a class="cp-faqs" href="https://access.redhat.com/articles/33844">Customer Portal FAQ</a></li>
                      <li><a class="login-problems" href="https://access.redhat.com/help/login_assistance">Log-in Assistance</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="site">
                  <h3>Site Info</h3>
                  <ul>
                      <li><a class="trust-red-hat" href="https://www.redhat.com/en/trust">Trust Red Hat</a></li>
                      <li><a class="browser-support-policy" href="https://www.redhat.com/en/about/browser-support">Browser Support Policy</a></li>
                      <li><a class="accessibility" href="https://www.redhat.com/en/about/digital-accessibility">Accessibility</a></li>
                      <li><a class="recognition" href="https://access.redhat.com/recognition/">Awards and Recognition</a></li>
                      <li><a class="colophon" href="https://access.redhat.com/help/colophon/">Colophon</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="other">
                  <h3>Related Sites</h3>
                  <ul>
                      <li><a href="https://www.redhat.com/" class="red-hat-com">redhat.com</a></li>
                      <li><a href="http://developers.redhat.com/" class="red-hat-developers">developers.redhat.com</a></li>
                      <li><a href="https://connect.redhat.com/" class="partner-connect">connect.redhat.com</a></li>
                      <li><a href="https://cloud.redhat.com/" class="cloud-com">cloud.redhat.com</a></li>
                  </ul>
              </div>

              <div role="navigation" aria-label="about">
                  <h3>About</h3>
                  <ul>
                      <li><a href="https://access.redhat.com/subscription-value" class="subscription-value">Red Hat Subscription Value</a></li>
                      <li><a href="https://www.redhat.com/about/" class="about-red-hat">About Red Hat</a></li>
                      <li><a href="http://jobs.redhat.com/" class="about-jobs">Red Hat Jobs</a></li>
                  </ul>
              </div>

            </div>
        </div>

        <div class="anchor">
            <div class="container">
                <div class="status-legal">
                    <a href="https://status.redhat.com/" class="status-page-widget">
                        <span class="status-description">All systems operational</span>
                        <span class="status-dot shape-circle shape-dash-lime"></span>
                    </a>
                    <div class="legal-copyright">
                        <div class="copyright">Copyright © 2023 Red Hat, Inc.</div>

                        <div role="navigation" aria-label="legal" class="legal">
                            <ul>
                                <li><a href="http://www.redhat.com/en/about/privacy-policy" class="privacy-policy">Privacy Statement</a></li>
                                <li><a href="https://www.redhat.com/en/about/terms-use" class="terms-of-use">Terms of Use</a></li>
                                <li><a href="http://www.redhat.com/en/about/all-policies-guidelines" class="all-policies">All Policies and Guidelines</a></li>
                                <li><a id="teconsent" consent="0,1,2"><a role="link" id="icon-id09945220940590842" tabindex="0" aria-haspopup="dialog" aria-label="Cookie Preferences, opens a dedicated popup modal window" class="truste_cursor_pointer" lang="en">Cookie preferences</a></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="social">
                    <a href="http://www.redhat.com/summit/" class="summit">
                        <img src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/rh-summit-red-a.svg" alt="Red Hat Summit"> <span class="offscreen">Red Hat Summit</span>
                    </a>

                    <div class="social-media">
                        <a href="https://twitter.com/RedHat" class="sm-icon twitter"><span class="nicon-twitter"></span><span class="offscreen">Twitter</span></a>                        
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- TrustArc -->
    <div id="consent_blackbar"></div> 
    <!--googleon: all-->
</div>
<!-- /CP_PRIMER_FOOTER -->


  </div>

    
  

<script>_satellite["_runScript2"](function(event, target, Promise) {
window._sdi=window._sdi||{},window._sdi.addEventHandler=window.addEventListener?function(e,i,t){e.addEventListener(i,t,!1)}:function(e,i,t){e.attachEvent("on"+i,t)},window._sdi.addEventHandler(window,"message",(function(e){var i={},t=0;(-1!==e.origin.indexOf("loop=1")||e.srcElement&&e.srcElement.playerOptions&&1==e.srcElement.playerOptions.loop)&&(t=1);var a=0;if(e.srcElement&&e.srcElement.playerOptions&&1==e.srcElement.playerOptions.autoplay&&(a=1),e.origin.match(/youtube\.com/)&&"undefined"!=typeof JSON&&!t&&!a){i=JSON.parse(e.data);var n=window._sdi.yt.videos;if("infoDelivery"==i.event){var d,o={};for(var r in i.info.videoData&&((o=n[d=i.info.videoData.video_id]||{}).info=i.info,o.id=i.id,n[d]=o),window._sdi.yt.videos){(c=window._sdi.yt.videos[r]).id==i.id&&(o=c)}var s=window._sdi.yt.sc||{};o.info&&(Math.abs(i.info.currentTime-o.info.currentTime)>1.5&&!0===s.track&&(s.s().Media.stop(o.info.videoData.title,o.info.currentTime),"paused"!=o.state&&s.s().Media.play(o.info.videoData.title,i.info.currentTime)),o.info.currentTime=i.info.currentTime),2==i.info.playerState&&(s.s().Media.stop(o.info.videoData.title,o.info.currentTime),o.state="paused"),1==i.info.playerState&&(o.started?!0===s.track&&s.s().Media.play(o.info.videoData.title,o.info.currentTime):(o.started=!0,!0===s.track&&(s.s().Media.open(o.info.videoData.title,o.info.duration,"youtube"),s.s().Media.play(o.info.videoData.title,o.info.currentTime))),o.state="playing"),3==i.info.playerState&&o.started&&(!0===s.track&&s.s().Media.stop(o.info.videoData.title,o.info.currentTime),o.state="paused"),0===i.info.playerState&&(!0===s.track&&(s.s().Media.stop(o.info.videoData.title,o.info.currentTime),s.s().Media.close(o.info.videoData.title)),o.state="completed")}else if("onStateChange"==i.event){for(var r in window._sdi.yt.videos){var c;(c=window._sdi.yt.videos[r]).id==i.id&&(o=c)}s=window._sdi.yt.sc||{};1==i.info&&(o.started?!0===s.track&&s.s().Media.play(o.info.videoData.title,o.info.currentTime):(o.started=!0,!0===s.track&&(s.s().Media.open(o.info.videoData.title,o.info.duration,"youtube"),"paused"!=o.state&&s.s().Media.play(o.info.videoData.title,i.info.currentTime))),o.state="playing"),2==i.info&&(!0===s.track&&s.s().Media.stop(o.info.videoData.title,o.info.currentTime),o.state="paused"),3==i.info&&o.started&&(!0===s.track&&s.s().Media.stop(o.info.videoData.title,o.info.currentTime),o.state="paused"),0===i.info&&(!0===s.track&&(s.s().Media.stop(o.info.videoData.title,o.info.currentTime),s.s().Media.close(o.info.videoData.title)),o.state="completed")}}})),window._sdi.loadScript=function(e,i){var t=document.createElement("script");t.type="text/javascript",i&&"function"==typeof i&&(t.readyState?t.onreadystatechange=function(){"loaded"!==t.readyState&&"complete"!==t.readyState||(t.onreadystatechange=null,i())}:t.onload=function(){i()}),t.src=e,document.getElementsByTagName("head")[0].appendChild(t)},window._sdi.yt={stages:{},players:{},sc:{track:!0,s:function(){return window.s}},init:function(){for(var e=document.getElementsByTagName("script"),i=!1,t=(window._sdi.yt.videos,0);t<e.length;t++){(e[t].src||"").match(/youtube\.com\/iframe_api/)&&(i=!0)}!1===i?window._sdi.loadScript("//www.youtube.com/iframe_api",(function(){window._sdi.yt.ready("api")})):window._sdi.yt.ready("api")},ready:function(e){window._sdi.yt.stages[e]=!0,window._sdi.yt.stages.dom&&window._sdi.yt.stages.api&&window._sdi.yt.checkIframes()},checkIframes:function(){var e=window._sdi.yt.videos,i=1e3,t=0;document.querySelectorAll("iframe[src*=youtube][data-sdiyt]").forEach((a=>{if("true"==a.dataset.sdiyt)return!1;if(-1!=a.src.indexOf("loop=1"))var n=null;else{var d;n=a.src.match(/h?t?t?p?s?\:?\/\/www\.youtube(-nocookie)?\.com\/embed\/([\w-]{11})(?:\?.*)?/)}if(n){d=n.length>2?n[2]:"",a.id||(a.id=d+t,t++);var o=!1;if(a.src.match(/enablejsapi=1/)||(a.src+=(a.src.indexOf("?")>-1?"&":"?")+"enablejsapi=1",o=!0),o){var r=a.cloneNode(!0);r.src=a.src,r.id=a.id,a.replaceWith(r)}else"undefined"!=typeof YT&&void 0!==YT.get?(ready=!0,e[d]={},(!YT.get(a.id)||void 0===YT.get(a.id).v&&void 0!==YT.get(a.id).v.videoId)&&(e[d].player=new YT.Player(a.id,{events:{onReady:function(){},onStateChange:function(){},videoId:a.id}})),a.setAttribute("data-sdiyt","true")):i=100}})),setTimeout((function(){window._sdi.yt.checkIframes()}),i)},videos:{}},void 0!==window._sdi&&void 0!==window._sdi.addEventHandler&&window._sdi.addEventHandler(window,"load",(function(){document.querySelectorAll('iframe[src*="youtube"]').length>=1?(window._sdi.yt.init(),window._sdi.yt.ready("dom")):window._sdi.ytinterval=setInterval((function(){document.querySelectorAll('iframe[src*="youtube"]').length>=1&&(window._sdi.yt.init(),window._sdi.yt.ready("dom"),clearInterval(window._sdi.ytinterval))}),500)}));
});</script><script>_satellite["_runScript3"](function(event, target, Promise) {
var dataLayerName="appEventData",reservedAttributes=["event"],internalDomains=[],downloadExtensions=["doc","docx","eps","jpg","png","svg","xls","ppt","pptx","pdf","xlsx","tab","csv","zip","txt","vsd","vxd","xml","js","css","rar","exe","wma","mov","avi","wmv","mp3","wav","m4v"],parseAttributes=function(t){var e={};for(var n in t.dataset)if("analytics"===n.substr(0,9)){var a=n.replace("analytics","");e[a[0]?a[0].toLocaleLowerCase()+a.slice(1):""]=t.dataset[n]}return e},addAttributes=function(t,e){return isJavascript(t)&&(e.isJavascript=!0),isDownload(t)&&(e.isDownload=!0),isCrossPropertyDomain(t)&&(e.isCrossPropertyDomain=!0,e.linkTypeName="cross property link"),isCta(t)&&(e.isCta=!0,e.linkTypeName="cta link"),isExitLink(t)&&(e.isExitLink=!0,e.linkTypeName="exit link"),isFooter(t)&&(e.isFooter=!0),isInternalCampaign(t)&&(e.isInternalCampaign=!0),isPromoSection(t)&&(e.isPromoSection=!0),isSearchContainer(t)&&(e.isSearchContainer=!0),e.targetHost=getHostName(t.href),e.internalCampaign=window._sdi.util.getQueryParam("icid",t.href)||window._sdi.util.getQueryParam("intcmp",t.href),e},getLinkText=function(t){return t.getAttribute("data-analytics-text")||t.getAttribute("sObjectId")||t.getAttribute("s-object-id")||t.getAttribute("sObjectID")||t.getAttribute("data-s-object-id")||t.innerText&&""!==t.innerText.trim()&&t.innerText.trim()||t.textContent&&""!==t.textContent.trim()&&t.textContent.trim()||t.querySelector("[alt]")&&t.querySelector("[alt]").getAttribute("alt")||t.querySelector("[title]")&&t.querySelector("[title]").getAttribute("title")||t.getAttribute("aria-label")||t.href||"unknown"},getRegions=function(t,e){if(e=e||[],!t)return e;var n=t.closest("[data-analytics-region]");return n?(e.push(n.dataset.analyticsRegion),e=getRegions(n.parentElement,e)):e},removeReservedAttributes=function(t){return reservedAttributes.forEach((function(e){delete t[e]})),t},redactEmail=function(t){return t.replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}/gi,"email_address_redacted")},buildDataObject=function(t,e,n){return n=n||getRegions(t),{event:buildEventName(t,e,n),linkInfo:Object.assign({href:t.href,regions:n.reverse().join("|"),text:redactEmail(getLinkText(t))},removeReservedAttributes(e))}},buildEventName=function(t,e,n){if(e.event)return e.event;var a={};if(n=n||getRegions(t))for(var i=0;i<n.length;i++)if(a[n[i]])return a[n[i]];return"Master Link Clicked"},findRootElement=function(t){if(t)return t.closest("a, [data-analytics-event]")},isJavascript=function(t){return new RegExp("^javascript:","i").test(t.href)},isDownload=function(t){return new RegExp(".("+downloadExtensions.join("|")+")$","i").test(t.href)},isInternalDomain=function(t){return new RegExp(internalDomains.join("|"),"i").test(t.href)},isExitLink=function(t){return!!t.href&&!new RegExp(_satellite.getVar("exitExclusionArray").join("|"),"i").test(t.href)},isCrossPropertyDomain=function(t){return document.location.hostname!==getHostName(t.href)&&"access.cdn.redhat.com"!==getHostName(t.href)&&new RegExp(_satellite.getVar("redHatDomains").join("|"),"i").test(getHostName(t.href))},isCta=function(t){return!(!t.classList.contains("cta-primary")&&"primary"!=t.getAttribute("data-rh-cta-type")&&"primary"!=t.getAttribute("data-ux-cta-type"))},isTab=function(t){return!!(t.classList.contains('[data-toggle="tab"]')||t.classList.contains("pfe-accordion-header")||t.classList.contains('[role="tab"]')||t.classList.contains("ux-vtab-nav-link")||t.classList.contains("ux-tile-nav-link")||t.classList.contains("btn-brick")||t.classList.contains("ux-htab-nav-link")||t.classList.contains("ux-horizontal-tab-nav-link")||t.classList.contains("ux-oss-hub-filter-type-text")||t.classList.contains("ux-htabb-nav-link")||"tab"==t.getAttribute("data-toggle")||"PFE-ACCORDION-HEADER"==t.tagName||"tab"==t.getAttribute("role"))},isFooter=function(t){return el=t.closest("footer"),"undefined"!=typeof el&&null!=el},isInternalCampaign=function(t){return(""!=window._sdi.util.getQueryParam("icid",t.href)||""!=window._sdi.util.getQueryParam("intcmp",t.href))&&(linkRole=t.getAttribute("role")||"",_satellite.logger.log("isInternalCampaign: linkRole:",linkRole),"tab"!==linkRole||void 0)},isPromoSection=function(t){return el=t.closest("div.band-hero"),"undefined"!=typeof el&&null!=el},isSearchContainer=function(t){return _satellite.logger.log("isSearchContainer ran"),el=t.closest("div.cp-sidebar")||t.closest("div.cp-search-results"),_satellite.logger.log("isSearchContainer el",el),_satellite.logger.log("isSearchContainer return","undefined"!=typeof el&&null!=el&&document.location.href.indexOf("search")>-1),"undefined"!=typeof el&&null!=el&&document.location.href.indexOf("search")>-1},getHostName=function(e){return t=document.createElement("a"),t.href=e,t.hostname},pushEvent=function(t){window.appEventData=window.appEventData||[],console.info("Pushing to the dataLayer",t);var e=window[dataLayerName];Array.isArray(e)&&e.push(t)};window.analyticsHelper=window.analyticsHelper||{},window.analyticsHelper.parseCustomEvent=function(t,e,n){_satellite.logger.log("target:",t);var a=parseAttributes(t),i=null,r=getRegions(t);if(e)i=e.closest("[data-analytics-region]");else{var s=t.getRootNode();s&&s.host&&(i=t.getRootNode().host.closest("[data-analytics-region]"))}i&&(r=r.concat(getRegions(i))),"expand"===n&&r.includes("mega menu")&&(a.event="Mega Menu Expanded"),"expand"===n&&r.includes("site-switcher")&&(a.event="Site Switcher Expanded"),"true"!==a.istab&&"true"!==a.isTab||(a.event="Tab Link Clicked",tabHref=t.getAttribute("href")||getLinkText(t)||"",tabHref=tabHref.trim(),a.tabHref=tabHref),_satellite.logger.log("attributes",a),_satellite.logger.log("event type",n),_satellite.logger.log("regions",r),a=addAttributes(t,a);var o=buildDataObject(t,a,r);o.event&&pushEvent(o)};var clickHandler=function(t){if(!(t.target&&t.target.tagName&&t.target.tagName.indexOf("-")>0)){var e=findRootElement(t.target);if(e){var n=parseAttributes(e);isTab(e)&&(n.event="Tab Link Clicked",tabHref=e.getAttribute("href")||getLinkText(e)||"",tabHref=tabHref.trim(),n.tabHref=tabHref),n=addAttributes(e,n);var a=buildDataObject(e,n);a.event&&pushEvent(a)}}};document.addEventListener("click",clickHandler,!0),document.addEventListener("pfe-tabs:shown-tab",(function(t){if(window.analyticsHelper&&"function"==typeof window.analyticsHelper.parseCustomEvent){var e=t.target.closest("pfe-content-set")||t.target.closest("pfe-tabs"),n=null;if(e){if("PFE-CONTENT-SET"===e.tagName){var a=t.detail.tab.querySelector("slot");if(a)(n=e.getSlot(a.getAttribute("name")))&&(n=e.getSlot(t.detail.tab.querySelector("slot").getAttribute("name"))[0])}else n=t.detail.tab;n?(n.setAttribute("data-analytics-isTab","true"),_satellite.logger.info("Called pfe-tabs:shown-tab:parseCustomEvent clicked"),window.analyticsHelper.parseCustomEvent(n,e,"clicked")):console.warn("Wasn't able to find the tabTextWrapper")}else console.warn("Wasn't able to find the componentParent")}})),document.addEventListener("pfe-accordion:change",(function(t){if(window.analyticsHelper&&"function"==typeof window.analyticsHelper.parseCustomEvent){var e=t.target.closest("pfe-content-set")||t.target.closest("pfe-accordion");if(t.detail.expanded){var n="PFE-ACCORDION-HEADER"===t.target.tagName?t.target:t.path[0];if(e&&"PFE-CONTENT-SET"===e.tagName){var a=n.querySelector("slot");if(a){var i=e.getSlot(a.getAttribute("name"));i&&i[0]&&(n=i[0])}}n&&n.setAttribute("data-analytics-isTab","true"),_satellite.logger.info("Called pfe-accordion:change:parseCustomEvent expand"),window.analyticsHelper.parseCustomEvent(n,e,"expand")}}})),document.addEventListener("pfe-shadow-dom-event",(function(t){window.analyticsHelper&&"function"==typeof window.analyticsHelper.parseCustomEvent&&window.analyticsHelper.parseCustomEvent(t.detail.target,t.detail.parentComponent,"click")})),document.addEventListener("pfe-navigation:expanded-item",(function(t){window.analyticsHelper&&"function"==typeof window.analyticsHelper.parseCustomEvent&&window.analyticsHelper.parseCustomEvent(t.detail.toggle,t.target,"expand")}));
});</script><div id="ZN_bCxD2jjWRr4bfVQ"></div><script type="text/javascript" src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/Untitled.js"></script><script src="Monitoring%20and%20managing%20system%20status%20and%20performance%20Red%20Hat%20Enterprise%20Linux%209%20Red%20Hat%20Customer%20Portal_files/CoreModule.js" defer="defer"></script><script>_satellite["_runScript4"](function(event, target, Promise) {
_satellite.getVar("eloqua_Tag");
});</script><script>_satellite["_runScript5"](function(event, target, Promise) {
var body=document.body,html=document.documentElement,pageHeight=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight),viewportHeight=window.innerHeight,initialPercent=viewportHeight/pageHeight,maxInterval=0;initialPercent=initialPercent>1?100:Math.round(100*initialPercent);var maxScroll=Math.floor(initialPercent);_satellite.cookie.set("sat_ppv",maxScroll,{domain:".redhat.com"});var ticking=!1,s=window.scrollY;document.addEventListener("scroll",(()=>{ticking||(window.requestAnimationFrame((()=>{var t=document.body,e=document.documentElement;s=window.scrollY;var i=Math.max(t.scrollHeight,t.offsetHeight,e.clientHeight,e.scrollHeight,e.offsetHeight),o=window.innerHeight,l=s/(i-o)*100;l>maxScroll&&(maxScroll=Math.floor(l)),_satellite.cookie.set("sat_ppv",maxScroll,{domain:".redhat.com"}),ticking=!1})),ticking=!0)}),{passive:!0});
});</script><script>
if("yes"==_satellite.getVar("tagsAllowedFunc")){var profileID=_satellite.getVar("profileID")||"";if(profileID)try{!function(e){!function(t,n,i,a,o){var c,l,r,f,s;for((o=t[a]=t[a]||{})._q=[],l=0,r=(c=["initialize","identify","updateOptions","pageLoad"]).length;l<r;++l)!function(e){o[e]=o[e]||function(){o._q[e===c[0]?"unshift":"push"]([e].concat([].slice.call(arguments,0)))}}(c[l]);(f=n.createElement(i)).async=!0,f.src="https://cdn.pendo.io/agent/static/"+e+"/pendo.js",(s=n.getElementsByTagName(i)[0]).parentNode.insertBefore(f,s)}(window,document,"script","pendo"),setTimeout((function(){"undefined"!=typeof pendo&&pendo.initialize({visitor:{id:_satellite.getVar("profileID"),internal:"",lang:""},account:{id:_satellite.getVar("accountID"),account_number:_satellite.getVar("accountID")}})}),2e3)}("f210c485-387f-43ad-4eee-f55bab22507f")}catch(e){}}
</script></body></html>